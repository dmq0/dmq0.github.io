{
    "version": "https://jsonfeed.org/version/1",
    "title": "杜明清的个人博客",
    "subtitle": "",
    "icon": "https://dmqweb.cn/images/favicon.ico",
    "description": "",
    "home_page_url": "https://dmqweb.cn",
    "items": [
        {
            "id": "https://dmqweb.cn/2024/05/02/HTTP/",
            "url": "https://dmqweb.cn/2024/05/02/HTTP/",
            "title": "HTTP",
            "date_published": "2024-05-01T18:24:04.000Z",
            "content_html": "<h1 id=\"目录\"><a class=\"anchor\" href=\"#目录\">#</a> #目录</h1>\n<blockquote>\n<p>[TOC]</p>\n</blockquote>\n<h1 id=\"浅学浏览器工作原理\"><a class=\"anchor\" href=\"#浅学浏览器工作原理\">#</a> 浅学浏览器工作原理</h1>\n<h1 id=\"一-浏览器工作流程概览\"><a class=\"anchor\" href=\"#一-浏览器工作流程概览\">#</a> 一、<strong>浏览器工作流程</strong>概览</h1>\n<blockquote>\n<p>・浏览器首先使用 HTTP 协议或者 HTTPS 协议，向服务端请求页面；</p>\n<p>・把请求回来的 HTML 代码经过解析，构建成 DOM 树；</p>\n<p>・计算 DOM 树上的 CSS 属性；</p>\n<p>・根据 CSS 属性对元素逐个进行渲染，得到内存中的 <code>位图</code> ①；</p>\n<p>・一个可选的步骤是对位图进行合成，这会极大地增加后续绘制的速度；</p>\n<p>・合成之后，再绘制到界面上。</p>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20210621175650437.png\" alt=\"该图来自视频课程截图\" /></p>\n</blockquote>\n<h3 id=\"位图\"><a class=\"anchor\" href=\"#位图\">#</a> 位图</h3>\n<blockquote>\n<p>位图，又称为点阵图像、像素图或栅格图像，是由像素（图片元素）的单个点组成。这些点可以进行不同的排列和染色以构成图样。</p>\n<p>位图的单位：像素（Pixel）</p>\n</blockquote>\n<h1 id=\"二-http协议底层原理概览\"><a class=\"anchor\" href=\"#二-http协议底层原理概览\">#</a> 二、HTTP 协议底层原理概览</h1>\n<blockquote>\n<p>Http 是基于 Tcp 协议基础上出现的，HTTP 在 Tcp 基础上规定了 Request 与 Response</p>\n<p>http1 标准:</p>\n<ul>\n<li>HTTP1.1 <span class=\"exturl\" data-url=\"aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzI2MTY=\">https://tools.ietf.org/html/rfc2616</span></li>\n<li>HTTP1.1 <span class=\"exturl\" data-url=\"aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzcyMzQ=\">https://tools.ietf.org/html/rfc7234</span></li>\n</ul>\n<p>http2 标准: <span class=\"exturl\" data-url=\"aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzI4MTg=\">https://tools.ietf.org/html/rfc2818</span></p>\n<p>HTTPS 标准: <span class=\"exturl\" data-url=\"aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzI4MTg=\">https://tools.ietf.org/html/rfc2818</span></p>\n</blockquote>\n<h2 id=\"1http请求是一种规则无状态无记忆\"><a class=\"anchor\" href=\"#1http请求是一种规则无状态无记忆\">#</a> 1.HTTP 请求：是一种规则，无状态，无记忆：</h2>\n<h3 id=\"i-http请求过程\"><a class=\"anchor\" href=\"#i-http请求过程\">#</a> Ⅰ- HTTP 请求过程</h3>\n<blockquote>\n<p>（1）建立 TCP 连接</p>\n<p>（2）web 浏览器向 web 服务器发送请求指令</p>\n<p>（3）web 浏览器发送请求头信息</p>\n<p>（4）web 服务器应答</p>\n<p>（5）web 服务器发送应答头信息</p>\n<p>（6）web 服务器向浏览器发送数据</p>\n<p>（7）web 服务器关闭 TCP 连接</p>\n</blockquote>\n<h3 id=\"ii-http请求的四个组成部分\"><a class=\"anchor\" href=\"#ii-http请求的四个组成部分\">#</a> Ⅱ- HTTP 请求的四个组成部分：</h3>\n<blockquote>\n<p>a、HTTP 请求方法或者动作 (GET/POST)</p>\n<p>b、正在请求的 URL</p>\n<p>c、请求头，包含客户环境信息、身份信息等</p>\n<p>d、请求体（正文），包含客户提交的查询字符串信息、表单信息</p>\n</blockquote>\n<h3 id=\"iii-http响应的三个组成部分\"><a class=\"anchor\" href=\"#iii-http响应的三个组成部分\">#</a> Ⅲ- HTTP 响应的三个组成部分：</h3>\n<blockquote>\n<p>a、一个数字和文字组成的转态码。作用：显示请求是否成功</p>\n<p>b、响应头，包含服务器类型、日期、内容类型、长度等</p>\n<p>c、响应体，即响应正文，字符串、HTML 等</p>\n</blockquote>\n<h2 id=\"2-http-协议格式\"><a class=\"anchor\" href=\"#2-http-协议格式\">#</a> 2、<strong>HTTP</strong> <strong>协议格式</strong></h2>\n<blockquote>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20210622195949961.png\" alt=\"image-20210622195949961\" /></p>\n</blockquote>\n<h3 id=\"i-http-method\"><a class=\"anchor\" href=\"#i-http-method\">#</a> Ⅰ- <strong>HTTP Method</strong></h3>\n<blockquote>\n<p>GET POST  HEAD PUT  DELETE CONNECT   <code>OPTIONS TRACE(通常这两种是调试时才使用的)</code></p>\n</blockquote>\n<h3 id=\"ii-http-status-code\"><a class=\"anchor\" href=\"#ii-http-status-code\">#</a> Ⅱ- <strong>HTTP Status code</strong></h3>\n<blockquote>\n<p>・1xx：临时回应，表示客户端请继续。</p>\n<p>・2xx：请求成功。 =&gt; 表示用户请求被正确接收、理解和处理，如 200</p>\n<p>・3xx: 表示请求的目标有变化，希望客户端进一步处理。 =&gt; 做定向使用  如 nginx 请求转发 再如 303 前端使用重定向</p>\n<p>・4xx：客户端请求错误。</p>\n<p>・5xx：服务端请求错误。</p>\n</blockquote>\n<h3 id=\"iii-http-head\"><a class=\"anchor\" href=\"#iii-http-head\">#</a> Ⅲ- <strong>HTTP Head</strong></h3>\n<h4 id=\"1-request-header\"><a class=\"anchor\" href=\"#1-request-header\">#</a> ① <em>Request Header</em></h4>\n<blockquote>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20210622202103234.png\" alt=\"image-20210622202103234\" /></p>\n</blockquote>\n<h4 id=\"2-response-header\"><a class=\"anchor\" href=\"#2-response-header\">#</a> ② <em>Response Header</em></h4>\n<blockquote>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20210622202158322.png\" alt=\"image-20210622202158322\" /></p>\n</blockquote>\n<h4 id=\"3-http-request-body\"><a class=\"anchor\" href=\"#3-http-request-body\">#</a> ③ <em><strong>HTTP Request Body</strong></em></h4>\n<blockquote>\n<p>・application/json \t\t\t\t  --&gt; 最常用的 json 格式</p>\n<p>・application/x-www-form-urlencoded  --&gt; 常用的 from 表单提交格式</p>\n<p>・multipart/form-data   \t\t\t --&gt; 常用的文件上传格式</p>\n<p>・text/xml               \t\t\t--&gt; 常用 xml 文件格式</p>\n</blockquote>\n<h4 id=\"4-http-head\"><a class=\"anchor\" href=\"#4-http-head\">#</a> ④ <em>HTTP head</em></h4>\n<blockquote>\n<p>略</p>\n</blockquote>\n<h2 id=\"3-osi模型图\"><a class=\"anchor\" href=\"#3-osi模型图\">#</a> 3、OSI 模型图</h2>\n<blockquote>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20210622203341816.png\" alt=\"\" /></p>\n</blockquote>\n<h2 id=\"4-数据传输简单基础原理服务端浏览器postget\"><a class=\"anchor\" href=\"#4-数据传输简单基础原理服务端浏览器postget\">#</a> 4、数据传输简单基础原理 =&gt;(服务端，浏览器，POST,GET)</h2>\n<blockquote>\n<h5 id=\"1-浏览器访问原理\"><a class=\"anchor\" href=\"#1-浏览器访问原理\">#</a> 1. 浏览器访问原理 =&gt;</h5>\n<ul>\n<li><code>协议=&gt;ip=&gt;端口=&gt;uri</code></li>\n</ul>\n<h5 id=\"2-服务端前端数据传输过程\"><a class=\"anchor\" href=\"#2-服务端前端数据传输过程\">#</a> 2. 服务端 (前端) 数据传输过程 =&gt;</h5>\n<ul>\n<li><code>控制层=&gt;逻辑层=&gt;数据层=&gt;后端(数据持久层)</code></li>\n</ul>\n<h5 id=\"3-get与post区别\"><a class=\"anchor\" href=\"#3-get与post区别\">#</a> 3. GET 与 POST 区别:=&gt;</h5>\n<ul>\n<li>GET 是进行明文传递，POST 非明文请求数据放在请求体中</li>\n</ul>\n</blockquote>\n<h2 id=\"5-请求响应与跨域概念\"><a class=\"anchor\" href=\"#5-请求响应与跨域概念\">#</a> 5、请求响应与跨域概念</h2>\n<blockquote>\n<h5 id=\"1reqrequest请求对象\"><a class=\"anchor\" href=\"#1reqrequest请求对象\">#</a> 1.req:request（请求对象）=&gt;</h5>\n<ul>\n<li>\n<pre><code>代表,所有跟请求有关的东西都在req对象里头,包括请求参数 请求头 请求头 cookie\n</code></pre>\n</li>\n</ul>\n<h5 id=\"2resresponse响应对象\"><a class=\"anchor\" href=\"#2resresponse响应对象\">#</a> 2.res:response（响应对象）=&gt;</h5>\n<ul>\n<li>所有响应客户端的东西都在 res 里头，包括相应参数，响应头 (跨域处理就是在这)</li>\n</ul>\n<h5 id=\"3跨域请求的本质与原理\"><a class=\"anchor\" href=\"#3跨域请求的本质与原理\">#</a> 3. 跨域请求的本质与原理 =&gt;</h5>\n<ul>\n<li>\n<p>当一个请求 url 的协议、域名、端口三者之间任意一个与当前页面 url 不同即为跨域</p>\n</li>\n<li>\n<p>请求本质是成功的，但是浏览器判断本次请求不安全</p>\n</li>\n</ul>\n</blockquote>\n<h1 id=\"目录-2\"><a class=\"anchor\" href=\"#目录-2\">#</a> #目录</h1>\n<blockquote>\n<p>[TOC]</p>\n</blockquote>\n<h1 id=\"从url输入到页面展现这中间发生了什么\"><a class=\"anchor\" href=\"#从url输入到页面展现这中间发生了什么\">#</a> 从 URL 输入到页面展现，这中间发生了什么？</h1>\n<blockquote>\n<p>完整流程图<img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20210623183143882.png\" alt=\"image-20210623183143882\" /></p>\n<p>总体来说分为以下几个过程：</p>\n<ul>\n<li>DNS 解析：将域名解析成 IP 地址</li>\n<li>TCP 连接：TCP 三次握手</li>\n<li>发送 HTTP 请求</li>\n<li>服务器处理请求并返回 HTTP 报文</li>\n<li>浏览器解析渲染页面</li>\n<li>断开连接：TCP 四次挥手</li>\n</ul>\n</blockquote>\n<h2 id=\"一-什么是url\"><a class=\"anchor\" href=\"#一-什么是url\">#</a> 一、什么是 URL？</h2>\n<p>URL（Uniform Resource Locator），统一资源定位符，用于定位互联网上资源，俗称网址。</p>\n<p><strong> <code>scheme</code> : //  <code>host</code> . <code>domain</code> : <code>port</code>  /  <code>path</code>  / <code>filename</code>  ? <code> query</code>  #  <code>fragment</code> </strong></p>\n<blockquote>\n<ul>\n<li>scheme       - 定义因特网服务的类型。常见的协议有 http、https、ftp、file - 其中最常见的类型是 http，而 https 则是进行加密的网络传输。</li>\n<li>host         - 定义域主机（http 的默认主机是 www）</li>\n<li>domain       - 定义因特网域名，比如 <span class=\"exturl\" data-url=\"aHR0cDovL2JhaWR1LmNvbQ==\">baidu.com</span></li>\n<li>port         - 定义主机上的端口号（http 的默认端口号是 80）</li>\n<li>path         - 定义服务器上的路径（如缺省则文档必须位于网站的根目录中）。</li>\n<li>filename     - 定义文档 / 资源的名称  (如缺省文件必须位于前面 <code>path</code>  后的根目录中)</li>\n<li>query        - 即？后的查询参数  <code>可以缺省</code></li>\n<li>fragment     - 即 # 后的 hash 值，一般用来定位到某个位置   <code>可以缺省</code></li>\n</ul>\n<p>举个栗子:</p>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20210623184854722.png\" alt=\"image-20210623184854722\" /></p>\n</blockquote>\n<h2 id=\"二-dns域名解析\"><a class=\"anchor\" href=\"#二-dns域名解析\">#</a> 二、DNS 域名解析</h2>\n<blockquote>\n<p>在浏览器输入网址后，首先要经过域名解析，因为浏览器并不能直接通过域名找到对应的服务器，而是要通过 IP 地址</p>\n</blockquote>\n<h3 id=\"1-ip地址是什么\"><a class=\"anchor\" href=\"#1-ip地址是什么\">#</a> 1、IP 地址是什么？</h3>\n<blockquote>\n<p>IP 地址是指互联网协议地址，是 IP Address 的缩写。IP 地址是 IP 协议提供的一种统一的地址格式，它为互联网上的每一个网络和每一台主机分配一个逻辑地址，以此来屏蔽物理地址的差异。</p>\n</blockquote>\n<h3 id=\"2-域名是什么\"><a class=\"anchor\" href=\"#2-域名是什么\">#</a> 2、域名是什么？</h3>\n<blockquote>\n<p><code>域名就相当于 IP 地址乔装打扮的伪装者，带着一副面具。它的作用就是便于记忆和沟通的一组服务器的地址</code> 。用户通常使用主机名或域名来访问对方的计算机，而不是直接通过 IP 地址访问。因为与 IP 地址的一组纯数字相比，用字母配合数字的表示形式来指定计算机名更符合人类的记忆习惯。但要让计算机去理解名称，相对而言就变得困难了。因为计算机更擅长处理一长串数字。为了解决上述的问题，DNS 服务应运而生</p>\n<p>举个栗子:<a href=\"https://gitee.com/hongjilin\"> <code>47.100.xxx.xxx.xx:80/hongjilin</code> </a>===<a href=\"https://gitee.com/hongjilin\"> <code>gitee.com/hongjilin</code> </a>, 对于我们肯定是<a href=\"https://gitee.com/hongjilin\"> <code>gitee.com/hongjilin</code> </a> 更便于记忆，而对计算机而言更擅长前者</p>\n</blockquote>\n<h3 id=\"3-什么是域名解析\"><a class=\"anchor\" href=\"#3-什么是域名解析\">#</a> 3、什么是域名解析？</h3>\n<blockquote>\n<p>DNS 协议提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务。<strong> <code>DNS 是一个网络服务器，我们的域名解析简单来说就是在 DNS 上记录一条信息记录</code> </strong></p>\n<p>举个栗子  <code>baidu.com</code>  <mark>解析</mark> &gt;  <code>220.114.23.56(服务器外网IP地址)80(服务器端口)</code></p>\n</blockquote>\n<h3 id=\"4-浏览器如何通过域名去查询-url-对应的-ip-呢\"><a class=\"anchor\" href=\"#4-浏览器如何通过域名去查询-url-对应的-ip-呢\">#</a> 4、浏览器如何通过域名去查询 URL 对应的 IP 呢？</h3>\n<blockquote>\n<ul>\n<li>浏览器缓存：浏览器会按照一定的频率缓存 DNS 记录。</li>\n<li>操作系统缓存：如果浏览器缓存中找不到需要的 DNS 记录，那就去操作系统中找。</li>\n<li>路由缓存：路由器也有 DNS 缓存。</li>\n<li>ISP 的 DNS 服务器：ISP 是互联网服务提供商 (Internet Service Provider) 的简称，ISP 有专门的 DNS 服务器应对 DNS 查询请求。</li>\n<li>根服务器：ISP 的 DNS 服务器还找不到的话，它就会向根服务器发出请求，进行递归查询（DNS <span class=\"exturl\" data-url=\"aHR0cDovL3huLS00NHFyNmFiYTk2bGQ0ZWRhNjN4ZXkyY2ZhMTExYXAzNnEuY29t\">服务器先问根域名服务器.com</span> 域名服务器的 IP 地址，然后再问.baidu 域名服务器，依次类推）</li>\n</ul>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20210623191500569.png\" alt=\"image-20210623191500569\" /></p>\n<p><code>结论</code> :<strong> 浏览器通过向 DNS 服务器发送域名，DNS 服务器查询到与域名相对应的 IP 地址，然后返回给浏览器，浏览器再将 IP 地址打在协议上，同时请求参数也会在协议搭载，然后一并发送给对应的服务器。</strong></p>\n</blockquote>\n<h3 id=\"5-dns的优化与应用\"><a class=\"anchor\" href=\"#5-dns的优化与应用\">#</a> 5、DNS 的优化与应用</h3>\n<blockquote>\n<ol>\n<li>DNS 缓存  <code>DNS存在着多级缓存</code> ，从离浏览器的距离排序的话，有以下几种:  <code>浏览器缓存，系统缓存，路由器缓存，IPS服务器缓存，根域名服务器缓存，顶级域名服务器缓存，主域名服务器缓存</code> 。</li>\n<li>DNS 负载均衡 <code>(DNS重定向) DNS负载均衡技术</code> 的实现原理是在 DNS 服务器中为同一个主机名配置多个 IP 地址，在应答 DNS 查询时， DNS 服务器对每个查询将以 DNS 文件中主机记录的 IP 地址按顺序返回不同的解析结果，将客户端的访问 引导到不同的机器上去，使得不同的客户端访问不同的服务器，从而达到负载均衡的目的。</li>\n</ol>\n<ul>\n<li>大家耳熟能详的 CDN (Content Delivery Network) 就是利用 DNS 的重定向技术，DNS 服务器会返回一个跟 用户最接近的点的 IP 地址给用户，CDN 节点的服务器负责响应用户的请求，提供所需的内容。</li>\n</ul>\n<ol start=\"3\">\n<li>dns-prefetch  <code>DNS Prefetch 是一种 DNS 预解析技术</code> 。当你浏览网页时，浏览器会在加载网页时对网页中的域名进行解析缓存，这样在你单击当前网页中的连接时就无需进行 DNS 的解析，减少用户等待时间，提高用户体验。</li>\n</ol>\n</blockquote>\n<h2 id=\"三-tcp三次握手\"><a class=\"anchor\" href=\"#三-tcp三次握手\">#</a> 三、TCP 三次握手</h2>\n<blockquote>\n<p><strong>HTTP 请求分为三个部分： <code>TCP 三次握手</code> 、http 请求响应信息、关闭 TCP 连接。</strong></p>\n<ol>\n<li>比喻图</li>\n</ol>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20210623192336724.png\" alt=\"image-20210623192336724\" /></p>\n<ol start=\"2\">\n<li>三次握手时序图 (该图来自<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vdXNlci8zMzg2MTUxNTQ1ODY5Nzgz\"> williamife</span>)</li>\n</ol>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/1692e4385f72aae4\" alt=\"img\" /></p>\n</blockquote>\n<h3 id=\"1-tcp三次握手的过程如下\"><a class=\"anchor\" href=\"#1-tcp三次握手的过程如下\">#</a> 1、TCP 三次握手的过程如下:</h3>\n<blockquote>\n<p>客户端发送一个带 SYN=1，Seq=X 的数据包到服务器端口 <code>（第一次握手，由浏览器发起，告诉服务器我要发送请求了）</code></p>\n<p>服务器发回一个带 SYN=1， ACK=X+1， Seq=Y 的响应包以示传达确认信息 <code>（第二次握手，由服务器发起，告诉浏览器我准备接受了，你赶紧发送吧）</code></p>\n<p>客户端再回传一个带 ACK=Y+1， Seq=Z 的数据包，代表 “握手结束” <code>（第三次握手，由浏览器发送，告诉服务器，我马上就发了，准备接受吧）</code></p>\n</blockquote>\n<h3 id=\"2-为何需要三次握手\"><a class=\"anchor\" href=\"#2-为何需要三次握手\">#</a> 2、为何需要三次握手？</h3>\n<blockquote>\n<p>“三次握手” 的目的是 “<strong> <code>为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误</code> </strong>”。</p>\n</blockquote>\n<h2 id=\"四-发送-http-请求\"><a class=\"anchor\" href=\"#四-发送-http-请求\">#</a> 四、发送 HTTP 请求</h2>\n<blockquote>\n<p>TCP 三次握手结束后，开始发送 HTTP 请求报文。</p>\n</blockquote>\n<h2 id=\"五-服务器处理请求并返回-http-报文\"><a class=\"anchor\" href=\"#五-服务器处理请求并返回-http-报文\">#</a> 五、服务器处理请求并返回 HTTP 报文</h2>\n<h3 id=\"1-服务器\"><a class=\"anchor\" href=\"#1-服务器\">#</a> 1、服务器</h3>\n<blockquote>\n<p>服务器是网络环境中的高性能计算机，它侦听网络上的其他计算机（客户机）提交的服务请求，并提供相应的服务，比如网页服务、文件下载服务、邮件服务、视频服务。而客户端主要的功能是浏览网页、看视频、听音乐等等，两者截然不同。 每台服务器上都会安装处理请求的应用 ——web server。常见的 web server 产品有 apache、nginx、IIS 或 Lighttpd 等。<br />\n<strong> <code>web server</code>  担任管控的角色</strong>，对于不同用户发送的请求，会结合配置文件，把不同请求委托给服务器上处理相应请求的程序进行处理（常见的 web server 产品有 apache、 <code>nginx</code> 、IIS、Lighttpd 等），然后返回后台程序处理产生的结果作为响应。</p>\n</blockquote>\n<h3 id=\"2-http-响应报文\"><a class=\"anchor\" href=\"#2-http-响应报文\">#</a> 2、http 响应报文</h3>\n<blockquote>\n<p>此处同上</p>\n</blockquote>\n<h2 id=\"六-浏览器解析渲染页面\"><a class=\"anchor\" href=\"#六-浏览器解析渲染页面\">#</a> 六、浏览器解析渲染页面</h2>\n<blockquote>\n<p>相关详细内容包括如何优化已在‘浏览器解析渲染页面原理及回流重绘优化笔记’中有叙述  --》 <strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vaG9uZ2ppbGluL2hvbmdzLXN0dWR5LW5vdGVzL3RyZWUvbWFzdGVyLyVFNyVCQyU5NiVFNyVBOCU4Ql8lRTUlODklOEQlRTclQUIlQUYlRTUlQkMlODAlRTUlOEYlOTElRTUlQUQlQTYlRTQlQjklQTAlRTclQUMlOTQlRTglQUUlQjAvQ2hyb21lJUU1JUJDJTgwJUU1JThGJTkxJUU0JUJEJUJGJUU3JTk0JUE4JUU1JThGJThBJUU1JUFEJUE2JUU0JUI5JUEwJUU3JUFDJTk0JUU4JUFFJUIwLyVFNiVCNSU4RiVFOCVBNyU4OCVFNSU5OSVBOCVFOCVBNyVBMyVFNiU5RSU5MCVFNiVCOCVCMiVFNiU5RiU5MyVFOSVBMSVCNSVFOSU5RCVBMiVFNSU4RSU5RiVFNyU5MCU4NiVFNSU4RiU4QSVFNSU5QiU5RSVFNiVCNSU4MSVFOSU4NyU4RCVFNyVCQiU5OCVFNCVCQyU5OCVFNSU4QyU5NiVFNyVBQyU5NCVFOCVBRSVCMA==\">浏览器解析渲染页面原理及回流重绘优化笔记</span></strong></p>\n<p>浏览器解析渲染页面分为一下五个步骤：</p>\n<ol>\n<li>根据 HTML 解析出 DOM 树</li>\n<li>根据 CSS 解析生成 CSS 规则树</li>\n<li>结合 DOM 树和 CSS 规则树，生成渲染树</li>\n<li>根据渲染树计算每一个节点的信息</li>\n<li>根据计算好的信息绘制页面</li>\n</ol>\n</blockquote>\n<h3 id=\"1-根据html解析dom树\"><a class=\"anchor\" href=\"#1-根据html解析dom树\">#</a> 1、根据 HTML 解析 DOM 树</h3>\n<blockquote>\n<ul>\n<li>根据 HTML 的内容，将标签按照结构解析成为 DOM 树，DOM 树解析的过程是一个深度优先遍历。即先构建当前节点的所有子节点，再构建下一个兄弟节点。</li>\n<li>在读取 HTML 文档，构建 DOM 树的过程中，若遇到 script 标签，则 DOM 树的构建会暂停，直至脚本执行完毕。</li>\n</ul>\n</blockquote>\n<h3 id=\"2-根据css解析生成css规则树-cssom树\"><a class=\"anchor\" href=\"#2-根据css解析生成css规则树-cssom树\">#</a> 2、根据 CSS 解析生成 CSS 规则树 --》【CSSOM 树】</h3>\n<blockquote>\n<ul>\n<li>解析 CSS 规则树时 js 执行将暂停，直至 CSS 规则树就绪。</li>\n<li>浏览器在 CSS 规则树生成之前不会进行渲染。</li>\n</ul>\n</blockquote>\n<h3 id=\"3-结合dom树和css规则树生成渲染树\"><a class=\"anchor\" href=\"#3-结合dom树和css规则树生成渲染树\">#</a> 3、结合 DOM 树和 CSS 规则树，生成渲染树</h3>\n<blockquote>\n<ul>\n<li>DOM 树和 CSS 规则树全部准备好了以后，浏览器才会开始构建渲染树。</li>\n<li>精简 CSS 并可以加快 CSS 规则树的构建，从而加快页面相应速度。</li>\n</ul>\n</blockquote>\n<h3 id=\"4-根据渲染树计算每一个节点的信息布局\"><a class=\"anchor\" href=\"#4-根据渲染树计算每一个节点的信息布局\">#</a> 4、根据渲染树计算每一个节点的信息（布局）</h3>\n<blockquote>\n<ul>\n<li>布局：通过渲染树中渲染对象的信息，计算出每一个渲染对象的位置和尺寸</li>\n<li>回流：在布局完成后，发现了某个部分发生了变化影响了布局，那就需要倒回去重新渲染。</li>\n</ul>\n</blockquote>\n<h3 id=\"5-根据计算好的信息绘制页面\"><a class=\"anchor\" href=\"#5-根据计算好的信息绘制页面\">#</a> 5、根据计算好的信息绘制页面</h3>\n<blockquote>\n<ul>\n<li>绘制阶段，系统会遍历呈现树，并调用呈现器的 “paint” 方法，将呈现器的内容显示在屏幕上。</li>\n<li>重绘：某个元素的背景颜色，文字颜色等，不影响元素周围或内部布局的属性，将只会引起浏览器的 <code>重绘</code> 。</li>\n<li>回流：某个元素的尺寸发生了变化，则需重新计算渲染树，重新渲染。</li>\n</ul>\n</blockquote>\n<h2 id=\"七-断开连接\"><a class=\"anchor\" href=\"#七-断开连接\">#</a> 七、断开连接</h2>\n<p><strong>当数据传送完毕，需要断开 tcp 连接，此时发起 tcp 四次挥手</strong>。<br />\n<img data-src=\"%E6%B5%85%E6%9E%90%E4%BB%8E%E8%BE%93%E5%85%A5URL%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%B1%95%E7%A4%BA%E8%BF%99%E4%B8%AD%E9%97%B4%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/1460000017184713.png\" alt=\"img\" /></p>\n<ul>\n<li><strong>发起方向被动方发送报文，Fin、Ack、Seq，表示已经没有数据传输了。并进入 FIN_WAIT_1 状态</strong>。(第一次挥手：由浏览器发起的，发送给服务器，我请求报文发送完了，你准备关闭吧)</li>\n<li><strong>被动方发送报文，Ack、Seq，表示同意关闭请求。此时主机发起方进入 FIN_WAIT_2 状态</strong>。(第二次挥手：由服务器发起的，告诉浏览器，我请求报文接受完了，我准备关闭了，你也准备吧)</li>\n<li><strong>被动方向发起方发送报文段，Fin、Ack、Seq，请求关闭连接。并进入 LAST_ACK 状态</strong>。(第三次挥手：由服务器发起，告诉浏览器，我响应报文发送完了，你准备关闭吧)</li>\n<li><strong>发起方向被动方发送报文段，Ack、Seq。然后进入等待 TIME_WAIT 状态。被动方收到发起方的报文段以后关闭连接。发起方等待一定时间未收到回复，则正常关闭</strong>。(第四次挥手：由浏览器发起，告诉服务器，我响应报文接受完了，我准备关闭了，你也准备吧)</li>\n</ul>\n<h2 id=\"1-前端缓存\"><a class=\"anchor\" href=\"#1-前端缓存\">#</a> 1、前端缓存</h2>\n<blockquote>\n<p>当我们第一次访问网站时，电脑会把网站上的图片与数据下载到电脑上，当我们再次访问该网站时，网站就会从电脑中直接加载出来，这就是缓存</p>\n<ul>\n<li>web 缓存是指一个 Web 资源 (如 html 页面、图、JS 等) 存在于 web 服务器和客户端 (浏览器) 之间的副本</li>\n<li>缓存会根据进来的请求保存输出内容的副本：当下一个请求来到的时候，如果是相同的 Url, 缓存会根据缓存机制决定是直接使用副本响应访问请求还是像源服务器再次发起请求</li>\n</ul>\n</blockquote>\n<h3 id=\"i-缓存有哪些好处\"><a class=\"anchor\" href=\"#i-缓存有哪些好处\">#</a> Ⅰ - 缓存有哪些好处</h3>\n<blockquote>\n<ul>\n<li>缓解服务端压力，不用每次都去请求某些数据</li>\n<li>提升性能，打开本地资源肯定比请求服务器来的更快</li>\n<li>减少宽带消耗，当我们使用缓存的时候，只会产生很小的网络消耗，至于为什么打开本地资源也会产生网络消耗？</li>\n</ul>\n</blockquote>\n<h3 id=\"ii-前端缓存种类\"><a class=\"anchor\" href=\"#ii-前端缓存种类\">#</a> Ⅱ - 前端缓存种类</h3>\n<blockquote>\n<ol>\n<li>数据库缓存</li>\n<li>CDN 缓存</li>\n<li>代理服务器缓存</li>\n<li>浏览器缓存</li>\n</ol>\n<p><strong>此图截取自网上相关文章</strong></p>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20211027182618788.png\" alt=\"image-20211027182618788\" /></p>\n</blockquote>\n<h2 id=\"2-什么是浏览器缓存策略\"><a class=\"anchor\" href=\"#2-什么是浏览器缓存策略\">#</a> 2、什么是浏览器缓存策略</h2>\n<blockquote>\n<p>良好的缓存策略可以降低资源的重复加载从而提高页面整体加载速度，通常浏览器缓存策略分为两种结果</p>\n<ul>\n<li>强缓存</li>\n<li>协商缓存</li>\n</ul>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20211027184535569.png\" alt=\"image-20211027184535569\" /></p>\n</blockquote>\n<h3 id=\"i-基本原理\"><a class=\"anchor\" href=\"#i-基本原理\">#</a> Ⅰ - 基本原理</h3>\n<blockquote>\n<ul>\n<li>浏览器在加载资源时，根据请求头的  <code>Expires(过期时间)</code>  和 <code>chche-control(缓存控制)</code>  判断是否命中强缓存，命中则直接从缓存中读取资源，不会发送到服务器</li>\n<li>如果没有命中强缓存，浏览器一定会发送一个请求到服务器，通过 <code>last-modified</code>  和 <code>etag</code>  验证资源是否命中协商缓存，如果命中，服务器回将这个请求返回，但是不会返回这个资源的数据，依然是从缓存中读取资源</li>\n<li>如果前面两者都没有命中，则直接从服务器加载资源</li>\n</ul>\n</blockquote>\n<h3 id=\"ii-根据什么规则缓存\"><a class=\"anchor\" href=\"#ii-根据什么规则缓存\">#</a> Ⅱ - 根据什么规则缓存</h3>\n<blockquote>\n<ol>\n<li><strong>新鲜度</strong> (过期机制): 也就是缓存副本有效期。一个缓存副本必须满足以下条件，浏览器会认为它是有效的，足够新的</li>\n</ol>\n<ul>\n<li>含有完整的过期时间控制头信息 (HTTP 协议报头), 并且仍在有效期内</li>\n<li>浏览器已经使用过这个缓存副本，并且在一个会话中已经检查过新鲜度</li>\n<li><strong>通常是强缓存阶段使用的机制</strong></li>\n</ul>\n<ol start=\"2\">\n<li><strong>校验值</strong> (验证机制): 服务器返回资源的时候有时在控制头信息带上这个资源的实体标签 <code>Etag</code> ,</li>\n</ol>\n<ul>\n<li>它可以用来作为浏览器再次请求过程的校验标识</li>\n<li>如果发现校验标识不匹配，说明资源已经被修改或者过期，浏览器需要重新获取资源内容</li>\n<li><strong>所以通常是协商缓存中使用的机制</strong></li>\n</ul>\n</blockquote>\n<h3 id=\"iii-http缓存的两个阶段\"><a class=\"anchor\" href=\"#iii-http缓存的两个阶段\">#</a> Ⅲ - HTTP 缓存的两个阶段</h3>\n<blockquote>\n<p>浏览器缓存一般分为两类: <strong>强缓存</strong> (也称本地缓存) 和 <strong>协商缓存</strong> (也称弱缓存)</p>\n<h6 id=\"强缓存阶段\"><a class=\"anchor\" href=\"#强缓存阶段\">#</a> 强缓存阶段</h6>\n<blockquote>\n<p>浏览器发送请求前，会去缓存里查看是否命中强缓存，如果命中，则直接从缓存中读取资源，不会发送请求到服务器；</p>\n</blockquote>\n<h6 id=\"协商缓存阶段\"><a class=\"anchor\" href=\"#协商缓存阶段\">#</a> 协商缓存阶段</h6>\n<blockquote>\n<p>当强缓存没有命中时，浏览器一定会向服务器发起请求</p>\n</blockquote>\n<blockquote>\n<ul>\n<li>服务器会根据  <code>request header</code>  中的一些字段来判断是否命中协商缓存</li>\n<li>如果命中，服务端会返回 304 响应，但是不会携带任何响应实体，只是高速浏览器可以直接从浏览器缓存中获取这个资源</li>\n<li>如果 <strong>强缓存</strong> 和 <strong>协商缓存</strong> 都没有命中，则直接从服务器加载资源</li>\n</ul>\n</blockquote>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20211027190616969.png\" alt=\"image-20211027190616969\" /></p>\n</blockquote>\n<h3 id=\"iv-优先级\"><a class=\"anchor\" href=\"#iv-优先级\">#</a> Ⅳ - 优先级</h3>\n<blockquote>\n<ul>\n<li><code>Cache-Control</code>  优先级大于  <code>expires</code></li>\n<li><code>Etag</code>  优先级大于  <code>last - Modified/if-Modified-since</code> , 同时存在时会以 Etag 为准</li>\n</ul>\n</blockquote>\n<h3 id=\"v-浏览器缓存流程图\"><a class=\"anchor\" href=\"#v-浏览器缓存流程图\">#</a> Ⅴ - 浏览器缓存流程图</h3>\n<blockquote>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20211027190721706.png\" alt=\"image-20211027190721706\" /></p>\n</blockquote>\n<h2 id=\"3-强缓存与协商缓存\"><a class=\"anchor\" href=\"#3-强缓存与协商缓存\">#</a> 3、强缓存与协商缓存</h2>\n<h3 id=\"i-强缓存\"><a class=\"anchor\" href=\"#i-强缓存\">#</a> Ⅰ - 强缓存</h3>\n<blockquote>\n<h6 id=\"通过expires过yu期和cache-control缓存控制器两种响应头实现\"><a class=\"anchor\" href=\"#通过expires过yu期和cache-control缓存控制器两种响应头实现\">#</a> 通过 <code>Expires(过yu期)</code>  和 <code>cache-control(缓存控制器)</code>  两种响应头实现</h6>\n<p>浏览器在加载资源时，根据请求头的  <code>Expires(过期时间)</code>  和 <code>chche-control(缓存控制)</code>  判断是否命中强缓存，命中则直接从缓存中读取资源，不会发送到服务器</p>\n</blockquote>\n<h4 id=\"1-expires过期\"><a class=\"anchor\" href=\"#1-expires过期\">#</a> ①  Expires (过期)</h4>\n<blockquote>\n<p><code>Expires</code>  是 http1.0 提出的表示资源过期时间的 header, 它描述的是一个绝对时间，由服务端返回；当我们准备再次发起请求时，本地时间未超过这个设置的时间，那么就不会真正的发出请求，而是读取缓存</p>\n<p>expires 受限于本地时间，如果修改了本地时间，可能会造成缓存失效</p>\n</blockquote>\n<h4 id=\"2-cache-control\"><a class=\"anchor\" href=\"#2-cache-control\">#</a> ②  cache-control</h4>\n<blockquote>\n<p><code>cache-control</code>  出现于 HTTP1.1, 优先级高于 Expires , 表示的是相对时间</p>\n<ul>\n<li><code>cache-control:no-cache</code>  的响应实际上是可以存储在本地缓存去中的，只是在与原始服务器进行新鲜度再验证之前，缓存不能将其提供给客户端使用</li>\n<li><code>Cache-Control: no-store</code>  真正的不缓存到本地</li>\n<li><code>Cache-Control: public</code>  可以被所有用户缓存 (多用户共享), 包括终端和 CDN 等中间代理服务器</li>\n<li><code>Cache-Control: private</code>  只能被终端浏览器缓存（而且是私有缓存），不允许中继缓存服务器进行缓存</li>\n</ul>\n<p>Cache-Control 除了在响应中使用，在请求中也可以使用。我们用开发者工具来模拟下请求时带上 Cache-Control：勾选 Disable cache，刷新页面，可以看到 Request Headers 中有个字段 Cache-Control: no-cache。</p>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20220225160543826.png\" alt=\"image-20220225160543826\" /></p>\n</blockquote>\n<h3 id=\"ii-协商缓存\"><a class=\"anchor\" href=\"#ii-协商缓存\">#</a> Ⅱ - 协商缓存</h3>\n<blockquote>\n<h6 id=\"协商缓存是通过last-modifiedif-modified-since和etag-if-none-match这两对header来管理的\"><a class=\"anchor\" href=\"#协商缓存是通过last-modifiedif-modified-since和etag-if-none-match这两对header来管理的\">#</a> 协商缓存是通过 <code>【Last-Modified，If-Modified-Since】</code> 和 <code>【ETag、If-None-Match】</code> 这两对 Header 来管理的</h6>\n<ul>\n<li>当浏览器对某个资源的请求没有命中强缓存 (换句话说就是: <strong>强缓存失效后</strong>)</li>\n<li>就会发一个请求到服务器，验证协商缓存是否命中；</li>\n<li>如果协商缓存命中，请求响应返回的 http 状态为 <code>304</code>  并且会显示一个 <code>Not Modified(未修改的)</code>  的字符串</li>\n</ul>\n</blockquote>\n<h4 id=\"1-last-modifiedif-modified-since\"><a class=\"anchor\" href=\"#1-last-modifiedif-modified-since\">#</a> ①  Last-Modified，If-Modified-Since</h4>\n<blockquote>\n<ol>\n<li><code>Last-Modified</code>  表示本地文件最后修改日期</li>\n</ol>\n<ul>\n<li>浏览器会在 request header 加上  <code>If-Modified-Since</code>  (上此返回的 <code>Last-Modified</code>  的值)</li>\n<li>询问服务器在该日期后资源是否有更新</li>\n<li>有更新的话就会将新的资源发送过来</li>\n</ul>\n<ol start=\"2\">\n<li>但如果在本地打开缓存文件，就会造成 <code>Last-Modified</code>  的修改，所以在 HTTP1.1 中出现了 <code>Etag</code></li>\n<li>当资源过期时（使用 <code>Cache-Control</code>  标识的 max-age/s-maxage）</li>\n</ol>\n<ul>\n<li>发现资源具有 <code>Last-Msodified</code>  声明，则向服务器请求时带上头  <code>If-Modified-Since</code> （即响应头中的 <code>Last-Modified</code>  值），表示请求时间。</li>\n<li>这个时候服务器收到请求后发现有头 <code>If-Modified-Since</code>  则与<strong>被请求资源</strong>的最后修改时间进行比对</li>\n<li>若最后修改时间较新，说明资源有被改动过，将新资源返回并返回状态 <code>200</code> ，否则返回 <code>304</code>  表示资源没被更新使用缓存即可。</li>\n</ul>\n</blockquote>\n<h4 id=\"2-etag-if-none-match\"><a class=\"anchor\" href=\"#2-etag-if-none-match\">#</a> ② ETag、If-None-Match</h4>\n<blockquote>\n<ol>\n<li><code>Etag</code>  就行是一个直问，资源变化都会导致 Etag 变化，跟最后修改时间没有关系，Etag 可以保证每一个资源都是唯一的</li>\n<li>当资源过期时（使用 Cache-Control 标识的 max-age/s-maxage）</li>\n</ol>\n<ul>\n<li>发现资源具有 <code>Etage</code>  声明，则向服务器请求时带上头 <code>If-None-Match</code> （即响应头中 <code>Etag</code>  的值）</li>\n<li>服务器收到请求后发现有头 <code>If-None-Match</code>  则与被请求资源的相应校验串进行比对</li>\n<li>决定返回 200 或 304（<strong>注意：服务器会优先验证 If-None-Match</strong>）</li>\n</ul>\n<h6 id=\"两者优先级\"><a class=\"anchor\" href=\"#两者优先级\">#</a> 两者优先级？</h6>\n<blockquote>\n<p><strong> <code>ETag</code>  的优先级比 <code>Last-Modified</code>  更高</strong></p>\n</blockquote>\n<blockquote>\n<p>具体为什么要用 <code>ETag</code> ，主要出于下面几种情况考虑：</p>\n</blockquote>\n<blockquote>\n<ul>\n<li>一些文件也许会周期性的更改，但是它的内容并不会改变 (仅仅只改变了修改时间), 这种时候我们并不希望客户端认为这个文件被修改了，而重新 GET</li>\n<li>某些文件修改非常频繁，比如在秒以下的时间内进行修改 (比如说 1s 内修改了 N 次), 而其他方法检查到的粒度是 s 级的，这种修改无法判断</li>\n<li>某些服务器不能精确的得到文件的最后修改时间</li>\n</ul>\n</blockquote>\n<h6 id=\"服务端返回-304-流程图\"><a class=\"anchor\" href=\"#服务端返回-304-流程图\">#</a> 服务端返回 304 流程图</h6>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20211027175045937-16353282573951.png\" alt=\"image-20211027175045937\" /></p>\n</blockquote>\n<h3 id=\"iii-强缓存与协商缓存简单异同点\"><a class=\"anchor\" href=\"#iii-强缓存与协商缓存简单异同点\">#</a> Ⅲ - 强缓存与协商缓存简单异同点</h3>\n<blockquote>\n<ul>\n<li><strong>相同点</strong>：如果命中，都是从客户端缓存中加载资源，而不是从服务器加载资源数据</li>\n<li><strong>不同点</strong>：强缓存不发送请求到服务器，协商缓存会发送请求到服务器</li>\n</ul>\n</blockquote>\n<h2 id=\"4-常见几种状态码的区别\"><a class=\"anchor\" href=\"#4-常见几种状态码的区别\">#</a> 4、常见几种状态码的区别</h2>\n<blockquote>\n<p>缓存中: 200 状态码总是强缓存，304 总是协商缓存</p>\n<ul>\n<li><code>200</code> : 强缓存 <code>expires/Cache-Control</code>  失效时，返回新的资源文件</li>\n<li><code>200(form cache)</code> : 强缓存两者都存在且未过期； <code>Cache-Control</code>  优先 <code>Expirs</code>  (默认就是这个优先级) 时 --&gt; 浏览器从本地获取资源成功  (这个状态还能更详细分类，在下面再给出详解)</li>\n<li><code>304(Not Modified)</code> : 协商缓存 <code>Last-modified/Etag</code>  没有过期时，服务端返回状态码 304</li>\n</ul>\n<h6 id=\"这里给出个截图安装了中文包所以显示的中文\"><a class=\"anchor\" href=\"#这里给出个截图安装了中文包所以显示的中文\">#</a> 这里给出个截图 (安装了中文包，所以显示的中文)</h6>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20211102140503290.png\" alt=\"image-20211102140503290\" /></p>\n</blockquote>\n<h2 id=\"5-缓存位置\"><a class=\"anchor\" href=\"#5-缓存位置\">#</a> 5、缓存位置</h2>\n<blockquote>\n<h6 id=\"强缓存我们会把资源放在-memory-cache内存缓存和disk-cache磁盘缓存-中那么他们的区别在哪呢为何要如此区分\"><a class=\"anchor\" href=\"#强缓存我们会把资源放在-memory-cache内存缓存和disk-cache磁盘缓存-中那么他们的区别在哪呢为何要如此区分\">#</a> 强缓存我们会把资源放在  <code>memory cache(内存缓存)</code>  和 <code>disk cache(磁盘缓存)</code>  中，那么他们的区别在哪呢？为何要如此区分？</h6>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%B5%85%E5%AD%A6%E7%B3%BB%E5%88%97%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/image-20211102140503290.png\" alt=\"image-20211102140503290\" /></p>\n<ul>\n<li>存储图像和网页等资源主要存储在 <code>disk cache(磁盘存储)</code></li>\n<li>操作系统缓存文件等资源大部分都会缓存在 <code>memory cache</code>  中</li>\n<li>具体操作浏览器自动分配，看谁的资源利用率不高就给谁</li>\n<li>查找浏览器缓存时会按照  <code>Service Worker</code>  --&gt;  <code>Memory Cache</code>  --&gt;  <code>Disk Cache</code>  --&gt;   <code>Push Cache</code></li>\n</ul>\n</blockquote>\n<h3 id=\"i-service-worker\"><a class=\"anchor\" href=\"#i-service-worker\">#</a> Ⅰ -  Service Worker</h3>\n<blockquote>\n<ul>\n<li>是运行在浏览器背后的独立线程，一般可以用来实现缓存功能.</li>\n<li>使用 <code>Service Worker</code>  的话，因为其中涉及到请求拦截，所以传输协议必须为 <code>HTTPS</code>  来保障安全</li>\n<li><code>Service Worker</code>  的缓存和浏览器其他内建的缓存机制不同，它可以让我们自由控制缓存那些文件，如何匹配缓存、读取缓存，并且缓存时持续性的</li>\n</ul>\n</blockquote>\n<h3 id=\"ii-memory-cache\"><a class=\"anchor\" href=\"#ii-memory-cache\">#</a> Ⅱ - Memory Cache</h3>\n<blockquote>\n<ul>\n<li><strong>内存中的缓存</strong>：主要包含的是当前页面中已经抓取到的资源：例如页面下载的样式、脚本、图片等</li>\n<li>读取 <strong>内存</strong> 中的数据肯定比 <strong>磁盘</strong> 的快</li>\n<li><strong>内存缓存</strong> 虽然读取高效，但是缓存持续性很短，会随着进程的释放而释放：如我们关闭了 tab 页面，内存中的缓存也就被释放了</li>\n</ul>\n</blockquote>\n<h3 id=\"iii-disk-cache\"><a class=\"anchor\" href=\"#iii-disk-cache\">#</a> Ⅲ -  Disk Cache</h3>\n<blockquote>\n<ul>\n<li>存储在 <strong>硬盘</strong> 中的缓存，读取速度慢点，但是什么都能存储到磁盘中，比之  <code>Memory Cache</code>  胜在容量和存储时效性上</li>\n<li>在所有浏览器缓存中， <code>Disk Cache</code>  覆盖面基本是最大的</li>\n<li>他会根据  <code>HTTP Header</code>  中的字段判断哪些资源需要缓存，哪些资源可以不请求直接使用，哪些资源已经过期需要重新请求</li>\n<li>并且即便在跨站点的情况下，相同地址的资源一旦被硬盘缓存下来，就不会再去请求数据，绝大部分数据都来自 <code>Disk Cache</code></li>\n<li><strong>磁盘缓存</strong> 比 <strong>内存缓存</strong> 慢的多</li>\n</ul>\n<h6 id=\"举个\"><a class=\"anchor\" href=\"#举个\">#</a> 举个🌰</h6>\n<blockquote>\n<p>从远程 Web 服务器直接提取访问文件可能需要 <strong>500 毫秒 (半秒)</strong>, 那么磁盘访问可能需要 <strong>10~20 毫秒</strong>；而内存访问可能只需要 <strong>100 纳秒</strong>；更高级的还有 <strong>L1 缓存访问</strong> 只需要 0.5 纳秒 (最快和最小的 CPU 缓存，详见此笔记 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vaG9uZ2ppbGluL2hvbmdzLXN0dWR5LW5vdGVzL2Jsb2IvbWFzdGVyLyVFNyVCQyU5NiVFNyVBOCU4Ql8lRTclQUUlOTclRTYlQjMlOTUlRTUlOEYlOEElRTglQUYlQkUlRTclQTglOEIlRTUlOUYlQkElRTclQTElODAlRTUlQUQlQTYlRTQlQjklQTAlRTclQUMlOTQlRTglQUUlQjAvJUU4JUFFJUExJUU3JUFFJTk3JUU2JTlDJUJBJUU3JUJCJTg0JUU2JTg4JTkwJUU1JThFJTlGJUU3JTkwJTg2LyVFNyVCQyU5MyVFNSVBRCU5OCVFMyU4MCU4MSVFNSU4NiU4NSVFNSVBRCU5OCVFMyU4MCU4MUNQVSVFNyU5RiVBNSVFOCVBRiU4NiVFNyU4MiVCOSVFOCVBNyVBMyVFNiU5RSU5MCVFNyVBQyU5NCVFOCVBRSVCMC5tZCMlRTUlOUIlOUJjcHUlRTclOUElODQlRTUlQTQlOUElRTclQkElQTclRTclQkMlOTMlRTUlQUQlOTglRTklQUIlOTglRTklODAlOUYlRTclQkMlOTMlRTUlQUQlOTg=\">缓存、内存、CPU 知识点解析</span> )</p>\n</blockquote>\n</blockquote>\n<h3 id=\"iv-prefetch-cache预取缓存\"><a class=\"anchor\" href=\"#iv-prefetch-cache预取缓存\">#</a> Ⅳ -  prefetch cache (预取缓存)</h3>\n<blockquote>\n<ul>\n<li><strong>link</strong> 标签带上 <strong>prefetch</strong> , 再次加载时会出现</li>\n<li><code>prefetch</code>  是 <strong>预加载</strong> 的一种方式：被标记为  <code>prefetch</code>  的资源，将会被浏览器在空闲时间加载</li>\n</ul>\n</blockquote>\n<h3 id=\"v-push-cache\"><a class=\"anchor\" href=\"#v-push-cache\">#</a> Ⅴ -  Push Cache</h3>\n<blockquote>\n<ul>\n<li><code>Push Cache(推送缓存)</code>  是 <strong>HTTP/2</strong> 中的内容，当以上三种缓存都没有命中时，它才会被使用</li>\n<li>它只在 <strong>会话 (Session)</strong> 中存在，一旦会话结束就会被释放，并且缓存时间也会很短暂</li>\n<li>在 Chrome 浏览器中只有 <strong>5 分钟</strong> 左右，同时它也并非严格执行 HTTP 头中的缓存指令</li>\n</ul>\n</blockquote>\n<h3 id=\"vi-cpu-内存-硬盘概述\"><a class=\"anchor\" href=\"#vi-cpu-内存-硬盘概述\">#</a> Ⅵ -  CPU、内存、硬盘概述</h3>\n<blockquote>\n<h6 id=\"可能有小伙伴对于此处知识点没什么直观的概念此处给出一个大概叙述-想了解更多的话此部分知识点本人有专门梳理笔记文件\"><a class=\"anchor\" href=\"#可能有小伙伴对于此处知识点没什么直观的概念此处给出一个大概叙述-想了解更多的话此部分知识点本人有专门梳理笔记文件\">#</a> 可能有小伙伴对于此处知识点没什么直观的概念，此处给出一个大概叙述；想了解更多的话此部分知识点本人有专门梳理笔记文件</h6>\n<h6 id=\"-点我传送\"><a class=\"anchor\" href=\"#-点我传送\">#</a> --&gt; <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vaG9uZ2ppbGluL2hvbmdzLXN0dWR5LW5vdGVzL2Jsb2IvbWFzdGVyLyVFNyVCQyU5NiVFNyVBOCU4Ql8lRTclQUUlOTclRTYlQjMlOTUlRTUlOEYlOEElRTglQUYlQkUlRTclQTglOEIlRTUlOUYlQkElRTclQTElODAlRTUlQUQlQTYlRTQlQjklQTAlRTclQUMlOTQlRTglQUUlQjAvJUU4JUFFJUExJUU3JUFFJTk3JUU2JTlDJUJBJUU3JUJCJTg0JUU2JTg4JTkwJUU1JThFJTlGJUU3JTkwJTg2LyVFNyVCQyU5MyVFNSVBRCU5OCVFMyU4MCU4MSVFNSU4NiU4NSVFNSVBRCU5OCVFMyU4MCU4MUNQVSVFNyU5RiVBNSVFOCVBRiU4NiVFNyU4MiVCOSVFOCVBNyVBMyVFNiU5RSU5MCVFNyVBQyU5NCVFOCVBRSVCMC5tZA==\">点我传送</span></h6>\n<ul>\n<li>CPU、内存、硬盘都是计算机的主要组成部分</li>\n<li><strong>CPU</strong>: 中央处理单元的缩写，也叫做  <code>处理器</code> ，是计算机的运算核心和控制核心；电脑靠 CPU 来运算、控制。让电脑各个部件顺利工作，起到协调作用</li>\n<li><strong>硬盘</strong>：存储资料和软件等数据的设备，有容量大、断电数据不丢失的特点</li>\n<li><strong>内存</strong>：负责 <strong>硬盘</strong> 等硬件上的数据与 <strong>CPU</strong> 之间数据的交换处理。特点是:  <code>体积小</code> 、 <code>速度快</code> 、 <code>有电可存</code> 、 <code>无电清空</code> ，即电脑在开机状态时内存中可存储数据，关机后将自动清空其中的所有数据</li>\n</ul>\n</blockquote>\n<h2 id=\"6-强缓存有协商缓存的区别\"><a class=\"anchor\" href=\"#6-强缓存有协商缓存的区别\">#</a> 6、强缓存有协商缓存的区别</h2>\n<blockquote>\n<p>这里再次总结整理一下两者之间的区别</p>\n<ul>\n<li>强缓存不发请求到服务端，所以有时候资源更新了浏览器还不知道；</li>\n<li>但是协商缓存会发请求到服务器，所以资源是否更新，服务器肯定知道</li>\n<li>大部分 web 服务器都默认开启协商缓存</li>\n</ul>\n</blockquote>\n<h2 id=\"7-刷新对于强缓存和协商缓存的影响\"><a class=\"anchor\" href=\"#7-刷新对于强缓存和协商缓存的影响\">#</a> 7、刷新对于强缓存和协商缓存的影响</h2>\n<blockquote>\n<ul>\n<li>当  <code>ctrl+F5</code>  强制刷新网页时：直接从服务器加载，<strong>跳过强缓存和协商缓存</strong></li>\n<li>当 f5 刷新网页时，跳过强缓存，但是会检查协商缓存</li>\n<li>浏览器地址写入 URL 并回车：浏览器发现缓存中有这个文件了，就不用继续请求了，直接去缓存拿 (最快)</li>\n</ul>\n</blockquote>\n",
            "tags": [
                "HTTP",
                "HTTP",
                "协议"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/03/29/TS/",
            "url": "https://dmqweb.cn/2024/03/29/TS/",
            "title": "",
            "date_published": "2024-03-29T05:29:43.221Z",
            "content_html": "<h1 id=\"ts\"><a class=\"anchor\" href=\"#ts\">#</a> TS</h1>\n<h3 id=\"定义数据类型\"><a class=\"anchor\" href=\"#定义数据类型\">#</a> 定义数据类型</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 定义数据类型</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> num<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token operator\">=</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">let</span> bool<span class=\"token operator\">:</span><span class=\"token builtin\">boolean</span><span class=\"token operator\">=</span><span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * 定义固定类型数组</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">let</span> arr1<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">let</span> arr2<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'2'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> * 使用泛型定义固定类型数组</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">let</span> arr3<span class=\"token operator\">:</span><span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">>=</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * 不声明类型定义数组</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">// 此时不生命类型则自动分配好了类型，不能赋值数组中不存在的类型</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">//ts 中数组中的类型默认声明好了，不能添加原本数组中不存在的类型</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">let</span> arr4<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">let</span> arr5 <span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">'2'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"23\"></td><td><pre> * 定义混合类型 any 数组</pre></td></tr><tr><td data-num=\"24\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">// 定义混合类型 any 的数组可以存放任何类型的值</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">let</span> arr6<span class=\"token operator\">:</span><span class=\"token builtin\">any</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">'ds'</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><h3 id=\"元组\"><a class=\"anchor\" href=\"#元组\">#</a> 元组</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 元组（类型写在数组外面，元组类型写在数组里面）</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 一旦定义了元组，其类型和固定顺序位置的数据类型就确定了</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">let</span> arr7<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span><span class=\"token builtin\">boolean</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 但是其长度可以通过 push 方法改变，但不能直接赋值改变</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>arr7<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//arr7 =[1,false,2]  // 报错</span></pre></td></tr></table></figure><h3 id=\"联合类型\"><a class=\"anchor\" href=\"#联合类型\">#</a> 联合类型</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 联合类型</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> a <span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span><span class=\"token number\">0</span></pre></td></tr></table></figure><h3 id=\"字面量类型\"><a class=\"anchor\" href=\"#字面量类型\">#</a> 字面量类型</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 字面量类型（字面量类型声明的值中只能赋值为指定的）</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> a1 <span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token number\">0</span> <span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>枚举类型</p>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 枚举类型 enum</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">enum</span> Color<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    red <span class=\"token punctuation\">,</span>green<span class=\"token punctuation\">,</span>blue</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">let</span> a2 <span class=\"token operator\">=</span> Color<span class=\"token punctuation\">.</span>blue</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>a2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 默认情况下赋值为 0,1,2</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">enum</span> Color<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    red1<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>green1<span class=\"token punctuation\">,</span>blue1</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Color<span class=\"token punctuation\">.</span>blue1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 改变后为 1，2，3</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">enum</span> Color<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    red2<span class=\"token operator\">=</span><span class=\"token string\">'red'</span><span class=\"token punctuation\">,</span>green2<span class=\"token operator\">=</span><span class=\"token string\">'green'</span><span class=\"token punctuation\">,</span>blue2<span class=\"token operator\">=</span><span class=\"token string\">'blue'</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Color<span class=\"token punctuation\">.</span>blue2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 赋值给其中一项的如果不是可迭代的（number），则需要为每一个都赋值</span></pre></td></tr></table></figure><h3 id=\"any和unknown类型\"><a class=\"anchor\" href=\"#any和unknown类型\">#</a> any 和 unknown 类型</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * any 类型和 unkonwn 类型的区别</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * unkonwn 类型表示强制类型检查（可以通过赋值改变类型，只有类型明确时才能使用对应属性或方法）</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * any 类型表示不进行类型检查</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">let</span> a3<span class=\"token operator\">:</span><span class=\"token builtin\">unknown</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a3<span class=\"token operator\">=</span><span class=\"token string\">'1'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>a3<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span>a1<span class=\"token operator\">:</span><span class=\"token string\">'dsf'</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// a3.a1</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// a3()</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">//a3.toString () 当定义 unknown 未知类型时，在类型未知的情况下不能使用方法</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> a3 <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token function\">a3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> a3 <span class=\"token operator\">===</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    a3<span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"void-undefined和never类型\"><a class=\"anchor\" href=\"#void-undefined和never类型\">#</a> void、undefined 和 never 类型</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * void 类型、undefined 类型 和 never 类型</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * void 类型一般用于表示函数无返回值</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * undefined 类型一般用于表示函数直接 return 或者 return undefined</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * never 类型一般用于表示函数死循环，永远无法 return</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 1 undefined 类型，此时函数返回时将返回 undefined（undefined 类型表示未赋值、为初始化）</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">a4</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a4'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 2 void 类型，表示变量本身就不存在，当函数没有返回值时，返回值就是 void</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">a5</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a5'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">// 2 never 类型，表示一个函数永远执行不完（报错或无限循环）</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">throwErr</span><span class=\"token punctuation\">(</span>message<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>errCode<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span><span class=\"token builtin\">never</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">throw</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        message<span class=\"token punctuation\">,</span>errCode</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">whileLoop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span><span class=\"token builtin\">never</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'永远为真'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"类型断言\"><a class=\"anchor\" href=\"#类型断言\">#</a> 类型断言</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 类型适配（类型断言）as</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> message<span class=\"token operator\">:</span><span class=\"token builtin\">any</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>message<span class=\"token operator\">=</span><span class=\"token string\">'1cf'</span> <span class=\"token comment\">// 即使这个时候赋值为字符串，类型仍然是 any</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">let</span> a6 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'c'</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">// 使用尖括号对变量进行类型断言</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">let</span> a7 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>message <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'f'</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">// 使用 as 关键字对变量进行类型断言</span></pre></td></tr></table></figure><h3 id=\"函数的声明\"><a class=\"anchor\" href=\"#函数的声明\">#</a> 函数的声明</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 函数的声明</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 1 ts 中函数形参的个数和传参时的个数必须要保持一致</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">let</span> <span class=\"token function-variable function\">a8</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>message<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>code<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span>code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">a8</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a8'</span><span class=\"token punctuation\">,</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 2 可选参数，用？表示可选参数（可选参数必须要在必选参数之后）</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">let</span> <span class=\"token function-variable function\">a9</span> <span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>message<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>code<span class=\"token operator\">?</span><span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span>code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">a9</span><span class=\"token punctuation\">(</span><span class=\"token string\">'你好'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// 3 默认参数，与 ES6 相似</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">let</span> a10<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>message<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token operator\">=</span><span class=\"token string\">'你好'</span><span class=\"token punctuation\">,</span>code<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span>code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token function\">a10</span><span class=\"token punctuation\">(</span><span class=\"token string\">'嗨'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"具体对象类型\"><a class=\"anchor\" href=\"#具体对象类型\">#</a> 具体对象类型</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 具体对象类型</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> person1 <span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    name<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    age<span class=\"token operator\">:</span><span class=\"token builtin\">number</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    name<span class=\"token operator\">:</span><span class=\"token string\">'张三'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    age<span class=\"token operator\">:</span><span class=\"token number\">18</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">let</span> person2<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    name<span class=\"token operator\">:</span><span class=\"token string\">'李四'</span><span class=\"token punctuation\">,</span>age<span class=\"token operator\">:</span><span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">//person2.nicname 此时会报错，不能使用对象没有的属性和方法</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">let</span> person3<span class=\"token operator\">:</span><span class=\"token builtin\">any</span><span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span>name<span class=\"token operator\">:</span><span class=\"token string\">'王五'</span><span class=\"token punctuation\">,</span>age<span class=\"token operator\">:</span><span class=\"token number\">22</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>person3<span class=\"token punctuation\">.</span>nickname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 如果将对象的类型改为 any，则可以使用任意类型（相当于原生 js 对象）</span></pre></td></tr></table></figure><h3 id=\"接口interface\"><a class=\"anchor\" href=\"#接口interface\">#</a> 接口 interface</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 定义接口 interface</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">interface</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    x<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">:</span><span class=\"token builtin\">number</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">let</span> <span class=\"token function-variable function\">drawPoint</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>point<span class=\"token operator\">:</span>Point<span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>x<span class=\"token operator\">:</span>point<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span>y<span class=\"token operator\">:</span>point<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//drawPoint (&#123;x:'1',y:1&#125;)  这时候不满足接口就会报错。同时这样讲函数和接口分开写不利于代码的高内聚低耦合原则</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">interface</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    age<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>name<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token function-variable function\">say</span><span class=\"token operator\">:</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token keyword\">void</span>  <span class=\"token comment\">// 用接口表示对应的类型生命，讲函数和接口放在一起提高代码的高内聚低耦合</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"类和接口\"><a class=\"anchor\" href=\"#类和接口\">#</a> 类和接口</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 类 class （ES6 中也有类的概念）</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">PersonClass</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">// 使用类实现接口</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    age<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>name<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>age<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span>name<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token operator\">=</span><span class=\"token string\">'张三'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">//js 中的函数不可以重载，一个类中有且只能有一个构造函数</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age<span class=\"token operator\">=</span>age<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token operator\">=</span>name</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token function-variable function\">say</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">我是：</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">,今年</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">碎了</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">const</span> person4 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PersonClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>person4<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"类的访问修饰符\"><a class=\"anchor\" href=\"#类的访问修饰符\">#</a> 类的访问修饰符</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 构造函数中访问修饰符：public、private、protected</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 1 public 访问修饰符 （没有书写时默认为：public）</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">PersonClass2</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Person</span><span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">// 使用类实现接口</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// age:number;name:string;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">public</span> age<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">public</span> name<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">//js 中的函数不可以重载，一个类中有且只能有一个构造函数</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 使用关键字 public 之后，将自动构造出静态属性，不用在赋值</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// this.age=age;this.name=name</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token function-variable function\">say</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">我是：</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">,今年</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">碎了</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">const</span> person5 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PersonClass2</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span><span class=\"token string\">'活活'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>person5<span class=\"token punctuation\">.</span><span class=\"token function\">say</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// 2 private 访问修饰符</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">interface</span> <span class=\"token class-name\">pp</span><span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token function-variable function\">say</span><span class=\"token operator\">:</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token keyword\">void</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// 添加 getter 和 setter，用于给私有变量赋值</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token function-variable function\">getAge</span><span class=\"token operator\">:</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token function-variable function\">getName</span><span class=\"token operator\">:</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token function-variable function\">setAge</span><span class=\"token operator\">:</span><span class=\"token punctuation\">(</span>val<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token keyword\">void</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token function-variable function\">setName</span><span class=\"token operator\">:</span><span class=\"token punctuation\">(</span>val<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token keyword\">void</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">PersonClass3</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">pp</span><span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">// 使用类实现接口</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> age<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">private</span> name<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">//js 中的函数不可以重载，一个类中有且只能有一个构造函数</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// 使用 private 访问修饰符后，同样不用自动注册</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token function-variable function\">say</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">我是：</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>getName<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">,今年</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>getAge<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">碎了</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">// 定义 setter 方法</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token function-variable function\">getName</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token function-variable function\">getAge</span><span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token function-variable function\">setName</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>val<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name<span class=\"token operator\">=</span>val</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token function-variable function\">setAge</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>val<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age<span class=\"token operator\">=</span>val</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"泛型-t\"><a class=\"anchor\" href=\"#泛型-t\">#</a> 泛型 &lt;T&gt;</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 泛型 & lt;T></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * 泛型定义了函数中需要使用的类型（可以动态变化，写在变量名之后，括号之前）</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * 不止函数，类和接口中都可以使用泛型</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 动态泛型保证函数返回值和参数的类型一致</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">let</span> lastInArray <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>arr<span class=\"token operator\">:</span><span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">return</span> arr<span class=\"token punctuation\">[</span>arr<span class=\"token punctuation\">.</span>length<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token constant\">L1</span> <span class=\"token operator\">=</span> <span class=\"token function\">lastInArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">L1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token constant\">L2</span> <span class=\"token operator\">=</span> <span class=\"token function\">lastInArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'b'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">L2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// 显示指明类型</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">let</span> <span class=\"token constant\">L3</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">lastInArray</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">number</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'2'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">// 多泛型表达</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">let</span> <span class=\"token constant\">L4</span> <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token punctuation\">,</span><span class=\"token constant\">Y</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span><span class=\"token constant\">T</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">:</span><span class=\"token constant\">Y</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">,</span>y<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">const</span> v1 <span class=\"token operator\">=</span> <span class=\"token constant\">L4</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">'one'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"类型type\"><a class=\"anchor\" href=\"#类型type\">#</a> 类型 type</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 类型 type</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Square</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    size<span class=\"token operator\">:</span><span class=\"token builtin\">number</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Rectangle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    width<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    height<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Shape</span> <span class=\"token operator\">=</span> Square <span class=\"token operator\">|</span> Rectangle<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 联合类型</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">area</span><span class=\"token punctuation\">(</span>shape<span class=\"token operator\">:</span>Shape<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token string\">'size'</span> <span class=\"token keyword\">in</span> shape<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">// 如果 shape 中有 size 属性，说明是正方形</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> shape<span class=\"token punctuation\">.</span>size <span class=\"token operator\">**</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token string\">'width'</span> <span class=\"token keyword\">in</span> shape<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">return</span> shape<span class=\"token punctuation\">.</span>width <span class=\"token operator\">*</span> shape<span class=\"token punctuation\">.</span>height</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"类型守护-is\"><a class=\"anchor\" href=\"#类型守护-is\">#</a> 类型守护 is</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 类型守护</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * 类型判断：typeof, 实例判断：instanceof，属性判断:in，字面量相等判断 (== 等)</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * 自定义类型判断，通过：&#123;形参&#125; is &#123;类型&#125;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 将判断变为返回 boolean 的函数时，类型守护失效，这时候就需要使用自定义类型判断</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Square1</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    size<span class=\"token operator\">:</span><span class=\"token builtin\">number</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Rectangle1</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    width<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    height<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">isSquare</span><span class=\"token punctuation\">(</span>shape1<span class=\"token operator\">:</span>Shape1<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span><span class=\"token builtin\">boolean</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">'size'</span> <span class=\"token keyword\">in</span> shape1</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">isRectangle</span><span class=\"token punctuation\">(</span>shape1<span class=\"token operator\">:</span>Shape1<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span><span class=\"token builtin\">boolean</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">'width'</span> <span class=\"token keyword\">in</span> shape1</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Shape1</span> <span class=\"token operator\">=</span> Square1 <span class=\"token operator\">|</span> Rectangle1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">area1</span><span class=\"token punctuation\">(</span>shape1<span class=\"token operator\">:</span>Shape1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">isSquare</span><span class=\"token punctuation\">(</span>shape1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">// 如果 shape 中有 size 属性，说明是正方形</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">return</span> shape1<span class=\"token punctuation\">.</span>size <span class=\"token operator\">**</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">isRectangle</span><span class=\"token punctuation\">(</span>shape1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">return</span> shape1<span class=\"token punctuation\">.</span>width <span class=\"token operator\">*</span> shape1<span class=\"token punctuation\">.</span>height</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"30\"></td><td><pre> * 应该将判断函数定义为类型（而不是布尔值），这样类型守卫才不会失效</pre></td></tr><tr><td data-num=\"31\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Square1</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    size<span class=\"token operator\">:</span><span class=\"token builtin\">number</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Rectangle1</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    width<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    height<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">isSquare</span><span class=\"token punctuation\">(</span>shape1<span class=\"token operator\">:</span>Shape1<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>shape1 <span class=\"token keyword\">is</span> Square1<span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">// 将 boolean 判断上升到类型判断中，使类型一致</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">'size'</span> <span class=\"token keyword\">in</span> shape1</pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">isRectangle</span><span class=\"token punctuation\">(</span>shape1<span class=\"token operator\">:</span>Shape1<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>shape1 <span class=\"token keyword\">is</span> Rectangle1<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">'width'</span> <span class=\"token keyword\">in</span> shape1</pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Shape1</span> <span class=\"token operator\">=</span> Square1 <span class=\"token operator\">|</span> Rectangle1<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">area1</span><span class=\"token punctuation\">(</span>shape1<span class=\"token operator\">:</span>Shape1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">isSquare</span><span class=\"token punctuation\">(</span>shape1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">// 如果 shape 中有 size 属性，说明是正方形</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">return</span> shape1<span class=\"token punctuation\">.</span>size <span class=\"token operator\">**</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">isRectangle</span><span class=\"token punctuation\">(</span>shape1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">return</span> shape1<span class=\"token punctuation\">.</span>width <span class=\"token operator\">*</span> shape1<span class=\"token punctuation\">.</span>height</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"函数重载\"><a class=\"anchor\" href=\"#函数重载\">#</a> 函数重载</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 函数重载（TS 的函数重载发生在编译时而不是运行时，因为 js 不支持函数重载）</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 使用函数重载将会明确函数的签名，大大提升对函数使用的准确性</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">makeDate</span><span class=\"token punctuation\">(</span>timeStamp<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>Date<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">makeDate</span><span class=\"token punctuation\">(</span>year<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>month<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>day<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>Date<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">makeDate</span><span class=\"token punctuation\">(</span>timeStampOrYear<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>month<span class=\"token operator\">?</span><span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>day<span class=\"token operator\">?</span><span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>month <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> day <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>timeStampOrYear<span class=\"token punctuation\">,</span>month<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>day<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>timeStampOrYear<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// 当调用函数时，ts 编译器会根据传入的参数类型和数量来确定应该调用哪个函数</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">makeDate</span><span class=\"token punctuation\">(</span><span class=\"token number\">123923892</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"函数签名\"><a class=\"anchor\" href=\"#函数签名\">#</a> 函数签名</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 调用签名（签名是函数重载中的概念，描述了函数所需的参数类型和返回值类型）</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 定义了一个类型（函数类型），其中类型别名包含一个 debugName 属性，然后包含一个函数重载</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Add</span><span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">(</span>a<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>b<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    debugName<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 添加 debugName 附加信息</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">(</span>a<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>b<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>c<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 进行函数的重载</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">const</span> add<span class=\"token operator\">:</span><span class=\"token function-variable function\">Add</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>a<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>b<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>c<span class=\"token operator\">?</span><span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">return</span> a<span class=\"token operator\">+</span>b<span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">?</span> c <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>add<span class=\"token punctuation\">.</span>debugName<span class=\"token operator\">=</span><span class=\"token string\">'附加信息'</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * new 构造函数进行签名</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Poit</span><span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span>x<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>y<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>z<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span>x<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>y<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>z<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">const</span> point <span class=\"token operator\">=</span> <span class=\"token keyword\">class</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">public</span> x<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">public</span> y <span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">public</span> z<span class=\"token operator\">?</span><span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"25\"></td><td><pre> * 索引签名</pre></td></tr><tr><td data-num=\"26\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">// 定义字典类型</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Dictionary</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span><span class=\"token builtin\">any</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">// 定义 Person 类型</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Person1</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    name<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    age<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">// 定义字典对象类型</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">PersonDictionary</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">[</span>username<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span>Person1</pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token keyword\">const</span> persons <span class=\"token operator\">:</span>PersonDictionary<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    alex<span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        name<span class=\"token operator\">:</span><span class=\"token string\">'阿莱克斯'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        age<span class=\"token operator\">:</span><span class=\"token number\">18</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    michal<span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        name<span class=\"token operator\">:</span><span class=\"token string\">'jackson'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        age<span class=\"token operator\">:</span><span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token keyword\">const</span> alex<span class=\"token operator\">=</span>persons<span class=\"token punctuation\">[</span><span class=\"token string\">'alex'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>persons<span class=\"token punctuation\">[</span><span class=\"token string\">'张三'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    name<span class=\"token operator\">:</span><span class=\"token string\">'张三'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    age<span class=\"token operator\">:</span><span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token keyword\">delete</span> persons<span class=\"token punctuation\">[</span><span class=\"token string\">'张三'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token comment\">// 注意：当访问不存在的属性时，ts 不会报错</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token keyword\">const</span> aa <span class=\"token operator\">=</span> persons<span class=\"token punctuation\">[</span><span class=\"token string\">'不存在'</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">//undefined</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token comment\">//aa.name  //ts 书写时不会报错，编译时报错</span></pre></td></tr></table></figure><h3 id=\"函数副作用\"><a class=\"anchor\" href=\"#函数副作用\">#</a> 函数副作用</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 函数的副作用</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">reverseSorted</span><span class=\"token punctuation\">(</span>input<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">return</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">let</span> arr8 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">reverseSorted</span><span class=\"token punctuation\">(</span>arr8<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span>arr8<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 可以观察到两个数组都变化了，函数出现了副作用</span></pre></td></tr></table></figure><h3 id=\"函数参数修饰符\"><a class=\"anchor\" href=\"#函数参数修饰符\">#</a> 函数参数修饰符</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 修饰符：public,private,readonly,protected</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> * readonly 只读属性</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 添加 readonly 之后，值只可以被读取，一旦被改写就会报错</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">reverseSorted2</span><span class=\"token punctuation\">(</span>input<span class=\"token operator\">:</span><span class=\"token keyword\">readonly</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// return input.slice().sort().reverse()</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>input<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">let</span> arr9 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">const</span> result2 <span class=\"token operator\">=</span> <span class=\"token function\">reverseSorted2</span><span class=\"token punctuation\">(</span>arr9<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result2<span class=\"token punctuation\">,</span>arr9<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"双重断言\"><a class=\"anchor\" href=\"#双重断言\">#</a> 双重断言</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 双重断言</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 断言：</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\"><span class=\"token constant\">T2D</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>x<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>y<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\"><span class=\"token constant\">T3D</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>x<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>y<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>z<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">let</span> <span class=\"token constant\">P2D</span> <span class=\"token operator\">:</span> <span class=\"token constant\">T2D</span><span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span>x<span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">let</span> <span class=\"token constant\">P3D</span> <span class=\"token operator\">:</span> <span class=\"token constant\">T3D</span><span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span>x<span class=\"token operator\">:</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">:</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span>z<span class=\"token operator\">:</span><span class=\"token number\">10</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token constant\">P2D</span><span class=\"token operator\">=</span><span class=\"token constant\">P3D</span>  <span class=\"token comment\">// 多出属性的值可以赋值给少属性的值</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// P3D=P2D  // 这样会报错，少属性的值不能付给多属性的值，此时可用类型断言</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token constant\">P3D</span> <span class=\"token operator\">=</span> <span class=\"token constant\">P2D</span> <span class=\"token keyword\">as</span> <span class=\"token constant\">T3D</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 使用类型断言，表示 P2D 为 T3D 类型的值，这样就可以赋值</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 双重类型断言 （如果两个值连类型都不一致）</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">PersonT</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>name<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>age<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">let</span> person6 <span class=\"token operator\">:</span> PersonT <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>name<span class=\"token operator\">:</span><span class=\"token string\">'张三'</span><span class=\"token punctuation\">,</span>age<span class=\"token operator\">:</span><span class=\"token number\">18</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// P3D = person6 报错</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">// P3D = person6 as T3D 单重断言仍报错，因为数据类型都不对</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token constant\">P3D</span> <span class=\"token operator\">=</span> person6 <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span> <span class=\"token keyword\">as</span> <span class=\"token constant\">T3D</span>  <span class=\"token comment\">// 双重断言</span></pre></td></tr></table></figure><h3 id=\"字符串不可更改\"><a class=\"anchor\" href=\"#字符串不可更改\">#</a> 字符串不可更改</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * js 中的字符串不可更改 immutable</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> king <span class=\"token operator\">=</span> <span class=\"token string\">'elvis'</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>king <span class=\"token operator\">=</span> <span class=\"token string\">'james'</span> <span class=\"token comment\">// 这里虽然变量变了，但是其实 elvis 字符串还在</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>king<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// 字符串通过索引可以访问到对应字母</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//king [2] = 'b'  // 报错，js 中字符串不可修改</span></pre></td></tr></table></figure><h3 id=\"常量断言-as-const\"><a class=\"anchor\" href=\"#常量断言-as-const\">#</a> 常量断言 as const</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 常量断言（js 中对象类型的值可以修改）</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    name<span class=\"token operator\">:</span><span class=\"token string\">'张三'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    age<span class=\"token operator\">:</span><span class=\"token number\">19</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>obj<span class=\"token punctuation\">.</span>name<span class=\"token operator\">=</span><span class=\"token string\">'李四'</span> <span class=\"token comment\">// 此时对象中的值可以任意修改</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">const</span> obj2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    name<span class=\"token operator\">:</span><span class=\"token string\">'王五'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    age<span class=\"token operator\">:</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    arr<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">//obj2.name=' 张三 ' // 此时报错，使用常量断言之后不能修改</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// 延展：常量断言可以断言任何一个类型（包括数组），将任何类型的成员变量都转换为 readonly 只读属性</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">// 应用场景 2：（常量断言会将值变为字面量类型）</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">layout</span><span class=\"token punctuation\">(</span>setting<span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span>align<span class=\"token operator\">:</span><span class=\"token string\">'left'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'align为：'</span><span class=\"token punctuation\">,</span>setting<span class=\"token punctuation\">.</span>align<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">// const test = &#123;align:'left'&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">//layout (test) // 此时会报错，因为 test 中的值是字符串，不是符合条件的字面量类型</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">const</span> test <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> align<span class=\"token operator\">:</span><span class=\"token string\">'left'</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token function\">layout</span><span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span>  <span class=\"token comment\">// 使用常量类型断言，将值变为字面量类型了</span></pre></td></tr></table></figure><h3 id=\"非空断言\"><a class=\"anchor\" href=\"#非空断言\">#</a> 非空断言！</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 非空断言：（变量后加: ！）</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> str<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 报错，str 可能为 null</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 不报错，使用非空断言操作符！告诉编译器 str 不为 null</span></pre></td></tr></table></figure><h3 id=\"this关键字\"><a class=\"anchor\" href=\"#this关键字\">#</a> this 关键字</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * this 关键字</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">double</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span>value<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">//this 必须是参数的第一位（假的）</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">*</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">const</span> valid <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    value<span class=\"token operator\">:</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    double</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>valid<span class=\"token punctuation\">.</span><span class=\"token function\">double</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 得到 20</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">const</span> valid2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    val<span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    double</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">//valid2.double () 此时报错，因为 balid2 中对象没有 value 属性</span></pre></td></tr></table></figure><h3 id=\"typeof操作符\"><a class=\"anchor\" href=\"#typeof操作符\">#</a> typeof 操作符</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * typeof 操作符，提取已有变量的类型</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> center <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    x<span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>z<span class=\"token operator\">:</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// type position = &#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//     x:number,y:number,z:number</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// &#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">position</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> center <span class=\"token comment\">// 这里使用 typeof 操作符就不用重新定义</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">const</span> unit<span class=\"token operator\">:</span>position<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span>   </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    x<span class=\"token operator\">:</span>center<span class=\"token punctuation\">.</span>x<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">:</span>center<span class=\"token punctuation\">.</span>y<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>z<span class=\"token operator\">:</span>center<span class=\"token punctuation\">.</span>z<span class=\"token operator\">+</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"keyof操作符\"><a class=\"anchor\" href=\"#keyof操作符\">#</a> keyof 操作符</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * keyof 操作符，拿到全部的成员变量作为联合类型</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Person3</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    name<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    age<span class=\"token operator\">:</span><span class=\"token builtin\">number</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">const</span> person7 <span class=\"token operator\">:</span> Person3 <span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    name<span class=\"token operator\">:</span><span class=\"token string\">'张三'</span><span class=\"token punctuation\">,</span>age<span class=\"token operator\">:</span><span class=\"token number\">18</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">getValueByKey</span><span class=\"token punctuation\">(</span>obj<span class=\"token operator\">:</span>Person3<span class=\"token punctuation\">,</span>key<span class=\"token operator\">:</span><span class=\"token keyword\">keyof</span> Person3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">//keyof 操作符得到联合类型</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">const</span> value <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">return</span> value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">const</span> age <span class=\"token operator\">=</span> <span class=\"token function\">getValueByKey</span><span class=\"token punctuation\">(</span>person7<span class=\"token punctuation\">,</span><span class=\"token string\">'age'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">//const email = getValueByKey (person7,'email') 这样会报错，不能得到不存在的 key</span></pre></td></tr></table></figure><h3 id=\"类型查找\"><a class=\"anchor\" href=\"#类型查找\">#</a> 类型查找</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 类型查找</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">res</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    user<span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        name<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        age<span class=\"token operator\">:</span><span class=\"token builtin\">number</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    data<span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        info<span class=\"token operator\">:</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        msg<span class=\"token operator\">:</span><span class=\"token builtin\">string</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// 通过定义的类型中的某一项进行类型查找</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">getInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>res<span class=\"token punctuation\">[</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        info<span class=\"token operator\">:</span><span class=\"token string\">'info'</span><span class=\"token punctuation\">,</span>msg<span class=\"token operator\">:</span><span class=\"token string\">'msg'</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"类型映射\"><a class=\"anchor\" href=\"#类型映射\">#</a> 类型映射</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 类型映射</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Point2</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    x<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span>z<span class=\"token operator\">:</span><span class=\"token builtin\">number</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 定义 Readonly 类型，用于将变量中每一项变为只读属性</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">Readonly<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span><span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span>  <span class=\"token comment\">// 使用 export 的原因是 Readonly 是 TS 内置好的函数</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">readonly</span> <span class=\"token punctuation\">[</span>item <span class=\"token keyword\">in</span> <span class=\"token keyword\">keyof</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">[</span>item<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">const</span> center2 <span class=\"token operator\">:</span> Readonly<span class=\"token operator\">&lt;</span>Point2<span class=\"token operator\">>=</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    x<span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>z<span class=\"token operator\">:</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">//center2.x = 100  此时会报错</span></pre></td></tr></table></figure><h3 id=\"类型修饰符\"><a class=\"anchor\" href=\"#类型修饰符\">#</a> 类型修饰符</h3>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 映射修饰符，readonly、? 等</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Point3</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">readonly</span> x<span class=\"token operator\">:</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    y<span class=\"token operator\">?</span><span class=\"token operator\">:</span><span class=\"token builtin\">number</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Mapped<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// readonly [item in keyof T] ? : T[item]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token operator\">-</span><span class=\"token keyword\">readonly</span> <span class=\"token punctuation\">[</span>item <span class=\"token keyword\">in</span> <span class=\"token keyword\">keyof</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span><span class=\"token operator\">?</span> <span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">[</span>item<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Result3</span> <span class=\"token operator\">=</span> Mapped<span class=\"token operator\">&lt;</span>Point3<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// 实际使用案例</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">State<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">public</span> current<span class=\"token operator\">:</span><span class=\"token constant\">T</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>next<span class=\"token operator\">:</span>Partial<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">,</span><span class=\"token operator\">...</span>next<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">Partial<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">[</span>item <span class=\"token keyword\">in</span> <span class=\"token keyword\">keyof</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">]</span><span class=\"token operator\">?</span><span class=\"token operator\">:</span><span class=\"token constant\">T</span><span class=\"token punctuation\">[</span>item<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">const</span> state <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">State</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>x<span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>y<span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>state<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>y<span class=\"token operator\">:</span><span class=\"token number\">124</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"interface和type的区别\"><a class=\"anchor\" href=\"#interface和type的区别\">#</a> interface 和 type 的区别</h3>\n<p>1、实现对象和类一般使用<strong> interface</strong>，</p>\n<p>而实现联合类型、元组类型、交叉类型一般使用<strong> type</strong></p>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 1 类型别名可以用于其它类型 （联合类型、元组类型、交叉类型），</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//interface 不支持这些，interface 支持对象类型定义更好。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">PartialPointX</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> x<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">PartialPointY</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> y<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//union (联合)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">PartialPoint</span> <span class=\"token operator\">=</span> PartialPointX <span class=\"token operator\">|</span> PartialPointY<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//tuple (元祖)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Data</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>PartialPointX<span class=\"token punctuation\">,</span> PartialPointY<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//primitive (原始值)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Name</span> <span class=\"token operator\">=</span> Number<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">//typeof 的返回值</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">let</span> div <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\"><span class=\"token constant\">B</span></span> <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> div<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>2 、 interface 可以多次定义 并被视为合并所有声明成员 type 不支持</p>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">interface</span> <span class=\"token class-name\">Point</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  x<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">interface</span> <span class=\"token class-name\">Point</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  y<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">const</span> point1<span class=\"token operator\">:</span> Point <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> x<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> y<span class=\"token operator\">:</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>3 、 type 能使用 in 关键字生成映射类型，但 interface 不行。</p>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">Keys</span> <span class=\"token operator\">=</span> <span class=\"token string\">'firstname'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'surname'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">type</span> <span class=\"token class-name\">DudeType</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>key <span class=\"token keyword\">in</span> Keys<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">const</span> test1<span class=\"token operator\">:</span> DudeType <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  firstname<span class=\"token operator\">:</span> <span class=\"token string\">'Pawel'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  surname<span class=\"token operator\">:</span> <span class=\"token string\">'Grzybek'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>4 、 默认导出方式不同</p>\n<figure class=\"highlight ts\"><figcaption data-lang=\"TypeScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//inerface 支持同时声明，默认导出 而 type 必须先声明后导出</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Config</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 同一个 js 模块只能存在一个默认导出哦</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> <span class=\"token keyword\">type</span> <span class=\"token class-name\">Config2</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Config2</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//   type 或者 interface 使用指南</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//   在选择使用 type 还是 interface 时，你可以根据具体情况来决定。通常来说，如果你需要定义对象的结构，或者要求类实现某个结构，使用 interface 是一个不错的选择。</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//   而如果你需要复杂的联合类型或交叉类型，或者仅仅是为了给某个类型起一个别名以提高可读性，那么使用 type 是更合适的</span></pre></td></tr></table></figure>",
            "tags": []
        },
        {
            "id": "https://dmqweb.cn/2024/03/02/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/",
            "url": "https://dmqweb.cn/2024/03/02/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/",
            "title": "前端性能优化",
            "date_published": "2024-03-02T04:24:04.000Z",
            "content_html": "<h1 id=\"5-1-前端性能优化\"><a class=\"anchor\" href=\"#5-1-前端性能优化\">#</a> 5-1 前端性能优化</h1>\n<h2 id=\"课程介绍\"><a class=\"anchor\" href=\"#课程介绍\">#</a> 课程介绍</h2>\n<p>任何小型企业，博主或成长型公司在网上出现时面临的最大挑战之一就是 “页面加载时间” 问题。除非您能确保尽可能快速无缝地加载每个页面，您才可以拥有世界上最好最引人注目的网站，否则您仍然无法赢得关注者的尊重和忠诚度。</p>\n<p>根据当今网络上的所有主要浏览器公司的说法，如果每个网站都想要排名靠前，表现良好并确保客户满意，那么每个网站都需要快。毕竟，如果您的网页加载速度很慢，那么您会立即增加客户开始在其他地方搜索信息，而不是坚持下去的风险。</p>\n<p>这也是为什么很多公司去找专门的技术人员来做 SEO（<strong>Search Engine Optimization</strong>），即搜索引擎优化。 因为，页面的加载会影响到爬虫的爬取，页面加载速度是一项非常重要的指标。况且，页面优化直接影响到了用户体验。所以学习前端性能优化势在必行。</p>\n<p><strong>经常有面试官会问：从用户输入浏览器输入 url 到页面最后呈现 有哪些过程？有什么办法能优化页面性能？</strong></p>\n<p>答案大致如下：</p>\n<ol>\n<li>用户输入 URL 地址</li>\n<li>浏览器解析 URL 解析出主机名</li>\n<li>浏览器将主机名转换成服务器 ip 地址（浏览器先查找本地 DNS 缓存列表 没有的话 再向浏览器默认的 DNS 服务器发送查询请求 同时缓存）</li>\n<li>浏览器将端口号从 URL 中解析出来</li>\n<li>浏览器建立一条与目标 Web 服务器的 TCP 连接（三次握手）</li>\n<li>浏览器向服务器发送一条 HTTP 请求报文</li>\n<li>服务器向浏览器返回一条 HTTP 响应报文</li>\n<li>关闭连接 浏览器解析文档</li>\n<li>如果文档中有资源 重复 6 7 8 动作 直至资源全部加载完毕</li>\n</ol>\n<p><img data-src=\"./assets/image-20190619100048897.png\" alt=\"image-20190619100048897\" /></p>\n<p>再深一点层次：会问到<strong>渲染机制</strong>，重排、重绘</p>\n<p>重排：</p>\n<ol>\n<li>\n<p>定义：DOM 结构中的各个元素都有自己的盒子 (模型)，这些都需要浏览器根据各种样式来计算并根据计算结果将元素放到它该出现的位置，这个过程称之为 reflow。</p>\n</li>\n<li>\n<p>触发 Reflow：</p>\n<ul>\n<li>当你增加、删除、修改 DOM 结点时，会导致 Reflow 或 Repaint</li>\n<li>当你移动 DOM 的位置，或是搞个动画的时候</li>\n<li>当你修改 CSS 样式的时候</li>\n<li>当你 Resize 窗口的时候 (移动端没有这个问题)，或者是滚动的时候</li>\n<li>当你修改网页的</li>\n</ul>\n<blockquote>\n<p>最常问：如何减少 Reflow? 或者避免 Reflow？</p>\n</blockquote>\n</li>\n</ol>\n<p>重绘：</p>\n<ol>\n<li>\n<p>定义：当各种盒子的位置、大小以及其他属性，例如颜色、字体大小等都确定下来后，浏览器于是便把这些元素都按照各自的特性绘制了一遍，于是页面的内容出现了，这个过程称之为 repaint。</p>\n<blockquote>\n<p>页面要呈现的内容，通通都绘制到页面上。</p>\n</blockquote>\n</li>\n<li>\n<p>触发 Repaint</p>\n<ul>\n<li>DOM 改动</li>\n<li>CSS 改动</li>\n</ul>\n<blockquote>\n<p>最常问：如何避免最小程序的 Repaint？</p>\n</blockquote>\n</li>\n</ol>\n<p>既然页面的性能优化这么重要，** 你知道有哪些原因是影响页面性能的？** 比如...</p>\n<ul>\n<li>HTTP 请求</li>\n<li>复杂的页面逻辑 (JS 设计)</li>\n<li>重度的 DOM 操作</li>\n<li>服务端响应</li>\n<li>大量的数据</li>\n</ul>\n<p>...</p>\n<p><strong>有哪些办法可以加速我们的页面性能？比如...</strong></p>\n<ul>\n<li>资源压缩与合并（代码打包）</li>\n<li>异步加载</li>\n<li>CDN</li>\n<li>DNS 预解析</li>\n<li>缓存</li>\n</ul>\n<p>...</p>\n<p><strong>本课程的主要内容：</strong></p>\n<ul>\n<li>页面加载缓慢原因分析</li>\n<li>性能优化原则</li>\n<li>优化工具介绍</li>\n<li>浏览器的工作机制，了解一些基本常识的原理：\n<ol>\n<li>为什么要将 js 放到页脚部分</li>\n<li>引入样式的几种方式的权重</li>\n<li>css 属性书写顺序建议</li>\n<li>何种类型的 DOM 操作是耗费性能的</li>\n</ol>\n</li>\n</ul>\n<p><strong>学习本门课你能收获什么？</strong></p>\n<ul>\n<li>前端页面优化，为成为 SEO 路添砖加瓦</li>\n<li>写出优质代码，页面性能蹭蹭蹭的往上走</li>\n<li>面试如果提到页面优化，可以娓娓道来，牛皮吹的飞起...</li>\n<li>几种常见的页面优化工具的使用 PageSpeed，JSPerf</li>\n</ul>\n<p><strong>课程准备：</strong></p>\n<ul>\n<li>注册 github 账号</li>\n</ul>\n<h2 id=\"页面性能优化\"><a class=\"anchor\" href=\"#页面性能优化\">#</a> 页面性能优化</h2>\n<p>前端性能优化可以分为两大部分：浏览器部分、代码部分。</p>\n<p>浏览器部分又可以分为：</p>\n<ul>\n<li>网络层面</li>\n<li>浏览器渲染层面</li>\n<li>服务端层面</li>\n</ul>\n<p>代码部分又可以分为：</p>\n<ul>\n<li>构建层面</li>\n<li>编码层面</li>\n<li>机制 (SSR，英文 Server Side Render：服务器端渲染)</li>\n<li>规范</li>\n</ul>\n<p>首先来看看浏览器部分：前端的页面主要在浏览器上运行着，那么我们追根溯源，从浏览器的原理开始，研究如何进行页面性能优化。</p>\n<h3 id=\"浏览器\"><a class=\"anchor\" href=\"#浏览器\">#</a> 浏览器</h3>\n<p>目前使用的主流浏览器有五个：Internet Explorer、Firefox、Safari、Chrome 浏览器和 Opera。本文中以开放源代码浏览器为例，即 Firefox、Chrome 浏览器和 Safari（部分开源）。根据 <span class=\"exturl\" data-url=\"aHR0cDovL2dzLnN0YXRjb3VudGVyLmNvbS8=\">StatCounter 浏览器统计数据</span>，目前（2019 年 6 月）Firefox、Safari 和 Chrome 浏览器的总市场占有率 62.7%。由此可见，如今开放源代码浏览器在浏览器市场中占据了非常坚实的部分。</p>\n<p><img data-src=\"./assets/image-20190618165435861.png\" alt=\"image-20190618165435861\" /></p>\n<h4 id=\"浏览器的主要作用\"><a class=\"anchor\" href=\"#浏览器的主要作用\">#</a> 浏览器的主要作用</h4>\n<p>浏览器的主要功能就是向服务器发出请求，在浏览器窗口中展示您选择的网络资源。这些网络资源包括以下内容：</p>\n<ul>\n<li>HTML</li>\n<li>CSS</li>\n<li>JavaScript 的</li>\n<li>媒体（图片，视频等）</li>\n</ul>\n<p>也可以分为 HTML 文档 (HTML/CSS/JS)、PDF、图片、视频和其他类型。</p>\n<p>浏览器解释并显示 HTML 文件的方式是在 HTML 和 CSS 规范中指定的。这些规范由网络标准化组织 W3C（万维网联盟）进行维护。<br />\n多年以来，各浏览器都没有完全遵从这些规范，同时还在开发自己独有的扩展程序，这给网络开发人员带来了严重的兼容性问题。如今，大多数的浏览器都是或多或少地遵从规范。</p>\n<p>浏览器的用户界面有很多彼此相同的元素，其中包括：</p>\n<ul>\n<li>用来输入 URI 的地址栏</li>\n<li>前进和后退按钮</li>\n<li>书签设置选项</li>\n<li>用于刷新和停止加载当前文档的刷新和停止按钮</li>\n<li>用于返回主页的主页按钮</li>\n</ul>\n<p>奇怪的是，浏览器的用户界面并没有任何正式的规范，这是多年来的最佳实践自然发展以及彼此之间相互模仿的结果。HTML5 也没有定义浏览器必须具有的用户界面元素，但列出了一些通用的元素，例如地址栏、状态栏和工具栏等。</p>\n<p><strong>有一些比较有趣的事情：</strong></p>\n<p>Safari 是乔布斯在 2003 年的 Macworld 大会发布的，9 年过去了，08 年才发展起来的 Chrome 用了不到 Safari 一半的时间远远把 Safari 甩在了后面，这让 Safari 情何以堪。</p>\n<p>两大浏览器都是基于苹果的布局引擎 Webkit，按道理 Safari 是占优势的，因为两者都分别是自己操作系统的默认浏览器，许多人就顺便使用了，懒得去下载别的浏览器。</p>\n<p>许多人可能会想，这还不简单，Chrome 运行于 Windows 操作系统，而 Safari 大部分时候都用于苹果自己的系统，Windows .VS. OS X，哪个使用人群广？很显然是前者，所以 Chrome 当然比 Safari 发真快，<strong>可是，实际上 Safari 要比 Chrome 更早登陆 Windows。</strong></p>\n<p>在 2007 年六月，Safari for Windows Beta 版就已经发布，正式版于 2008 年三月发布，而 Chrome 直到 2008 年的九月才发布，Chrome 只用了一年的时间就超过了 Safari。</p>\n<p>大量 Benchmark 测试表明 Chrome 不管在网页打开还是 JavaScript 表现方面，速度都最快。</p>\n<p>但是，当 Safari 发布 Windows 版的时候，测试结果也是一样的，不管在 Mac 还是 PC 上测试，那时候都是最快的，如果仅仅是因为速度，那么 Safari 在 2007 年六月的表现就应该和 chrome 在 2008 年九月的时候一样。</p>\n<p>难道 Chrome 胜在插件？也许，不过 Safari 在 2010 年年中的时候也有了许多插件，当然，Chrome 的插件质量更好更丰富，如果这也足够让 Safari 落后于 Chrome，那么开发商们可能早就将游戏植入 Chrome，而且，Firefox 也先于 Chrome 和 Safari 植入插件，现在不也败给了 Chrome 吗？</p>\n<p>主要原因：</p>\n<ol>\n<li>Safari 用起来不舒服，google 推广给力</li>\n<li>独特的用户体验 (UI、交互、云、Google 全家桶)</li>\n</ol>\n<p><strong>那么 Safari 就一文不值了？</strong></p>\n<p>但是，Mac 上的用户使用 safari 更加的省电、省资源，稳定性会更好。** 插件不需要爬梯子！！！** 更低的学习成本。</p>\n<p><strong>IE (Internet Explorer) 的黑历史：</strong></p>\n<p>IE 浏览器的开发应该是在 1994 年中开始的，那是我还在读大学。微软为了对抗当时的主流浏览器 NetScape，准备开发自己的浏览器并在 Windows 中默认捆绑销售。但是，留给微软的时间并不充裕，他们没时间从零开始，于是和 Spyglass 合作开发，于是，计算机历史上最著名也最臭名昭著的浏览器 IE 诞生了。因为强大的功能和捆绑策略，IE 迅速击败了 NetScape，成为浏览器市场的绝对霸主。</p>\n<p>在 2002 年，IE 已经拥有了 95% 的市场份额，几乎打败了所有的竞争对手。大为僵，又不思进取，于是颠覆者前仆后继。Firefox 开始迅速崛起，Chrome 后来居上，反观 IE，出现了各种安全漏洞和兼容性问题。2006 年，IE 被评为 “史上第八糟科技产品”。在相当长的时间里，<strong>IE 浏览器是前端程序员员的噩梦</strong>。</p>\n<p>带给我们的思考：</p>\n<ul>\n<li>软件迭代更新的重要性 (居安思危)</li>\n<li>用户体验、用户感知的重要性 (人性化产品)</li>\n<li>互联网时代，什么都是可以替代的</li>\n<li>分享、免费、共筑共赢才是互联网的精神</li>\n</ul>\n<h4 id=\"浏览器的组成结构\"><a class=\"anchor\" href=\"#浏览器的组成结构\">#</a> 浏览器的组成结构</h4>\n<p><img data-src=\"./assets/layers.png\" alt=\"img\" /></p>\n<ol>\n<li>\n<p><strong>用户界面（User Interface）</strong> - 包括地址栏、前进 / 后退按钮、书签菜单等。除了浏览器主窗口显示的您请求的页面外，其他显示的各个部分都属于用户界面。</p>\n</li>\n<li>\n<p><strong>浏览器引擎（Browser engine）</strong> - 在用户界面和渲染引擎之间传送指令。</p>\n</li>\n<li>\n<p><strong>渲染引擎（Rendering engine）</strong> - 负责显示请求的内容。如果请求的内容是 HTML，它就负责解析 HTML 和 CSS 内容，并将解析后的内容显示在屏幕上。</p>\n<blockquote>\n<p>也可以叫呈现引擎（Rendering Engine）或者布局引擎（Layout Engine）</p>\n</blockquote>\n<p>默认情况下，渲染引擎可显示 HTML 和 XML 文档与图片。通过插件（或浏览器扩展程序），还可以显示其他类型的内容；例如，使用 PDF 查看器插件就能显示 PDF 文档。但是在本章中，我们将集中介绍其主要用途：显示使用 CSS 格式化的 HTML 内容和图片。</p>\n<p>浏览器（Firefox、Chrome 浏览器和 Safari）是基于两种渲染引擎构建的。Firefox 使用的是 Gecko，这是 Mozilla 公司 “自制” 的渲染引擎。而 Safari 和 Chrome 浏览器使用的都是 WebKit。</p>\n<table>\n<thead>\n<tr>\n<th>浏览器</th>\n<th>渲染引擎（开发语言）</th>\n<th>脚本引擎（开发语言）</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Chrome</td>\n<td>Blink (c++)</td>\n<td>V8 (c++)</td>\n</tr>\n<tr>\n<td>Opera</td>\n<td>Blink (c++)</td>\n<td>V8 (c++)</td>\n</tr>\n<tr>\n<td>Safari</td>\n<td>Webkit (c++)</td>\n<td>JavaScript Core (nitro)</td>\n</tr>\n<tr>\n<td>FireFox</td>\n<td>Gecko (c++)</td>\n<td>SpiderMonkey (c/c++)</td>\n</tr>\n<tr>\n<td>Edge</td>\n<td>EdgeHTML (c++)</td>\n<td>Chakra JavaScript Engine (c++)</td>\n</tr>\n<tr>\n<td>IE</td>\n<td>Trident (c++)</td>\n<td>Chakra JScript Engine (c++)</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>Firefox 在 2017 年启用了新的 web 引擎 Quantum，Quantum 以 Gecko 引擎为基础，同时利用了 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmp1ZWppbi5pbS8/dGFyZ2V0PWh0dHBzJTNBJTJGJTJGZ2l0aHViLmNvbSUyRnJ1c3QtbGFuZyUyRnJ1c3Q=\">Rust</span> 的良好并发性和 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlcnZvL3NlcnZv\">Servo</span> 的高性能组件，为 Firefox 带来了更多的并行化和 GPU 运算，让 Firefox 更快更可靠。</p>\n<p>2015 年 3 月，微软将放弃自家 Edge：转而开发 Chromium 内核浏览器。</p>\n</blockquote>\n<p>它们的开发时间轴：</p>\n<p><img data-src=\"./assets/image-20190618172835156.png\" alt=\"image-20190618172835156\" /></p>\n<p>WebKit 是一种开放源代码渲染引擎，起初用于 Linux 平台，随后由 Apple 公司进行修改，从而支持苹果机和 Windows。有关详情，请参阅 <span class=\"exturl\" data-url=\"aHR0cDovL3dlYmtpdC5vcmcv\">webkit.org</span></p>\n</li>\n<li>\n<p><strong>网络（Networking）</strong> - 用于网络调用，比如 HTTP 请求。其接口与平台无关，并为所有平台提供底层实现。</p>\n</li>\n<li>\n<p><strong>用户界面后端（UI Backend）</strong> - 用于绘制基本的窗口小部件，比如组合框和窗口。其公开了与平台无关的通用接口，而在底层使用操作系统的用户界面方法。</p>\n</li>\n<li>\n<p><strong>JavaScript 解释器（JavaScript Interpreter）</strong>。用于解析和执行 JavaScript 代码，如 V8 引擎。</p>\n<p>JS 引擎线程负责解析 Javascript 脚本，运行代码。</p>\n<p><strong>JS 引擎一直等待任务队列中任务的到来，然后加以处理，一个 Tab 页（renderer 进程）中只有一个 JS 线程在运行</strong></p>\n</li>\n<li>\n<p><strong>数据存储（Data Persistence）</strong>。这是持久层。浏览器需要在硬盘上保存各种数据，例如 Cookie。新的 HTML 规范 (HTML5) 定义了 “网络数据库”，这是一个完整（但是轻便）的浏览器内数据库。</p>\n</li>\n</ol>\n<h4 id=\"浏览器是多进程的\"><a class=\"anchor\" href=\"#浏览器是多进程的\">#</a> 浏览器是多进程的</h4>\n<blockquote>\n<p>进程线程简单的理解：进程里面可以有多个线程，进程就是 QQ，线程就是会话。</p>\n</blockquote>\n<ul>\n<li>浏览器是多进程的</li>\n<li>浏览器之所以能够运行，是因为系统给它的进程分配了资源（cpu、内存）</li>\n<li>简单点理解，每打开一个 Tab 页，就相当于创建了一个独立的浏览器进程。</li>\n</ul>\n<p>浏览器里面的进程：</p>\n<ol>\n<li>\n<p>Browser 进程：浏览器的主进程（负责协调、主控），只有一个。作用有</p>\n<ul>\n<li>负责浏览器界面显示，与用户交互。如前进，后退等</li>\n<li>负责各个页面的管理，创建和销毁其他进程</li>\n<li>将 Renderer 进程得到的内存中的 Bitmap，绘制到用户界面上</li>\n<li>网络资源的管理，下载等</li>\n</ul>\n</li>\n<li>\n<p>第三方插件进程：每种类型的插件对应一个进程，仅当使用该插件时才创建</p>\n</li>\n<li>\n<p>GPU 进程：最多一个，用于 3D 绘制等</p>\n</li>\n<li>\n<p>渲染进程（浏览器内核）（Renderer 进程，内部是多线程的）</p>\n<ul>\n<li>默认每个 Tab 页面一个进程，互不影响。</li>\n<li>主要作用为页面渲染，脚本执行，事件处理等</li>\n</ul>\n</li>\n</ol>\n<p>渲染进程是多线程的：</p>\n<ol>\n<li>\n<p>GUI 渲染线程</p>\n<ul>\n<li>负责渲染浏览器界面，解析 HTML，CSS，构建 DOM 树和 RenderObject 树，布局和绘制等。</li>\n<li><strong>当界面需要重绘（Repaint）或由于某种操作引发回流 (reflow) 时，该线程就会执行</strong></li>\n<li>注意，GUI 渲染线程与 JS 引擎线程是互斥的，当 JS 引擎执行时 GUI 线程会被挂起（相当于被冻结了），GUI 更新会被保存在一个队列中等到 JS 引擎空闲时立即被执行。</li>\n</ul>\n</li>\n<li>\n<p>js 引擎线程</p>\n<ul>\n<li>也称为 JS 内核，负责处理 Javascript 脚本程序。（例如 V8 引擎）</li>\n<li>JS 引擎线程负责解析 Javascript 脚本，运行代码。</li>\n<li><strong>JS 引擎一直等待任务队列中任务的到来，然后加以处理，一个 Tab 页（renderer 进程）中只有一个 JS 线程在运行</strong></li>\n<li><strong>同样注意，GUI 渲染线程与 JS 引擎线程是互斥的。所以如果 JS 执行的时间过长，要放在 body 下面，否则就会导致页面渲染加载阻塞。</strong></li>\n</ul>\n</li>\n<li>\n<p>事件触发线程</p>\n<ul>\n<li>管理着事件队列</li>\n<li>监听事件，符合条件时把回调函数放入事件队列中</li>\n</ul>\n</li>\n<li>\n<p>定时触发器线程</p>\n<ul>\n<li>setInterval 与 setTimeout 在此线程中计时完毕后，把回调函数放入事件队列中</li>\n<li><strong>浏览器定时计数器并不是由 JavaScript 引擎计数的</strong>，（因为 JavaScript 引擎是单线程的，如果处于阻塞线程状态就会影响记计时的准确），因此通过单独线程来计时并触发定时（计时完毕后，添加到事件队列中，等待 JS 引擎空闲后执行）</li>\n<li>注意，W3C 在 HTML 标准中规定，规定要求<strong> setTimeout 中低于 4ms 的时间间隔算为 4ms</strong>。</li>\n</ul>\n</li>\n<li>\n<p>异步 http 请求线程</p>\n<ul>\n<li>检测到 XHR 对象状态变化时，将回调函数放入事件队列中</li>\n<li>将检测到状态变更时，如果设置有回调函数，异步线程就<strong>产生状态变更事件</strong>，将这个回调再放入事件队列中。再由 JavaScript 引擎执行。</li>\n</ul>\n<p>了解 一下，执行线：</p>\n<p><img data-src=\"./assets/image-20190619165952240.png\" alt=\"image-20190619165952240\" /></p>\n</li>\n</ol>\n<p><strong>渲染线程与 JS 引擎线程互斥</strong></p>\n<p>由于 JavaScript 是可操纵 DOM 的，如果在修改这些元素属性同时渲染界面（即 JS 线程和 UI 线程同时运行），那么渲染线程前后获得的元素数据就可能不一致了。</p>\n<p>因此为了防止渲染出现不可预期的结果，浏览器设置 GUI 渲染线程与 JS 引擎为互斥的关系，当 JS 引擎执行时 GUI 线程会被挂起， GUI 更新则会被保存在一个队列中等到 JS 引擎线程空闲时立即被执行。</p>\n<p>举一个简单的例子：</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>X-UA-Compatible<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ie=edge<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Document<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token comment\">// 页面上的 hello world 不会变成红色</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"app\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token string\">\"red\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>app<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      hello world!</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>JS 阻塞页面加载</strong></p>\n<p>从上述的互斥关系，可以推导出，JS 如果执行时间过长就会阻塞页面。</p>\n<p>譬如，假设 JS 引擎正在进行巨量的计算，此时就算 GUI 有更新，也会被保存到队列中，等待 JS 引擎空闲后执行。 然后，由于巨量计算，所以 JS 引擎很可能很久很久后才能空闲，自然会感觉到巨卡无比。</p>\n<p>所以，要尽量避免 JS 执行时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞的感觉。</p>\n<p>总结一下：</p>\n<ul>\n<li>css 加载不会阻塞 DOM 树解析（异步加载时 DOM 照常构建），但会阻塞 render 树渲染（渲染时需等 css 加载完毕，因为 render 树需要 css 信息）</li>\n<li>Javascript 阻塞 DOM 解析</li>\n</ul>\n<h4 id=\"浏览器的渲染机制\"><a class=\"anchor\" href=\"#浏览器的渲染机制\">#</a> 浏览器的渲染机制</h4>\n<p>对于渲染，我们首先需要了解一个概念：设备刷新率。</p>\n<p>设备刷新率是设备屏幕渲染的频率，通俗一点就是，把屏幕当作墙，设备刷新率就是多久重新粉刷一次墙面。基本我们平常接触的设备，如手机、电脑，它们的默认刷新频率都是 60FPS，也就是屏幕在 1s 内渲染 60 次，约 16.7ms 渲染一次屏幕。</p>\n<p>这就意味着，我们的浏览器最佳的渲染性能就是所有的操作在一帧 16.7ms 内完成，能否做到一帧内完成直接决定着渲染性，影响用户交互。</p>\n<p>渲染引擎一开始会从网络层获取请求文档的内容，内容的大小一般限制在 8000 个块以内。</p>\n<p>然后进行如下所示的<strong>基本流程</strong>：</p>\n<p><img data-src=\"./assets/flow.png\" alt=\"img\" /></p>\n<p>渲染引擎将开始解析 HTML 文档，并将各标记逐个转化成 “内容树” 上的 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHRtbDVyb2Nrcy5jb20vemgvdHV0b3JpYWxzL2ludGVybmFscy9ob3dicm93c2Vyc3dvcmsvI0RPTQ==\">DOM</span> 节点。同时也会解析外部 CSS 文件以及样式元素中的样式数据。HTML 中这些带有视觉指令的样式信息将用于创建另一个树结构：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHRtbDVyb2Nrcy5jb20vemgvdHV0b3JpYWxzL2ludGVybmFscy9ob3dicm93c2Vyc3dvcmsvI1JlbmRlcl90cmVlX2NvbnN0cnVjdGlvbg==\">呈现树</span>。</p>\n<p>呈现树包含多个带有视觉属性（如颜色和尺寸）的矩形。这些矩形的排列顺序就是它们将在屏幕上显示的顺序。</p>\n<p>呈现树构建完毕之后，进入 “<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHRtbDVyb2Nrcy5jb20vemgvdHV0b3JpYWxzL2ludGVybmFscy9ob3dicm93c2Vyc3dvcmsvI2xheW91dA==\">布局</span>” 处理阶段，也就是为每个节点分配一个应出现在屏幕上的确切坐标。下一个阶段是<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHRtbDVyb2Nrcy5jb20vemgvdHV0b3JpYWxzL2ludGVybmFscy9ob3dicm93c2Vyc3dvcmsvI1BhaW50aW5n\">绘制</span> - 渲染引擎会遍历呈现树，由用户界面后端层将每个节点绘制出来。</p>\n<p>需要着重指出的是，这是一个渐进的过程。为达到更好的用户体验，渲染引擎会力求尽快将内容显示在屏幕上。它不必等到整个 HTML 文档解析完毕之后，就会开始构建呈现树和设置布局。在不断接收和处理来自网络的其余内容的同时，渲染引擎会将部分内容解析并显示出来。</p>\n<blockquote>\n<p>那么我们知道了，CSSOM 树和 DOM 树合并成渲染树，然后用于计算每个可见元素的布局，并输出给绘制流程，将像素渲染到屏幕上。优化上述每一个步骤对实现最佳渲染性能至关重要。</p>\n</blockquote>\n<p>具体的流程：</p>\n<ul>\n<li>DOM 树与 CSSOM 树合并后形成渲染树。</li>\n<li>渲染树只包含渲染网页所需的节点。</li>\n<li>布局计算每个对象的精确位置和大小。</li>\n<li>最后一步是绘制，使用最终渲染树将像素渲染到屏幕上。</li>\n</ul>\n<p><img data-src=\"./assets/render-tree-construction.png\" alt=\"DOM CSSOM RenderTree\" /></p>\n<blockquote>\n<p>请注意  <code>visibility: hidden</code>  与  <code>display: none</code>  是不一样的。前者隐藏元素，但元素仍占据着布局空间（即将其渲染成一个空框），而后者 ( <code>display: none</code> ) 将元素从渲染树中完全移除，元素既不可见，也不是布局的组成部分。</p>\n</blockquote>\n<p>我们以 webkit 的渲染作为示例：</p>\n<p><img data-src=\"./assets/webkitflow.png\" alt=\"img\" /></p>\n<p>我们可以使用调试工具来看一个真实的例子：</p>\n<p><img data-src=\"./assets/image-20190618182337662.png\" alt=\"image-20190618182337662\" /></p>\n<p><code>script</code>  标签的处理</p>\n<p>JS 可以操作 DOM 来修改 DOM 结构，可以操作 CSSOM 来修改节点样式，这就导致了浏览器在解析 HTML 时，一旦碰到 <code>script</code> ，就会立即停止 HTML 的解析（而 CSS 不会），执行 JS，再返还控制权。</p>\n<p>事实上，JS 执行前不仅仅是停止了 HTML 的解析，它还必须等待 CSS 的解析完成。当浏览器碰到 <code>script</code>  元素时，发现该元素前面的 CSS 还未解析完，就会等待 CSS 解析完成，再去执行 JS。</p>\n<p>JS 阻塞了 HTML 的解析，也阻塞了其后的 CSS 解析，整个解析进程必须等待 JS 的执行完成才能够继续，这就是所谓的 JS 阻塞页面。一个 script 标签，推迟了 DOM 的生成、CSSOM 的生成以及之后的所有渲染过程，从性能角度上讲，将 <code>script</code>  放在页面底部，也就合情合理了。</p>\n<p>简单来说：渲染线程与 JS 引擎线程是互斥的，当 JS 引擎执行时渲染线程会被挂起（相当于被冻结了），渲染更新会被保存在一个队列中等到 JS 引擎空闲时立即被执行。</p>\n<p>总结一下：</p>\n<p>浏览器的渲染流程分为：</p>\n<ul>\n<li>DOM 树构建</li>\n<li>CSSOM 树构建</li>\n<li>RenderObject 树构建</li>\n<li>布局</li>\n<li>绘制</li>\n</ul>\n<h4 id=\"重排reflow与重绘repaint\"><a class=\"anchor\" href=\"#重排reflow与重绘repaint\">#</a> 重排 reflow 与重绘 repaint</h4>\n<p><strong>重排 reflow</strong></p>\n<p>reflow 指的是重新计算页面布局。</p>\n<p>某个节点 reflow 时会重新计算节点的尺寸和位置，而且还有可能触发其子节点、祖先节点和页面上的其他节点 reflow。在这之后再触发一次 repaint。</p>\n<p>当 render tree 中的一部分 (或全部) 因为元素的规模尺寸，布局，隐藏等改变而需要重新构建。这就称为回流，每个页面至少需要一次回流，就是在页面第一次加载的时候。</p>\n<p>导致 reflow 的操作</p>\n<ul>\n<li>调整窗口大小</li>\n<li>改变字体</li>\n<li>增加或者移除样式表</li>\n<li>内容变化，比如用户在 input 框中输入文字</li>\n<li>激活 CSS 伪类，比如 :hover (IE 中为兄弟结点伪类的激活)</li>\n<li>操作 class 属性</li>\n<li>脚本操作 DOM</li>\n<li>计算 offsetWidth 和 offsetHeight 属性</li>\n<li>设置 style 属性的值</li>\n</ul>\n<p>触发页面重布局的一些 css 属性</p>\n<ul>\n<li>盒子模型相关属性会触发重布局\n<ul>\n<li><code>width</code></li>\n<li><code>height</code></li>\n<li><code>padding</code></li>\n<li><code>margin</code></li>\n<li><code>display</code></li>\n<li><code>border-width</code></li>\n<li><code>border</code></li>\n<li><code>min-height</code></li>\n</ul>\n</li>\n<li>定位属性及浮动也会触发重布局\n<ul>\n<li><code>top</code></li>\n<li><code>bottom</code></li>\n<li><code>left</code></li>\n<li><code>right</code></li>\n<li><code>position</code></li>\n<li><code>float</code></li>\n<li><code>clear</code></li>\n</ul>\n</li>\n<li>改变节点内部文字结构也会触发重布局\n<ul>\n<li><code>text-align</code></li>\n<li><code>overflow-y</code></li>\n<li><code>font-weight</code></li>\n<li><code>overflow</code></li>\n<li><code>font-family</code></li>\n<li><code>line-height</code></li>\n<li><code>vertical-align</code></li>\n<li><code>white-space</code></li>\n<li><code>font-size</code></li>\n</ul>\n</li>\n</ul>\n<p><strong>重绘 repaint</strong></p>\n<p>repiant 或者 redraw 遍历所有的节点检测各节点的可见性、颜色、轮廓等可见的样式属性，然后根据检测的结果更新页面的响应部分。</p>\n<p>当 render tree 中的一些元素需要更新属性，而这些属性只是影响元素的外观，风格，而不会影响布局的，比如 background-color。则就叫称为重绘</p>\n<p>只触发重绘不触发重排的一些 CSS 属性：</p>\n<ul>\n<li><code>color</code></li>\n<li><code>border-style</code> 、 <code>border-radius</code></li>\n<li><code>visibility</code></li>\n<li><code>text-decoration</code></li>\n<li><code>background</code> 、 <code>background-image</code> 、 <code>background-position</code> 、 <code>background-repeat</code> 、 <code>background-size</code></li>\n<li><code>outline</code> 、 <code>outline-color</code> 、 <code>outline-style</code> 、 <code>outline-width</code></li>\n<li><code>box-shadow</code></li>\n</ul>\n<p>我们来看一个例子：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> bstyle <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">;</span> <span class=\"token comment\">// cache</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>bstyle<span class=\"token punctuation\">.</span>padding <span class=\"token operator\">=</span> <span class=\"token string\">\"20px\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// reflow, repaint</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>bstyle<span class=\"token punctuation\">.</span>border <span class=\"token operator\">=</span> <span class=\"token string\">\"10px solid red\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//  再一次的 reflow 和 repaint</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>bstyle<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token string\">\"blue\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// repaint</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>bstyle<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">\"#fad\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// repaint</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>bstyle<span class=\"token punctuation\">.</span>fontSize <span class=\"token operator\">=</span> <span class=\"token string\">\"2em\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// reflow, repaint</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// new DOM element - reflow, repaint</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">createTextNode</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dude!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>当然，我们的浏览器是聪明的，它不会像上面那样，你每改一次样式，它就 reflow 或 repaint 一次。一般来说，浏览器会把这样的操作积攒一批，然后做一次 reflow，这又叫异步 reflow 或增量异步 reflow。但是有些情况浏览器是不会这么做的，比如：resize 窗口，改变了页面默认的字体，等。对于这些操作，浏览器会马上进行 reflow。</p>\n<p>但是有些时候，我们的脚本会阻止浏览器这么干，比如：如果我们请求下面的一些 DOM 值：</p>\n<p><strong>减少重绘与重排：</strong></p>\n<p>重绘和回流在实际开发中是很难避免的，我们能做的就是尽量减少这种行为的发生。</p>\n<ul>\n<li>\n<p>js 尽量少访问 dom 节点和 css 属性，尽量不要过多的频繁的去增加，修改，删除元素，因为这可能会频繁的导致页面 reflow，可以先把该 dom 节点抽离到内存中进行复杂的操作然后再 display 到页面上。(虚拟 DOM)</p>\n</li>\n<li>\n<p>减少不必要的 DOM 层级（DOM depth）。改变 DOM 树中的一级会导致所有层级的改变，上至根部，下至被改变节点的子节点。这导致大量时间耗费在执行 reflow 上面。</p>\n</li>\n<li>\n<p>不要通过父级来改变子元素样式，最好直接改变子元素样式，改变子元素样式尽可能不要影响父元素和兄弟元素的大小和尺寸</p>\n</li>\n<li>\n<p>尽量通过 class 来设计元素样式，切忌用 style 多次操作单个属性</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// bad</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> left <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>top <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>el<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>left <span class=\"token operator\">=</span> left <span class=\"token operator\">+</span> <span class=\"token string\">\"px\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>el<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>top  <span class=\"token operator\">=</span> top  <span class=\"token operator\">+</span> <span class=\"token string\">\"px\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// Good</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>el<span class=\"token punctuation\">.</span>className <span class=\"token operator\">+=</span> <span class=\"token string\">\" theclassname\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// Good</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>el<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>cssText <span class=\"token operator\">+=</span> <span class=\"token string\">\"; left: \"</span> <span class=\"token operator\">+</span> left <span class=\"token operator\">+</span> <span class=\"token string\">\"px; top: \"</span> <span class=\"token operator\">+</span> top <span class=\"token operator\">+</span> <span class=\"token string\">\"px;\"</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>尽可能的为产生动画的 HTML 元素使用  <code>fixed</code>  或  <code>absolute</code>  的  <code>position</code>  ，那么修改他们的 CSS 是不会 Reflow 的。</p>\n</li>\n<li>\n<p>img 标签要设置高宽，以减少重绘重排</p>\n</li>\n<li>\n<p>把 DOM 离线后修改，如将一个 dom 脱离文档流，比如 <code>display：none</code>  ，再修改属性，这里只发生一次回流。</p>\n</li>\n<li>\n<p>尽量用  <code>transform</code>  来做形变和位移，不会造成回流</p>\n</li>\n<li>\n<p>权衡速度的平滑。比如实现一个动画，以 1 个像素为单位移动这样最平滑，但 reflow 就会过于频繁，CPU 很快就会被完全占用。如果以 3 个像素为单位移动就会好很多。</p>\n</li>\n<li>\n<p>不要用 tables 布局的另一个原因就是 tables 中某个元素一旦触发 reflow 就会导致 table 里所有的其它元素 reflow。在适合用 table 的场合，可以设置 table-layout 为 auto 或 fixed，</p>\n</li>\n<li>\n<p>避免不必要的复杂的 CSS 选择器，尤其是后代选择器（descendant selectors），因为为了匹配选择器将耗费更多的 CPU。</p>\n</li>\n</ul>\n<blockquote>\n<p>PS:  display:none 会触发 reflow，而 visibility:hidden 只会触发 repaint，因为没有发现位置变化。</p>\n</blockquote>\n<p>总结一下：</p>\n<p>重排：元素的尺寸变了、位置变了</p>\n<p>重绘：元素的颜色、背景、边框、轮廓变了，但是，元素的几何尺寸没有变。</p>\n<p>Reflow 的成本比 Repaint 的成本高得多的多。DOM Tree 里的每个结点都会有 reflow 方法，一个结点的 reflow 很有可能导致子结点，甚至父点以及同级结点的 reflow。在一些高性能的电脑上也许还没什么，但是如果 reflow 发生在手机上，那么这个过程是非常痛苦和耗电的。</p>\n<h3 id=\"页面加载缓慢的原因\"><a class=\"anchor\" href=\"#页面加载缓慢的原因\">#</a> 页面加载缓慢的原因</h3>\n<p><img data-src=\"./assets/browser-rendering.gif\" alt=\"browser-rendering\" /></p>\n<p><img data-src=\"./assets/backend-generation.gif\" alt=\"backend-generation\" /></p>\n<p><img data-src=\"./assets/wpo-front-backend.png\" alt=\"wpo-front-backend\" /></p>\n<h4 id=\"浏览器部分\"><a class=\"anchor\" href=\"#浏览器部分\">#</a> 浏览器部分</h4>\n<ul>\n<li>\n<p>网络层面</p>\n<ol>\n<li>\n<p>过多的 HTTP 请求</p>\n<p>打开一个网页的时候，后台程序的响应并不所需太多时间，等待的时间主要花费在下载网页元素上了，即 HTML、CSS、JavaScript、Flash、图片等。据统计，每增加一个元素，网页载入的时间就会增加 25-40 毫秒（具体取决于用户的带宽情况）。</p>\n</li>\n<li>\n<p>资源访问带宽小</p>\n<p>两方面，一方面是客户端的带宽，一方面是服务器端的带宽。</p>\n</li>\n<li>\n<p>网页元素 (图片、视频、样式) 太大</p>\n</li>\n</ol>\n</li>\n<li>\n<p>浏览器渲染层面</p>\n<ol>\n<li>\n<p>渲染阻塞：</p>\n<p>浏览器想要渲染一个页面就必须先构建出 <code>DOM</code>  树与 <code>CSSOM</code>  树，如果 <code>HTML</code>  与 <code>CSS</code>  文件结构非常庞大与复杂，这显然会给页面加载速度带来严重影响。</p>\n<p>所谓渲染阻塞资源，即是对该资源发送请求后还需要先构建对应的 <code>DOM</code>  树或 <code>CSSOM</code>  树，这种行为显然会延迟渲染操作的开始时间。</p>\n<p>JS 阻塞与 CSS 阻塞：</p>\n<p><strong>HTML、CSS、JavaScript 都是会对渲染产生阻塞的资源，HTML 是必需的（没有 DOM 还谈何渲染），但还可以从 CSS 与 JavaScript 着手优化，尽可能地减少阻塞的产生。</strong></p>\n</li>\n<li>\n<p>重复渲染</p>\n</li>\n<li>\n<p>DNS 解析</p>\n</li>\n</ol>\n</li>\n<li>\n<p>服务端层面</p>\n<ol>\n<li>硬件配置低：这个是双向的</li>\n<li>服务器软件，比如防火墙、内网策略等</li>\n<li>未对 Nginx 这类 web 服务器进行配置优化</li>\n<li>CPU 占满、数据库未优化</li>\n<li>代码问题，代码效率，代码性能</li>\n<li>包含了过多的分析类工具</li>\n</ol>\n</li>\n</ul>\n<h4 id=\"代码部分\"><a class=\"anchor\" href=\"#代码部分\">#</a> 代码部分</h4>\n<ul>\n<li>\n<p>构建层面</p>\n<p>未对代码进行打包、压缩、兼容性优化。</p>\n<p>未合并重复的请求、代码。</p>\n</li>\n<li>\n<p>编码层面</p>\n<p>没有良好的编码习惯，错误的编排 JS 与 CSS</p>\n<p>for 循环、迭代、同步、重定向、阻塞请求</p>\n<p>未删除重复、无用的代码</p>\n<p>未对逻辑业务复杂的代码进行重构，了解设计模式，对业务进行疏理</p>\n</li>\n<li>\n<p>机制 (SSR，英文 Server Side Render：服务器端渲染)</p>\n<p>未加入 Async 异步机制</p>\n<p>未思考页面加载、用户体验</p>\n</li>\n<li>\n<p>规范</p>\n<p>CSS 规范</p>\n<p>HTML 规范 / HTML5 规范</p>\n<p>Airbnb 代码规范等。</p>\n</li>\n</ul>\n<h3 id=\"优化原则\"><a class=\"anchor\" href=\"#优化原则\">#</a> 优化原则</h3>\n<h4 id=\"尽量减少http请求\"><a class=\"anchor\" href=\"#尽量减少http请求\">#</a> 尽量减少 HTTP 请求</h4>\n<p>在浏览器 (客户端) 和服务器发生通信时，就已经消耗了大量的时间，尤其是在网络情况比较糟糕的时候，这个问题尤其的突出。</p>\n<p>一个正常 HTTP 请求的流程简述：如在浏览器中输入 &quot;<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy54eHh4eHguY29t\">www.xxxxxx.com</span>&quot; 并按下回车，浏览器再与这个 URL 指向的服务器建立连接，然后浏览器才能向服务器发送请求信息，服务器在接受到请求的信息后再返回相应的信息，浏览器接收到来自服务器的应答信息后，对这些数据解释执行。</p>\n<p>而当我们请求的网页文件中有很多图片、CSS、JS 甚至音乐等信息时，将会频繁的与服务器建立连接，与释放连接，这必定会造成资源的浪费，且每个 HTTP 请求都会对服务器和浏览器产生性能负担。</p>\n<p>网速相同的条件下，下载一个 100KB 的图片比下载两个 50KB 的图片要耗费的网络资源更多。所以，请减少 HTTP 请求。</p>\n<p><strong>具体的方法：</strong></p>\n<ol>\n<li>\n<p>组合文件，优化图片，使用 sprites 设计风格：将背景图片合并成一个文件，通过 <code>background-image</code>  和  <code>background-position</code>  控制显示；</p>\n<p>确保您的图像不大于它们所需的图像，它们采用正确的文件格式（PNG 通常更适用于少于 16 种颜色的图形，而 JPEG 通常更适合照片）并且它们是针对 Web 压缩的。</p>\n<p>使用 CSS sprites 在网站上经常使用的图像创建模板，如按钮和图标。CSS sprites 将您的图像组合成一个大图像，一次加载所有（这意味着更少的 HTTP 请求），然后只显示您想要显示的部分。这意味着您通过不让用户等待加载多个图像来节省加载时间。</p>\n<p>有一些在线工具：</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zcHJpdGVjb3cuY29tLw==\">Sprite Cow</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc3ByaXRlYm94Lm5ldC8=\">Spritebox</span></li>\n</ul>\n</li>\n<li>\n<p>肉联图片，使用 <code>data:URL</code>  方案将图像数据嵌入实际页面中。这可以增加 HTML 文档的大小。将内嵌图像组合到（缓存的）样式表中是一种减少 HTTP 请求并避免增加页面大小的方法。</p>\n</li>\n<li>\n<p>简化页面的设计</p>\n</li>\n</ol>\n<h4 id=\"使用内容传送网络cdn\"><a class=\"anchor\" href=\"#使用内容传送网络cdn\">#</a> 使用内容传送网络 CDN</h4>\n<p>内容分发网络（CDN），也称为内容传送网络，是用于分发传送内容的负载的服务器网络。从本质上讲，您网站的副本存储在多个地理位置不同的数据中心，以便用户可以更快，更可靠地访问您的网站。</p>\n<p>对于初创公司和私人网站来说，CDN 服务的成本可能过高，但随着您的目标受众变得越来越大并变得更加全球化，CDN 对于实现快速响应时间是必要的。</p>\n<p>请记住，最终用户响应时间的 80-90％用于下载页面中的所有组件：图像，样式表，脚本，Flash 等。这是<em> Performance Golden Rule</em>。而不是从重新设计应用程序架构的艰巨任务开始，最好首先分散您的静态内容。这不仅可以大大缩短响应时间，而且由于内容交付网络，它更容易实现。</p>\n<p>内容传送网络（CDN）是分布在多个位置的 Web 服务器的集合，以更有效地向用户传送内容。选择用于向特定用户传送内容的服务器通常基于网络接近度的度量。例如，选择具有最少网络跳数的服务器或具有最快响应时间的服务器。</p>\n<blockquote>\n<p>CDN 服务商有很多，这里就不再多说：专门做 CDN 服务器的蓝讯、网宿、帝联、快网，还有阿里云、腾讯云、华为云等。国外如<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5ha2FtYWkuY29tLw==\"> Akamai Technologies</span>，<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5lZGdlY2FzdC5jb20v\">EdgeCast</span> 或<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5sZXZlbDMuY29tL2luZGV4LmNmbT9wYWdlSUQ9MzY=\"> level3</span></p>\n</blockquote>\n<p>除了去购买一些 CDN 服务商的服务以外，对于大多数开发者，可以使用公共 CDN 网络上的资源，如以下的方式去使用 CDN 加速：</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- google --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">&lt;!-- cdnjs --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">&lt;!-- qiniu cloud --></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">&lt;!-- other cdn --></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token attr-name\">crossorigin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>anonymous<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token attr-name\">integrity</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://lib.baomitu.com/jquery/3.4.1/jquery.min.js<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h4 id=\"避免空src或者是href值\"><a class=\"anchor\" href=\"#避免空src或者是href值\">#</a> 避免空 src 或者是 href 值</h4>\n<p>空的 src 和 href 都会导致多余的 HTTP 请求，虽然不影响加载时间，但是会对服务器产生不必要的流量和压力。浏览器仍然会向服务器发起一个 HTTP 请求：</p>\n<ul>\n<li>IE 向页面所在的目录发送请求</li>\n<li>Safari、Chrome、Firefox 向页面本身发送请求</li>\n<li>Opera 不执行任何操作</li>\n</ul>\n<p>空的 src 的 image 严重的以至于影响整个网站的用户体验，空  <code>src</code>  产生请求的后果不容小憩：</p>\n<ul>\n<li>给服务器造成意外的流量负担，尤其时日 PV 较大时；</li>\n<li>浪费服务器计算资源；</li>\n<li>可能产生报错。</li>\n</ul>\n<p>有两种形式：</p>\n<ol>\n<li>\n<p>HTML 形式</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>JavaScript 形式</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> img <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>img<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n</ol>\n<p>解决办法：</p>\n<ol>\n<li>删除空的 <code>src</code>  和 <code>href</code>  标签</li>\n<li>给 <code>a</code>  标签的 <code>href</code>  属性，连接到实际的页面：</li>\n</ol>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#nogo<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>##<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>###<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>void(0);<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>void(0)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ol start=\"3\">\n<li>禁止跳转，添加 <code>cursor:pointer</code>  样式</li>\n</ol>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\"></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token selector\">a</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">cursor</span><span class=\"token punctuation\">:</span> pointer<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span><span class=\"token punctuation\">></span></span>点击一<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token special-attr\"><span class=\"token attr-name\">onclick</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value javascript language-javascript\"><span class=\"token function\">doSomething</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span>点击二<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ol start=\"4\">\n<li>给 <code>a</code>  标签创建一个带有描述信息的 <code>href</code>  属性，并监控 <code>click</code>  事件调用 <code>preventDefault()</code>  函数。</li>\n</ol>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#Something_De scriptive<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my_id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Trigger<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#my_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 取消单击事件的默认动作以阻止链接的跳转。</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">//  其他的代码</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>优点：</p>\n<ul>\n<li>让 <code>&lt;a&gt;</code>  够响应键盘事件并获得焦点（从而屏幕阅读器能够读出背后的内容，增强可访问性）</li>\n<li>优雅降级，在网络连接很差，还没有加载到 CSS 的时候， <code>&lt;a&gt;</code>  依然有手型与正常的 link 样式。</li>\n</ul>\n<h4 id=\"gzip的组件\"><a class=\"anchor\" href=\"#gzip的组件\">#</a> gzip 的组件</h4>\n<p>所有现代浏览器都支持  <code>gzip</code>  压缩并会为所有 HTTP 请求自动协商此类压缩。启用  <code>gzip</code>  压缩可大幅缩减所传输的响应的大小（最多可缩减 90%），从而显著缩短下载相应资源所需的时间、减少客户端的流量消耗并加快网页的首次呈现速度。</p>\n<p>从 HTTP / 1.1 开始，Web 客户端表示支持使用 HTTP 请求中的 Accept-Encoding 标头进行压缩。</p>\n<pre><code>Accept-Encoding：gzip，deflate\n</code></pre>\n<p>压缩包括 XML 和 JSON 在内的任何文本响应都是值得的。不应对图像和 PDF 文件进行 gzip 压缩，因为它们已经过压缩。试图对它们进行 gzip 不仅会浪费 CPU，还可能会增加文件大小。</p>\n<p>比如，在 nginx 中开启 gzip 压缩：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 开启 gzip</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">gzip</span> on<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 启用 gzip 压缩的最小文件，小于设置值的文件将不会压缩</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>gzip_min_length 1k<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># gzip 压缩级别，1-10，数字越大压缩的越好，也越占用 CPU 时间，后面会有详细说明</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>gzip_comp_level <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 进行压缩的文件类型。javascript 有多种形式。其中的值可以在 mime.types 文件中找到。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png font/ttf font/otf image/svg+xml<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># 是否在 http header 中添加 Vary: Accept-Encoding，建议开启</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>gzip_vary on<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 禁用 IE 6 gzip</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>gzip_disable <span class=\"token string\">\"MSIE [1-6]\\.\"</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>其他 web 容器启动 gzip 的方法：</p>\n<ul>\n<li>Apache：使用 <span class=\"exturl\" data-url=\"aHR0cDovL2h0dHBkLmFwYWNoZS5vcmcvZG9jcy9jdXJyZW50L21vZC9tb2RfZGVmbGF0ZS5odG1s\">mod_deflate</span></li>\n<li>Nginx：使用 <span class=\"exturl\" data-url=\"aHR0cDovL25naW54Lm9yZy9lbi9kb2NzL2h0dHAvbmd4X2h0dHBfZ3ppcF9tb2R1bGUuaHRtbA==\">ngx_http_gzip_module</span></li>\n<li>IIS：<span class=\"exturl\" data-url=\"aHR0cDovL3RlY2huZXQubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2NjNzcxMDAzKHY9V1MuMTApLmFzcHg=\">配置 HTTP 压缩功能</span></li>\n</ul>\n<h4 id=\"css放在顶部js放在底部\"><a class=\"anchor\" href=\"#css放在顶部js放在底部\">#</a> CSS 放在顶部，JS 放在底部</h4>\n<p>把 Javascript 脚本在底部，删除阻止渲染的 JavaScript<br />\n 在 HTML 文件 <code>&lt;body&gt;</code>  中指定外部样式表和内联样式块可能对浏览器的渲染性能产生不利影响。</p>\n<ol>\n<li>浏览器阻塞渲染网页直到所有外部的样式表都已被下载。</li>\n<li>（用 <code>&lt;style&gt;</code>  标记指定的）内联样式块可能会导致 reflows 和页面跳动。<br />\n因此，把外部样式表和内联样式块放在页面的 <code>&lt;head&gt;</code>  中是很重要的。通过确保样式表首先被下载和解析，可以让浏览器逐步渲染页面。</li>\n</ol>\n<p>具体做法：</p>\n<ul>\n<li>\n<p>将内联样式块和 <code>&lt;link&gt;</code>  元素从页面 <code>&lt;body&gt;</code>  移动到页面 <code>&lt;head&gt;</code>  中。</p>\n<p>HTML 4.01 规范（第 12.3 节）规定，始终把使用 <code>&lt;link&gt;</code>  标签的外部样式表放在 <code>&lt;head&gt;</code>  部分里，还要确保您指定的样式有正确的顺序。</p>\n</li>\n<li>\n<p>把 <code>&lt;style&gt;</code>  区块放在 <code>&lt;head&gt;</code>  部分里。</p>\n</li>\n<li>\n<p>使用 css 媒体类型</p>\n</li>\n</ul>\n<p>如果可以让 <code>CSS</code>  资源只在特定条件下使用，这样这些资源就可以在首次加载时先不进行构建 <code>CSSOM</code>  树，只有在符合特定条件时，才会让浏览器进行阻塞渲染然后构建 <code>CSSOM</code>  树。</p>\n<p><code>CSS</code>  的媒体查询正是用来实现这个功能的，它由媒体类型以及零个或多个检查特定媒体特征状况的表达式组成。</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- 没有使用媒体查询，这个 css 资源会阻塞渲染  --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style.css<span class=\"token punctuation\">\"</span></span>    <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">&lt;!-- all 是默认类型，它和不设置媒体查询的效果是一样的 --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style.css<span class=\"token punctuation\">\"</span></span>    <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">media</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>all<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!-- 动态媒体查询， 将在网页加载时计算。</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>根据网页加载时设备的方向，portrait.css 可能阻塞渲染，也可能不阻塞渲染。--></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>portrait.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">media</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>orientation:portrait<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">&lt;!-- 只在打印网页时应用，因此网页首次在浏览器中加载时，它不会阻塞渲染。 --></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>print.css<span class=\"token punctuation\">\"</span></span>    <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">media</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>print<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>使用媒体查询可以让 CSS 资源不在首次加载中阻塞渲染，但不管是哪种 CSS 资源它们的下载请求都不会被忽略，浏览器仍然会先下载 CSS 文件。</p>\n<p><strong>把 Javascript 脚本在底部，删除阻止渲染的 JavaScript</strong></p>\n<p>浏览器必须通过在呈现页面之前解析 HTML 来构建 DOM 树。如果您的浏览器在此过程中遇到脚本，则必须先停止并执行它，然后才能继续。</p>\n<p>具体做法：</p>\n<p>将脚本定义或引用放置到 <code>&lt;body&gt;</code>  底部。<br />\n <code>&lt;script defer=&quot;defer&quot;&gt;</code>  defer 属性规定是否对脚本执行进行延迟， 脚本将在页面完成解析时执行。</p>\n<p><img data-src=\"./assets/bVcQV0.jpeg\" alt=\"请输入图片描述\" /></p>\n<p>蓝色线代表网络读取，红色线代表执行时间，这俩都是针对脚本的；绿色线代表 HTML 解析。</p>\n<p>此图告诉我们以下几个要点：</p>\n<ol>\n<li><code>defer</code>  和  <code>async</code>  在网络读取（下载）这块儿是一样的，都是异步的（相较于 HTML 解析）</li>\n<li>它俩的差别在于脚本下载完之后何时执行，显然  <code>defer</code>  * 是最接近我们对于应用脚本加载和执行的要求的</li>\n<li>关于  <code>defer</code> ，此图未尽之处在于它是按照加载顺序执行脚本的，这一点要善加利用</li>\n<li><code>async</code>  则是一个乱序执行的主，反正对它来说脚本的加载和执行是紧紧挨着的，所以不管你声明的顺序如何，只要它加载完了就会立刻执行</li>\n<li>仔细想想， <code>async</code>  对于应用脚本的用处不大，因为它完全不考虑依赖（哪怕是最低级的顺序执行），不过它对于那些可以不依赖任何脚本或不被任何脚本依赖的脚本来说却是非常合适的，最典型的例子：Google Analytics</li>\n</ol>\n<h4 id=\"减少dns查找\"><a class=\"anchor\" href=\"#减少dns查找\">#</a> 减少 DNS 查找</h4>\n<p>用户访问网站的过程如下：</p>\n<ol>\n<li>\n<p>在地址栏输入网站地址，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS13d3ctZW84ZS5leGFtcGxlLmNvbQ==\">如 www.example.com</span>;</p>\n</li>\n<li>\n<p>本地 DNS 得到这个请求，查询本地 DNS 缓存，如果有这条记录，则直接返回对应的 IP；否则，请求网络上的 DNS 服务器，得到相应的 IP，返回给客户机，并缓存这条记录；</p>\n</li>\n<li>\n<p>浏览器向得到的 IP 发起建立连接请求，得到响应后建立连接，请求数据；</p>\n</li>\n<li>\n<p>Server 端计算所需数据，并返回给 client 端；</p>\n</li>\n<li>\n<p>client 端，即浏览器，解析数据并显示在浏览器窗口中，至此，请求完成。</p>\n</li>\n</ol>\n<p>在 一次请求中，DNS 解析可以占到请求时间的三分之一左右（这点有待验证），所以如果可以缩短 DNS 解析时间，就可以加快页面的打开速度。</p>\n<p>缩短 DNS 解析的 方法可以<strong>通过延长 DNS 缓存的时间</strong>，<strong>选用更快的 DNS Server</strong>，<strong>减少域名总数</strong>（例如原来有 5 个 img server，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS1pbWcxLXVoNWY1NHJvaC54eHgueG4tLWNvbWltZzUtem8wdC54eHguY29t\">分别为 img1.xxx.com 至 img5.xxx.com</span>，则现在可以减少到 3 个）等等，但是减少域名个数又会降低资源并行下载的数量， 因为同一域名最多可以并行下载两个资源，所以这里需要一个折衷方案，作者的建议就是将资源分布在大于等于 2 但小于等于 4 个域名上（这个也有待验证，例如针 对多大的系统选用多少个域名是最合理的等）。</p>\n<p><strong>使用 DNS 预解析</strong></p>\n<p>这里会有一些兼容性问题，可以参见：<span class=\"exturl\" data-url=\"aHR0cDovL2Nhbml1c2UuY29tLyNmZWF0PWxpbmstcmVsLWRucy1wcmVmZXRjaA==\">http://caniuse.com/#feat=link-rel-dns-prefetch</span></p>\n<p><img data-src=\"./assets/sdfdsf.png\" alt=\"sdfdsf\" /></p>\n<p>在网页体验中我们常会遇到这种情况，即在调用百度联盟、谷歌联盟以及当前网页所在域名外的域名文件时会遇到请求延时非常严重的情况。那么有没有方法去解决这种请求严重延时的现象呢？</p>\n<p>一般来说这种延时的原因不会是对方网站带宽或者负载的原因，那么到底是什么导致了这种情况呢。湛蓝试着进行推测，假设是 DNS 的问题，因为 DNS 解析速度很可能是造成资源延时的最大原因。在页面 header 中添加了以下代码（用以 DNS 预解析）：</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>x-dns-prefetch-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>on<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dns-prefetch<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://bdimg.share.baidu.com<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dns-prefetch<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://nsclick.baidu.com<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dns-prefetch<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://hm.baidu.com<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dns-prefetch<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://eiv.baidu.com<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><p>dns-prefetch 需慎用，多页面重复 DNS 预解析会增加重复 DNS 查询次数。</p>\n<p>使用场景：</p>\n<ol>\n<li>新用户访问，后端可以通过 Cookie 判断是否为首次进入站点，对于这类用户，DNS Prefetch 可以比较明显地提升访问速度</li>\n<li>登录页，提前在页面上进行下一跳页用到资源的 DNS Prefetch</li>\n<li>页面中的静态资源在不同的 domain 下，如 CSS、JS、图片等文件</li>\n<li>电商网站的商品页大量载入不同 domain 下的商品图，如淘宝</li>\n<li>手机网页</li>\n<li>大型网站</li>\n<li>js 或服务端重定向</li>\n</ol>\n<blockquote>\n<p>Chrome 中的一些指令：</p>\n<ul>\n<li><code>chrome://histograms/DNS.PrefetchQueue</code> ：查看队列状态</li>\n<li><code>chrome://histograms/DNS</code> ：查看从浏览器启动到上一页的 DNS 记录</li>\n<li><code>chrome://dns</code> ：查看个域名 DNS 统计</li>\n<li><code>chrome://net-internals/#dns</code> ：清除 host 缓存</li>\n</ul>\n</blockquote>\n<h4 id=\"压缩资源\"><a class=\"anchor\" href=\"#压缩资源\">#</a> 压缩资源</h4>\n<ul>\n<li>\n<p>压缩 js，css，image</p>\n<p><strong>通过对外部资源进行压缩可以大幅度地减少浏览器需要下载的资源量，它会减少关键路径长度与关键字节，使页面的加载速度变得更快。</strong></p>\n<p><strong>对数据进行压缩其实就是使用更少的位数来对数据进行重编码</strong>。如今有非常多的压缩算法，且每一个的作用领域也各不相同，它们的复杂度也不相同，不过在这里我不会讲压缩算法的细节，感兴趣的朋友可以自己 Google。</p>\n<p>在对 <code>HTML</code> 、 <code>CSS</code>  和 <code>JavaScript</code>  这些文件进行压缩之前，还需要先进行一次冗余压缩。<strong>所谓冗余压缩，就是去除多余的字符，例如注释、空格符和换行符</strong>。这些字符对于程序员是有用的，毕竟没有格式化的代码可读性是非常恐怖的，但它们对于浏览器是没有任何意义的，去除这些冗余可以减少文件的数据量。</p>\n<p>小图片采用 base64 的格式，直接嵌入代码中，可以帮我们减少 http 请求，但是同样，这个会造成我们代码的提及变大。请求的速度会减慢，这个需要平衡。</p>\n<p>常用工具：webpack，gulp</p>\n<blockquote>\n<p>浏览器接收到服务器返回的 HTML、CSS 和 JavaScript 字节数据并对其进行解析和转变成像素的渲染过程被称为 <code>关键渲染路径</code> 。通过优化关键渲染路径即可以缩短浏览器渲染页面的时间。</p>\n</blockquote>\n</li>\n<li>\n<p>删除重复的脚本，类似 <code>tree-shaking</code></p>\n<p>在一个页面中重复引用一个脚本可能存在的问题：浏览器会重复下载并执行脚本文件。</p>\n</li>\n<li>\n<p>使用合适大小的图片</p>\n<p>如果你只需要一个小图，就不要传一个大图。例如你实际需要显示的是一个 60x60 的头像，就不要传一个 100x100 的然后再通过设置宽高将它缩小为 60x60 的。原因很简单，这样会消耗不必要的带宽和系统资源。</p>\n</li>\n<li>\n<p>减少 DOM 元素的数量</p>\n<p>复杂页面意味着要下载更多字节，这也意味着 JavaScript 中的 DOM 访问速度更慢。如果您想要添加事件处理程序，例如，在页面上循环 500 或 5000 个 DOM 元素，则会有所不同。</p>\n</li>\n<li>\n<p>使用异步加载，async、defer</p>\n<blockquote>\n<p>服务端渲染也是一种减少浏览器资源消耗，减少页面重排重绘，也是一种现行 MVVM 框架单页应用最主要的 SEO 优化手段。</p>\n</blockquote>\n</li>\n</ul>\n<h4 id=\"避免3xx4xx\"><a class=\"anchor\" href=\"#避免3xx4xx\">#</a> 避免 3xx/4xx</h4>\n<p><strong>避免重定向</strong></p>\n<p>3xx 是重定向相关的 HTTP 响应代码</p>\n<p>重定向的意思是，用户的原始请求（例如请求 A）被重定向到其他的请求（例如请求 B）。</p>\n<p>每次页面重定向到另一个页面时，您的访问者都会面临等待 HTTP 请求 - 响应周期完成的额外时间。例如，如果移动重定向模式如下所示：</p>\n<p><code>example.com</code>  - &gt;  <code>www.example.com</code>  - &gt;  <code>m.example.com</code>  - &gt;  <code>m.example.com/home</code> ，这两个额外重定向中的每一个都会使您的页面成为可能加载速度慢。</p>\n<p>HTTP 重定向通过  <code>301</code> / <code>302</code>  状态码实现。</p>\n<pre><code>HTTP/1.1 301 Moved Permanently  \nLocation: http://example.com/newuri  \nContent-Type: text/html  \n</code></pre>\n<p><code>301 Moved Permanently</code> ，这个状态码标识用户所请求的资源被移动到了另外的位置，客户端接收到此响应后，需要发起另外一个请求去下载所需的资源。</p>\n<p><code>302 Found</code> ，这个状态码标识用户所请求的资源被找到了，但不在原始位置，服务器会回复其他的一个位置，客户端收到此响应后，也需要发起另外一个请求去下载所需的资源。</p>\n<p>客户端收到服务器的重定向响应后，会根据响应头中  <code>Location</code>  的地址再次发送请求。重定向会影响用户体验，尤其是多次重定向时，用户在一段时间内看不到任何内容，只看到浏览器进度条一直在刷新。</p>\n<p>有时重定向无法避免，在糟糕也比抛出  <code>404</code>  好。虽然通过 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmp1ZWppbi5pbS8/dGFyZ2V0PWh0dHBzJTNBJTJGJTJGZW4ud2lraXBlZGlhLm9yZyUyRndpa2klMkZNZXRhX3JlZnJlc2g=\">HTML meta refresh</span> 和 JavaScript 也能实现，但首选 HTTP  <code>3xx</code>  跳转，以保证浏览器「后退」功能正常工作（也利于 SEO）。</p>\n<p><strong>常见的优化办法：</strong></p>\n<ul>\n<li>\n<p>最浪费的重定向经常发生、而且很容易被忽略：URL 末尾应该添加  <code>/</code>  但未添加。比如，访问  <code>http://astrology.yahoo.com/astrology</code>  将被 301 重定向到  <code>http://astrology.yahoo.com/astrology/</code> （注意末尾的  <code>/</code> ）。如果使用 Apache，可以通过  <code>Alias</code>  或  <code>mod_rewrite</code>  或  <code>DirectorySlash</code>  解决这个问题。</p>\n</li>\n<li>\n<p>网站域名变更：CNAME 结合  <code>Alias</code>  或  <code>mod_rewrite</code>  或者其他服务器类似功能实现跳转。</p>\n</li>\n<li>\n<p>在定义链接地址的 href 属性的时候，尽量使用最完整的、直接的地址。例如：<br />\n使用  <code>www.cnblogs.com</code>  而不是 <code>cnblogs.com</code> <br />\n 使用 <code>cn.bing.com</code>  而不是 <code>bing.com</code> <br />\n 使用 <code>www.google.com.hk</code>  而不是 <code>google.com</code> <br />\n 使用 <code>www.mysite.com/products/</code>  而不是 <code>www.mysite.com/products</code></p>\n</li>\n</ul>\n<p><strong>避免 404 浏览器找不到资源的情况发生</strong></p>\n<p>发出 HTTP 请求并获得无用的响应（即 404 Not Found）是完全没必要的。特别糟糕的是当外部 JavaScript 的链接错误并且结果是 404 时。首先，此下载将阻止并行下载。接下来，浏览器可能会尝试解析 404 响应主体，就像它是 JavaScript 代码一样，这样就带来的性能的浪费。</p>\n<p><strong>404 的影响：</strong></p>\n<p>有时候，404 错误发生了，用户可能根本没有感觉到。例如</p>\n<ul>\n<li>例如请求 favicon.ico 文件，或者请求了某个不存在的脚本文件、样式表、图片文件，页面还是会按照正常的方式进行呈现。</li>\n<li>丢失的脚本文件、样式表、图片文件，会导致页面的某些行为、界面效果出现异常（也可能不是很明显）</li>\n<li>最大的问题可能是性能方面的影响。尤其是如果请求一个不存在的脚本文件，因为浏览器在请求脚本文件的时候，即便是返回 404，它也会尝试去按照 Javascript 的方式解析响应中的内容。这无疑会增加很多处理的时间，而因为该文件不存在，所以这些都是无用功。</li>\n</ul>\n<p>看得到的影响：</p>\n<ul>\n<li>如果用户请求的某个页面不存在，那么他将收到明确的回应</li>\n<li>默认情况下，他将收到一个标准的错误页面（请注意：不少用户会被这个页面吓到）</li>\n</ul>\n<p><strong>常见的优化办法：</strong></p>\n<p>404 意味着 Not Found，意思是说未找到资源。既然如此，那么至少会有两种原因导致 404 错误：</p>\n<ul>\n<li>该资源按理说是要有，但我们没有提供。用户按照正常的方式来请求，所以资源找不到。\n<ul>\n<li>为网站提供 favicon.ico 这种经常可能会被忽略的资源</li>\n<li>使用一些检查工具：比如 Link checker</li>\n</ul>\n</li>\n<li>该资源本来就不存在，用户按照不正常的方式来请求，当然还是找不到。\n<ul>\n<li>避免用户收藏绝对地址，给后期更新带来隐患。可以使用地址 Rewrite 来重写，或者在设计阶段定义一些灵活友好的地址</li>\n<li>使用 Routing 技术，配置路由规则。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"ajax优化\"><a class=\"anchor\" href=\"#ajax优化\">#</a> AJAX 优化</h4>\n<p><strong>使 Ajax 可缓存</strong></p>\n<p>AJAX=Asynchronous JavaScript And XML，AJAX 不是新的编程语言，而是一种使用现有标准的新方法。<br />\nAJAX 是与服务器交换数据并更新部分网页的艺术，在不重新加载整个页面的情况下。</p>\n<p>由于 AJAX 其实也是需要发起请求，然后服务器执行，并将结果（通常是 JSON 格式的）发送给浏览器进行最后的呈现或者处理，所以对于网站设计优化的角度而言，我们同样需要考虑对这些请求，是否可以尽可能的利用到缓存的功能来提高性能。</p>\n<p>对于 AJAX 而言，有一些特殊性，并不是所有的 AJAX 请求都是可以缓存的。</p>\n<ol>\n<li><code>POST</code>  的请求，是不可以在客户端缓存的，每次请求都需要发送给服务器进行处理，每次都会返回状态码 200。（这里可以优化的是，服务器端对数据进行缓存，以便提高处理速度）</li>\n<li><code>GET</code>  的请求，是可以（并且默认）在客户端进行缓存的，除非指定了不同的地址，否则同一地址的 AJAX 请求，不会重复再服务器执行，而是返回 304。</li>\n</ol>\n<p>有的时候，我们可能希望 <code>GET</code>  请求不被缓存，有几种做法来达到这样的目的。</p>\n<ol>\n<li>每次调用的时候，请求不同的地址（可以在原始地址后面添加一个随机的号码）。</li>\n<li>如果你所使用的是 jquery 的话，则可以考虑禁用 AJAX 的缓存。</li>\n</ol>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$<span class=\"token punctuation\">.</span><span class=\"token function\">ajaxSetup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">cache</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>axios 中</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\t<span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span><span class=\"token string-property property\">'Cache-Control'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'no-cache'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/post'</span><span class=\"token punctuation\">,</span>config<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><strong>使用 GET 的 Ajax 请求</strong></p>\n<p>在使用 XMLHttpRequest（目前的 AJAX 都是基于它实现的）的时候，浏览器中的 POST 实现为两步走的过程，首先发送头部信息，然后再发送数据。但如果是使用 GET 的话，就只有一个 TCP 的包发送出去（除非有大量的 Cookie），这样无疑可以提高性能。</p>\n<p>但是 get 有容量限制，大于 2K (对 get 的限制 IE 是 2K，firefox、chrome 是 4K) 的内容只能用 post。</p>\n<h4 id=\"cookie优化\"><a class=\"anchor\" href=\"#cookie优化\">#</a> Cookie 优化</h4>\n<ul>\n<li>\n<p>减小 cookie 大小</p>\n<p>减小 cookie 的大小，因为在发请求时浏览器会将 cookie 信息发送到 server 端，所以应该只在 cookie 中存必要的信息且越长度越小越好。在 写 cookie 的时候要记得给 cookie 设置一个合理的过期时间及域</p>\n</li>\n<li>\n<p>对一些静态资源不需要使用 cookie 的单独设置域</p>\n<p>当浏览器发出静态图像请求并将 cookie 与请求一起发送时，服务器对这些 cookie 没有任何用处。因此，他们只会毫无理由地创建网络流量。您应该确保使用无 cookie 请求请求静态组件。创建一个子域并在那里托管所有静态组件。</p>\n<p>如果您的域名是 <code>www.example.org</code> ，您可以托管您的静态组件 <code>static.example.org</code> 。但是，如果您已经在顶级域上设置了 cookie  <code>example.org</code>  而不是 <code>www.example.org</code> ，则所有请求都  <code>static.example.org</code>  将包含这些 cookie。在这种情况下，您可以购买一个全新的域，在那里托管您的静态组件，并保持此域无 cookie。雅虎 用途 <code>yimg.com</code> ，YouTube 使用 <code>ytimg.com</code> ，亚马逊使用 <code>images-amazon.com</code>  等。</p>\n<p>在无 cookie 域上托管静态组件的另一个好处是，某些代理可能拒绝缓存使用 cookie 请求的组件。在相关说明中，如果您想知道是否应该使用 <code>example.org</code>  或 <code>www.example.org</code>  作为主页，请考虑 cookie 的影响。</p>\n<blockquote>\n<p>省略 www 会让您别无选择，只能写入 cookie  <code>*.example.org</code> ，因此出于性能原因，最好使用 www 子域并将 cookie 写入该子域。</p>\n</blockquote>\n</li>\n</ul>\n<p>归类一下：</p>\n<ul>\n<li>去除不必要的 Cookie；</li>\n<li>尽量压缩 Cookie 大小；</li>\n<li>注意设置 Cookie 的 domain 级别，如无必要，不要影响到 sub-domain；</li>\n<li>设置合适的过期时间。</li>\n</ul>\n<h4 id=\"利用缓存\"><a class=\"anchor\" href=\"#利用缓存\">#</a> 利用缓存</h4>\n<p>浏览器会缓存大量信息（样式表，图像，JavaScript 文件等），以便当访问者返回您的站点时，浏览器不必重新加载整个页面。然后设置 “expires” 标题，以表示希望缓存该信息的时间。在许多情况下，除非您的网站设计经常更改，否则一年是合理的时间段。</p>\n<p><strong>利用浏览器缓存 ，为链接或者资源，添加 Expires 或 Cache-Control 头</strong></p>\n<ul>\n<li>对于静态组件：通过设置远期未来 <code>Expires</code>  标头实现 “永不过期” 策略</li>\n<li>对于动态组件：使用适当的 <code>Cache-Control</code>  标头来帮助浏览器处理条件请求</li>\n</ul>\n<p>格式：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Expires <span class=\"token operator\">=</span> <span class=\"token string\">\"Expires\"</span> <span class=\"token string\">\":\"</span> HTTP-date</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># e.g.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Expires: Thu, 01 Dec <span class=\"token number\">1994</span> <span class=\"token number\">16</span>:00:00 GMT </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#（必须是 GMT 格式）</span></pre></td></tr></table></figure><p>通过 HTTP 的 META 设置 expires 和 cache-control</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Cache-Control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>max-age=7200<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Expires<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Mon, 01 Aug 2019 00:00:00 GMT<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><p>上述设置仅为举例，实际使用其一即可。这样写的话仅对该网页有效，对网页中的图片或其他请求无效，并不会做任何 <code>cache</code> 。<br />\n这样客户端的请求就多了，尽管只是检查 <code>Last-modified</code>  状态的东西，但是请求一多对浏览速度必定有影响。</p>\n<p><code>Cache-Control</code>  的参数包括:</p>\n<ul>\n<li><strong>max-age=</strong>[单位：秒 seconds] — 设置缓存最大的有效时间。类似于  <code>Expires</code> , 但是这个参数定义的是时间大小（比如：60）而不是确定的时间点。单位是 [秒 seconds].</li>\n<li><strong>s-maxage=</strong>[单位：秒 seconds] — 类似于  <code>max-age</code> , 但是它只用于公享缓存 (e.g., proxy) .</li>\n<li><strong>public</strong> — 响应会被缓存，并且在多用户间共享。正常情况，如果要求 <span class=\"exturl\" data-url=\"aHR0cDovL2JhaWtlLmJhaWR1LmNvbS92aWV3LzIwNzY0MDguaHRt\">HTTP 认证</span>，响应会自动设置为 private.</li>\n<li><strong>private</strong> — 响应只能够作为私有的缓存 (e.g., 在一个浏览器中)，不能再用户间共享。</li>\n<li><strong>no-cache</strong> — 响应不会被缓存，而是实时向服务器端请求资源。这一点很有用，这对保证<span class=\"exturl\" data-url=\"aHR0cDovL2JhaWtlLmJhaWR1LmNvbS92aWV3LzIwNzY0MDguaHRt\"> HTTP 认证</span>能够严格地禁止缓存以保证安全性很有用（这是指页面与 public 结合使用的情况下）. 既没有牺牲缓存的效率，又能保证安全。</li>\n<li><strong>no-store</strong> — 在任何条件下，响应都不会被缓存，并且不会被写入到客户端的磁盘里，这也是基于安全考虑的某些敏感的响应才会使用这个。</li>\n<li><strong>must-revalidate</strong> — 响应在特定条件下会被重用，以满足接下来的请求，但是它必须到服务器端去验证它是不是仍然是最新的。</li>\n<li><strong>proxy-revalidate</strong> — 类似于  <code>must-revalidate</code> , 但不适用于代理缓存.</li>\n</ul>\n<p><strong>把 css 与 js 使用外联的方式进行使用</strong></p>\n<p>建议将 css 和 js 以外联方式引用以充分利用 <code>cache</code> ，只有一个例外就是针对首页，首页可以采用内联来减少 http 请求数，加快页面显示速度，文中说首 页内联的原因是首页被人们访问的次数不会太多，而且样式一般比较特殊，不像其它页面一样有相同的页面模板（因为就有相同的样式部分），所以首页的样式可以 内联。并且应该在首页加载完成之后，再在后台动态加载后续页面的 css 和 js，以提高后续页面的访问速度。</p>\n<p>如果站点上的用户每个会话有多个页面查看，并且您的许多页面重复使用相同的脚本和样式表，则缓存的外部文件可能会带来更大的潜在好处。</p>\n<blockquote>\n<p>对于现在的单页面的应用，更适合于动态加载的方案</p>\n</blockquote>\n<p><strong>缓存 favicon.ico，并设置最好小于 1k</strong></p>\n<p>favicon.ico 是一个保留在服务器根目录中的图片，为了减轻拥有 favicon.ico 的带来的性能问题，请确保：</p>\n<ul>\n<li>优化它的大小，最好不到 1K。</li>\n<li>设置 Expires 标头，使其缓存。</li>\n</ul>\n<p><strong>配置的 ETag</strong></p>\n<p>ETag，全程为： <code>Entity Tag</code> ，意思是实体标签，它属于 HTTP 协议的一部分，也就是所有的 Web 服务器都应该支持这个特性。它的作用是用一个特殊的字符串来标识某个资源的 “版本”，客户端（浏览器）请求的时候，比较 ETag 如果一致，则表示该资源并没有被修改过，客户端（浏览器）可以使用自己缓存的版本，避免重复下载。<br />\n它比 last-modified date 更具有弹性，例如某个文件在 1 秒内修改了 10 次，Etag 可以综合 Inode (文件的索引节点 (inode) 数)，MTime (修改时间) 和 Size 来精准的进行判断，避开 UNIX 记录 MTime 只能精确到秒的问题。 服务器集群使用，可取后两个参数。使用 ETags 减少 Web 应用带宽和负载。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">响应标</th>\n<th style=\"text-align:left\">优势 和特点</th>\n<th style=\"text-align:left\">劣势 和可能的问题</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Expires</td>\n<td style=\"text-align:left\">- HTTP 1.0 就有，简单易用。 - 服务器通过这个 Header 告诉浏览器，某资源直到某个时间才会过期，所以在没有过期之前，浏览器就直接使用本地的缓存了。</td>\n<td style=\"text-align:left\">- 因为这是时间是由服务器发送的（UTC），但如果服务器时间和客户端事件存在不一致，可能会有些问题。 - 可能存在版本的问题，因为如果在到期之前修改过了，客户端是不会知道的。 - Cache-Control 中的 max-age 可以实现类似的效果，但更加好，因为 max-age 是一个以秒为单位的时间数，而不是具体的时间，所以不存在上面提到的第一个问题。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Cache-Contro</td>\n<td style=\"text-align:left\">- 服务器通过一个 Header（Last-Modified）告诉浏览器，某资源最后修改的时间。 - 浏览器在请求的时候，包含一个 Header（If-Modified-Since）, 然后服务器可以进行比较，如果在该时间后没有修改过，则返回 304。 - 它比 Expires 多很多选项设置</td>\n<td style=\"text-align:left\">- Last-Modified 也是一个时间，但该时间只能精确到秒，如果在同一个秒中有多次修改（这个在现在的环境下应该确实是可能的），则可能会发生问题。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ETag</td>\n<td style=\"text-align:left\">- 可以更加精确地判断资源是否被修改，因为它不是一个时间值，而是对时间经过处理的一个长整型数值（当然具体算法我们目前还不得而知）。 - 浏览器发起新请求时需要包含 If-None-Match。</td>\n<td style=\"text-align:left\">- 如果部署在服务器场环境中，配置不当的话，可能每个服务器会对相同的资源生成不一样的 ETag，这样就增加了重复下载的可能性。</td>\n</tr>\n</tbody>\n</table>\n<p>我们来看一个真实的例子：</p>\n<p><img data-src=\"./assets/image-20190619145105413.png\" alt=\"image-20190619145105413\" /></p>\n<p>其他的一些缓存使用：</p>\n<ul>\n<li>使用本地缓存，缓存部分常用用户数据、公开数据</li>\n<li>缓存机制设计：缓存 + 过期时间</li>\n</ul>\n<p>总结一下：</p>\n<ul>\n<li>添加 Expires 或 Cache-Control</li>\n<li>Etag</li>\n<li>缓存 favicon.ico</li>\n<li>外联 js/css</li>\n</ul>\n<h4 id=\"缩短服务器响应时间\"><a class=\"anchor\" href=\"#缩短服务器响应时间\">#</a> 缩短服务器响应时间</h4>\n<p>服务器响应时间受到访问流量，每个页面使用的资源，服务器使用的软件以及硬件本身的影响。要改善服务器响应时间，请查找性能瓶颈，如慢速数据库查询，慢速路由或缺少足够的内存并修复它们。最佳服务器响应时间低于 200 毫秒。</p>\n<p>很多潜在因素都可能会延缓服务器响应，例如缓慢的应用逻辑、缓慢的数据库查询、缓慢的路由、框架、库、资源 CPU 不足或内存不足。您需要充分考虑所有这些因素，才能改善服务器的响应用时。 若想找出服务器响应用时过长的原因，首先要进行衡量。然后，准备好相关数据，并参阅有关如何解决该问题的相应指导。当解决问题后，您必须继续衡量服务器响应用时，并设法应对任何会在将来出现的性能瓶颈问题。</p>\n<ol>\n<li><strong>收集并检查</strong>现有性能和数据。若无可用内容，请使用自动化的网络应用监测解决方案（市面上有托管的开源版本，适用于大多数平台）进行评估，或添加自定义的方法。</li>\n<li><strong>找出并修复</strong>首要的性能瓶颈问题。如果 z 您使用的是热门网页框架或内容管理平台，请参阅与性能优化最佳做法相关的文档。</li>\n<li><strong>监测并提醒</strong>任何会在将来出现的性能衰退问题！</li>\n</ol>\n<blockquote>\n<p>通常来说，服务器的响应时间由数据库的问题居多，还有错误的程序设计 (比如：烂用 for 循环去查数据库)。</p>\n</blockquote>\n<h3 id=\"优化工具\"><a class=\"anchor\" href=\"#优化工具\">#</a> 优化工具</h3>\n<h4 id=\"google-page-speed\"><a class=\"anchor\" href=\"#google-page-speed\">#</a> Google Page Speed</h4>\n<p>Google Page Speed 以帮助开发人员和网站所有者确保他们的网页尽可能顺畅，快速地运行。</p>\n<p><strong>Google Page Speed 特点：</strong></p>\n<ul>\n<li>在 CSS 方面更加注重细节，对于 CSS 选择器，Google Page Speed 提供了大量有用的建议</li>\n<li>页面速度活动功能类似于加载计时器评估，但它实时提供图表，因此可以在任何给定时间准确查看网站上发生的情况。</li>\n<li>自动优化：使用 PageSpeed 模块，可以将 Google 与您的 Nginx 或 Apache 网站服务器集成，以自动优化您的网站。</li>\n<li>优化库集成：可以找到 PageSpeed 模块背后优化建议，允许设计和构建自己的工具。</li>\n</ul>\n<p>对于某些人来说，Google Page Speed 将是显而易见的选择，因为它可以与其他对维护网站性能至关重要的 Google 工具一起使用，例如 Google Analytics。</p>\n<h4 id=\"jsperf-benchmarkjs\"><a class=\"anchor\" href=\"#jsperf-benchmarkjs\">#</a> JsPerf &amp; Benchmark.js</h4>\n<p>经常看到项目中有一个 benchmark 的文件夹，那么这个 benchmark 是干嘛用的？</p>\n<p>JsPerf 在线：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qc3BlcmYuY29tLw==\">https://jsperf.com/</span></p>\n<p>JsPerf Github 地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2pzcGVyZi9qc3BlcmYuY29t\">https://github.com/jsperf/jsperf.com</span></p>\n<p>Benchmark.js 网址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Jlc3RpZWpzL2JlbmNobWFyay5qcw==\">https://github.com/bestiejs/benchmark.js</span></p>\n<p>BenchMark.js 可以本地安装，而 JsPerf.js 是线上使用的。</p>\n<p>HTML 中引入：</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lodash.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>platform.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>benchmark.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>或者使用 <code>npm</code> :</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token punctuation\">&#123;</span>sudo -H<span class=\"token punctuation\">&#125;</span> <span class=\"token function\">npm</span> i <span class=\"token parameter variable\">-g</span> <span class=\"token function\">npm</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>$ <span class=\"token function\">npm</span> i <span class=\"token parameter variable\">--save</span> benchmark</pre></td></tr></table></figure><p>下面是一个具体的用例：</p>\n<p>Reg vs IndexOf</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> suite <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Benchmark<span class=\"token punctuation\">.</span>Suite</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// add tests</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>suite<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'RegExp#test'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">o</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'String#indexOf'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'o'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// add listeners</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cycle'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'complete'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fastest is '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fastest'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">// run async</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string-property property\">'async'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">// logs:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">// => RegExp#test x 4,161,532 +-0.99% (59 cycles)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">// => String#indexOf x 6,139,623 +-1.00% (131 cycles)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">// => Fastest is String#indexOf</span></pre></td></tr></table></figure><p>再来看一个 call 与 apply 的对比：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> Benchmark <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'benchmark'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> suite <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Benchmark<span class=\"token punctuation\">.</span>Suite</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">arr1</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">str</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">str2</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">str</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 添加测试</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>suite<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'arr1'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token function\">arr1</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'str2'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token function\">str2</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">// add listeners</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cycle'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'complete'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fastest is '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fastest'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pluck</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">// run async</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string-property property\">'async'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>benckmark 是对 js 运行能效的一个对比测试，让你能够知道自己的 JS 代码中与其他方案对比的时候，是否有优化的空间。当然，这些新的方案，需要自己去编写去测试。同样，也可以在 JsPerf 的官网上去看其他的测试结果。</p>\n<p>执行办法 ：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>npm init <span class=\"token operator\">-</span>y</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>npm install <span class=\"token operator\">-</span><span class=\"token constant\">S</span> benchmark</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>touch test<span class=\"token punctuation\">.</span>js <span class=\"token comment\">//Linux</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>node test<span class=\"token punctuation\">.</span>js</pre></td></tr></table></figure><h2 id=\"代码优化写出优质的代码\"><a class=\"anchor\" href=\"#代码优化写出优质的代码\">#</a> 代码优化 —— 写出优质的代码</h2>\n<p>命题很大，但是我们要简化来谈一下。</p>\n<p>代码优化，先要写出优质的代码，有几点原则：</p>\n<ul>\n<li>使用辅助应用对代码进行检查，Eslint 等</li>\n<li>使用预编译工具，如 less，sass，stylus。</li>\n<li>使用官方的开发规范：命名规范、注释、使用规范、文档规范</li>\n<li>写出逻辑上易于阅读的代码：设计模式、代码结构、文档编排 (目录结构)</li>\n<li>代码审查</li>\n<li>单元测试</li>\n<li>异常与错误机制</li>\n</ul>\n<p>之后就是练习与阅读，阅读别人的代码，学习别人的精华，了解别人代码中的缺点。使用 JsPerf 或者 benchemark 去对比优化性能。</p>\n<p>前端代码规范：Airbnb，github，Google，腾讯，阿里等。</p>\n<h2 id=\"jsperf\"><a class=\"anchor\" href=\"#jsperf\">#</a> JsPerf</h2>\n<h3 id=\"jsperf使用简介\"><a class=\"anchor\" href=\"#jsperf使用简介\">#</a> JsPerf 使用简介</h3>\n<h4 id=\"线上使用方案\"><a class=\"anchor\" href=\"#线上使用方案\">#</a> 线上使用方案</h4>\n<p>需要使用 Github 进行登录：</p>\n<p><img data-src=\"./assets/image-20190618210408261.png\" alt=\"image-20190618210408261\" /></p>\n<p>点击 <code>Login with Github to Create Test Cases</code> :</p>\n<p><img data-src=\"./assets/image-20190619103010414.png\" alt=\"image-20190619103010414\" /></p>\n<p>登录之后，进入授权页面：</p>\n<p><img data-src=\"./assets/image-20190619103140822.png\" alt=\"image-20190619103140822\" /></p>\n<p>登录过后，就可以创建自己的测试用例啦：</p>\n<p>\u0001<img data-src=\"./assets/image-20190619143549467.png\" alt=\"image-20190619143549467\" /></p>\n<h4 id=\"线下使用方案\"><a class=\"anchor\" href=\"#线下使用方案\">#</a> 线下使用方案：</h4>\n<p>环境准备：</p>\n<ul>\n<li>Mysql</li>\n<li>Nodejs</li>\n</ul>\n<p>创建过程：</p>\n<ol>\n<li>\n<p>安装 Mysql</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mysql <span class=\"token parameter variable\">-uroot</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"CREATE DATABASE jsperf; GRANT ALL ON jsperf.* TO 'jsuser'@'localhost' IDENTIFIED BY 'jspass'; FLUSH PRIVILEGES;\"</span></pre></td></tr></table></figure></li>\n<li>\n<p>在 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYnJvd3NlcnNjb3BlLm9yZy8=\">Browserscope.org</span> 注册一个 API key ，在 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYnJvd3NlcnNjb3BlLm9yZy91c2VyL3NldHRpbmdz\">the settings page</span> 页面中.</p>\n</li>\n<li>\n<p>注册一个 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NldHRpbmdzL2FwcGxpY2F0aW9ucy9uZXc=\">new OAuth GitHub application</span>. 使用 callback URL 留空。复制 &quot;Client ID&quot; 和 &quot;Client Secret&quot; 到 github 的页面上。</p>\n</li>\n<li>\n<p>使用 <code>npm install</code>  安装</p>\n</li>\n<li>\n<p>配置 <code>.env</code>  的文件</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">NODE_ENV</span><span class=\"token operator\">=</span>development</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># from Prerequisites step 1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">MYSQL_USER</span><span class=\"token operator\">=</span>jsuser</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">MYSQL_PASSWORD</span><span class=\"token operator\">=</span>jspass</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">MYSQL_DATABASE</span><span class=\"token operator\">=</span>jsperf</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># from Prerequisites step 2</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">BROWSERSCOPE</span><span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># from Prerequisites step 3</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">GITHUB_CLIENT_ID</span><span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">GITHUB_CLIENT_SECRET</span><span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">GITHUB_CALLBACK</span><span class=\"token operator\">=</span>http://localhost:3000</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">BELL_COOKIE_PASS</span><span class=\"token operator\">=</span>password-should-be-32-characters</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token assign-left variable\">COOKIE_PASS</span><span class=\"token operator\">=</span>password-should-be-32-characters</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># customizable but not recommended for local development</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># SCHEME=http</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># DOMAIN=localhost</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># PORT=3000</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\"># MYSQL_HOST=localhost</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># MYSQL_PORT=3306</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\"># LOGGLY_TOKEN=</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># LOGGLY_SUBDOMAIN=</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># REDIS_HOST=</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\"># REDIS_PORT=</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\"># REDIS_PASSWORD=</span></pre></td></tr></table></figure><ol start=\"6\">\n<li>运行 <code>npm start</code></li>\n</ol>\n<h3 id=\"代码示例for-vs-foreach\"><a class=\"anchor\" href=\"#代码示例for-vs-foreach\">#</a> 代码示例 for vs foreach</h3>\n<p>我们对比一下 for 与 foreach</p>\n<p><img data-src=\"./assets/screencapture-jsperf-2019-06-18-21_15_29.png\" alt=\"screencapture-jsperf-2019-06-18-21_15_29\" /></p>\n<p>测试过程：</p>\n<p><img data-src=\"./assets/image-20190618211820471.png\" alt=\"image-20190618211820471\" /></p>\n<p>测试结果：</p>\n<p><img data-src=\"./assets/image-20190618211915799.png\" alt=\"image-20190618211915799\" /></p>\n<p>这里有一个更全面的对比结果：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qc3BlcmYuY29tL2Zvci12cy1mb3JlYWNoLzc1\">https://jsperf.com/for-vs-foreach/75</span></p>\n<p><img data-src=\"./assets/image-20190618213130251.png\" alt=\"image-20190618213130251\" /></p>\n<p><img data-src=\"./assets/image-20190618213201840.png\" alt=\"image-20190618213201840\" /></p>\n<p>还有一些比较有意思的测试：</p>\n<p>可以通过浏览：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qc3BlcmYuY29tL3BvcHVsYXI=\">https://jsperf.com/popular</span> 进行查看</p>\n<p><img data-src=\"./assets/image-20190619143653346.png\" alt=\"image-20190619143653346\" /></p>\n<h3 id=\"前端项目优化实践\"><a class=\"anchor\" href=\"#前端项目优化实践\">#</a> 前端项目优化实践</h3>\n<p>我们来对比下 Date () 与 Moment () 中的 format</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> Benchmark <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'benchmark'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> moment <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'moment'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">Date</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">Format</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">fmt</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">var</span> o <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token string-property property\">\"M+\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 月份</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token string-property property\">\"d+\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 日</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token string-property property\">\"h+\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 小时</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token string-property property\">\"m+\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMinutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 分</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token string-property property\">\"s+\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSeconds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 秒</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token string-property property\">\"q+\"</span><span class=\"token operator\">:</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 季度</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token string-property property\">\"S\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMilliseconds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 毫秒</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">(y+)</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>fmt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> fmt <span class=\"token operator\">=</span> fmt<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span> <span class=\"token operator\">-</span> RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> k <span class=\"token keyword\">in</span> o<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"(\"</span> <span class=\"token operator\">+</span> k <span class=\"token operator\">+</span> <span class=\"token string\">\")\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>fmt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> fmt <span class=\"token operator\">=</span> fmt<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"00\"</span> <span class=\"token operator\">+</span> o<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span> <span class=\"token operator\">+</span> o<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token keyword\">return</span> fmt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">var</span> suite <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Benchmark<span class=\"token punctuation\">.</span>Suite</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">// add tests</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>suite<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Date format'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Format</span><span class=\"token punctuation\">(</span><span class=\"token string\">'yyyy-MM-dd hh:mm:ss'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Moment format'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">'YYYY-MM-DD HH:mm:ss'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token comment\">// add listeners</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cycle'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'complete'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fastest is '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fastest'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token comment\">// run async</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string-property property\">'async'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>输出结果 ：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Moment <span class=\"token function\">format</span> x <span class=\"token number\">73,570</span> ops/sec ±4.93% <span class=\"token punctuation\">(</span><span class=\"token number\">82</span> runs sampled<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Fastest is Moment <span class=\"token function\">format</span></pre></td></tr></table></figure><h2 id=\"pagespeed\"><a class=\"anchor\" href=\"#pagespeed\">#</a> PageSpeed</h2>\n<h3 id=\"pagespeed简介\"><a class=\"anchor\" href=\"#pagespeed简介\">#</a> PageSpeed 简介</h3>\n<p>PageSpeed Insights 的 Chrome 扩展是由谷歌官方开发的一款可以分析页面载入的各个方面，包括资源、网络、DOM 以及时间线等等信息的插件，也提供在线访问方式。</p>\n<h4 id=\"使用google-pagespeed-insights\"><a class=\"anchor\" href=\"#使用google-pagespeed-insights\">#</a> 使用<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vc3BlZWQvcGFnZXNwZWVkL2luc2lnaHRzLw==\"> Google PageSpeed Insights</span></h4>\n<p>打开 https://developers.google.com/speed/pagespeed/insights/</p>\n<p>输入需要分析的网址即可，这里面需要注意必须在公网可以访问到网址。</p>\n<p><img data-src=\"./assets/image-20190619212956061.png\" alt=\"image-20190619212956061\" /></p>\n<h4 id=\"使用chrome插件mozila插件\"><a class=\"anchor\" href=\"#使用chrome插件mozila插件\">#</a> 使用 Chrome 插件 / Mozila 插件</h4>\n<p><img data-src=\"./assets/image-20190619203556941.png\" alt=\"image-20190619203556941\" /></p>\n<p>下载安装办法：</p>\n<ol>\n<li>\n<p>使用插件 ID: <code>djfpadpbeemogokhllpiakdeadpoclan</code>  到 https://chrome-extension-downloader.com/ 来下载</p>\n<p>打开：<span class=\"exturl\" data-url=\"Y2hyb21lOi8vZXh0ZW5zaW9ucy8=\">chrome://extensions/</span></p>\n<p>把 <code>ctx</code>  文件拖进去</p>\n</li>\n<li>\n<p>如果有梯子，那么直接在商店里面搜索</p>\n</li>\n</ol>\n<p>插件使用：</p>\n<p><img data-src=\"./assets/image-20190619212836235.png\" alt=\"image-20190619212836235\" /></p>\n<h3 id=\"前端项目优化实践-2\"><a class=\"anchor\" href=\"#前端项目优化实践-2\">#</a> 前端项目优化实践</h3>\n<h2 id=\"补充学习\"><a class=\"anchor\" href=\"#补充学习\">#</a> 补充学习</h2>\n<h3 id=\"编码-解码形成dom树的过程\"><a class=\"anchor\" href=\"#编码-解码形成dom树的过程\">#</a> 编码、解码形成 DOM 树的过程</h3>\n<p>浏览器从网络或硬盘中获得 <code>HTML</code>  字节数据后会经过一个流程将字节解析为 <code>DOM</code>  树：</p>\n<ul>\n<li>编码： <strong>先将 HTML 的原始字节数据转换为文件指定编码的字符。</strong></li>\n<li>令牌化： 然后<strong>浏览器会根据 HTML 规范来将字符串转换成各种令牌</strong>（如 <code>&lt;html&gt;</code> 、 <code>&lt;body&gt;</code>  这样的标签以及标签中的字符串和属性等都会被转化为令牌，每个令牌具有特殊含义和一组规则）。令牌记录了标签的开始与结束，通过这个特性可以轻松判断一个标签是否为子标签（假设有 <code>&lt;html&gt;</code>  与 <code>&lt;body&gt;</code>  两个标签，当 <code>&lt;html&gt;</code>  标签的令牌还未遇到它的结束令牌 <code>&lt;/html&gt;</code>  就遇见了 <code>&lt;body&gt;</code>  标签令牌，那么 <code>&lt;body&gt;</code>  就是 <code>&lt;html&gt;</code>  的子标签）。</li>\n<li>生成对象： <strong>接下来每个令牌都会被转换成定义其属性和规则的对象（这个对象就是节点对象）。</strong></li>\n<li>构建完毕： <strong>DOM 树构建完成，整个对象集合就像是一棵树形结构</strong>。可能有人会疑惑为什么 <code>DOM</code>  是一个树形结构，这是因为标签之间含有复杂的父子关系，树形结构正好可以诠释这个关系（ <code>CSSOS</code>  同理，层叠样式也含有父子关系。例如：  <code>div p &#123;font-size: 18px&#125;</code> ，会先寻找所有 <code>p</code>  标签并判断它的父标签是否为 <code>div</code>  之后才会决定要不要采用这个样式进行渲染）。</li>\n</ul>\n<p>整个 <code>DOM</code>  树的构建过程其实就是： <strong>字节 -&gt; 字符 -&gt; 令牌 -&gt; 节点对象 -&gt; 对象模型</strong>，下面将通过一个示例 <code>HTML</code>  代码与配图更形象地解释这个过程。</p>\n<p>如下面的这段 HTML</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width,initial-scale=1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Critical Path<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Hello <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>web performance<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span> students!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>awesome-photo.jpg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><img data-src=\"./assets/63503acbly1fk2te7tuh0j20nv0dbjtl.jpg\" alt=\"DOM Rendering\" /></p>\n<h3 id=\"优化工作清单\"><a class=\"anchor\" href=\"#优化工作清单\">#</a> 优化工作清单</h3>\n<p>当小伙伴们出现了页面性能问题时，或者在设计我们的应用之前，就可以参考如下的条目进行快速检查。</p>\n<ul>\n<li>页面内容\n<ul>\n<li>减少 HTTP 请求数</li>\n<li>减少 DNS 查询</li>\n<li>避免重定向</li>\n<li>缓存 Ajax 请求</li>\n<li>延迟加载</li>\n<li>预先加载</li>\n<li>减少 DOM 元素数量</li>\n<li>划分内容到不同域名</li>\n<li>尽量减少 iframe 使用</li>\n<li>避免 404 错误</li>\n</ul>\n</li>\n<li>服务器\n<ul>\n<li>使用 CDN</li>\n<li>添加 Expires 或 Cache-Control 响应头</li>\n<li>启用 Gzip</li>\n<li>配置 Etag</li>\n<li>尽早输出缓冲</li>\n<li>Ajax 请求使用 GET 方法</li>\n<li>避免图片 src 为空</li>\n</ul>\n</li>\n<li>Cookie\n<ul>\n<li>减少 Cookie 大小</li>\n<li>静态资源使用无 Cookie 域名</li>\n</ul>\n</li>\n<li>CSS\n<ul>\n<li>把样式表放在  <code>&lt;head&gt;</code>  中</li>\n<li>不要使用 CSS 表达式</li>\n<li>使用  <code>link</code>  替代  <code>@import</code></li>\n<li>不要使用 filter</li>\n</ul>\n</li>\n<li>JavaScript\n<ul>\n<li>把脚本放在页面底部</li>\n<li>使用外部 JavaScript 和 CSS</li>\n<li>压缩 JavaScript 和 CSS</li>\n<li>移除重复脚本</li>\n<li>减少 DOM 操作</li>\n<li>使用高效的事件处理</li>\n</ul>\n</li>\n<li>图片\n<ul>\n<li>优化图片</li>\n<li>优化 CSS Sprite</li>\n<li>不要在 HTML 中缩放图片</li>\n<li>使用体积小、可缓存的 favicon.ico</li>\n</ul>\n</li>\n<li>移动端\n<ul>\n<li>保持单个文件小于 25 KB</li>\n<li>打包内容为分段（multipart）文档</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"优化关键渲染路径\"><a class=\"anchor\" href=\"#优化关键渲染路径\">#</a> 优化关键渲染路径</h3>\n<p>假设有一个 <code>HTML</code>  页面，它只引入了一个 <code>CSS</code>  外部文件：</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width,initial-scale=1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Hello <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>web performance<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span> students!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>awesome-photo.jpg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>它的关键渲染路径如下：</p>\n<p><img data-src=\"./assets/63503acbly1fk56dzdbn9j20nr068dga.jpg\" alt=\"img\" /></p>\n<p>首先浏览器要先对服务器发送请求获得 <code>HTML</code>  文件，得到 <code>HTML</code>  文件后开始构建 <code>DOM</code>  树，在遇见 <code>&lt;link&gt;</code>  标签时浏览器需要向服务器再次发出请求来获得 <code>CSS</code>  文件，然后则是继续构建 <code>DOM</code>  树和 <code>CSSOM</code>  树，浏览器合并出渲染树，根据渲染树进行布局计算，执行绘制操作，页面渲染完成。</p>\n<p>有以下几个用于描述关键渲染路径性能的词汇：</p>\n<ul>\n<li>关键资源：可能阻塞网页首次渲染的资源（上图中为 2 个， <code>HTML</code>  文件与外部 <code>CSS</code>  文件 <code>style.css</code> ）。</li>\n<li>关键路径长度： 获取关键资源所需的往返次数或总时间（上图为 2 次或以上，一次获取 <code>HTML</code>  文件，一次获取 <code>CSS</code>  文件，这个次数基于 <code>TCP</code>  协议的最大拥塞窗口，一个文件不一定能在一次连接内传输完毕）。</li>\n<li>关键字节：所有关键资源文件大小的总和（上图为 <code>9KB</code> ）。</li>\n</ul>\n<p>接下来，案例代码的需求发生了变化，它新增了一个 <code>JavaScript</code>  文件。</p>\n<pre><code>&lt;html&gt;\n  &lt;head&gt;\n    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;\n    &lt;link href=&quot;style.css&quot; rel=&quot;stylesheet&quot;&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;p&gt;Hello &lt;span&gt;web performance&lt;/span&gt; students!&lt;/p&gt;\n    &lt;div&gt;&lt;img src=&quot;awesome-photo.jpg&quot;&gt;&lt;/div&gt;\n    &lt;script src=&quot;app.js&quot;&gt;&lt;/script&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<p><a href=\"http://wx1.sinaimg.cn/large/63503acbly1fk56e0i20xj20or06ygmi.jpg\"><img data-src=\"http://wx1.sinaimg.cn/large/63503acbly1fk56e0i20xj20or06ygmi.jpg\" alt=\"img\" /></a></p>\n<p><code>JavaScript</code>  文件阻塞了 <code>DOM</code>  树的构建，并且在执行 <code>JavaScript</code>  脚本时还需要先等待构建 <code>CSSOM</code>  树，上图的关键渲染路径特性如下：</p>\n<ul>\n<li>关键资源： 3（ <code>HTML</code> 、 <code>style.css</code> 、 <code>app.js</code> ）</li>\n<li>关键路径长度： 2 或以上（浏览器会在一次连接中一起下载 <code>style.css</code>  和 <code>app.js</code> ）</li>\n<li>关键字节：11KB</li>\n</ul>\n<p>现在，我们要优化关键渲染路径，首先将 <code>&lt;script&gt;</code>  标签添加异步属性 <code>async</code> ，这样浏览器的 <code>HTML</code>  解析器就不会阻塞这个 <code>JavaScript</code>  文件了。</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width,initial-scale=1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Hello <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>web performance<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span> students!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>awesome-photo.jpg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>app.js<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">async</span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><img data-src=\"./assets/63503acbly1fk56e0sokqj20oj074ab1.jpg\" alt=\"img\" /></p>\n<ul>\n<li>关键资源：2（ <code>app.js</code>  为异步加载，不会成为阻塞渲染的资源）</li>\n<li>关键路径长度： 2 或以上</li>\n<li>关键字节： 9KB（ <code>app.js</code>  不再是关键资源，所以没有算上它的大小）</li>\n</ul>\n<p>接下来对 <code>CSS</code>  进行优化，比如添加上媒体查询。</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width,initial-scale=1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">media</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>print<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Hello <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>web performance<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span> students!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>awesome-photo.jpg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>app.js<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">async</span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><img data-src=\"./assets/63503acbly1fk56e15x4jj20ny082mxu.jpg\" alt=\"img\" /></p>\n<ul>\n<li>关键资源：1（ <code>app.js</code>  为异步加载， <code>style.css</code>  只有在打印时才会使用，所以只剩下 <code>HTML</code>  一个关键资源，也就是说当 <code>DOM</code>  树构建完毕，浏览器就会开始进行渲染）</li>\n<li>关键路径长度：1 或以上</li>\n<li>关键字节：5KB</li>\n</ul>\n<p><strong>优化关键渲染路径就是在对关键资源、关键路径长度和关键字节进行优化</strong>。关键资源越少，浏览器在渲染前的准备工作就越少；同样，关键路径长度和关键字节关系到浏览器下载资源的效率，它们越少，浏览器下载资源的速度就越快。</p>\n<h3 id=\"其他js在线测试网站\"><a class=\"anchor\" href=\"#其他js在线测试网站\">#</a> 其他 JS 在线测试网站\u0010</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qc2JlbmNoLm1lLw==\">jsbench.me</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2pzYmVuLmNoLw==\">jsben.ch</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWFzdXJldGhhdC5uZXQv\">measurethat.net</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWJwYWdldGVzdC5vcmcv\">webpagetest.org</span></li>\n</ul>\n<h3 id=\"参考资料\"><a class=\"anchor\" href=\"#参考资料\">#</a> 参考资料</h3>\n<ol>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHRtbDVyb2Nrcy5jb20vemgvdHV0b3JpYWxzL2ludGVybmFscy9ob3dicm93c2Vyc3dvcmsv\">浏览器的工作原理：新式网络浏览器幕后揭秘</span> <strong>强烈推荐</strong></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vd2ViL2Z1bmRhbWVudGFscy9wZXJmb3JtYW5jZS9jcml0aWNhbC1yZW5kZXJpbmctcGF0aC9yZW5kZXItdHJlZS1jb25zdHJ1Y3Rpb24=\">渲染树构建、布局及绘制</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb3ouY29tL2Jsb2cvaW1wcm92aW5nLXNlYXJjaC1yYW5rLWJ5LW9wdGltaXppbmcteW91ci10aW1lLXRvLWZpcnN0LWJ5dGU=\">优化第一个字节的时间</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3F6Y3N1L2FydGljbGUvZGV0YWlscy83Mjg2MTg5MQ==\">TCP 的三次握手与四次挥手（详解 + 动图）</span>推荐</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90ZWNoLm1laXR1YW4uY29tLzIwMTYvMTIvMDIvcGVyZm9ybWFuY2UtdHVubmluZy5odG1s\">常见性能优化策略的总结</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb3ouY29tL2xlYXJuL3Nlby9wYWdlLXNwZWVk\">Page Speed</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YzAxMWUwYzUxODgyNTJlYTY2YWZkZmEjaGVhZGluZy02OA==\">web 性能优化篇</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YTk2NmJkMTZmYjlhMDYzNTE3MmE1MGE=\">2018 前端性能优化清单</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YzQ2Y2JhZWU1MWQ0NTNmNDU2MTJhMmM=\">（译）2019 年前端性能优化清单 — 上篇</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YzQ3MWVhZmYyNjVkYTYxNmQ1NDdjOGM=\">（译）2019 年前端性能优化清单 — 中篇</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YzQ3M2NkYWU1MWQ0NTUxOGQ0NzAxZmY=\">（译）2019 年前端性能优化清单 — 下篇</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vc3BlZWQvZG9jcy9pbnNpZ2h0cy9ydWxlcw==\">PageSpeed Insights 规则</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zeWx2YW5hc3N1bi5naXRodWIuaW8vMjAxNy8xMC8wMy8yMDE3LTEwLTAzLUJyb3dzZXJDcml0aWNhbFJlbmRlcmluZ1BhdGgv\">浏览器渲染过程与性能优化</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC8yNjhjN2YzZGQ3YTY=\">如何提升 CSS 选择器性能</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHRtbC5jbi9hcmNoaXZlcy85NTE3\">前端性能优化：2018 年 JavaScript 开销及优化工具和方法</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YTY1NDdkMGYyNjVkYTNlMjgzYTFkZjc=\">从浏览器多进程到 JS 单线程，JS 运行机制最全面的一次梳理</span>推荐</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vZW50cnkvNWFkODZjMTZmMjY1ZGE1MDVhNzdkY2E0\">彻底理解浏览器的缓存机制</span> 推荐 2</li>\n</ol>\n",
            "tags": [
                "前端性能优化",
                "性能优化"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/03/02/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/",
            "url": "https://dmqweb.cn/2024/03/02/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/",
            "title": "自动化测试",
            "date_published": "2024-03-02T02:04:04.000Z",
            "content_html": "<h1 id=\"5-3-自动化测试\"><a class=\"anchor\" href=\"#5-3-自动化测试\">#</a> 5-3 自动化测试</h1>\n<h2 id=\"课程介绍\"><a class=\"anchor\" href=\"#课程介绍\">#</a> 课程介绍</h2>\n<p>在前端界，浏览器兼容性是让工程师们头疼的问题，对于经验丰富的人来说，很清楚浏览器有哪些坑，但是对于大部分程序员，最可怕的是代码明明在这个浏览器运行得很好，但是到了另一个浏览器中就不能正常运行了。对于这部分的程序员，保障代码能正常运行的方法便是能尽早发现问题，然后将其解决。</p>\n<p><strong>为什么需要自动化测试？</strong></p>\n<p>项目经过不断的开发，最终肯定会趋于稳定，在<strong>适当的时机下</strong>引入自动化测试能及早发现问题，<strong>保证产品的质量</strong>。</p>\n<p>测试作为完整的开发流程中最后的一环，是保证产品质量重要的一环。而前端测试一般在产品开发流程中属于偏后的环节，在整个开发架构中属于较高层次，前端测试更加偏向于 GUI 的特性，因此前端的测试难度很大。</p>\n<p>测试的目的：</p>\n<ul>\n<li>有利于写出高质量的代码，尽早发现问题</li>\n<li>有利于代码的扩展</li>\n<li>有利于代码的维护</li>\n</ul>\n<p><strong>本课程的学习路径：</strong></p>\n<ul>\n<li>学习基础的概念，清晰测试不同的应用场景</li>\n<li>学习不同的前端测试工具，了解如何进行选择</li>\n<li>在项目中进行实践</li>\n</ul>\n<p><strong>本课程的主要内容：</strong></p>\n<ul>\n<li>介绍测试框架的分类</li>\n<li>单元测试工具介绍：Mocha，Jest，AVA，Karma</li>\n<li>E2E 测试工具介绍：Nightmare</li>\n</ul>\n<p><strong>本课程的学习准备：</strong></p>\n<ul>\n<li>IDE vscode，node  LTS</li>\n<li>包管理工具：yarn, cnpm</li>\n</ul>\n<h2 id=\"前端自动化测试\"><a class=\"anchor\" href=\"#前端自动化测试\">#</a> 前端自动化测试</h2>\n<p>测试是一个庞大的主题，包括各种分类的测试，诸如黑盒测试 / 白盒测试、单元测试 / 集成测试 / 端到端测试等。通常程序员在测试自己的代码的时候用得最多的便是单元测试，但是因为测试也是需要代价，很多人是不喜欢写测试的，甚至是一点都不写。</p>\n<p>那么是什么原因让大家不愿意写呢？</p>\n<ol>\n<li>不熟悉</li>\n<li>浪费时间</li>\n<li>知识不成体系</li>\n<li>团队氛围</li>\n<li>缺少实践</li>\n</ol>\n<p>我们要从基础的东西学起，打消对测试的恐惧。</p>\n<h3 id=\"测试的分类\"><a class=\"anchor\" href=\"#测试的分类\">#</a> 测试的分类</h3>\n<p>在多浏览器的自动化测试，我们多半是进行端到端的测试工作，一小部分是大粒度的单元测试。端到端测试测试模拟用户的行为。在 Web 应用程序中，他们会启动服务器，打开浏览器，模拟用户的行为进行点击、输入、提交等动作，断言浏览器中发生了特定的事情或者是得到了期待的结果，从而让我们相信功能可以正常的运行。</p>\n<p>而单元测试根据代码单元的公共 API 运行它们。这些测试需要创建一个类的实例，使用特定的输入调用它的方法，断言被调用的方法达到了预期的效果。在下文中我们会看到这两种测试的实践，当然有时候区分度并不大，可能无法明显地区分哪些是端对端测试哪些是单元测试，有时候他们是混合起来的，不过只要记住我们的目标是保证功能可以正常运行救足够了。</p>\n<p>按照软件工程自底而上的概念，前端测试一般分为单元测试（Unit Testing ）、集成测试（Integration Testing）和端到端测试（E2E Testing）。从下面的图可以看出，从底向上测试的复杂度将不断提高，另一方面测试的收益反而不断降低的。</p>\n<p><img data-src=\"assets/16415de723a8d411.png\" alt=\"img\" /></p>\n<blockquote>\n<p>关于软件测试分类，可见<a href=\"#%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E7%9A%84%E5%88%86%E7%B1%BB\">软件测试的分类</a></p>\n</blockquote>\n<h3 id=\"测试工具对比\"><a class=\"anchor\" href=\"#测试工具对比\">#</a> 测试工具对比</h3>\n<p>在进行项目实践前，很重要的一项工作是选择合适的技术栈。好比在前端开发时应该选择 React，Vue 还是 Angular 作为框架一样，前端的测试工作也需要选择一套技术栈。很多时候大家在制定技术栈时容易走偏，在选择技术框架时不是选择最合适的框架，而是选择最热门的框架。当然一定程度上热门的框架能反应其受欢迎程度，可能是因为其出众的优点，如较高的开发效率、高效的渲染特性或者是活跃的社区。在前端开发中，很容易有这样的感受，就是只要半个月没有关注业界的最新动态，就感觉恍若隔世，新的解决方案层出不穷，让人喘不过气。</p>\n<p>经过几年的前端洗礼之后，就已经过了慌乱的年纪，再也不会盲目地追寻新技术，而转向关注技术背后解决的痛点，原理等。</p>\n<p><img data-src=\"assets/v2-af09ebe8167f63a49ea49287fe04526f_hd-20190706122102737.jpg\" alt=\"img\" /></p>\n<h4 id=\"如何选择测试框架\"><a class=\"anchor\" href=\"#如何选择测试框架\">#</a> 如何选择测试框架</h4>\n<p>测试框架基本上都做了一件事儿：</p>\n<ul>\n<li>描述你要测试的东西</li>\n<li>对其进行测试</li>\n<li>判断是否符合预期</li>\n</ul>\n<p>选择框架会考虑下面的点：</p>\n<ul>\n<li>\n<p>测试框架是否有简明的语法与文档。</p>\n<p>Mocha、Jasmine、Jest、AVA、Karma、Nightmare</p>\n</li>\n<li>\n<p>断言 (Assertions)：用于判断结果是否符合预期。有些框架需要单独的断言库。</p>\n<p>Should.js、chai、expect.js 等等，断言库提供了很多语义化的方法来对值做各种各样的判断。当然也可以不用断言库，Node.js 中也可以直接使用原生 assert 库。</p>\n</li>\n<li>\n<p>适合 TDD / BDD：是否适合 测试驱动型 / 行为驱动型 的测试风格。</p>\n<blockquote>\n<p>BDD (Bebavior Driven Developement，行为驱动测试) 和 TDD (Testing Driven Developement，测试驱动开发)</p>\n</blockquote>\n<p>BDD 和 TDD 均有各自的适用场景，BDD 一般更偏向于系统功能和业务逻辑的自动化测试设计，而 TDD 在快速开发并测试功能模块的过程中则更加高效，以快速完成开发为目的。下面我们看下 BDD 和 TDD 具体的特点：</p>\n<p>BDD 的特点：</p>\n<ul>\n<li>从业务逻辑的角度定义具体的输入与预期输出，以及可衡量的目标；</li>\n<li>尽可能覆盖所有的测试用例情况；</li>\n<li>描述一系列可执行的行为，根据业务的分析来定义预期输出。例如，expect, should, assert；</li>\n<li>设定关键的测试通过节点输出提示，便于测试人员理解；</li>\n<li>最大程度的交付出符合用户期望的产品，避免输出不一致带来的问题。</li>\n</ul>\n<p>TDD 的特点：</p>\n<ul>\n<li>需求分析，快速编写对应的输入输出测试脚本；</li>\n<li><strong>仅在自动测试失败时才编写新代码</strong>。</li>\n<li>重构去除不必要的依赖关系，然后重复测试，最终让程序符合所有要求。</li>\n</ul>\n</li>\n<li>\n<p>异步测试：有些框架对异步测试支持良好。</p>\n</li>\n<li>\n<p>使用的语言：大部分 js 测试框架使用 js。</p>\n</li>\n<li>\n<p>用于特定目的：每个框架可能会擅长处理不同的问题。</p>\n<p>是要测试单个功能、单个组件、还是集成化测试？</p>\n<p>是要测试 GUI 逻辑、交互？</p>\n<p>是要测试非功能性指标？兼容性？</p>\n</li>\n<li>\n<p>社区是否活跃。</p>\n</li>\n</ul>\n<h4 id=\"测试工具的类型\"><a class=\"anchor\" href=\"#测试工具的类型\">#</a> 测试工具的类型</h4>\n<p>测试工具可分为以下功能。有些只为我们提供了一种功能，有些功能为我们提供了一种组合。</p>\n<p>为了实现最灵活的集合功能，通常使用多种工具的组合。</p>\n<ul>\n<li>\n<p>提供 UI 界面或者 CLI 工具：（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9rYXJtYS1ydW5uZXIuZ2l0aHViLmlvLw==\">Karma</span>，<span class=\"exturl\" data-url=\"aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==\">Jasmine</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=\">Jest</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=\">TestCafe</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=\">Cypress</span>）</p>\n<p><strong>CLI 工具</strong>会给出一系列测试，以及运行这些测试所需的各种配置和脚手架（运行什么浏览器，使用什么 babel 插件，如何格式化输出等）</p>\n</li>\n<li>\n<p>提供测试框架（形成文件目录）：(<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2NoYWpzLm9yZy8=\">Mocha</span>, <span class=\"exturl\" data-url=\"aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==\">Jasmine</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=\">Jest</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2N1Y3VtYmVyL2N1Y3VtYmVyLWpz\">Cucumber</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=\">TestCafe</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=\">Cypress</span>)</p>\n</li>\n<li>\n<p>提供断言：（<span class=\"exturl\" data-url=\"aHR0cDovL2NoYWlqcy5jb20v\">Chai</span>，<span class=\"exturl\" data-url=\"aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==\">Jasmine</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=\">Jest</span>，<span class=\"exturl\" data-url=\"aHR0cDovL3VuZXhwZWN0ZWQuanMub3JnLw==\">Unexpected</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=\">TestCafe</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=\">Cypress</span>）</p>\n<p><strong>断言函数</strong>检查测试返回的结果是否符合预期</p>\n</li>\n<li>\n<p>生成，展示测试结果（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2NoYWpzLm9yZy8=\">Mocha</span>，<span class=\"exturl\" data-url=\"aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==\">Jasmine</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=\">Jest</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9rYXJtYS1ydW5uZXIuZ2l0aHViLmlvLw==\">Karma</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=\">TestCafe</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=\">Cypress</span>）</p>\n</li>\n<li>\n<p>快照测试（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=\">Jest</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2F2YQ==\">Ava</span>）</p>\n<p>快照测试 (snapshot testing)，测试 UI 或数据结构是否和之前完全一致，通常 UI 测试不在单元测试中</p>\n</li>\n<li>\n<p>提供仿真（<span class=\"exturl\" data-url=\"aHR0cDovL3Npbm9uanMub3JnLw==\">Sinon</span>，<span class=\"exturl\" data-url=\"aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==\">Jasmine</span>，<span class=\"exturl\" data-url=\"aHR0cDovL2FpcmJuYi5pby9lbnp5bWUvZG9jcy9hcGkv\">enzyme</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=\">Jest</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly90ZXN0ZG91YmxlLmNvbS8=\">testdouble</span>）</p>\n<p>仿真 (mocks, spies, and stubs)：获取方法的调用信息，模拟方法，模块，甚至服务器</p>\n</li>\n<li>\n<p>生成测试覆盖率报告 (<span class=\"exturl\" data-url=\"aHR0cHM6Ly9nb3R3YXJsb3N0LmdpdGh1Yi5pby9pc3RhbmJ1bC8=\">Istanbul</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=\">Jest</span>, <span class=\"exturl\" data-url=\"aHR0cDovL2JsYW5rZXRqcy5vcmcv\">Blanket</span>)</p>\n</li>\n<li>\n<p>提供类浏览器环境 (<span class=\"exturl\" data-url=\"aHR0cDovL25pZ2h0d2F0Y2hqcy5vcmcv\">Nightwatch</span>, <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5uaWdodG1hcmVqcy5vcmcv\">Nightmare</span>, <span class=\"exturl\" data-url=\"aHR0cDovL3BoYW50b21qcy5vcmcv\">Phantom</span><strong>,</strong> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dvb2dsZUNocm9tZS9wdXBwZXRlZXI=\">Puppeteer</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=\">TestCafe</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=\">Cypress</span>)</p>\n</li>\n<li>\n<p>可视化回归工具 (<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcHBsaXRvb2xzLmNvbS8=\">Applitools</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZXJjeS5pby8=\">Percy</span>, <span class=\"exturl\" data-url=\"aHR0cDovL2JiYy1uZXdzLmdpdGh1Yi5pby93cmFpdGgv\">Wraith</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3dlYmRyaXZlcmlvLWJvbmV5YXJkL3dlYmRyaXZlcmNzcw==\">WebdriverCSS</span>)</p>\n</li>\n</ul>\n<h4 id=\"单元测试类工具\"><a class=\"anchor\" href=\"#单元测试类工具\">#</a> 单元测试类工具</h4>\n<p>npm trends: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtdHJlbmRzLmNvbS9tb2NoYS12cy1qZXN0LXZzLWF2YS12cy1qYXNtaW5lLWNvcmU=\">点击链接</span></p>\n<p><img data-src=\"assets/image-20190706101634263.png\" alt=\"image-20190706101634263\" /></p>\n<p><strong>Karma</strong></p>\n<p>Karma 是一个 Runner（即运行环境），具体详细的介绍见 <a href=\"#%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83&amp;%E5%B8%AE%E6%89%8BKarma\">后面的章节 Karma</a></p>\n<blockquote>\n<p>A test runner is the library or tool that picks up an assembly (or a source code directory) that contains unit tests, and a bunch of settings, and then executes them and writes the test results to the console or log files.<br />\nthere are many runners for different languages. See Nunit and MSTest for C#, or Junit for Java.</p>\n</blockquote>\n<p>karma 设计目标主要有下面四点：</p>\n<blockquote>\n<p>高效<br />\n扩展性<br />\n运行在真实设备<br />\n无缝的使用流程</p>\n</blockquote>\n<p>karma 是一个典型的 C/S 程序，包含 client 和 server ，通讯方式基于 Http ，通常情况下，客户端和服务端基本都运行在开发者本地机器上。</p>\n<p>一个服务端实例对应一个项目，假如想同时运行多个项目，得同时开启多个服务端实例。</p>\n<p>Karma 的<strong>优点</strong>是能通过插件和配置的方式集成大部分的主流的测试框架和前端库，能方便的一次在多浏览器环境执行测试用例，并集成了测试覆盖率生成功能，生成页面形式覆盖率报告并能导出不同形式的覆盖率报告数据。</p>\n<p>它的<strong>缺点</strong>是，对测试页面环境的搭建和资源文件的加载不是常见的形式，最开始搭建环境时会有很多跟预期不一致的情况，配置不直观。</p>\n<p><strong>Jasmine</strong></p>\n<p>Jasmine 带有 assertions (断言)，spies (用来模拟函数的执行环境) 和 mocks (mock 工具)，Jasmine 初始化设置简单，同时，如果你需要一些单元功能的时候你仍然可以加一些库进来。</p>\n<p><strong>Mocha</strong></p>\n<p>Mocha 是一个灵活的库，提供给开发者的只有一个基础测试结构。然后，其它功能性的功能如 assertions， spies 和 mocks，这些功能<strong>需要引用添加其它库</strong> / 插件来完成。</p>\n<p><strong>Jest</strong></p>\n<p>被 Facebook 和各种 React 应用推荐和使用，Jest 得到了很好的支持。Jest 也被发现是一个非常快速的测试库在平行测试报告中。</p>\n<p>对于小型项目来说你可能在开始的时候不用过多担心，而性能的提高，对于希望全天持续部署的大型应用 app 来说是非常之好的。</p>\n<p>而开发人员主要是用 Jest 去测试 React 应用，Jest 可以很容易地集成到其它应用程序中充许你使用更独特的特性在其它地方</p>\n<p>快照测试是一个非常好用的工具，去确保你的应用 UI 不会有超出预期的错误，在产品发布替换的期间发生。虽然大部分功能，专门设计都是使用在 React 上。</p>\n<p>Jest 有着很广阔的 API 。</p>\n<p><strong>AVA</strong></p>\n<p>AVA 它的优势是 JavaScript 的异步特性和并发运行测试.</p>\n<p>利用了 JavaScript 的异步特性优势，优化了在部署的时间等待</p>\n<p>保留了简单的 API 为你提供你所需要的功能。</p>\n<p>如果搭配 mocking 来使用它会显得更加友好，但是必须安装一个单独的库。</p>\n<h4 id=\"e2e测试类工具\"><a class=\"anchor\" href=\"#e2e测试类工具\">#</a> E2E 测试类工具</h4>\n<p>npm trends: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtdHJlbmRzLmNvbS9jeXByZXNzLXZzLW5pZ2h0bWFyZS12cy1uaWdodHdhdGNoLXZzLXRlc3RjYWZlLXZzLXdlYmRyaXZlcmlv\">点击链接</span></p>\n<p><img data-src=\"assets/image-20190706100636750.png\" alt=\"image-20190706100636750\" /></p>\n<h3 id=\"最佳实践\"><a class=\"anchor\" href=\"#最佳实践\">#</a> 最佳实践</h3>\n<p>测试有很多好处，但不代表一上来就要写出 100% 场景覆盖的测试用例。</p>\n<p><strong>最佳的实践：基于投入产出比来做测试</strong></p>\n<p>由于维护测试用例也是一大笔开销（毕竟没有多少测试会专门帮前端写业务测试用例，而前端使用的流程自动化工具更是没有测试参与了）。</p>\n<p>对于像基础组件、基础模型之类的不常变更且复用较多的部分，可以考虑去写测试用例来保证质量。个</p>\n<p>先写少量的测试用例覆盖到 80%+ 的场景，保证覆盖主要使用流程。</p>\n<p>一些极端场景出现的 bug 可以在迭代中形成测试用例沉淀，场景覆盖也将逐渐趋近 100%。</p>\n<p>但对于迭代较快的业务逻辑以及生存时间不长的活动页面之类的就别花时间写测试用例了，维护测试用例的时间大了去了，成本太高。</p>\n<p>大型项目，可以使用 Jest 快速形成配置并且开始单元测试。</p>\n<p>需要测试快照，则可以选择 Jest 或者 Ava。</p>\n<p>对于配置性要求高，对测试框架性能有要求的可以选择 mocha。</p>\n<p>对模拟还原浏览器业务操作有很大的需求的，可以选择 nightmare</p>\n<p>配合 CI 工具完成自动化测试、测试覆盖率、测试结果推送。</p>\n<h2 id=\"喜欢简单选择mocha\"><a class=\"anchor\" href=\"#喜欢简单选择mocha\">#</a> 喜欢简单，选择 Mocha</h2>\n<p><a href=\"https://mochajs.org/\"> <code>Mocha</code> </a>（发音 &quot;摩卡&quot;）诞生于 2011 年，是现在最流行的 JavaScript 测试框架之一，在浏览器和 Node 环境都可以使用。所谓 &quot;测试框架&quot;，就是运行测试的工具。通过它，可以为 JavaScript 应用添加测试，从而保证代码的质量。</p>\n<h3 id=\"安装\"><a class=\"anchor\" href=\"#安装\">#</a> 安装</h3>\n<p>全局安装 Mocha</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-g</span> mocha</pre></td></tr></table></figure><p>项目中也安装 Mocha</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev mocha</pre></td></tr></table></figure><p>在 package.json 中加入下面脚本：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token string\">\"scripts\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string\">\"test\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"mocha\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Chai 是一个针对 Node.js 和浏览器的行为驱动测试和测试驱动测试的<strong>断言库</strong>，可与任何 JavaScript 测试框架集成。它是 Mocha 的好帮手～～</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev chai</pre></td></tr></table></figure><p>在 package.json 中加入下面脚本：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mocha\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"关于断言\"><a class=\"anchor\" href=\"#关于断言\">#</a> 关于断言</h3>\n<p><code>expect</code>  断言的优点是很接近自然语言，下面是一些例子。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 相等或不相等</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span> <span class=\"token operator\">+</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span> <span class=\"token operator\">+</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>deep<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">bar</span><span class=\"token operator\">:</span> <span class=\"token string\">'baz'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 布尔值为 true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'everthing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>ok<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>ok<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// typeof</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token string\">'string'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> <span class=\"token string\">'bar'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">an</span><span class=\"token punctuation\">(</span><span class=\"token string\">'object'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>an<span class=\"token punctuation\">.</span><span class=\"token function\">instanceof</span><span class=\"token punctuation\">(</span>Foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// include</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">include</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foobar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">contain</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> <span class=\"token string\">'bar'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">hello</span><span class=\"token operator\">:</span> <span class=\"token string\">'universe'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>include<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">// empty</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>empty<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>empty<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>empty<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">// match</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foobar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^foo</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>两种使用方式：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// commonjs</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> expect <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'chai'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>expect</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// es6</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> expect <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'chai'</span></pre></td></tr></table></figure><h3 id=\"测试案例\"><a class=\"anchor\" href=\"#测试案例\">#</a> 测试案例</h3>\n<p>其中 index.js 为我们的被测试代码：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 加法函数</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @param &#123;第一个数&#125; a </pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @param &#123;第二个数&#125; b </pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">addNum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span>b</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> a<span class=\"token operator\">+</span>b<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports<span class=\"token operator\">=</span>addNum<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>新建测试脚本 <code>test/demo.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> expect <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'chai'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>expect<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> addNum <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../src/index'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试index.js'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试addNum函数'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'两数相加结果为两个数字的和'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">addNum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token comment\">// 以上语法为 chai 的 expect 语法，它还有 should 语法和 asset 语法。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// 等价的意思</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">var</span> addNum<span class=\"token operator\">=</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../src/index'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试index.js'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试addNum函数'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'两数相加结果为两个数字的和'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>       <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">addNum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!==</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"两数相加结果不为两个数字的和\"</span><span class=\"token punctuation\">)</span>；</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>       <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"mocha测试命令\"><a class=\"anchor\" href=\"#mocha测试命令\">#</a> Mocha 测试命令</h3>\n<p>如果想测试单一的测试 js，可以用：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mocha test/index.test.js</pre></td></tr></table></figure><p>或者多个 js</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mocha test/index.test.js test/add.test.js</pre></td></tr></table></figure><p>当然也可以用通配符测试某个文件夹下所有的 js 和 jsx：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># node 通配符</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>mocha <span class=\"token string\">'test/some/*.@(js|jsx)'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># shell 通配符</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>mocha test/unit/*.js</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>mocha spec/<span class=\"token punctuation\">&#123;</span>my,awesome<span class=\"token punctuation\">&#125;</span>.js</pre></td></tr></table></figure><h3 id=\"es6语法支持\"><a class=\"anchor\" href=\"#es6语法支持\">#</a> ES6 语法支持</h3>\n<p>在上面我们用的并非是 ES6 的语法，那么让我们把其中的代码都改为 ES6 的语法。<br />\n其中 index.js 为：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 加法函数</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @param &#123;第一个数&#125; a </pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @param &#123;第二个数&#125; b </pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">addNum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  addNum</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>而 index.test.js 为：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> expect <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'chai'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> addNum <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../src/index'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试index.js'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试addNum函数'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'两个参数相加结果为两个数字的和'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">addNum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'两个参数相加结果不为和以外的数'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">addNum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>此时直接运行 mocha 肯定是不行的，我们现需要安装一下 babel：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev @babel/cli @babel/core @babel/node @babel/register @babel/preset-env chai mocha nodemon</pre></td></tr></table></figure><p>然后，在项目目录下面，新建一个.babelrc 文件：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"@babel/preset-env\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>接着讲 package.json 中的脚本改为：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mocha --require @babel/register\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><p>命令变得更加简单了</p>\n<h3 id=\"更多用法\"><a class=\"anchor\" href=\"#更多用法\">#</a> 更多用法</h3>\n<h4 id=\"超时\"><a class=\"anchor\" href=\"#超时\">#</a> 超时</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>--timeout, -t, <span class=\"token parameter variable\">--timeouts</span>  Specify <span class=\"token builtin class-name\">test</span> <span class=\"token function\">timeout</span> threshold <span class=\"token punctuation\">(</span>in milliseconds<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>                                                        <span class=\"token punctuation\">[</span>number<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>default: <span class=\"token number\">2000</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>官方默认的超时是 2000 毫秒，即 2s。</p>\n<p>有三种方式来修改超时：</p>\n<p><code>--no-timeout</code>  参数或者 <code>debug</code>  模式中，全局禁用了超时；</p>\n<p><code>--timeout</code>  后面接时间（毫秒），全局修改了本次执行测试用例的超时时间；</p>\n<p>在测试用例里面，使用 <code>this.timeout</code>  方法：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should take less than 500ms'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>在<a href=\"#%E9%92%A9%E5%AD%90%E6%96%B9%E6%B3%95%EF%BC%88%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0%EF%BC%89\">钩子方法</a>里面使用：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a suite of tests'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// A very long environment setup.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">2500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><blockquote>\n<p>同样，可以使用 ``this.timeout (0) <code> </code> 去禁用超时。</p>\n</blockquote>\n<h4 id=\"钩子方法生命周期函数\"><a class=\"anchor\" href=\"#钩子方法生命周期函数\">#</a> 钩子方法（生命周期函数）</h4>\n<p>Mocha 在 describe 块之中，提供测试用例的四个钩子：before ()、after ()、beforeEach () 和 afterEach ()。它们会在指定时间执行。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试index.js'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span>console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"在本区块的所有测试用例之前执行\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token function\">after</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span>console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"在本区块的所有测试用例之后执行\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span>console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"在本区块的每个测试用例之前执行\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token function\">afterEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span>console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"在本区块的每个测试用例之后执行\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试addNum函数'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'两数相加结果为两个数字的和'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      assert<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token function\">addNum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"异步测试\"><a class=\"anchor\" href=\"#异步测试\">#</a> 异步测试</h4>\n<p>Mocha 本身是支持异步测试的。只需要为 <code>describe</code>  回调函数添加一个 <code>done</code>  参数， 成功时调用 <code>done()</code> ，失败时调用 <code>done(err)</code> 。例如：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> expect <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'chai'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>expect<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'db'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#get'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        db<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> foo</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token function\">done</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>如果未调用 <code>done</code>  函数，Mocha 会一直等待直到超时。</li>\n<li>如果未添加 <code>done</code>  参数，Mocha 会直接返回成功，不会捕获到异步的断言失败。例如：</li>\n</ul>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#get'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>运行上述测试<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2NoYWpzLm9yZy8=\"> Mocha</span> 总会提示 Passing。</p>\n<blockquote>\n<p>Mocha 怎么知道是否要等待异步断言呢？因为 JavaScript 中的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvRnVuY3Rpb24=\"> Function</span> 有一个 <code>length</code>  属性， 通过它可以获得该函数的形参个数。Mocha 通过传入回调的 <code>length</code>  来判断是否需要等待。</p>\n</blockquote>\n<p>或者， <code>done()</code>  您可以返回<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvUHJvbWlzZQ==\"> Promise</span>，而不是使用回调。如果您正在测试的 API 返回 promises 而不是回调，可以这样进行使用：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">return</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">return</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>tobi<span class=\"token punctuation\">,</span> loki<span class=\"token punctuation\">,</span> jane<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#find()'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'respond with matching records'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">return</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'User'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>should<span class=\"token punctuation\">.</span>eventually<span class=\"token punctuation\">.</span>have<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>同样，可以使用<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvU3RhdGVtZW50cy9hc3luY19mdW5jdGlvbg==\"> async /await</span>，您还可以编写如下的异步测试：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">await</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">await</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>tobi<span class=\"token punctuation\">,</span> loki<span class=\"token punctuation\">,</span> jane<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#find()'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'responds with matching records'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">const</span> users <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'User'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    users<span class=\"token punctuation\">.</span>should<span class=\"token punctuation\">.</span>have<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><blockquote>\n<p>需要 Babel 支持～～～</p>\n</blockquote>\n<h3 id=\"示例项目\"><a class=\"anchor\" href=\"#示例项目\">#</a> 示例项目</h3>\n<h4 id=\"创建项目安装依赖\"><a class=\"anchor\" href=\"#创建项目安装依赖\">#</a> 创建项目 &amp; 安装依赖</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>// 初始化一个nodejs项目</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">npm</span> init <span class=\"token parameter variable\">-y</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>// 安装依赖</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev @babel/cli @babel/core @babel/node @babel/register @babel/preset-env chai mocha nodemon</pre></td></tr></table></figure><p>形成 package.json</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"projects\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index.js\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token property\">\"keywords\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token property\">\"license\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ISC\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token property\">\"@babel/cli\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.5.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token property\">\"@babel/core\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.5.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token property\">\"@babel/node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.5.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token property\">\"@babel/preset-env\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.5.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token property\">\"@babel/register\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.4.4\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token property\">\"chai\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.2.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token property\">\"mocha\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^6.1.4\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token property\">\"nodemon\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^1.19.1\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"测试过程\"><a class=\"anchor\" href=\"#测试过程\">#</a> 测试过程</h4>\n<p>新建一个待测试的方法 <code>./src/index.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sayHello</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token string\">\"Hello world!!!\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// ES6 语法</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> sayHello</pre></td></tr></table></figure><p>测试脚本 <code>./test/index.spec.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> expect <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"chai\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> sayHello <span class=\"token keyword\">from</span> <span class=\"token string\">\"../src/index\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"index test\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sayHello function\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should say Hello guys!\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token keyword\">const</span> str <span class=\"token operator\">=</span> <span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello guys!\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><code>package.json</code>  中的脚本：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// \"start\": \"nodemon ./src/index.js\",  // 针对 ES5 语法</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"start:babel\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nodemon --exec babel-node ./src/index.js\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"test:watch\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mocha --require @babel/register --watch\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mocha --require @babel/register\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"babel src --out-dir ./dist --source-maps\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token property\">\"serve\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node ./dist/index.js\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token property\">\"debug\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node --inspect-brk ./dist/index.js\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><p>开始测试： <code>npm run test</code></p>\n<p>报错了，因为期望的值与实际值不一致。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Hello world<span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  index <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    sayHello <span class=\"token keyword\">function</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> should say Hello guys<span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token number\">0</span> passing <span class=\"token punctuation\">(</span>9ms<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token number\">1</span> failing</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> index <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>       sayHello <span class=\"token keyword\">function</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>         should say Hello guys<span class=\"token operator\">!</span>:</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      AssertionError: expected <span class=\"token string\">'Hello world!!!'</span> to equal <span class=\"token string\">'Hello guys!'</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      + expected - actual</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token parameter variable\">-Hello</span> world<span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      +Hello guys<span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      at Context.equal <span class=\"token punctuation\">(</span>test/index.spec.js:9:22<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>修改测试脚本，或者修改 index.js 文件：</p>\n<p>修改 <code>./test/index.spec.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> expect <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"chai\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> sayHello <span class=\"token keyword\">from</span> <span class=\"token string\">\"../src/index\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"index test\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sayHello function\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should say Hello world!!!\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token keyword\">const</span> str <span class=\"token operator\">=</span> <span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello world!!!\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>再次测试：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> mocha <span class=\"token parameter variable\">--require</span> @babel/register</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Hello world<span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  index <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    sayHello <span class=\"token keyword\">function</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      ✓ should say Hello world<span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token number\">1</span> passing <span class=\"token punctuation\">(</span>6ms<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>使用 <code>mochawesome</code>  展示你的测试结果：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev mochawesome</pre></td></tr></table></figure><p>然后在 <code>package.json</code>  的 <code>scripts</code>  中添加如下内容，</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token property\">\"report\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mocha --require @babel/register --reporter mochawesome\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>使用方式：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> run report</pre></td></tr></table></figure><p>形成出来的报告在浏览器中打开：</p>\n<p><img data-src=\"assets/image-20190707212821248.png\" alt=\"image-20190707212821248\" /></p>\n<p>在 Vscode 中可以安装 Live Server 这个插件快速打开：</p>\n<p><img data-src=\"assets/image-20190707212923919.png\" alt=\"image-20190707212923919\" /></p>\n<h2 id=\"开箱即用jest\"><a class=\"anchor\" href=\"#开箱即用jest\">#</a> 开箱即用 Jest</h2>\n<p>Jest 是由 Facebook 发布的开源的、基于<span class=\"exturl\" data-url=\"aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==\"> Jasmine</span> 的 JavaScript 单元测试框架。Jest 源于 Facebook 的构想，用于快速、可靠地测试 Web 聊天应用。它吸引了公司内部的兴趣，Facebook 的一名软件工程师 Jeff Morrison 半年前又重拾这个项目，改善它的性能，并将其开源。Jest 的目标是减少开始测试一个项目所要花费的时间和认知负荷，因此它提供了大部分你需要的现成工具：快速的命令行接口、Mock 工具集以及它的自动模块 Mock 系统。此外，如果你在寻找隔离工具例如 Mock 库，大部分其它工具将让你在测试中（甚至经常在你的主代码中）写一些不尽如人意的样板代码，以使其生效。Jest 与 Jasmine 框架的区别是在后者之上增加了一些层。最值得注意的是，运行测试时，Jest 会自动模拟依赖。Jest 自动为每个依赖的模块生成 Mock，并默认提供这些 Mock，这样就可以很容易地隔离模块的依赖。</p>\n<p>Jest 支持 Babel，我们将很轻松的使用 ES6 的高级语法</p>\n<p>Jest 支持 webpack，非常方便的使用它来管理我们的项目</p>\n<p>Jest 支持 TypeScript，书写测试用例更加严谨</p>\n<ol>\n<li>\n<p>简化 API</p>\n<p>Jest 既简单又强大，内置支持以下功能：</p>\n<ul>\n<li>灵活的配置：比如，可以用文件名通配符来检测测试文件。</li>\n<li>测试的事前步骤 (Setup) 和事后步骤 (Teardown)，同时也包括测试范围。</li>\n<li>匹配表达式 (Matchers)：能使用期望 <code>expect</code>  句法来验证不同的内容。</li>\n<li>测试异步代码：支持承诺 (promise) 数据类型和异步等待 <code>async</code>  /  <code>await</code>  功能。</li>\n<li>模拟函数：可以修改或监查某个函数的行为。</li>\n<li>手动模拟：测试代码时可以忽略模块的依存关系。</li>\n<li>虚拟计时：帮助控制时间推移。</li>\n</ul>\n</li>\n<li>\n<p>性能与隔离</p>\n<p>Jest 文档里写道：</p>\n<p>Jest 能运用所有的工作部分，并列运行测试，使性能最大化。终端上的信息经过缓冲，最后与测试结果一起打印出来。沙盒中生成的测试文件，以及自动全局状态在每个测试里都会得到重置，这样就不会出现两个测试冲突的情况。</p>\n<p>Mocha 用一个进程运行所有的测试，和它比较起来，Jest 则完全不同。要在测试之间模拟出隔离效果，我们必须要引入几个测试辅助函数来妥善管理清除工作。这种做法虽然不怎么理想，但 99% 的情况都可以用，因为测试是按顺序进行的。</p>\n</li>\n<li>\n<p>沉浸式监控模式</p>\n<p>快速互动式监控模式可以监控到哪些测试文件有过改动，只运行与改动过的文件相关的测试，并且由于优化作用，能迅速放出监控信号。设置起来非常简单，而且还有一些别的选项，可以用文件名或测试名来过滤测试。我们用 Mocha 时也有监控模式，不过没有那么强大，要运行某个特定的测试文件夹或文件，就不得不自己创造解决方法，而这些功能 Jest 本身就已经提供了，不用花力气。</p>\n</li>\n<li>\n<p>代码覆盖率 &amp; 测试报告</p>\n<p>Jest 内置有代码覆盖率报告功能，设置起来易如反掌。可以在整个项目范围里收集代码覆盖率信息，包括未经受测试的文件。</p>\n<p>要使完善 Circle CI 整合，只需要一个自定义报告功能。有了 Jest，用<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pY2hhZWxsZWVhbGxlbi9qZXN0LWp1bml0LXJlcG9ydGVy\"> jest-junit-reporter</span> 就可以做到，其用法和 Mocha 几乎相同。</p>\n</li>\n<li>\n<p>快照功能</p>\n<p>快照测试的目的不是要替换现有的单元测试，而是要使之更有价值，让测试更轻松。在某些情况下，某些功能比如 React 组件功能，有了快照测试意味着无需再做单元测试，但同样这两者不是非此即彼。</p>\n</li>\n</ol>\n<h3 id=\"安装-2\"><a class=\"anchor\" href=\"#安装-2\">#</a> 安装</h3>\n<p>新建文件夹然后通过 npm 命令安装：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev jest</pre></td></tr></table></figure><p>或者通过 yarn 来安装：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> <span class=\"token parameter variable\">--dev</span> jest</pre></td></tr></table></figure><p>然后就可以开始测试了</p>\n<p>也可用 <code>npm install -g jest</code>  进行全局安装；并在 package.json 中指定 test 脚本：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jest\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Jest 的测试脚本名形如 <code>.test.js</code> ，不论 Jest 是全局运行还是通过 <code>npm test</code>  运行，它都会执行当前目录下所有的 <code>*.test.js</code>  或  <code>*.spec.js</code>  文件、完成测试。</p>\n<p>ES6 语法支持：</p>\n<ol>\n<li>安装依赖</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> <span class=\"token parameter variable\">--dev</span> babel-jest @babel/core @babel/preset-env</pre></td></tr></table></figure><ol start=\"2\">\n<li>配置 <code>.babelrc</code></li>\n</ol>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token string\">\"@babel/preset-env\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"targets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>          <span class=\"token property\">\"node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"current\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>接下来就可以使用 ES6 的语法了～～～</p>\n<p>更多高阶的 ES6/7/8… 语法，可以参见：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWJlbGpzLmlvLw==\">babel 官网</span></p>\n<p>关于 Typescript 的支持，可以参见 ：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qZXN0anMuaW8vZG9jcy9lbi9nZXR0aW5nLXN0YXJ0ZWQjdXNpbmctdHlwZXNjcmlwdA==\">Using Typescript</span></p>\n<h3 id=\"举个例子\"><a class=\"anchor\" href=\"#举个例子\">#</a> 举个例子</h3>\n<p>关于 test suite 与 test case：</p>\n<p><img data-src=\"assets/w80140jb42.jpg\" alt=\"img\" /></p>\n<p>describe 属于 test suite 的描述，而每个 test 或者 it 则描述了每个 test case。</p>\n<p>例如： <code>math.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">add</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">multiple</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>测试脚本： <code>math.test.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> math <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/math'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"math\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">let</span> a</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">let</span> b</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    a <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    b <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#should return result as a+b\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// test code</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> math<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#should return result as a*b\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">//test code</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> math<span class=\"token punctuation\">.</span><span class=\"token function\">multiple</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>test suite 可以进行嵌套：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bar\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"foo bar\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token comment\">//test code</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>test case 也可以脱离 test suite 独立运行：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// hello.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token string\">'Hello world'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// hello.test.js</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">let</span> hello <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello.js'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should get \"Hello world\"'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello world'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 测试成功</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//expect (hello ()).toBe ('Hello') // 测试失败</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"mock与spy\"><a class=\"anchor\" href=\"#mock与spy\">#</a> Mock 与 Spy</h3>\n<p><strong>mock</strong> 测试就是在测试过程中，对于某些不容易构造或者不容易获取的对象，用一个虚拟的对象来创建以便测试的测试方法。</p>\n<p>Mock 是单元测试中经常使用的一种技术。单元测试，顾名思义测试的重点是某个具体单元。但是在实际代码中，代码与代码之间，模块与模块之间总是会存在着相互引用。这个时候，剥离出这种单元的依赖，让测试更加独立，使用到的技术就是 Mock。</p>\n<p><strong>为什么要使用 Mock 函数？</strong></p>\n<p>在项目中，一个模块的方法内常常会去调用另外一个模块的方法。在单元测试中，我们可能并不需要关心内部调用的方法的执行过程和结果，只想知道它是否被正确调用即可，甚至会指定该函数的返回值。此时，使用 Mock 函数是十分有必要。</p>\n<p>Mock 函数提供的以下三种特性，在我们写测试代码时十分有用：</p>\n<ul>\n<li>捕获函数调用情况</li>\n<li>设置函数返回值</li>\n<li>改变函数的内部实现</li>\n</ul>\n<p><img data-src=\"assets/8u3cp5kz2s.png\" alt=\"img\" /></p>\n<p>举个例子：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// math.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getFooResult</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token comment\">// foo logic here</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getBarResult</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token comment\">// bar logic here</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// caculate.js</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> getFooResult<span class=\"token punctuation\">,</span> getBarResult <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./math\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getFooBarResult</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getFooResult</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token function\">getBarResult</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>此时，getFooResult () 和 getBarResult () 就是 getFooBarResult 这个函数的依赖。如果我们关注的点是 getFooBarResult 这个函数，我们就应该把 getFooResult 和 getBarResult Mock 掉，剥离这种依赖。下面是一个使用 Jest 进行 Mock 的例子。</p>\n<p><code>jest.fn()</code>  是\b创建 Mock 函数最简单的方式，如果没有定义函数内部的实现， <code>jest.fn()</code>  会返回 <code>undefined</code>  作为返回值。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试jest.fn()调用'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">let</span> mockFn <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token function\">mockFn</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token comment\">// 断言 mockFn 的执行后返回 undefined</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeUndefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token comment\">// 断言 mockFn 被调用</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>mockFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token comment\">// 断言 mockFn 被调用了一次</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>mockFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeCalledTimes</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token comment\">// 断言 mockFn 传入的参数为 1, 2, 3</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>mockFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><strong>情景一：设置函数 的返回值</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// calculate.test.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> getFooBarResult <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./calculate\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> fooBar <span class=\"token keyword\">from</span> <span class=\"token string\">'./math'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getResult should return result getFooResult() + getBarResult()'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token comment\">//mock add 方法和 multiple 方法</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  fooBar<span class=\"token punctuation\">.</span>getFooBarResult <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  fooBar<span class=\"token punctuation\">.</span>getBarResult <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">getFooBarResult</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>Mock 其实就是一种 Spies，在 Jest 中使用 spies 来 “spy”(窥探) 一个函数的行为。</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qZXN0anMuaW8vZG9jcy9lbi9tb2NrLWZ1bmN0aW9uLWFwaS5odG1sI2NvbnRlbnQ=\">Jest 文档</span>对于 spies 的解释:</p>\n<blockquote>\n<p>Mock 函数也称为 “spies”，因为它们让你窥探一些由其他代码间接调用的函数的行为，而不仅仅是测试输出。你可以通过使用  <code>jest.fn()</code>  创建一个 mock 函数。</p>\n</blockquote>\n<p>简单来说，一个 spy 是另一个内置的能够记录对其调用细节的函数：调用它的次数，使用什么参数。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// calculate.test.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> getFooBarResult <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./calculate\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> fooBar <span class=\"token keyword\">from</span> <span class=\"token string\">'./math'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getResult should return result getFooResult() + getBarResult()'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token comment\">//mock add 方法和 multiple 方法</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  fooBar<span class=\"token punctuation\">.</span>getFooResult <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  fooBar<span class=\"token punctuation\">.</span>getBarResult <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">getFooBarResult</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token comment\">// 监控 getFooResult 和 getBarResult 的调用情况.</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>fooBar<span class=\"token punctuation\">.</span>getFooResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>fooBar<span class=\"token punctuation\">.</span>getBarResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>情景二：捕获函数调用情况</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// bot method</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> bot <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token function-variable function\">sayHello</span><span class=\"token operator\">:</span> <span class=\"token parameter\">name</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hello </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>name<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// test.js</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bot\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should say hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">const</span> spy <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span>bot<span class=\"token punctuation\">,</span> <span class=\"token string\">\"sayHello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    bot<span class=\"token punctuation\">.</span><span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Michael\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Michael\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    spy<span class=\"token punctuation\">.</span><span class=\"token function\">mockRestore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>我们通过  <code>jest.spyOn</code>  创建了一个监听  <code>bot</code>  对象的  <code>sayHello</code>  方法的 spy。它就像间谍一样监听了所有对  <code>bot#sayHello</code>  方法的调用。由于创建 spy 时，Jest 实际上修改了  <code>bot</code>  对象的  <code>sayHello</code>  属性，所以在断言完成后，我们还要通过  <code>mockRestore</code>  来恢复  <code>bot</code>  对象原本的  <code>sayHello</code>  方法。</p>\n<p>Jest 的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qZXN0anMuaW8vZG9jcy9lbi9qZXN0LW9iamVjdCNqZXN0c3B5b25vYmplY3QtbWV0aG9kbmFtZQ==\"> spyOn 介绍</span></p>\n<p><strong>情景三：修改函数的内容实现</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> bot <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token function-variable function\">sayHello</span><span class=\"token operator\">:</span> <span class=\"token parameter\">name</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hello </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>name<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bot\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should say hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">const</span> spy <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span>bot<span class=\"token punctuation\">,</span> <span class=\"token string\">\"sayHello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockImplementation</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hello mix </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>name<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    bot<span class=\"token punctuation\">.</span><span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Michael\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Michael\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    spy<span class=\"token punctuation\">.</span><span class=\"token function\">mockRestore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>使用 spyOn 方法，还可以去修改 Math.random 这样的函数</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>jest<span class=\"token punctuation\">.</span><span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">,</span> <span class=\"token string\">\"random\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockImplementation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">0.9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>举个例子：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// getNum.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getNum</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">index</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> arr<span class=\"token punctuation\">[</span>index <span class=\"token operator\">%</span> <span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">return</span> arr<span class=\"token punctuation\">[</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// num.test.js</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> getNum <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../src/getNum'</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getNum\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should select numbber based on index if provided\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">getNum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should select a random number based on Math.random if skuId not available\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">const</span> spy <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">,</span> <span class=\"token string\">\"random\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockImplementation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">0.9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">getNum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    spy<span class=\"token punctuation\">.</span><span class=\"token function\">mockRestore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"cli命令\"><a class=\"anchor\" href=\"#cli命令\">#</a> CLI 命令</h3>\n<pre><code>➜ npx jest --help\nUsage: jest [--config=&lt;pathToConfigFile&gt;] [TestPathPattern]\n\n选项：\n  --help, -h                    显示帮助信息                              [布尔]\n  --version, -v                 Print the version and exit                [布尔]\n  --config, -c                  The path to a jest config file specifying how to\n                                find and execute tests. If no rootDir is set in\n                                the config, the directory containing the config\n                                file is assumed to be the rootDir for the\n                                project.This can also be a JSON encoded value\n                                which Jest will use as configuration.   [字符串]\n  --coverage                    Indicates that test coverage information should\n                                be collected and reported in the output.  [布尔] \n  --timers                      Setting this value to fake allows the use of\n                                fake timers for functions such as setTimeout.\n                                                                        [字符串]\n  --verbose                     Display individual test results with the test\n                                suite hierarchy.                          [布尔]\n  --watch                       Watch files for changes and rerun tests related\n                                to changed files. If you want to re-run all\n                                tests when a file has changed, use the\n                                `--watchAll` option.                      [布尔]\n  --watchAll                    Watch files for changes and rerun all tests. If\n                                you want to re-run only the tests related to the\n                                changed files, use the `--watch` option.  [布尔]\n...\n</code></pre>\n<p>常见使用：</p>\n<p><code>--verbose</code>  显示详细的测试信息，包括测试 suite 和 case：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜ npx jest <span class=\"token parameter variable\">--verbose</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> PASS  test/mock.test.js</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  bot</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    ✓ should say hello <span class=\"token punctuation\">(</span>7ms<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  console.log test/mock.test.js:10</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    Hello mix Michael</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre> PASS  test/domain.test.js</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  getImageDomain</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    ✓ should <span class=\"token keyword\">select</span> domain based on skuId <span class=\"token keyword\">if</span> provided <span class=\"token punctuation\">(</span>1ms<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    ✓ should <span class=\"token keyword\">select</span> a random domain based on Math.random <span class=\"token keyword\">if</span> skuId not available <span class=\"token punctuation\">(</span>1ms<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  console.log test/sayhello.test.js:3</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    Hello Michael<span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre> PASS  test/sayhello.test.js</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  bot</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    ✓ should say hello <span class=\"token punctuation\">(</span>6ms<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre> PASS  test/num.test.js</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  getNum</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    ✓ should <span class=\"token keyword\">select</span> numbber based on index <span class=\"token keyword\">if</span> provided <span class=\"token punctuation\">(</span>1ms<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    ✓ should <span class=\"token keyword\">select</span> a random number based on Math.random <span class=\"token keyword\">if</span> skuId not available</pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> PASS  test/math.test.js</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  math</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    ✓ <span class=\"token comment\">#should return result as a+b (1ms)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    ✓ <span class=\"token comment\">#should return result as a*b (4ms)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>Test Suites: <span class=\"token number\">5</span> passed, <span class=\"token number\">5</span> total</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>Tests:       <span class=\"token number\">8</span> passed, <span class=\"token number\">8</span> total</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>Snapshots:   <span class=\"token number\">0</span> total</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>Time:        <span class=\"token number\">1</span>.075s</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>Ran all <span class=\"token builtin class-name\">test</span> suites.</pre></td></tr></table></figure><p><code>--watch</code>  和 <code>--watchAll</code>  用来监听测试文件的变化</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Ran all <span class=\"token builtin class-name\">test</span> suites.</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Watch Usage</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> › Press f to run only failed tests.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> › Press o to only run tests related to changed files.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> › Press p to filter by a filename regex pattern.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> › Press t to filter by a <span class=\"token builtin class-name\">test</span> name regex pattern.</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> › Press q to quit <span class=\"token function\">watch</span> mode.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> › Press Enter to trigger a <span class=\"token builtin class-name\">test</span> run.</pre></td></tr></table></figure><p><code>--coverage</code>  用来形成测试覆盖率报告</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>-----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>-------------------<span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>File       <span class=\"token operator\">|</span>  % Stmts <span class=\"token operator\">|</span> % Branch <span class=\"token operator\">|</span>  % Funcs <span class=\"token operator\">|</span>  % Lines <span class=\"token operator\">|</span> Uncovered Line <span class=\"token comment\">#s |</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>-----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>-------------------<span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>All files  <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>                   <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> getNum.js <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>                   <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> math.js   <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>                   <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>-----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>-------------------<span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Test Suites: <span class=\"token number\">5</span> passed, <span class=\"token number\">5</span> total</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Tests:       <span class=\"token number\">8</span> passed, <span class=\"token number\">8</span> total</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Snapshots:   <span class=\"token number\">0</span> total</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>Time:        <span class=\"token number\">1</span>.497s</pre></td></tr></table></figure><h3 id=\"jest在react-vue项目中的应用\"><a class=\"anchor\" href=\"#jest在react-vue项目中的应用\">#</a> Jest 在 React、Vue 项目中的应用</h3>\n<p>在 <code>create-react-app</code>  中的应用：</p>\n<p>安装对应的依赖：</p>\n<pre><code>npm install react-test-renderer enzyme enzyme-adapter-react-16 \n</code></pre>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FpcmJuYi9lbnp5bWU=\">Enzyme</span> 是一个非常棒的 React 组件测试测试库。</p>\n<blockquote>\n<p>Enzyme is a JavaScript Testing utility for React that makes it easier to test your React Components' output. You can also manipulate, traverse, and in some ways simulate runtime given the output.</p>\n<p>Enzyme's API is meant to be intuitive and flexible by mimicking jQuery's API for DOM manipulation and traversal</p>\n</blockquote>\n<p>需要注意的两点是：</p>\n<ul>\n<li>需要配置 Adapter，不同的 React 的 Adapter 不同</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Enzyme Adapter Package</th>\n<th>React semver compatibility</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>enzyme-adapter-react-16</code></td>\n<td><code>^16.4.0-0</code></td>\n</tr>\n<tr>\n<td><code>enzyme-adapter-react-16.3</code></td>\n<td><code>~16.3.0-0</code></td>\n</tr>\n<tr>\n<td><code>enzyme-adapter-react-16.2</code></td>\n<td><code>~16.2</code></td>\n</tr>\n<tr>\n<td><code>enzyme-adapter-react-16.1</code></td>\n<td><code>~16.0.0-0 || ~16.1</code></td>\n</tr>\n<tr>\n<td><code>enzyme-adapter-react-15</code></td>\n<td><code>^15.5.0</code></td>\n</tr>\n<tr>\n<td><code>enzyme-adapter-react-15.4</code></td>\n<td><code>15.0.0-0 - 15.4.x</code></td>\n</tr>\n<tr>\n<td><code>enzyme-adapter-react-14</code></td>\n<td><code>^0.14.0</code></td>\n</tr>\n<tr>\n<td><code>enzyme-adapter-react-13</code></td>\n<td><code>^0.13.0</code></td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>\n<p>需要初始化配置 <code>setUpTests.js</code></p>\n<p>官方文档在 Package.json 中设置 jest 配置，已经过时，Jest 框架最新会默认加载文件 <code>src/setUpTests.js</code></p>\n</li>\n<li>\n<pre><code class=\"language-react\">import &#123; configure &#125; from 'enzyme';\nimport Adapter from 'enzyme-adapter-react-16'\n\nconfigure(&#123; adapter: new Adapter() &#125;)\n</code></pre>\n</li>\n</ul>\n<p>在 vue 工程化项目中：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"@vue/cli-plugin-unit-jest\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.9.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"@vue/test-utils\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0-beta.29\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"babel-core\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"7.0.0-bridge.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token property\">\"babel-eslint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^10.0.1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token property\">\"babel-jest\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^23.6.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token property\">\"babel-preset-env\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^1.7.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><p>添加如上依赖，</p>\n<p>配置 scripts:</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token string-property property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token string-property property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vue-cli-service test:unit\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><p>配置 <code>jest.config.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token comment\">// 处理 vue 结尾的文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token literal-property property\">moduleFileExtensions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token string\">'js'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token string\">'jsx'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token string\">'json'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token string\">'vue'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token comment\">//es6 转义</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token literal-property property\">transform</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token string-property property\">'^.+\\\\.vue$'</span><span class=\"token operator\">:</span> <span class=\"token string\">'vue-jest'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token string-property property\">'.+\\\\.(css|styl|less|sass|scss|svg|png|jpg|ttf|woff|woff2)$'</span><span class=\"token operator\">:</span> <span class=\"token string\">'jest-transform-stub'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token string-property property\">'^.+\\\\.jsx?$'</span><span class=\"token operator\">:</span> <span class=\"token string\">'babel-jest'</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token literal-property property\">transformIgnorePatterns</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token string\">'/node_modules/'</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token comment\">//cli 配置了 webpack 别名</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token literal-property property\">moduleNameMapper</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token string-property property\">'^@/(.*)$'</span><span class=\"token operator\">:</span> <span class=\"token string\">'&lt;rootDir>/src/$1'</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token literal-property property\">snapshotSerializers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token string\">'jest-serializer-vue'</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token literal-property property\">testMatch</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token string\">'**/tests/unit/**/*.spec.(js|jsx|ts|tsx)|**/__tests__/*.(js|jsx|ts|tsx)'</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token literal-property property\">testURL</span><span class=\"token operator\">:</span> <span class=\"token string\">'http://localhost/'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token literal-property property\">watchPlugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token string\">'jest-watch-typeahead/filename'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token string\">'jest-watch-typeahead/testname'</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>写一个测试用例：</p>\n<pre><code>\n</code></pre>\n<h2 id=\"简约之美ava\"><a class=\"anchor\" href=\"#简约之美ava\">#</a> 简约之美 AVA</h2>\n<p>简单的说 ava 是 mocha 的替代品：</p>\n<ul>\n<li>es6 语法支持更好，对 aysnc/await 有支持</li>\n<li>执行效率更高，使用 io 并发，就必须保证测试的原子性</li>\n<li>语义上更简单，集众家之长</li>\n</ul>\n<p>虽然 JavaScript 是单线程，但在 Node.js 里由于其异步的特性使得 IO 可以并行。AVA 利用这个优点让你的测试可以并发执行，这对于 IO 繁重的测试特别有用。另外，测试文件可以在不同的进程里并行运行，让每一个测试文件可以获得更好的性能和独立的环境。</p>\n<h3 id=\"ava特点\"><a class=\"anchor\" href=\"#ava特点\">#</a> AVA 特点</h3>\n<ul>\n<li>\n<p>轻量和高效</p>\n</li>\n<li>\n<p>简单的测试语法</p>\n</li>\n<li>\n<p>并发运行测试</p>\n</li>\n<li>\n<p>强制编写<strong>原子测试</strong></p>\n<p>一旦开始，就一直运行到结束，中间不会切换到另一个测试</p>\n</li>\n<li>\n<p>没有隐藏的全局变量</p>\n</li>\n<li>\n<p>为每个测试文件隔离环境</p>\n</li>\n<li>\n<p><strong>用 ES2015 编写测试</strong></p>\n</li>\n<li>\n<p>支持 Promise</p>\n</li>\n<li>\n<p>支持 Generator</p>\n</li>\n<li>\n<p>支持 Async</p>\n</li>\n<li>\n<p>支持 Observable</p>\n</li>\n<li>\n<p>强化断言信息</p>\n</li>\n<li>\n<p>可选的 TAP 输出显示</p>\n<p><img data-src=\"assets/tap-reporter.png\" alt=\"img\" /></p>\n</li>\n<li>\n<p>简明的堆栈跟踪</p>\n</li>\n</ul>\n<h3 id=\"安装开始\"><a class=\"anchor\" href=\"#安装开始\">#</a> 安装 &amp; 开始</h3>\n<p>情景一：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>// 创建一个ava项目</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">npm</span> init ava</pre></td></tr></table></figure><p>形成 package.json</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"awesome-package\"</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ava\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token property\">\"ava\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^1.0.0\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>情景二：（推荐）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> init <span class=\"token parameter variable\">-y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>// <span class=\"token function\">npm</span> <span class=\"token operator\">&amp;</span> cnpm</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-D</span> ava</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>// <span class=\"token function\">yarn</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> ava <span class=\"token parameter variable\">-D</span></pre></td></tr></table></figure><p>测试 ava 正常安装：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜ npx ava <span class=\"token parameter variable\">--version</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2.2</span>.0</pre></td></tr></table></figure><h3 id=\"第一个ava测试例子\"><a class=\"anchor\" href=\"#第一个ava测试例子\">#</a> 第一个 ava 测试例子</h3>\n<p>流程：</p>\n<ol>\n<li>引用 ava 的测试 API</li>\n<li>执行测试</li>\n<li>使用断言</li>\n</ol>\n<p>创建 <code>test.js</code>  文件</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> test <span class=\"token keyword\">from</span> <span class=\"token string\">'ava'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">testfn</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a <span class=\"token operator\">+</span> b</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello ava'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">t</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  t<span class=\"token punctuation\">.</span><span class=\"token function\">pass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'my first test'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">t</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token keyword\">const</span> str <span class=\"token operator\">=</span> <span class=\"token string\">'hello ava!!!!'</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  t<span class=\"token punctuation\">.</span><span class=\"token function\">is</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">,</span> <span class=\"token string\">'hello ava!!!!'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'add method'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">t</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">testfn</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  t<span class=\"token punctuation\">.</span><span class=\"token function\">is</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>ava 自动搜索如下文件结尾的文件：</p>\n<ul>\n<li><code>**/test.js</code></li>\n<li><code>**/test-*.js</code></li>\n<li><code>**/*.spec.js</code></li>\n<li><code>**/*.test.js</code></li>\n<li><code>**/test/**/*.js</code></li>\n<li><code>**/tests/**/*.js</code></li>\n<li><code>**/__tests__/**/*.js</code></li>\n</ul>\n<p>ava 中的断言：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>.pass(<span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>.fail(<span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>.assert(value<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>.truthy(value<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>.falsy(value<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>.<span class=\"token boolean\">true</span>(value<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>.<span class=\"token boolean\">false</span>(value<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>.is(value<span class=\"token punctuation\">,</span> expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>.not(value<span class=\"token punctuation\">,</span> expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>.deepEqual(value<span class=\"token punctuation\">,</span> expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>.notDeepEqual(value<span class=\"token punctuation\">,</span> expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>.deepEqual()。</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>.throws(fn<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>.throwsAsync(thrower<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>.notThrows(fn<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>.notThrowsAsync(nonThrower<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>.regex(contents<span class=\"token punctuation\">,</span> regex<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>.notRegex(contents<span class=\"token punctuation\">,</span> regex<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>.snapshot(expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>.snapshot(expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>options<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr></table></figure><h3 id=\"cli命令-2\"><a class=\"anchor\" href=\"#cli命令-2\">#</a> CLI 命令</h3>\n<p>使用 <code>--help</code>  命令去查看 ava 支持的 cli 参数</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜ npx ava <span class=\"token parameter variable\">--help</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  Testing can be a drag. AVA helps you get it done.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  Usage</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    ava <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>file<span class=\"token operator\">></span> <span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  Options</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    --watch, <span class=\"token parameter variable\">-w</span>             Re-run tests when tests and <span class=\"token builtin class-name\">source</span> files change</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    --match, <span class=\"token parameter variable\">-m</span>             Only run tests with matching title <span class=\"token punctuation\">(</span>Can be repeated<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    --update-snapshots, <span class=\"token parameter variable\">-u</span>  Update snapshots</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    --fail-fast             Stop after first <span class=\"token builtin class-name\">test</span> failure</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    --timeout, <span class=\"token parameter variable\">-T</span>           Set global <span class=\"token function\">timeout</span> <span class=\"token punctuation\">(</span>milliseconds or human-readable, e.g. 10s, 2m<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    --serial, <span class=\"token parameter variable\">-s</span>            Run tests serially</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    --concurrency, <span class=\"token parameter variable\">-c</span>       Max number of <span class=\"token builtin class-name\">test</span> files running at the same <span class=\"token function\">time</span> <span class=\"token punctuation\">(</span>Default: CPU cores<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    --verbose, <span class=\"token parameter variable\">-v</span>           Enable verbose output</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    --tap, <span class=\"token parameter variable\">-t</span>               Generate TAP output</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token parameter variable\">--color</span>                 Force color output</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    --no-color              Disable color output</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    --reset-cache           Reset AVA's compilation cache and <span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token parameter variable\">--config</span>                JavaScript <span class=\"token function\">file</span> <span class=\"token keyword\">for</span> AVA to <span class=\"token builtin class-name\">read</span> its config from, instead of using package.json</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                            or ava.config.js files</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  Examples</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    ava</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    ava test.js test2.js</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    ava test-*.js</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    ava <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  The above relies on your shell expanding the glob patterns.</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  Without arguments, AVA uses the following patterns:</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    **/test.js **/test-*.js **/*.spec.js **/*.test.js **/test/**/*.js **/tests/**/*.js **/__tests__/**/*.js</pre></td></tr></table></figure><h4 id=\"文件匹配\"><a class=\"anchor\" href=\"#文件匹配\">#</a> 文件匹配</h4>\n<p>使用 <code>match</code>  指令，匹配对应需要测试的文件：</p>\n<p>匹配标题以 <code>foo</code> ：结尾</p>\n<pre><code>npx ava --match ='* foo'\n</code></pre>\n<p>匹配标题以 <code>foo</code> ：</p>\n<pre><code>npx ava --match ='foo *'\n</code></pre>\n<p>匹配标题包含 <code>foo</code> ：</p>\n<pre><code>npx ava --match ='* foo *'\n</code></pre>\n<p>匹配是完全相同  <code>foo</code> ：</p>\n<pre><code>npx ava --match ='foo'\n</code></pre>\n<p>匹配标题不包含 <code>foo</code> ：</p>\n<pre><code>npx ava --match ='！* foo *'\n</code></pre>\n<p>匹配以下 <code>foo</code>  结尾的标题 <code>bar</code> ：</p>\n<pre><code>npx ava --match ='foo * bar'\n</code></pre>\n<p>匹配 <code>foo</code>  以 <code>bar</code> ：开头或结尾的标题：</p>\n<pre><code>npx ava --match ='foo *' -  match ='* bar'\n</code></pre>\n<h4 id=\"关于reporter\"><a class=\"anchor\" href=\"#关于reporter\">#</a> 关于 reporter</h4>\n<p>默认情况下，AVA 使用最小的报告：</p>\n<p><a href=\"https://github.com/avajs/ava/blob/master/media/mini-reporter.gif\"><img data-src=\"assets/mini-reporter.gif\" alt=\"img\" /></a></p>\n<p>使用该 <code>--verbose</code>  标志启用详细的报告者。除非启用 TAP 报告，否则始终在 CI 环境中使用此选项。</p>\n<p><a href=\"https://github.com/avajs/ava/blob/master/media/verbose-reporter.png\"><img data-src=\"assets/verbose-reporter.png\" alt=\"img\" /></a></p>\n<p><strong>TAP 报告（推荐）</strong></p>\n<p>AVA 支持 TAP 格式，因此与任何 TAP 报告器兼容。使用该 <code>--tap</code>  标志启用 TAP 输出。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ npx ava <span class=\"token parameter variable\">--tap</span> <span class=\"token operator\">|</span> npx tap-nyan</pre></td></tr></table></figure><p><a href=\"https://github.com/avajs/ava/blob/master/media/tap-reporter.png\"><img data-src=\"assets/tap-reporter-20190709154342692.png\" alt=\"img\" /></a></p>\n<p>这里有一些格式：</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Njb3R0Y29yZ2FuL3RhcC1kb3Q=\">tap-dot</span> - Dotted output.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Njb3R0Y29yZ2FuL3RhcC1zcGVj\">tap-spec</span> - Mocha-like spec reporter.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NhbHZpbm1ldGNhbGYvdGFwLW55YW4=\">tap-nyan</span> - Nyan cat.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2d1bW1lc3Nvbi90YXAtbWlu\">tap-min</span> - Minimal output.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25hbXVvbC90YXAtZGlmZmxldA==\">tap-difflet</span> - Minimal output with diffing.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F4cm9zcy90YXAtZGlmZg==\">tap-diff</span> - Human-friendly output with diffing.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2pvZXliYWtlci90YXAtc2ltcGxl\">tap-simple</span> - Simple output.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N1YnN0YWNrL2ZhdWNldA==\">faucet</span> - Human-readable summarizer.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2lzYWFjcy90YXAtbW9jaGEtcmVwb3J0ZXI=\">tap-mocha-reporter</span> - Use any of the <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2lzYWFjcy90YXAtbW9jaGEtcmVwb3J0ZXIvdHJlZS9tYXN0ZXIvbGliL3JlcG9ydGVycw==\">Mocha reporters</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3pvdWJpbi90YXAtc3VtbWFyeQ==\">tap-summary</span> - Summarized output.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NsdXgvdGFwLXBlc3NpbWlzdA==\">tap-pessimist</span> - Only shows failed tests.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Rvb2xuZXNzL3RhcC1wcmV0dGlmeQ==\">tap-prettify</span> - Nice readable output with diffing.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N1YnN0YWNrL3RhcC1jb2xvcml6ZQ==\">tap-colorize</span> - Colorize the output while preserving machine-readability.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2p1bGlhbmdydWJlci90YXAtYmFpbA==\">tap-bail</span> - Bail out when the first test fails.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F4cm9zcy90YXAtbm90aWZ5\">tap-notify</span> - Notifier for macOS, Linux and Windows.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2d1bW1lc3Nvbi90YXAtanNvbg==\">tap-json</span> - JSON output.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3lvdmFzeDIvYXZhLXRhcC1qc29u\">ava-tap-json</span> - JSON output with AVA compatibility.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FnaGFzc2VtaS90YXAteHVuaXQ=\">tap-xunit</span> - xUnit output.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Ntb2NrbGUvdGFwLXRlYW1jaXR5\">tap-teamcity</span> - Output for TeamCity.</li>\n</ul>\n<h4 id=\"快照功能\"><a class=\"anchor\" href=\"#快照功能\">#</a> 快照功能</h4>\n<p>ava 自动进行项目测试快照，如果文件放置在 <code>test</code>  或者 <code>tests</code>  目录，则快照会放置在 <code>snapshots</code>  目录。如果测试放置在 <code>__test__</code> 目录，则快照放置在 <code>__snapshots__</code> 目录</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ava --update-snapshots</pre></td></tr></table></figure><p>可以指定一个固定位置，以便在 AVA 的 <code>package.json</code>  配置中存储快照文件：</p>\n<p><strong>package.json：</strong></p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t <span class=\"token string\">\"ava\"</span>：<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t <span class=\"token string\">\"snapshotDir\"</span>：<span class=\"token string\">\"自定义目录\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"设置超时\"><a class=\"anchor\" href=\"#设置超时\">#</a> 设置超时</h4>\n<p>AVA 中的超时行为与其他测试框架中的行为不同。AVA 在每次测试后重置计时器，如果在指定的超时内没有收到新的测试结果，则强制测试退出。这可用于处理停滞的测试。</p>\n<p><em>没有默认超时。</em></p>\n<p>您可以配置使用超时 <code>--timeout</code>  命令行选项，或配置文件中设置。它们可以以人类可读的方式设置：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 10 秒</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>npx ava <span class=\"token parameter variable\">--timeout</span> <span class=\"token operator\">=</span> 10s </pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 2 分钟</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>npx ava <span class=\"token parameter variable\">--timeout</span> <span class=\"token operator\">=</span> 2m </pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 100 毫秒</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>npx ava <span class=\"token parameter variable\">--timeout</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span></pre></td></tr></table></figure><p>还可以为每个测试单独设置超时。每次进行断言时都会重置这些超时。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">t</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tt<span class=\"token punctuation\">.</span><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 100 milliseconds</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token comment\">// Write your assertions here</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"其他ava设置相关\"><a class=\"anchor\" href=\"#其他ava设置相关\">#</a> 其他 ava 设置相关</h3>\n<h4 id=\"eslint\"><a class=\"anchor\" href=\"#eslint\">#</a> ESLint</h4>\n<p>如果使用了 ESLint，请添加<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2VzbGludC1wbHVnaW4tYXZh\"> eslint-plugin-ava</span></p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tplugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t<span class=\"token string\">\"ava\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"异步相关\"><a class=\"anchor\" href=\"#异步相关\">#</a> 异步相关</h4>\n<p>如果异步操作使用 promises，则应返回 promise：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetches foo'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">t</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\tt<span class=\"token punctuation\">.</span><span class=\"token function\">is</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>更好的是，使用 <code>async</code> /  <code>await</code> ：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetches foo'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">t</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tt<span class=\"token punctuation\">.</span><span class=\"token function\">is</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"测试环境帮手karma\"><a class=\"anchor\" href=\"#测试环境帮手karma\">#</a> 测试环境 &amp; 帮手 Karma</h2>\n<p>Karma 是一个基于 Node.js 的 JavaScript 测试执行过程管理工具（Test Runner）。该工具可用于测试所有主流 Web 浏览器，也可以集成到 CI（Continuous integration）工具，还可以和其他代码编辑器一起使用。</p>\n<p>Karma 会监控配置文件中所指定的每一个文件，每当文件发生改变，它都会向测试服务器发送信号，来通知所有的浏览器再次运行测试代码。此时，浏览器会重新加载源文件，并执行测试代码。其结果会传递回服务器，并以某种形式显示给开发者。</p>\n<p>访问浏览器执行结果，可通过以下的方式</p>\n<ul>\n<li>手工方式 - 通过浏览器</li>\n<li>自动方式 - 让 karma 来启动对应的浏览器</li>\n</ul>\n<h3 id=\"工作原理简介\"><a class=\"anchor\" href=\"#工作原理简介\">#</a> 工作原理简介</h3>\n<p><code>karma</code>  是一个典型的  <code>C/S</code>  程序，包含 client 和 server ，通讯方式基于  <code>Http</code>  ，通常情况下，客户端和服务端基本都运行在开发者本地机器上。</p>\n<p>一个服务端实例对应一个项目，假如想同时运行多个项目，得同时开启多个服务端实例。</p>\n<p><strong>Server</strong></p>\n<p><code>Server</code>  是框架的主要组成部分之一，它内部保存了所有的程序运行状态，比如 client 连接，当前运行的单测文件，根据这些数据状态，它提供了下面几个功能， 下图是 server 的结构</p>\n<p><img data-src=\"assets/TB13X9xLXXXXXXoaXXXDUoU9pXX-902-329.png\" alt=\"karma_server\" /></p>\n<ul>\n<li>监听文件</li>\n<li>与 client 进行通讯</li>\n<li>向开发者输出测试结果</li>\n<li>提供 client 端所需的资源文件</li>\n</ul>\n<p><strong>Client</strong></p>\n<p>client 是单测最终运行的地方，类似一个 web app ， 跟 server 端通讯利用  <code>socket.io</code> ， 执行单测在一个独立的  <code>iframe</code>  中。下面是它的结构图</p>\n<p><img data-src=\"assets/TB1jTKwLXXXXXX.aXXX0KhCSFXX-619-472.png\" alt=\"karma_impl_client\" /></p>\n<p>client 和 server 端通讯采用  <code>socket.io</code></p>\n<ul>\n<li>client 端会发送这些消息</li>\n</ul>\n<p><img data-src=\"assets/TB1XXuILXXXXXcAXFXX.hdJKpXX-918-179.png\" alt=\"karma_impl_client_message_c\" /></p>\n<ul>\n<li>server 端会发送这些消息</li>\n</ul>\n<p><img data-src=\"assets/TB1PvisLXXXXXcqaXXXEHlCNpXX-896-103.png\" alt=\"karma_impl_client_message_s\" /></p>\n<h3 id=\"安装karma\"><a class=\"anchor\" href=\"#安装karma\">#</a> 安装 Karma</h3>\n<p>对于 Nodejs 版本的要求：</p>\n<blockquote>\n<p>Karma currently works on Node.js <strong>6.x</strong>, <strong>8.x</strong>, and <strong>10.x</strong>. See <span class=\"exturl\" data-url=\"aHR0cHM6Ly9rYXJtYS1ydW5uZXIuZ2l0aHViLmlvLzQuMC9pbnRyby9mYXEuaHRtbA==\">FAQ</span> for more info.</p>\n</blockquote>\n<ol>\n<li>\n<p>全局安装</p>\n<pre><code>$npm install -g karma\n</code></pre>\n<p>安装 Karma 命令会到全局的  <code>node_modules</code>  目录下，我们可以在任何位置直接运行 karma 命令。</p>\n<pre><code>npm install -g karma-cli\n</code></pre>\n<p>此命令用来安装  <code>karma-cli</code> ，它会在当前目录下寻找 karma 的可执行文件。这样我们就可以在一个系统内运行多个版本的 Karma。</p>\n</li>\n<li>\n<p>本地安装</p>\n<pre><code>$ npm install karma --save-dev\n</code></pre>\n<p>安装 Karma 命令到当前  <code>node_modules</code>  目录下，此时，如果需要执行 karma 命令，就需要这样</p>\n<pre><code>./node_modules/.bin/karma\n\nnpx karma --version\n</code></pre>\n</li>\n</ol>\n<h3 id=\"配置karma\"><a class=\"anchor\" href=\"#配置karma\">#</a> 配置 Karma</h3>\n<p>karma 配置文件可以用 JavaScript，CoffeeScript 或 TypeScript 编写，并作为常规 Node.js 模块加载。</p>\n<p>除非作为参数提供，否则 Karma CLI 将在以下位置以该顺序 (从上至下) 查找配置文件</p>\n<ul>\n<li><code>./karma.conf.js</code></li>\n<li><code>./karma.conf.coffee</code></li>\n<li><code>./karma.conf.ts</code></li>\n<li><code>./.config/karma.conf.js</code></li>\n<li><code>./.config/karma.conf.coffee</code></li>\n<li><code>./.config/karma.conf.ts</code></li>\n</ul>\n<p>在配置文件中，配置代码通过设置 <code>module.exports</code>  指向一个接受一个参数的函数：配置对象。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// karma.conf.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  config<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token literal-property property\">basePath</span><span class=\"token operator\">:</span> <span class=\"token string\">'../..'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token literal-property property\">frameworks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'jasmine'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">//...</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre># karma<span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">.</span>coffee</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  config<span class=\"token punctuation\">.</span>set</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token literal-property property\">basePath</span><span class=\"token operator\">:</span> <span class=\"token string\">'../..'</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token literal-property property\">frameworks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'jasmine'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    # <span class=\"token operator\">...</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// karma.conf.ts</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  config<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token literal-property property\">basePath</span><span class=\"token operator\">:</span> <span class=\"token string\">'../..'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token literal-property property\">frameworks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'jasmine'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">//...</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>关于 typescript 的支持，需要使用到 <code>ts-node</code> ，配置 ts-node 以使用 <code>commonjs</code>  模块格</p>\n</blockquote>\n<p>配置文件中的基本的属性介绍：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9rYXJtYS1ydW5uZXIuZ2l0aHViLmlvLzQuMC9jb25maWcvY29uZmlndXJhdGlvbi1maWxlLmh0bWw=\">Overview</span></p>\n<p>使用 CLI 工具，快速创建配置</p>\n<p>开始配置</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>~/Downloads/Demo is 📦 v1.0.0 via ⬢ v10.16.0 </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>➜ npx karma init</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 如果在应用中用到了其它的测试框架，那就需要我们安装它们所对应的插件，并在配置文件中标注它们（详见 karma.conf.js 中的 plugins 项）</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Which testing framework <span class=\"token keyword\">do</span> you want to use ?</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Press tab to list possible options. Enter to move to the next question.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">></span> jasmine</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># mocha</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># qunit</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># nodeunit</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># nunit</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># Require.js 是异步加载规范（AMD）的实现。常被作为基础代码库，应用在了很多的项目与框架之中，例如 Dojo, AngularJs 等</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>Do you want to use Require.js ?</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>This will <span class=\"token function\">add</span> Require.js plugin.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>Press tab to list possible options. Enter to move to the next question.</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token operator\">></span> no</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># yes</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\"># 选择需要运行测试用例的浏览器。需要注意的就是，必须保证所对应的浏览器插件已经安装成功。</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>Do you want to capture any browsers automatically ?</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>Press tab to list possible options. Enter empty string to move to the next question.</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token operator\">></span> Chrome</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># ChromeHeadless</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\"># ChromeCanary</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\"># Firefox</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\"># Safari</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\"># PhantomJS</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\"># Opera</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\"># IE</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\"># 选择测试用例所在的目录位置。Karma 支持通配符的方式配置文件或目录，例如 *.js, test/**/*.js 等。如果目录或文件使用相对位置，要清楚地是，此时的路径是相对于当前运行 karma 命令时所在的目录。</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>What is the location of your <span class=\"token builtin class-name\">source</span> and <span class=\"token builtin class-name\">test</span> files ?</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>You can use glob patterns, eg. <span class=\"token string\">\"js/*.js\"</span> or <span class=\"token string\">\"test/**/*Spec.js\"</span><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>Enter empty string to move to the next question.</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token operator\">></span> src/*js</pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\"># 目录中不包括的那些文件。</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>Should any of the files included by the previous patterns be excluded ?</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>You can use glob patterns, eg. <span class=\"token string\">\"**/*.swp\"</span><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>Enter empty string to move to the next question.</pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\"># 是否需要 Karma 自动监听文件？并且文件一旦被修改，就重新运行测试用例？</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>Do you want Karma to <span class=\"token function\">watch</span> all the files and run the tests on change ?</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>Press tab to list possible options.</pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">yes</span></pre></td></tr></table></figure><p>生成了一个 <code>karma.conf.js</code>  文件：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// Karma configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Generated on Wed Jul 10 2019 22:46:32 GMT+0800 (GMT+08:00)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  config<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// base path that will be used to resolve all patterns (eg. files, exclude)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token literal-property property\">basePath</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// frameworks to use</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// available frameworks: https://npmjs.org/browse/keyword/karma-adapter</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token literal-property property\">frameworks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'mocha'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// list of files / patterns to load in the browser</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token literal-property property\">files</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token string\">'src/*js'</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// list of files / patterns to exclude</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token literal-property property\">exclude</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token comment\">// preprocess matching files before serving them to the browser</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">// available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token literal-property property\">preprocessors</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\">// test results reporter to use</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token comment\">// possible values: 'dots', 'progress'</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token comment\">// available reporters: https://npmjs.org/browse/keyword/karma-reporter</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token literal-property property\">reporters</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'progress'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token comment\">// web server port</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token literal-property property\">port</span><span class=\"token operator\">:</span> <span class=\"token number\">9876</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token comment\">// enable / disable colors in the output (reporters and logs)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token literal-property property\">colors</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token comment\">// level of logging</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token comment\">// possible values: config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token literal-property property\">logLevel</span><span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token constant\">LOG_INFO</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token comment\">// enable / disable watching file and executing tests whenever any file changes</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token literal-property property\">autoWatch</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token comment\">// start these browsers</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token comment\">// available browser launchers: https://npmjs.org/browse/keyword/karma-launcher</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token literal-property property\">browsers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'Chrome'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token comment\">// Continuous Integration mode</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token comment\">// if true, Karma captures browsers, runs the tests and exits</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token literal-property property\">singleRun</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token comment\">// Concurrency level</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token comment\">// how many browser should be started simultaneous</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token literal-property property\">concurrency</span><span class=\"token operator\">:</span> <span class=\"token number\">Infinity</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"karma示例\"><a class=\"anchor\" href=\"#karma示例\">#</a> karma 示例</h3>\n<p>目标 ：</p>\n<ul>\n<li>babel 支持，ES6 语法支持</li>\n<li>mocha 与 chai 支持</li>\n<li>karma 与 chrome、webpack 对接</li>\n</ul>\n<p>说明：</p>\n<p>Karma 对 babel 支持的，一个可选项：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2JhYmVsL2thcm1hLWJhYmVsLXByZXByb2Nlc3Nvcg==\">karma-babel-preprocessor</span>，但是：</p>\n<blockquote>\n<p>babel and karma-babel-preprocessor only convert ES6 modules to CommonJS/AMD/SystemJS/UMD**. If you choose CommonJS, you still need to resolve and concatenate CommonJS modules on your own**. We recommend <strong>karma-browserify + babelify</strong> or <strong>webpack + babel-loader</strong> in such cases.</p>\n</blockquote>\n<p>所以，我们选择了 webpack</p>\n<ol>\n<li>\n<p>安装依赖</p>\n<pre><code>npm install @babel/core @babel/preset-env chai mocha webpack webpack-cli babel-loader -D\n</code></pre>\n</li>\n<li>\n<p>安装 karma 的适配器</p>\n<pre><code>npm install karma-webpack karma-chrome-launcher karma-mocha karma-chai -D\n</code></pre>\n</li>\n<li>\n<p>配置 <code>karma.config.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// Karma configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Generated on Thu Jul 11 2019 23:23:44 GMT+0800 (GMT+08:00)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  config<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// base path that will be used to resolve all patterns (eg. files, exclude)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token literal-property property\">basePath</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// frameworks to use</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// available frameworks: https://npmjs.org/browse/keyword/karma-adapter</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token literal-property property\">frameworks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'mocha'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// list of files / patterns to load in the browser</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token literal-property property\">files</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token string\">'src/**/*.js'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token string\">'test/**/*.js'</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre> </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// ....</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\">// preprocess matching files before serving them to the browser</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token comment\">// available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token literal-property property\">preprocessors</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token string-property property\">'src/**/*.js'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'webpack'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token string-property property\">'test/**/*.js'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'webpack'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token literal-property property\">webpack</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token literal-property property\">mode</span><span class=\"token operator\">:</span> <span class=\"token string\">\"none\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token literal-property property\">node</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token literal-property property\">fs</span><span class=\"token operator\">:</span> <span class=\"token string\">'empty'</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>          <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.js?$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">\"babel-loader\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">presets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"@babel/env\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre> </pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token comment\">// ....</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token string\">'karma-mocha'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token string\">'karma-chai'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      <span class=\"token string\">'karma-chrome-launcher'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      <span class=\"token string\">'karma-webpack'</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>书写测试用例 <code>test.js</code> ：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> describe <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"mocha\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> expect <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'chai'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'first test'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello mocha and karma'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello mocha'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure></li>\n<li>\n<p>开始测试：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>npx karma start</pre></td></tr></table></figure><p>添加到 <code>package.json</code></p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"karma\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"karma start\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><p>然后使用， <code>npm run karma</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜ npx karma start</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ℹ ｢wdm｣: Hash: 9d2c943b68425fd58dd0</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Version: webpack <span class=\"token number\">4.35</span>.3</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Time: 53ms</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Built at: <span class=\"token number\">2019</span>-07-12 <span class=\"token number\">5</span>:07:49 PM</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ℹ ｢wdm｣: Compiled successfully.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ℹ ｢wdm｣: Compiling<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>⚠ ｢wdm｣: Hash: cca8316f4bd5855fc4de</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Version: webpack <span class=\"token number\">4.35</span>.3</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Time: 2414ms</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Built at: <span class=\"token number\">2019</span>-07-12 <span class=\"token number\">5</span>:07:52 PM</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>       Asset      Size  Chunks             Chunk Names</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>src/index.js  <span class=\"token number\">3.62</span> KiB       <span class=\"token number\">0</span>  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  src/index</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>test/test.js  <span class=\"token number\">1010</span> KiB       <span class=\"token number\">1</span>  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  test/test</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Entrypoint src/index <span class=\"token operator\">=</span> src/index.js</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>Entrypoint test/test <span class=\"token operator\">=</span> test/test.js</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> ./src/index.js <span class=\"token number\">27</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> ./test/test.js <span class=\"token number\">223</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> ./node_modules/mocha/browser-entry.js <span class=\"token number\">4.19</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> ./node_modules/process/browser.js <span class=\"token number\">4.96</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>webpack<span class=\"token punctuation\">)</span>/buildin/global.js <span class=\"token number\">878</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> ./node_modules/browser-stdout/index.js <span class=\"token number\">662</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> ./node_modules/stream-browserify/index.js <span class=\"token number\">3.53</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">36</span><span class=\"token punctuation\">]</span> ./node_modules/util/util.js <span class=\"token number\">19</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">38</span><span class=\"token punctuation\">]</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">21.8</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">39</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>webpack<span class=\"token punctuation\">)</span>/buildin/module.js <span class=\"token number\">552</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">40</span><span class=\"token punctuation\">]</span> ./node_modules/escape-string-regexp/index.js <span class=\"token number\">230</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">41</span><span class=\"token punctuation\">]</span> path <span class=\"token punctuation\">(</span>ignored<span class=\"token punctuation\">)</span> <span class=\"token number\">15</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">42</span><span class=\"token punctuation\">]</span> ./node_modules/mocha/lib/reporters/index.js <span class=\"token number\">945</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">105</span><span class=\"token punctuation\">]</span> ./node_modules/chai/index.js <span class=\"token number\">39</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">106</span><span class=\"token punctuation\">]</span> ./node_modules/chai/lib/chai.js <span class=\"token number\">1.22</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    + <span class=\"token number\">128</span> hidden modules</pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">217</span>:20-37</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"36\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"37\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">222</span>:24-70</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"41\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"42\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">266</span>:24-35</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"46\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"47\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">313</span>:35-48</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"51\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"52\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">329</span>:23-44</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"56\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"57\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>ℹ ｢wdm｣: Compiled with warnings.</pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:07:52.761:WARN <span class=\"token punctuation\">[</span>karma<span class=\"token punctuation\">]</span>: No captured browser, <span class=\"token function\">open</span> http://localhost:9876/</pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:07:52.770:INFO <span class=\"token punctuation\">[</span>karma-server<span class=\"token punctuation\">]</span>: Karma v4.1.0 server started at http://0.0.0.0:9876/</pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:07:52.770:INFO <span class=\"token punctuation\">[</span>launcher<span class=\"token punctuation\">]</span>: Launching browsers Chrome with concurrency unlimited</pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:07:52.773:INFO <span class=\"token punctuation\">[</span>launcher<span class=\"token punctuation\">]</span>: Starting browser Chrome</pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:07:54.135:INFO <span class=\"token punctuation\">[</span>Chrome <span class=\"token number\">75.0</span>.3770 <span class=\"token punctuation\">(</span>Mac OS X <span class=\"token number\">10.14</span>.5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>: Connected on socket R9R31QB1GtR_kayNAAAA with <span class=\"token function\">id</span> <span class=\"token number\">55412577</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>Chrome <span class=\"token number\">75.0</span>.3770 <span class=\"token punctuation\">(</span>Mac OS X <span class=\"token number\">10.14</span>.5<span class=\"token punctuation\">)</span> LOG: <span class=\"token string\">'hello karma'</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>LOG: <span class=\"token string\">'hello mocha'</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>Chrome <span class=\"token number\">75.0</span>.3770 <span class=\"token punctuation\">(</span>Mac OS X <span class=\"token number\">10.14</span>.5<span class=\"token punctuation\">)</span>: Executed <span class=\"token number\">1</span> of <span class=\"token number\">1</span> SUCCESS <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> secs / <span class=\"token number\">0.001</span> secs</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>~/Downloads/karma-demo is 📦 v1.0.0 via ⬢ v10.16.0 </pre></td></tr><tr><td data-num=\"69\"></td><td><pre>➜ <span class=\"token function\">npm</span> run karma</pre></td></tr><tr><td data-num=\"70\"></td><td><pre></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token operator\">></span> karma-demo@1.0.0 karma /Users/itheima/Downloads/karma-demo</pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token operator\">></span> karma start</pre></td></tr><tr><td data-num=\"73\"></td><td><pre></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>ℹ ｢wdm｣: Hash: 9d2c943b68425fd58dd0</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>Version: webpack <span class=\"token number\">4.35</span>.3</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>Time: 48ms</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>Built at: <span class=\"token number\">2019</span>-07-12 <span class=\"token number\">5</span>:24:02 PM</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>ℹ ｢wdm｣: Compiled successfully.</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>ℹ ｢wdm｣: Compiling<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>⚠ ｢wdm｣: Hash: cca8316f4bd5855fc4de</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>Version: webpack <span class=\"token number\">4.35</span>.3</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>Time: 2307ms</pre></td></tr><tr><td data-num=\"83\"></td><td><pre>Built at: <span class=\"token number\">2019</span>-07-12 <span class=\"token number\">5</span>:24:04 PM</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>       Asset      Size  Chunks             Chunk Names</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>src/index.js  <span class=\"token number\">3.62</span> KiB       <span class=\"token number\">0</span>  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  src/index</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>test/test.js  <span class=\"token number\">1010</span> KiB       <span class=\"token number\">1</span>  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  test/test</pre></td></tr><tr><td data-num=\"87\"></td><td><pre>Entrypoint src/index <span class=\"token operator\">=</span> src/index.js</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>Entrypoint test/test <span class=\"token operator\">=</span> test/test.js</pre></td></tr><tr><td data-num=\"89\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> ./src/index.js <span class=\"token number\">27</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> ./test/test.js <span class=\"token number\">223</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> ./node_modules/mocha/browser-entry.js <span class=\"token number\">4.19</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> ./node_modules/process/browser.js <span class=\"token number\">4.96</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>webpack<span class=\"token punctuation\">)</span>/buildin/global.js <span class=\"token number\">878</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> ./node_modules/browser-stdout/index.js <span class=\"token number\">662</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> ./node_modules/stream-browserify/index.js <span class=\"token number\">3.53</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">36</span><span class=\"token punctuation\">]</span> ./node_modules/util/util.js <span class=\"token number\">19</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">38</span><span class=\"token punctuation\">]</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">21.8</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">39</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>webpack<span class=\"token punctuation\">)</span>/buildin/module.js <span class=\"token number\">552</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">40</span><span class=\"token punctuation\">]</span> ./node_modules/escape-string-regexp/index.js <span class=\"token number\">230</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">41</span><span class=\"token punctuation\">]</span> path <span class=\"token punctuation\">(</span>ignored<span class=\"token punctuation\">)</span> <span class=\"token number\">15</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">42</span><span class=\"token punctuation\">]</span> ./node_modules/mocha/lib/reporters/index.js <span class=\"token number\">945</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">105</span><span class=\"token punctuation\">]</span> ./node_modules/chai/index.js <span class=\"token number\">39</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">106</span><span class=\"token punctuation\">]</span> ./node_modules/chai/lib/chai.js <span class=\"token number\">1.22</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>    + <span class=\"token number\">128</span> hidden modules</pre></td></tr><tr><td data-num=\"105\"></td><td><pre></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">217</span>:20-37</pre></td></tr><tr><td data-num=\"107\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"108\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"109\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"110\"></td><td><pre></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">222</span>:24-70</pre></td></tr><tr><td data-num=\"112\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"113\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"114\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"115\"></td><td><pre></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">266</span>:24-35</pre></td></tr><tr><td data-num=\"117\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"118\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"119\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"120\"></td><td><pre></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">313</span>:35-48</pre></td></tr><tr><td data-num=\"122\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"123\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"124\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"125\"></td><td><pre></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">329</span>:23-44</pre></td></tr><tr><td data-num=\"127\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"128\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"129\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"130\"></td><td><pre>ℹ ｢wdm｣: Compiled with warnings.</pre></td></tr><tr><td data-num=\"131\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:24:04.905:WARN <span class=\"token punctuation\">[</span>karma<span class=\"token punctuation\">]</span>: No captured browser, <span class=\"token function\">open</span> http://localhost:9876/</pre></td></tr><tr><td data-num=\"132\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:24:04.914:INFO <span class=\"token punctuation\">[</span>karma-server<span class=\"token punctuation\">]</span>: Karma v4.1.0 server started at http://0.0.0.0:9876/</pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:24:04.914:INFO <span class=\"token punctuation\">[</span>launcher<span class=\"token punctuation\">]</span>: Launching browsers Chrome with concurrency unlimited</pre></td></tr><tr><td data-num=\"134\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:24:04.922:INFO <span class=\"token punctuation\">[</span>launcher<span class=\"token punctuation\">]</span>: Starting browser Chrome</pre></td></tr><tr><td data-num=\"135\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:24:06.289:INFO <span class=\"token punctuation\">[</span>Chrome <span class=\"token number\">75.0</span>.3770 <span class=\"token punctuation\">(</span>Mac OS X <span class=\"token number\">10.14</span>.5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>: Connected on socket EbCCSbQRPbxHbq3OAAAA with <span class=\"token function\">id</span> <span class=\"token number\">92342032</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>Chrome <span class=\"token number\">75.0</span>.3770 <span class=\"token punctuation\">(</span>Mac OS X <span class=\"token number\">10.14</span>.5<span class=\"token punctuation\">)</span> LOG: <span class=\"token string\">'hello karma'</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>LOG: <span class=\"token string\">'hello mocha'</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>Chrome <span class=\"token number\">75.0</span>.3770 <span class=\"token punctuation\">(</span>Mac OS X <span class=\"token number\">10.14</span>.5<span class=\"token punctuation\">)</span>: Executed <span class=\"token number\">1</span> of <span class=\"token number\">1</span> SUCCESS <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> secs / <span class=\"token number\">0.001</span> secs</pre></td></tr><tr><td data-num=\"140\"></td><td><pre>Chrome <span class=\"token number\">75.0</span>.3770 <span class=\"token punctuation\">(</span>Mac OS X <span class=\"token number\">10.14</span>.5<span class=\"token punctuation\">)</span>: Executed <span class=\"token number\">1</span> of <span class=\"token number\">1</span> SUCCESS <span class=\"token punctuation\">(</span><span class=\"token number\">0.006</span> secs / <span class=\"token number\">0.001</span> </pre></td></tr><tr><td data-num=\"141\"></td><td><pre>secs<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>TOTAL: <span class=\"token number\">1</span> SUCCESS</pre></td></tr></table></figure></li>\n</ol>\n<h2 id=\"ui测试利器nightmare\"><a class=\"anchor\" href=\"#ui测试利器nightmare\">#</a> UI 测试利器 Nightmare</h2>\n<p>Nightmare 是<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWdtZW50LmNvbS8=\"> Segment</span> 的高级浏览器自动化库。</p>\n<p>目标是公开一些模仿用户操作（例如 <code>goto</code> ， <code>type</code>  和 <code>click</code> ）的简单方法，使用对每个脚本块感觉同步的 API，而不是深层嵌套的回调。它最初设计用于在没有 API 的站点之间自动执行任务，但最常用于 UI 测试和爬网。</p>\n<p>它使用<span class=\"exturl\" data-url=\"aHR0cDovL2VsZWN0cm9uLmF0b20uaW8v\"> Electron</span>，它与<span class=\"exturl\" data-url=\"aHR0cDovL3BoYW50b21qcy5vcmcv\"> PhantomJS</span> 类似，但大约<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9uaWdodG1hcmUvaXNzdWVzLzQ4NCNpc3N1ZWNvbW1lbnQtMTg0NTE5NTkx\">快两倍</span>，更现代。</p>\n<h3 id=\"安装与起步\"><a class=\"anchor\" href=\"#安装与起步\">#</a> 安装与起步</h3>\n<ol>\n<li>\n<p>安装 <code>nightmare</code></p>\n</li>\n<li>\n<pre><code>// 初始化项目\nnpm init -y\n\nnpm install --save-dev nightmare\n\n</code></pre>\n</li>\n</ol>\n<p>npm install --save-dev mocha</p>\n<pre><code>\n2. 淘宝源加速\n\n</code></pre>\n<p>// 使用淘宝源加速 electron 的安装<br />\n export ELECTRON_MIRROR=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ucG0udGFvYmFvLm9yZy9taXJyb3JzL2VsZWN0cm9uLw==\">https://npm.taobao.org/mirrors/electron/</span>&quot;</p>\n<pre><code>\n3. 起步测试：\n\n```js\nconst Nightmare = require('nightmare')\nconst assert = require('assert')\n\ndescribe('Load a Page', function () &#123;\n  // Recommended: 5s locally, 10s to remote server, 30s from airplane ¯\\_(ツ)_/¯\n  this.timeout('30s')\n\n  let nightmare = null\n  beforeEach(() =&gt; &#123;\n    nightmare = new Nightmare()\n  &#125;)\n\n  describe('/ (Home Page)', () =&gt; &#123;\n    it('should load without error', done =&gt; &#123;\n      // your actual testing urls will likely be `http://localhost:port/path`\n      nightmare.goto('https://www.baidu.com')\n        .end()\n        .then(function (result) &#123;\n          done()\n        &#125;)\n        .catch(done)\n    &#125;)\n  &#125;)\n&#125;)\n</code></pre>\n<h3 id=\"nightmare配合mocha测试\"><a class=\"anchor\" href=\"#nightmare配合mocha测试\">#</a> nightmare 配合 mocha 测试</h3>\n<p>nightmare 可以进行网页的抓取，配合 mocha 进行页面的测试：</p>\n<p>安装 <code>mocha</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev mocha</pre></td></tr></table></figure><blockquote>\n<p>还可以安装一些断言库，如： <code>chai</code></p>\n</blockquote>\n<p>新建测试：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> Nightmare <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'nightmare'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> assert <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'assert'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Search nightmare'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token string\">'30s'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">let</span> nightmare <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    nightmare <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Nightmare</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should load with result nightmare'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">done</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">const</span> selector <span class=\"token operator\">=</span> <span class=\"token string\">'em'</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    nightmare<span class=\"token punctuation\">.</span><span class=\"token function\">goto</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://www.baidu.com'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#kw'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'nightmare'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#su'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token string\">'em'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">selector</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token comment\">// now we're executing inside the browser scope.</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token keyword\">return</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>innerText</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> selector<span class=\"token punctuation\">)</span> <span class=\"token comment\">// &lt;-- that's how you pass parameters from Node scope to browser scope</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      assert<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> <span class=\"token string\">'nightmare'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>将 mocha 作为测试脚本添加到您的   <code>package.json</code> ：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mocha\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"api介绍\"><a class=\"anchor\" href=\"#api介绍\">#</a> API 介绍</h3>\n<h4 id=\"nightmare的配置项\"><a class=\"anchor\" href=\"#nightmare的配置项\">#</a> nightmare 的配置项</h4>\n<pre><code>waitTimeout (default: 30s)\ngotoTimeout (default: 30s)\nloadTimeout (default: infinite)\nexecutionTimeout (default: 30s)\npaths\nswitches\nelectronPath\ndock\nopenDevTools\ntypeInterval (default: 100ms)\npollInterval (default: 250ms)\nmaxAuthRetries (default: 3)\ncertificateSubjectName\n.engineVersions()\n.useragent(useragent)\n.authentication(user, password)\n.authentication(user, password)\n.halt(error, done)\n</code></pre>\n<p>配置链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9uaWdodG1hcmUjbmlnaHRtYXJlb3B0aW9ucw==\">https://github.com/segmentio/nightmare#nightmareoptions</span></p>\n<h4 id=\"页面交互相关\"><a class=\"anchor\" href=\"#页面交互相关\">#</a> 页面交互相关</h4>\n<pre><code>.back()\n.forward()\n.refresh()\n.click(selector)\n.mousedown(selector)\n.mouseup(selector)\n.mouseover(selector)\n.mouseout(selector)\n.type(selector[, text])\n.insert(selector[, text])\n.check(selector)\n.uncheck(selector)\n.select(selector, option)\n.scrollTo(top, left)\n.viewport(width, height)\n.inject(type, file)\n.evaluate(fn[, arg1, arg2,...])\n.wait(ms)\n.wait(selector)\n.wait(fn[, arg1, arg2,...])\n.header(header, value)\n</code></pre>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9uaWdodG1hcmUjaW50ZXJhY3Qtd2l0aC10aGUtcGFnZQ==\">配置参考链接</span></p>\n<h4 id=\"页面提取\"><a class=\"anchor\" href=\"#页面提取\">#</a> 页面提取</h4>\n<pre><code>.exists(selector)\n.visible(selector)\n.on(event, callback)\n.once(event, callback)\n.removeListener(event, callback)\n.screenshot([path][, clip])\n.html(path, saveType)\n.pdf(path, options)\n.title()\n.url()\n.path()\n</code></pre>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9uaWdodG1hcmUjZXh0cmFjdC1mcm9tLXRoZS1wYWdl\">配置参考链接</span></p>\n<h2 id=\"补充学习\"><a class=\"anchor\" href=\"#补充学习\">#</a> 补充学习</h2>\n<h3 id=\"补充资料\"><a class=\"anchor\" href=\"#补充资料\">#</a> 补充资料</h3>\n<h4 id=\"软件测试的分类\"><a class=\"anchor\" href=\"#软件测试的分类\">#</a> 软件测试的分类</h4>\n<p><strong>第一部分：软件测试的分类</strong></p>\n<ul>\n<li>\n<p>按测试执行阶段划分</p>\n<p>单元测试、集成测试、系统测试、验收测试（正式验收测试、Alpha 测试、Beta 测试）</p>\n</li>\n<li>\n<p>按测试技术划分</p>\n<p>白盒测试、黑盒测试、灰盒测试</p>\n</li>\n<li>\n<p>被测试对象是否运行划分</p>\n<p>动态测试、静态测试（文档检查、代码走查、界面检查）</p>\n</li>\n<li>\n<p>按不同的测试手段划分</p>\n<p>手工测试、自动化测试</p>\n</li>\n<li>\n<p>按测试包含的内容划分</p>\n<p>功能测试、界面测试、安全测试、兼容性测试、易用性测试、性能测试、压力测试、负载测试、恢复测试</p>\n</li>\n<li>\n<p>其他测试</p>\n<p>冒烟测试、回归测试、探索性测试 / 自由测试（测试思维）</p>\n</li>\n</ul>\n<p><strong>第二部分：接下来对软件测试分类进行一个说明</strong></p>\n<p><img data-src=\"../../5-2%20%E9%A1%B9%E7%9B%AE%E8%B4%A8%E9%87%8F%E7%9B%91%E6%B5%8B/resource/assets/v2-889a2848a1b2a8eeccae000be23c247a_hd.jpg\" alt=\"img\" /><img data-src=\"../../5-2%20%E9%A1%B9%E7%9B%AE%E8%B4%A8%E9%87%8F%E7%9B%91%E6%B5%8B/resource/assets/v2-889a2848a1b2a8eeccae000be23c247a_hd.jpg\" alt=\"img\" /></p>\n<p><img data-src=\"../../5-2%20%E9%A1%B9%E7%9B%AE%E8%B4%A8%E9%87%8F%E7%9B%91%E6%B5%8B/resource/assets/v2-f831b8041976b50aad7c2425aada44e2_hd-1561454378198.jpg\" alt=\"img\" /><img data-src=\"../../5-2%20%E9%A1%B9%E7%9B%AE%E8%B4%A8%E9%87%8F%E7%9B%91%E6%B5%8B/resource/assets/v2-f831b8041976b50aad7c2425aada44e2_hd.jpg\" alt=\"img\" /></p>\n<p><strong>第三部分：测试工具</strong></p>\n<p>SVN，Git——&gt; 版本控制管理工具</p>\n<p>禅道 ——&gt;Bug 管理工具</p>\n<p>Fiddler——&gt; 抓包，定位问题你</p>\n<p>postman，jmeter，soapui——&gt; 接口测试</p>\n<p>Loadrunner，Jmeter——&gt; 性能，压力测试</p>\n<h4 id=\"2019年javascript测试概览\"><a class=\"anchor\" href=\"#2019年javascript测试概览\">#</a> 2019 年 Javascript 测试概览</h4>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL3dlbGxkb25lLXNvZnR3YXJlL2FuLW92ZXJ2aWV3LW9mLWphdmFzY3JpcHQtdGVzdGluZy1pbi0yMDE5LTI2NGUxOTUxNGQwYQ==\">https://medium.com/welldone-software/an-overview-of-javascript-testing-in-2019-264e19514d0a</span></p>\n<p>这是一篇非常好的国外的博文，同时也是 2018 年 Javascript 测试概览的作者。这里有 2018 年的译文：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zMjcwMjQyMQ==\">展望 2018 年 JavaScript Testing</span></p>\n<p>在文中很好介绍到了测试类型，并举了大量的例子，非常全面。</p>\n<h4 id=\"什么是tdd\"><a class=\"anchor\" href=\"#什么是tdd\">#</a> 什么是 TDD？</h4>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YzNlNzM4NzZmYjlhMDQ5ZDM3ZjVkYjE=\">测试驱动开发（TDD）总结 —— 原理篇</span></p>\n<p>TDD （Test Driven Development） 在不同的圈子、不同的角色的认知中可能会有不同的理解，有人可能会理解成 ATDD（Acceptance Test Driven Development），也有人可能会理解成 UTDD（Unit Test Driven Development），为了避免产生歧义，<strong>文章涉及到 TDD 专指 UTDD（Unit Test Driven Development），即 「单元测试驱动开发」</strong>。</p>\n<p>TDD 的目标</p>\n<blockquote>\n<p>Kent Beck 在他的著作《Test-Driven Development》一书中提到：“<strong>代码简洁可用</strong>这句言简意赅的话，正是 TDD 所追求的目标”。</p>\n</blockquote>\n<p><strong>对于如何保证 “代码简洁可用” 可以使用分而治之的方法，先达到 “可用” 目标，再追求 “简洁” 目标。</strong></p>\n<p><strong>可用：</strong> 保证代码通过自动化测试。</p>\n<p><strong>代码简洁：</strong> 在不同阶段人们对简洁的理解程度也不一样，不过遵循的原则差不多，例如 OOD 的 SOLID 原则，Kent Beck 的 Simple Design 原则等。</p>\n<p>虽然有很多因素妨碍我们得到整洁的代码，甚至可用的代码，无需征求太多意见，只需要采用 TDD 的开发方式来驱动出简洁可用的代码。</p>\n<h4 id=\"karma的前世今生\"><a class=\"anchor\" href=\"#karma的前世今生\">#</a> Karma 的前世今生</h4>\n<p>2016 年的文章，由淘宝前端团队书写：<span class=\"exturl\" data-url=\"aHR0cDovL3Rhb2Jhb2ZlZC5vcmcvYmxvZy8yMDE2LzAxLzA4L2thcm1hLW9yaWdpbi8=\">http://taobaofed.org/blog/2016/01/08/karma-origin/</span></p>\n<p>通篇介绍了 karma 的工作原理及实现原理，非常有价值的文章。</p>\n<h3 id=\"ava框架的配置文件\"><a class=\"anchor\" href=\"#ava框架的配置文件\">#</a> ava 框架的配置文件</h3>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token property\">\"ava\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t<span class=\"token property\">\"files\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\t<span class=\"token string\">\"test/**/*\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\t<span class=\"token string\">\"!test/exclude-files-in-this-directory\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t<span class=\"token string\">\"!**/exclude-files-with-this-name.*\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token property\">\"helpers\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token string\">\"**/helpers/**/*\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t<span class=\"token property\">\"sources\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token string\">\"src/**/*\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t<span class=\"token string\">\"*oo\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t<span class=\"token string\">\"!foo\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token property\">\"cache\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token property\">\"concurrency\"</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token property\">\"failFast\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t<span class=\"token property\">\"failWithoutAssertions\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t<span class=\"token property\">\"environmentVariables\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t<span class=\"token property\">\"MY_ENVIRONMENT_VARIABLE\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"some value\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token property\">\"tap\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t<span class=\"token property\">\"verbose\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t<span class=\"token property\">\"compileEnhancements\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t<span class=\"token property\">\"require\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t<span class=\"token string\">\"@babel/register\"</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t<span class=\"token property\">\"babel\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\t<span class=\"token property\">\"extensions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"js\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"jsx\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t<span class=\"token property\">\"testOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t\t<span class=\"token property\">\"babelrc\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li><code>files</code> ：用于选择测试文件的 glob 模式数组。带有下划线前缀的文件将被忽略。默认情况下，仅选择具有 <code>js</code>  扩展名的文件，即使该模式与其他文件匹配。指定 <code>extensions</code>  并 <code>babel.extensions</code>  允许其他文件扩展名</li>\n<li><code>helpers</code> ：用于选择帮助文件的 glob 模式数组。这里匹配的文件永远不会被视为测试。默认情况下，仅选择具有 <code>js</code>  扩展名的文件，即使该模式与其他文件匹配。指定 <code>extensions</code>  并 <code>babel.extensions</code>  允许其他文件扩展名</li>\n<li><code>sources</code> ：一组 glob 模式，用于匹配文件，这些文件在更改时会导致重新运行测试（在监视模式下）。有关详细信息，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2F2YS9ibG9iL21hc3Rlci9kb2NzL3JlY2lwZXMvd2F0Y2gtbW9kZS5tZCNzb3VyY2UtZmlsZXMtYW5kLXRlc3QtZmlsZXM=\">请参阅</span></li>\n<li><code>match</code> ：通常在 <code>package.json</code>  配置中没用，但等同于在 CLI 上指定 <code>--match</code></li>\n<li><code>cache</code> ：缓存编译的测试和帮助文件 <code>node_modules/.cache/ava</code> 。如果 <code>false</code> ，文件缓存在临时目录中</li>\n<li><code>failFast</code> ：一旦测试失败，停止运行进一步的测试</li>\n<li><code>failWithoutAssertions</code> ：如果设置成 <code>false</code> ，那么如果没有运行断言，则测试失败</li>\n<li><code>environmentVariables</code> ：指定要供测试使用的环境变量。此处定义的环境变量会覆盖其中的环境变量 <code>process.env</code></li>\n<li><code>tap</code> ：设置成  <code>true</code> ，启用 TAP 报告</li>\n<li><code>verbose</code> ：设置成  <code>true</code> ，启用详细输出</li>\n<li><code>snapshotDir</code> ：指定用于存储快照文件的固定位置。如果快照最终位于错误的位置，请使用此选项</li>\n<li><code>compileEnhancements</code> ：设置成  <code>false</code> ，禁用了 <a href=\"https://github.com/avajs/ava/blob/master/docs/03-assertions.md#enhanced-assertion-messages\"> <code>power-assert</code> </a>，否则有助于提供更具描述性的错误消息， 并检测 <code>t.throws()</code>  断言的不当使用</li>\n<li><code>extensions</code> ：未使用 AVA 的 Babel 预设进行预编译的测试文件的扩展名。请注意，文件仍然会被编译为启用 <code>power-assert</code>  和其他功能，因此您可能还需要设置 <code>compileEnhancements</code>  为 <code>false</code>  文件是否为有效的 JavaScript。设置此 <code>&quot;js&quot;</code>  值会覆盖默认值，因此请确保在列表中包含该扩展名，只要它不包含在内 <code>babel.extensions</code></li>\n<li><code>require</code> ：在运行测试之前需要额外的模块。工作进程中需要模块</li>\n<li><code>babel</code> ：测试文件特定的 Babel 选项。有关详细信息，请参阅<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2F2YS9ibG9iL21hc3Rlci9kb2NzL3JlY2lwZXMvYmFiZWwubWQjY29uZmlndXJpbmctYmFiZWw=\"> Babel 配置</span></li>\n<li><code>babel.extensions</code> ：将使用 AVA 的 Babel 预设进行预编译的测试文件的扩展。设置此选项会覆盖默认 <code>&quot;js&quot;</code>  值，因此请确保在列表中包含该扩展名。</li>\n<li><code>timeout</code> ：AVA 中的超时行为与其他测试框架中的行为不同。AVA 在每次测试后重置计时器，如果在指定的超时内没有收到新的测试结果，则强制测试退出。这可用于处理停滞的测试。请参阅我们的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2F2YS9ibG9iL21hc3Rlci9kb2NzLzA3LXRlc3QtdGltZW91dHMubWQ=\">超时文档</span>以获取更多选</li>\n</ul>\n<p>请注意，在 CLI 上提供文件会覆盖该 <code>files</code>  选项。</p>\n<h2 id=\"参考资料\"><a class=\"anchor\" href=\"#参考资料\">#</a> 参考资料</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC80NzAwOTY2NA==\">使用 Jest 测试 JavaScript (Mock 篇)</span></li>\n</ul>\n",
            "tags": [
                "自动化测试",
                "自动化测试"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/03/02/%E8%BD%AF%E4%BB%B6%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/",
            "url": "https://dmqweb.cn/2024/03/02/%E8%BD%AF%E4%BB%B6%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/",
            "title": "设计模式",
            "date_published": "2024-03-02T00:24:04.000Z",
            "content_html": "<h1 id=\"设计模式\"><a class=\"anchor\" href=\"#设计模式\">#</a> 设计模式</h1>\n<h2 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h2>\n<p>有一些重要的设计原则在开篇和大家分享下，这些原则将贯通全文：</p>\n<ul>\n<li>\n<p>面向接口编程，而不是面向实现。这个很重要，也是优雅的、可扩展的代码的第一步，这就不需要多说了吧。</p>\n</li>\n<li>\n<p>职责单一原则。每个类都应该只有一个单一的功能，并且该功能应该由这个类完全封装起来。</p>\n</li>\n<li>\n<p>对修改关闭，对扩展开放。对修改关闭是说，我们辛辛苦苦加班写出来的代码，该实现的功能和该修复的 bug 都完成了，别人可不能说改就改；对扩展开放就比较好理解了，也就是说在我们写好的代码基础上，很容易实现扩展。</p>\n</li>\n</ul>\n<p>创建型模式比较简单，但是会比较没有意思，结构型和行为型比较有意思</p>\n<p>每个代理模式的代码都必须自己手动完成一遍。</p>\n<h2 id=\"创建型模式\"><a class=\"anchor\" href=\"#创建型模式\">#</a> 创建型模式</h2>\n<p>创建型模式的作用就是创建对象，说到创建一个对象，最熟悉的就是 new 一个对象，然后 set 相关属性。但是，在很多场景下，我们需要给客户端提供更加友好的创建对象的方式，尤其是那种我们定义了类，但是需要提供给其他开发者用的时候。</p>\n<p>工厂模式分为简单工厂模式，工厂模式，抽象工厂模式</p>\n<p>在工厂模式中，我们在创建对象时不会对客户端暴露创建逻辑，并且是通过使用一个共同的接口来指向新创建的对象。<strong>本质就是使用工厂方法代替 new 操作。</strong></p>\n<h3 id=\"简单工厂模式\"><a class=\"anchor\" href=\"#简单工厂模式\">#</a> 简单工厂模式</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodFactory</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Food</span> <span class=\"token function\">makeFood</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"兰州拉面\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token class-name\">Food</span> noodle <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LanZhouNoodle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"兰州拉面\"</span><span class=\"token operator\">+</span>noodle<span class=\"token operator\">+</span><span class=\"token string\">\"出锅啦\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token keyword\">return</span> noodle<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"黄焖鸡\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">Food</span> chicken <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HuangMenChicken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"黄焖鸡\"</span><span class=\"token operator\">+</span> chicken <span class=\"token operator\">+</span><span class=\"token string\">\"出锅啦\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token keyword\">return</span> chicken<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"不知道你做的什么哦~\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>其中，LanZhouNoodle 和 HuangMenChicken 都继承自 Food。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Cook</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">Food</span> food <span class=\"token operator\">=</span> <span class=\"token class-name\">FoodFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">makeFood</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"黄焖鸡\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">FoodFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">makeFood</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jaja\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>简单地说，<strong>简单工厂模式通常就是这样，一个工厂类 XxxFactory，里面有一个静态方法，根据我们不同的参数，返回不同的派生自同一个父类（或实现同一接口）的实例对象。</strong></p>\n<blockquote>\n<p>我们强调<strong>职责单一</strong>原则，一个类只提供一种功能，FoodFactory 的功能就是只要负责生产各种 Food。</p>\n</blockquote>\n<p>在此例中可以看出，Cook 类在使用 FoodFactory 时就不需要 new 任何一个对象，这就是简单工厂模式的好处，封装了 new 的部分，做到的代码易用性。</p>\n<h3 id=\"工厂模式\"><a class=\"anchor\" href=\"#工厂模式\">#</a> 工厂模式</h3>\n<p>简单工厂模式很简单，如果它能满足我们的需要，我觉得就不要折腾了。之所以需要引入工厂模式，是因为我们往往需要使用两个或两个以上的工厂。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">FoodFactory</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">Food</span> <span class=\"token function\">makeFood</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ChineseFoodFactory</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FoodFactory</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Food</span> <span class=\"token function\">makeFood</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ChineseFoodA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ChineseFoodB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AmericanFoodFactory</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FoodFactory</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Food</span> <span class=\"token function\">makeFood</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AmericanFoodA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AmericanFoodB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>其中，ChineseFoodA、ChineseFoodB、AmericanFoodA、AmericanFoodB 都派生自 Food。</p>\n<p>客户端调用：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">APP</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 先选择一个具体的工厂</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">FoodFactory</span> factory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ChineseFoodFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 由第一步的工厂产生具体的对象，不同的工厂造出不一样的对象</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">Food</span> food <span class=\"token operator\">=</span> factory<span class=\"token punctuation\">.</span><span class=\"token function\">makeFood</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>虽然都是调用 makeFood (&quot;A&quot;) 制作 A 类食物，但是，不同的工厂生产出来的完全不一样。</p>\n<p>第一步，我们需要选取合适的工厂，然后第二步基本上和简单工厂一样。</p>\n<p><strong>核心在于，我们需要在第一步选好我们需要的工厂</strong>。比如，我们有 LogFactory 接口，实现类有 FileLogFactory 和 KafkaLogFactory，分别对应将日志写入文件和写入 Kafka 中，显然，我们客户端第一步就需要决定到底要实例化 FileLogFactory 还是 KafkaLogFactory，这将决定之后的所有的操作。</p>\n<h3 id=\"抽象工厂模式\"><a class=\"anchor\" href=\"#抽象工厂模式\">#</a> 抽象工厂模式</h3>\n<p>当涉及到<strong>产品族</strong>的时候，就需要引入抽象工厂模式了。 一个经典的例子是造一台电脑 。</p>\n<p>当涉及到这种产品族的问题的时候，就需要抽象工厂模式来支持了。我们不再定义 CPU 工厂、主板工厂、硬盘工厂、显示屏工厂等等，我们直接定义电脑工厂，每个电脑工厂负责生产所有的设备，这样能保证肯定不存在兼容问题。</p>\n<p>当然，抽象工厂的问题也是显而易见的，比如我们要加个显示器，就需要修改所有的工厂，给所有的工厂都加上制造显示器的方法。这有点违反了<strong>对修改关闭，对扩展开放</strong>这个设计原则。</p>\n<p>本节要介绍的抽象工厂模式将考虑多等级产品的生产，将同一个具体工厂所生产的位于不同等级的一组产品称为一个产品族，图 1 所示的是海尔工厂和 TCL 工厂所生产的电视机与空调对应的关系图。</p>\n<p><img data-src=\"%E8%BD%AF%E4%BB%B6%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/3-1Q1141559151S.gif\" alt=\"3-1Q1141559151S\" /></p>\n<p>抽象工厂（AbstractFactory）模式的定义：是一种为访问类提供一个创建一组相关或相互依赖对象的接口，且访问类无须指定所要产品的具体类就能得到同族的不同等级的产品的模式结构。</p>\n<p>抽象工厂模式是工厂方法模式的升级版本，工厂方法模式只生产一个等级的产品，而抽象工厂模式可生产多个等级的产品。</p>\n<p>使用抽象工厂模式一般要满足以下条件。</p>\n<ul>\n<li>系统中有多个产品族，每个具体工厂创建同一族但属于不同等级结构的产品。</li>\n<li>系统一次只可能消费其中某一族产品，即同族的产品一起使用。</li>\n</ul>\n<p>抽象工厂模式除了具有工厂方法模式的优点外，其他主要优点如下。</p>\n<ul>\n<li>可以在类的内部对产品族中相关联的多等级产品共同管理，而不必专门引入多个新的类来进行管理。</li>\n<li>当增加一个新的产品族时不需要修改原代码，满足开闭原则。</li>\n</ul>\n<p>其缺点是：当产品族中需要增加一个新的产品时，所有的工厂类都需要进行修改。</p>\n<h3 id=\"单例模式\"><a class=\"anchor\" href=\"#单例模式\">#</a> 单例模式</h3>\n<p>简单点说，就是一个应用程序中，某个类的实例对象只有一个，你没有办法去 new，因为构造器是被 private 修饰的，一般通过 getInstance () 的方法来获取它们的实例。</p>\n<p>getInstance () 的返回值是一个对象的引用，并不是一个新的实例，所以不要错误的理解成多个对象。</p>\n<p><strong>特点</strong></p>\n<ul>\n<li>类构造器私有</li>\n<li>持有自己类型的属性</li>\n<li>对外提供获取实例的静态方法</li>\n</ul>\n<p><strong>饿汉式写法</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Singleton</span> <span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">Singleton</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span>  </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>弊端：因为类加载的时候就会创建对象，所以有的时候还不需要使用对象，就会创建对象，造成内存的浪费；</p>\n<p><strong>饱汉模式最容易出错：</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Singleton</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 首先，也是先堵死 new Singleton () 这条路</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 和饿汉模式相比，这边不需要先实例化出来，注意这里的 volatile，它是必须的</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">Singleton</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>instance <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token comment\">// 加锁</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token comment\">// 这一次判断也是必须的，不然会有并发问题</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>instance <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                    instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>双重检查，指的是两次检查 instance 是否为 null。</p>\n<p>volatile 在这里是需要的，希望能引起读者的关注。</p>\n<p>很多人不知道怎么写，直接就在 getInstance () 方法签名上加上 synchronized，这就不多说了，性能太差。</p>\n</blockquote>\n<p>嵌套类最经典，以后大家就用它吧：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Singleton</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 主要是使用了 嵌套类可以访问外部类的静态属性和静态方法 的特性</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Holder</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Holder</span><span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>注意，很多人都会把这个<strong>嵌套类</strong>说成是<strong>静态内部类</strong>，严格地说，内部类和嵌套类是不一样的，它们能访问的外部类权限也是不一样的。</p>\n</blockquote>\n<p>最后，我们说一下枚举，枚举很特殊，它在类加载的时候会初始化里面的所有的实例，而且 JVM 保证了它们不会再被实例化，所以它天生就是单例的。</p>\n<p><strong>TODO:</strong></p>\n<p>建造者模式</p>\n<p>原型模式</p>\n<h2 id=\"结构型模式\"><a class=\"anchor\" href=\"#结构型模式\">#</a> 结构型模式</h2>\n<p>前面创建型模式介绍了创建对象的一些设计模式，这节介绍的结构型模式旨在通过改变代码结构来达到解耦的目的，使得我们的代码容易维护和扩展。</p>\n<h3 id=\"代理模式\"><a class=\"anchor\" href=\"#代理模式\">#</a> 代理模式</h3>\n<p>第一个要介绍的代理模式是最常使用的模式之一了，用一个代理来隐藏具体实现类的实现细节，通常还用于在真实的实现的前后添加一部分逻辑。</p>\n<p>既然说是<strong>代理</strong>，那就要对客户端隐藏真实实现，由代理来负责客户端的所有请求。当然，代理只是个代理，它不会完成实际的业务逻辑，而是一层皮而已，但是对于客户端来说，它必须表现得就是客户端需要的真实实现。</p>\n<p>理解<strong>代理</strong>这个词，这个模式其实就简单了。 下面上代码理解。 代理接口：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 要有一个代理接口让实现类和代理实现类来实现。</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">FoodService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">Food</span> <span class=\"token function\">makeChicken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>被代理的实现类：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FoodService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Food</span> <span class=\"token function\">makeChicken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">Food</span> f <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Chicken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        f<span class=\"token punctuation\">.</span><span class=\"token function\">setChicken</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1kg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        f<span class=\"token punctuation\">.</span><span class=\"token function\">setSpicy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1g\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        f<span class=\"token punctuation\">.</span><span class=\"token function\">setSalt</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"3g\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"鸡肉加好佐料了\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> f<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>被代理实现类就只需要做自己该做的事情就好了，不需要管别的。</p>\n<p>代理实现类：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodServiceProxy</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FoodService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 内部一定要有一个真实的实现类，当然也可以通过构造方法注入</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">FoodService</span> foodService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FoodServiceImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Food</span> <span class=\"token function\">makeChicken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"开始制作鸡肉\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// 如果我们定义这句为核心代码的话，那么，核心代码是真实实现类做的，</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 代理只是在核心代码前后做些 “无足轻重” 的事情</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">Food</span> food <span class=\"token operator\">=</span> foodService<span class=\"token punctuation\">.</span><span class=\"token function\">makeChicken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"鸡肉制作完成啦，加点胡椒粉\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        food<span class=\"token punctuation\">.</span><span class=\"token function\">addCondiment</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pepper\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"上锅咯\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">return</span> food<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>客户端调用，注意，我们要用代理来实例化接口：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 这里用代理类来实例化</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">FoodService</span> foodService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FoodServiceProxy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>foodService<span class=\"token punctuation\">.</span><span class=\"token function\">makeChicken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>所谓代理模式，<strong>就是对被代理方法包装或者叫增强， 在面向切面编程（AOP）中，其实就是动态代理的过程。比如 Spring 中，我们自己不定义代理类，但是 Spring 会帮我们动态来定义代理，然后把我们定义在 @Before、@After、@Around 中的代码逻辑动态添加到代理中。</strong></p>\n<p>待续。。。</p>\n<h2 id=\"行为型模式\"><a class=\"anchor\" href=\"#行为型模式\">#</a> 行为型模式</h2>\n<h3 id=\"模板模式\"><a class=\"anchor\" href=\"#模板模式\">#</a> 模板模式</h3>\n<p>在含有继承结构的代码中，模板方法模式是非常常用的。</p>\n<p><strong>父类定义了骨架（调用哪些方法及顺序），某些特定方法由子类实现</strong></p>\n<p>模板方法只负责定义第一步应该要做什么，第二步应该做什么，第三步应该做什么，至于怎么做，由子类来实现。</p>\n<p>好处：代码复用，减少重复代码。除了子类要实现的特定方法，其他方法及方法调用顺序都在父类中预先写好</p>\n<p>缺点： 每一个不同的实现都需要一个子类来实现，导致类个数增加，使系统更加庞大</p>\n<p><strong>模板模式的关键点：</strong></p>\n<p>1、使用抽象类定义模板类，并在其中定义所有的基本方法、模板方法，钩子方法，不限数量，以实现功能逻辑为主。其中基本方法使用 final 修饰，其中要调用基本方法和钩子方法，基本方法和钩子方法可以使用 protected 修饰，表明可被子类修改。</p>\n<p>2、定义实现抽象类的子类，重写其中的模板方法，甚至钩子方法，完善具体的逻辑。</p>\n<p>使用场景：</p>\n<p>1、在多个子类中拥有相同的方法，而且逻辑相同时，可以将这些方法抽出来放到一个模板抽象类中。</p>\n<p>2、程序主框架相同，细节不同的情况下，也可以使用模板方法。</p>\n<h4 id=\"架构方法介绍\"><a class=\"anchor\" href=\"#架构方法介绍\">#</a> 架构方法介绍</h4>\n<p>模板方法使得子类可以在不改变算法结构的情况下，重新定义算法中的某些步骤。其主要分为两大类：模版方法和基本方法，而基本方法又分为：抽象方法（Abstract Method），具体方法（Concrete Method），钩子方法（Hook Method）。</p>\n<p>四种方法的基本定义（前提：在抽象类中定义）：</p>\n<p>（1）抽象方法：由抽象类声明，由具体子类实现，并以 abstract 关键字进行标识。</p>\n<p>（2）具体方法：由抽象类声明并且实现，子类并不实现或者做覆盖操作。其实质就是普遍适用的方法，不需要子类来实现。</p>\n<p>（3）钩子方法：由抽象类声明并且实现，子类也可以选择加以扩展。通常抽象类会给出一个空的钩子方法，也就是没有实现的扩展。<strong>它和具体方法在代码上没有区别，不过是一种意识的区别</strong>；而它和抽象方法有时候也是没有区别的，就是在子类都需要将其实现的时候。而不同的是抽象方法必须实现，而钩子方法可以不实现。也就是说钩子方法为你在实现某一个抽象类的时候提供了可选项，<strong>相当于预先提供了一个默认配置。</strong></p>\n<p>（4）模板方法：定义了一个方法，其中定义了整个逻辑的基本骨架。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> abstract <span class=\"token keyword\">class</span> <span class=\"token class-name\">AbstractTemplate</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 这就是模板方法</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">templateMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 这个是重点</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 可以作为钩子方法</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">// 这是具体方法</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"init 抽象层已经实现，子类也可以选择覆写\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// 这是抽象方法，留给子类实现</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">protected</span> abstract <span class=\"token keyword\">void</span> <span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token comment\">// 这是钩子方法，可定义一个默认操作，或者为空</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "设计模式",
                "设计模式"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/02/03/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2/",
            "url": "https://dmqweb.cn/2024/02/03/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2/",
            "title": "持续集成与持续部署",
            "date_published": "2024-02-03T06:04:09.000Z",
            "content_html": "<h1 id=\"5-4-持续集成与持续部署\"><a class=\"anchor\" href=\"#5-4-持续集成与持续部署\">#</a> 5-4 持续集成与持续部署</h1>\n<h2 id=\"课程介绍\"><a class=\"anchor\" href=\"#课程介绍\">#</a> 课程介绍</h2>\n<p>那些大厂们，天天 DevOps、持续集成的？到底在讲些什么？这堂课来给你揭开持续集成与持续部署的面纱！！没有什么难的，盘它！</p>\n<p><strong>传统的开发过程中的坑：</strong></p>\n<ul>\n<li>BUG 总是在最后才发现</li>\n<li>越到项目后期，加班越严重</li>\n<li>交付无法保障</li>\n<li>变更频繁导致效率低下</li>\n<li>无效的等待多，用户满足度低</li>\n</ul>\n<p><img data-src=\"./assets/1460000014924499.png\" alt=\"img\" /></p>\n<p><strong>你有没有想过 / 用过？当你哪一天...</strong></p>\n<ul>\n<li>不用为开发 / 测试环境不一致而苦恼</li>\n<li>不用麻烦运维人员帮忙调试环境</li>\n<li>不用手动进行测试，模拟环境中进行自测</li>\n<li>不用手动发布、部署，自动化实现发布部署</li>\n<li>不用管开发 / 测试环境，只用专注代码的开发？</li>\n</ul>\n<p><strong>持续集成解决了什么问题？</strong></p>\n<ul>\n<li>提高软件质量</li>\n<li>效率迭代</li>\n<li>便捷部署</li>\n<li>快速交付、便于管理</li>\n</ul>\n<p><strong>课程的主要内容：</strong></p>\n<ul>\n<li>\n<p>什么是 CI/CD</p>\n</li>\n<li>\n<p>介绍 CI/CD 流程</p>\n</li>\n<li>\n<p>前端项目：结合 CI/CD 流程，实现快速迭代</p>\n</li>\n<li>\n<p>Docker 的使用，Jenkins+gitlab+nodejs 自动化项目</p>\n</li>\n<li>\n<p>持续集成工具介绍：Jenkins、Travis CI、Circle CI</p>\n</li>\n</ul>\n<p><strong>环境准备：</strong></p>\n<ul>\n<li>Linux 服务器 (Centos 7.6/Ubuntu 16.04LTS)</li>\n<li>VSCode + 插件 Dockerfile</li>\n<li>注册 github 账号</li>\n</ul>\n<h2 id=\"持续集成\"><a class=\"anchor\" href=\"#持续集成\">#</a> 持续集成</h2>\n<h3 id=\"核心概念\"><a class=\"anchor\" href=\"#核心概念\">#</a> 核心概念</h3>\n<p><strong>集成，就是一些孤立的事物或元素通过某种方式集中在一起，产生联系，从而构成一个有机整体的过程</strong>。知识经济的社会，集成已经成了很重要的一个名词。各行各业基本都会用到集成。比如汽车行业，那么复杂的一台跑车愣是通过一大堆零件组装起来。对于这些传统行业，它们在研发成功以后，可以通过流水线的方法批量生产进行集成。而在软件行业中，集成并不是一个简单的 “搬箱子” 的过程。因为软件工业是一个知识生产活动，其内在逻辑非常复杂，需求又很难一次性确定，完成的产品与最初的设计往往相差很远。敏捷宣言中就有一条是说响应变化重于遵循计划。而且由于软件行业的迅猛发展，软件变的越来越复杂，单靠个人是根本无法完成。大型软件为了重用及解耦，往往还需要分成好几个模块，这样集成就成了软件开发中不可或缺的一部分。</p>\n<p>持续，不言而喻，就是指<strong>长期的对项目代码进行集成。</strong></p>\n<h4 id=\"持续集成-2\"><a class=\"anchor\" href=\"#持续集成-2\">#</a> 持续集成</h4>\n<p>持续集成（英文：Continuous Integration，简称 CI）</p>\n<p>在软件工程中，持续集成是指将所有开发者工作副本每天多次合并到主干的做法。</p>\n<blockquote>\n<p>Grady Booch 在 1991 年的 Booch method 中首次命名并提出了 CI 的概念，尽管在当时他并不主张每天多次集成。而 XP（Extreme programming，极限编程）采用了 CI 的概念，并提倡每天不止一次集成。</p>\n<p>在《持续集成》一书中，对持续集成的定义如下： <code>持续集成</code> 是一种软件开发实践。在持续集成中，团队成员频繁集成他们的工作成果，一般每人每天至少集成一次，也可以多次。每次集成会经过自动构建 (包括自动测试) 的检验，以尽快发现集成错误。自从在团队中引入这样的实践之后， <code>Martin Fowler</code>  发现这种方法可以显著减少集成引起的问题，并可以加快团队合作软件开发的速度。</p>\n</blockquote>\n<p><img data-src=\"./assets/c5c8e6f40c7c133e22402c00bb7e1a25_hd.jpg\" alt=\"img\" /></p>\n<p>持续集成强调开发人员提交了新代码之后，立刻进行构建、（单元）测试。根据测试结果，我们可以确定新代码和原有代码能否正确地集成在一起。</p>\n<p>对于一天需要集成多少次数，并没有一个明确的定义。一般就是按照自己项目的实际需要来设置一定的频率，少则可能几次，多则可能达几十次。可以设置按照代码的变更来触发集成，或者设置一个固定时间周期来集成，也可以手工点击集成的按钮来 “一键集成”。</p>\n<h4 id=\"持续交付\"><a class=\"anchor\" href=\"#持续交付\">#</a> 持续交付</h4>\n<p>持续交付（英文：Continuous Delivery，简称 CD）</p>\n<p>完成 CI 中构建及单元测试和集成测试的自动化流程后，持续交付可自动将已验证的代码发布到存储库。为了实现高效的持续交付流程，务必要确保 CI 已内置于开发管道。持续交付的目标是拥有一个可随时部署到生产环境的代码库。</p>\n<p><img data-src=\"./assets/db7198e3c39e4656e18efcb4bd1b20b1_hd.jpg\" alt=\"img\" /></p>\n<p>在持续交付中，每个阶段（从代码更改的合并，到生产就绪型构建版本的交付）都涉及测试自动化和代码发布自动化。在流程结束时，运维团队可以快速、轻松地将应用部署到生产环境中。</p>\n<p>比如，我们完成单元测试后，可以把代码部署到连接数据库的 Staging 环境中更多的测试。如果代码没有问题，可以继续 <code>手动</code> 部署到生产环境中。</p>\n<h4 id=\"持续部署\"><a class=\"anchor\" href=\"#持续部署\">#</a> 持续部署</h4>\n<p>持续部署（英文：Continuous Deployment，简称 CD）</p>\n<p>对于一个成熟的 CI/CD 管道来说，最后的阶段是持续部署。作为持续交付 —— 自动将生产就绪型构建版本发布到代码存储库 —— 的延伸，持续部署可以自动将应用发布到生产环境。由于在生产之前的管道阶段没有手动门控，因此持续部署在很大程度上都得依赖精心设计的测试自动化。</p>\n<p><img data-src=\"./assets/f96f19e4d567aad5006d841963a86e41_hd.jpg\" alt=\"img\" /></p>\n<p>实际上，持续部署意味着开发人员对应用的更改在编写后的几分钟内就能生效（假设它通过了自动化测试）。这更加便于持续接收和整合用户反馈。总而言之，所有这些 CI/CD 的关联步骤都有助于降低应用的部署风险，因此更便于以小件的方式（而非一次性）发布对应用的更改。不过，由于还需要编写自动化测试以适应 CI/CD 管道中的各种测试和发布阶段，因此前期投资还是会很大。</p>\n<p>持续部署则是在持续交付的基础上，把部署到生产环境的过程 <code>自动化</code> 。</p>\n<h3 id=\"持续集成组成要素\"><a class=\"anchor\" href=\"#持续集成组成要素\">#</a> 持续集成组成要素</h3>\n<p><strong>一个最小化的持续集成系统需要包含以下几个要素：</strong></p>\n<ol>\n<li>** 版本管理系统：** 项目的源代码需要托管到适合的版本管理系统中，一般我们使用 git 作为版本控制库，版本管理软件可以使用 github、 <code>gitlab</code> 、stash 等。</li>\n<li>** 构建脚本 &amp; 工具：** 每个项目都需要有构建脚本来实现对整个项目的自动化构建。比如 Java 的项目就可以使用 gradle 作为构建工具。通过构建工具实现对编译、静态扫描、运行测试、样式检查、打包、发布等活动串起来，可以通过命令行自动执行。</li>\n<li>**CI 服务器：**CI 服务器可以检测项目中的代码变动，并及时的通过构建机器运行构建脚本，并将集成结果通过某种方式反馈给团队成员。</li>\n</ol>\n<h3 id=\"应用场景\"><a class=\"anchor\" href=\"#应用场景\">#</a> 应用场景</h3>\n<ul>\n<li>\n<p>打包平台</p>\n<p>常见的打包，Java 应用（Gradle/Maven）、Nodejs 前端应用 (npm/yarn)</p>\n<p>移动端打包：Android/iOS</p>\n</li>\n<li>\n<p>测试平台</p>\n<p>接口测试</p>\n<p>自动化测试 Robotium、Testlink</p>\n<p>单元测试 junit</p>\n<p>性能测试 Jmeter</p>\n</li>\n<li>\n<p>自动部署</p>\n<p>FTP</p>\n<p>Shell</p>\n<p>Tomcat/Dokcer</p>\n<p>Kubernetes/Rancher/Cluster</p>\n</li>\n<li>\n<p>持续集成</p>\n<p>Git: gitlab github gitee 等</p>\n<p>Jenkins/TravisCi/CircleCI</p>\n<p>Docker</p>\n</li>\n</ul>\n<h3 id=\"工作流\"><a class=\"anchor\" href=\"#工作流\">#</a> 工作流</h3>\n<h4 id=\"传统的工作流\"><a class=\"anchor\" href=\"#传统的工作流\">#</a> 传统的工作流</h4>\n<p>参与人员：开发、项目经理、测试</p>\n<p>主要流程：</p>\n<ul>\n<li>项目一开始是先划分好模块， <code>分配模块</code> 给相应的开发人员；</li>\n<li>开发人员 <code>开发好</code> 一个模块就进行 <code>单元测试</code> ；</li>\n<li>等所有的模块都开发完成之后，由项目经理对 <code>所有代码进行集成</code> ；</li>\n<li>集成后的项目由项目经理 <code>部署到测试服务器</code> 上，被交由测试人员进行集成测试；</li>\n<li>测试过程中出现 Bug 就提把问题 <code>记录</code> 进行  <code>Bug</code>  列表中；</li>\n<li><code>项目经理分配 Bug</code>  给相应的责任人进行修改；</li>\n<li>修改完成后，项目经理 <code>再次</code> 对项目进行集成，并 <code>部署</code> 到测试服务器上；</li>\n<li>测试人员在下一次的集成测试中进行 <code>回归测试</code> ；</li>\n<li>通过通过之后就 <code>部署到生产环境</code> 中；</li>\n<li>如果测试不通过，则重复上述 “分配 Bug -&gt; 修改 Bug -&gt; 集成代码 -&gt; 部署到测试服务器上 -&gt; 集成测试” 工作。</li>\n</ul>\n<blockquote>\n<p>这也是传统的瀑布式开发模型，请参考：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vLU9ZSy9hcmNoaXZlLzIwMTIvMTAvMDgvMjcxNDY2OS5odG1s\">软件开发模式对比 (瀑布、迭代、螺旋、敏捷)</span></p>\n</blockquote>\n<p>带来的问题：</p>\n<ol>\n<li>\n<p><strong>重复性劳动，无效的等待变多</strong></p>\n<p>重复的进行发布部署。</p>\n<p>流程上：有可能开发在等集成其他人的模块；测试人员在等待开发人员修复 Bug；产品经理在等待新版本上线好给客户做演示；项目经理在等待其他人提交代码。不管怎么样，等待意味低效。</p>\n<p>自动化部署工作可以解放了集成、测试、部署等重复性劳动，而且机器集成的频率明显可以比手工的高很多。</p>\n</li>\n<li>\n<p><strong>很晚才发现缺陷，并且难以修复</strong>。</p>\n<p>实践证明，缺陷发现的越晚，需要修复的时间和精力也就越大。从上一个可工作的软件到发现缺陷之间可能存在很多次提交，而要从这些提交中找出问题并修复的成本会很大，因为开发人员需要回忆每个提交的上下文来评估影响点。</p>\n</li>\n<li>\n<p><strong>低品质的软件，软件交付时机无法保障</strong></p>\n<p>由于集成时每次包含的代码很多，所以大家的关注点主要都是如何保证编译通过、自动化测试通过，而往往很容易忽略代码是否遵守了编码规范、是否包含有重复代码、是否有重构的空间等问题。而这些问题又反过来会影响今后的开发和集成，久而久之集成变得越来越困难，软件的质量可想而知。</p>\n</li>\n<li>\n<p><strong>项目缺少可见性</strong></p>\n<p>某些项目，程序会经常需要变更，特别是敏捷开发的实践者。由于产品经理在与客户交流过程中，往往实际的软件就是最好的原型，所以软件会被当作原型作为跟客户交流的工具。当然，客户最希望的当然是客户的想法能够马上反映到原型上，这会导致程序会经常被修改的。那么也就意味着 “分配 Bug -&gt; 修改 Bug -&gt; 集成代码 -&gt; 部署到测试服务器上 -&gt; 集成测试” 工作无形又爆增了。</p>\n</li>\n</ol>\n<h4 id=\"常见的工作流\"><a class=\"anchor\" href=\"#常见的工作流\">#</a> 常见的工作流</h4>\n<p><img data-src=\"./assets/DevOps.png\" alt=\"DevOps\" /></p>\n<p>该系统的各个组成部分是按如下顺序来发挥作用的：</p>\n<ol>\n<li>\n<p>开发者检入代码到源代码仓库。</p>\n</li>\n<li>\n<p>CI 系统会为每一个项目创建了一个单独的工作区。当预设或请求一次新的构建时，它将把源代码仓库的源码存放到对应的工作区。</p>\n</li>\n<li>\n<p>CI 系统会在对应的工作区内执行构建过程。</p>\n</li>\n<li>\n<p>配置如果存在）构建完成后，CI 系统会在一个新的构件中执行定义的一套测试。完成后触发通知 (Email,RSS 等等) 给相关的当事人。</p>\n</li>\n<li>\n<p>配置如果存在）如果构建成功，这个构件会被打包并转移到一个部署目标 (如应用服务器) 或存储为软件仓库中的一个新版本。软件仓库可以是 CI 系统的一部分，也可以是一个外部的仓库，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS1KYXZhLWs4NGZ1aTI0Y2U0ZzI1ZWs4bG96aWN6MGFlaGtibGZzMTdpZTd2Yi5uZXQ=\">诸如一个文件服务器或者像 Java.net</span>、SourceForge 之类的网站。</p>\n</li>\n<li>\n<p>CI 系统通常会根据请求发起相应的操作，诸如即时构建、生成报告，或者检索一些构建好的构件。</p>\n</li>\n</ol>\n<blockquote>\n<p>“You build it, you run it”，这是 Amazon 一年可以完成 5000 万次部署，平均每个工程师每天部署超过 50 次的核心秘籍。</p>\n</blockquote>\n<h4 id=\"解决的问题\"><a class=\"anchor\" href=\"#解决的问题\">#</a> 解决的问题</h4>\n<ul>\n<li>\n<p>高效率</p>\n<p>高效率的发布，避免了重复性的劳动；</p>\n<p>更快的修复 BUG，更快的交付成果，减少了等待时间。</p>\n</li>\n<li>\n<p>高质量</p>\n<p>只有在完成集成测试、系统测试后，才能得到可用的软件，整个过程中只有最后时刻才能拿到可运行软件。集成活动不一定在一个标准的构建机器上生成，而是在某个开发人员的机器上构建的，那么可能存在在其他机器上无法运行的问题。</p>\n<p>人与机器的一个最大的区别是，在重复性动作上，人容易犯错，而机器犯错的几率几乎为零。所以，当我们搭建完成集成服务器后，以后的事就交给集成服务器来打理吧。</p>\n</li>\n<li>\n<p>高产出</p>\n<p>快速开发和上市一个新产品，并快速取得预期的投资回报是每个企业孜孜以求的目标。</p>\n<p>便捷的部署 + 项目的可预期，使得团队的开发变成了一种开心的事情。</p>\n<p>持续集成可以让你在任何时间发布可以部署的软件。在外界看来，这是持续集成最明显的好处，对客户来说，可以部署的软件产品是最实际的资产。利用持续集成，你可以经常对源代码进行一些小改动，并将这些改动和其他代码进行集成。</p>\n</li>\n</ul>\n<h4 id=\"常见问题\"><a class=\"anchor\" href=\"#常见问题\">#</a> 常见问题</h4>\n<ol>\n<li>\n<p>思维转变后，新技术抵触</p>\n<ul>\n<li>无法接受新事物：不管怎么样，求稳心态的人还是多。总是有人认为老的技术代表稳定，新的事物往往会带来问题。</li>\n<li>认为手工集成也没有多少工作量：不是所有的人都参与到了整个持续集成的环节，所以没有办法认识到问题全貌。</li>\n</ul>\n<p><strong>针对这个问题，可以通过设置一定的持续集成技术培训、宣讲得到改观</strong></p>\n</li>\n<li>\n<p>管理层的抵触</p>\n<ul>\n<li>培训持续集成需要投入资金啊，没钱。</li>\n<li>持续集成服务器要增加软硬件成本啊，没钱。</li>\n<li>开发人员领了那么高的工资，多干活多加班应该啊。</li>\n</ul>\n<p><strong>针对这一点，可以从开发人员的成本和持续集成的投入（软硬件）的成本上两者做下估算。</strong></p>\n<blockquote>\n<p>硬件参考：</p>\n<p>Jenkins 主服务器一般 2C4G，slave 服务器根据生产需要进行选购。</p>\n<p>git 服务器一般 2C4G (10 人团队)</p>\n<p>Docker 服务器 8C32G (Rancher + harbor)</p>\n</blockquote>\n</li>\n<li>\n<p>生产环境的复杂</p>\n<ul>\n<li>比如部署的生成环境是在政务外网，无法从互联网直接访问等。</li>\n<li>构建效率低下，任务多</li>\n</ul>\n<p>目前，这个是最麻烦的，还在研究中。初步设想是让政务外网开辟一个白名单，给持续集成服务器设置一个单独的通道。只是思路，未验证。</p>\n</li>\n</ol>\n<h4 id=\"最佳实践\"><a class=\"anchor\" href=\"#最佳实践\">#</a> 最佳实践</h4>\n<p>实施持续集成的开发人员可以尽早并经常提交。这允许他们尽早发现冲突。并且，如果存在任何问题，则使用较小的提交可以更轻松地对代码进行故障排除。每天或甚至更频繁地提交软件对于持续集成是必要的，但还不够。</p>\n<p>要成功使用持续集成，团队必须：</p>\n<ul>\n<li>\n<p>使测试成为开发过程中不可或缺的一部分。应该在创建代码时编写测试。</p>\n<p>公司成功持续整合所需的最重要因素是严格的测试文化。为了将新代码自信地集成到主线中，团队需要确信代码是健全的。这是通过测试来实现的，这应该定期进行。工程师应该在开发每个功能时编写测试。</p>\n</li>\n<li>\n<p>确保测试环境反映生产一致。</p>\n<p>为了支持您严格的测试文化，测试环境必须反映生产环境。否则，您无法保证您正在测试的内容将在生产中起作用。这意味着测试环境应使用相同版本的数据库，Web 服务器配置，工件等。</p>\n</li>\n<li>\n<p>使用编码最佳实践，例如结对编程。</p>\n<p>软件开发的另一个最佳实践是在编码期间进行配对。对于更复杂的功能，团队在编写单行代码之前讨论体系结构方法。在将任何代码合并到生产环境之前，其他开发人员始终会检查代码。这有助于确保使用编码最佳实践，代码不会与其他开发人员正在处理的现有代码或代码冲突，并且新功能是可扩展的。</p>\n<blockquote>\n<p><strong>Pair programming</strong> is an <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQWdpbGVfc29mdHdhcmVfZGV2ZWxvcG1lbnQ=\">agile software development</span> technique in which two <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29tcHV0ZXJfcHJvZ3JhbW1lcg==\">programmers</span> work together at one workstation. One, the <em>driver</em>, writes <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU291cmNlX2NvZGU=\">code</span> while the other, the <em>observer</em> or <em>navigator</em>,[<span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUGFpcl9wcm9ncmFtbWluZyNjaXRlX25vdGUtMQ==\">1]</span> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29kZV9yZXZpZXc=\">reviews</span> each line of code as it is typed in. The two programmers switch roles frequently.</p>\n<p>While reviewing, the observer also considers the &quot;strategic&quot; direction of the work, coming up with ideas for improvements and likely future problems to address. This is intended to free the driver to focus all of their attention on the &quot;tactical&quot; aspects of completing the current task, using the observer as a safety net and guide.</p>\n</blockquote>\n</li>\n<li>\n<p>自动化部署工作流程。</p>\n<p>最后，为确保整个软件开发流程快速高效，构建需要快速，部署工作流程应自动化。代码构建的每一分钟都浪费了一分钟。通过自动化部署工作流程，团队可以更快地将完成的代码生成。因为，毕竟，如果没有接触到客户，那么快速开发软件有什么意义呢？</p>\n</li>\n</ul>\n<h3 id=\"效率工具对比\"><a class=\"anchor\" href=\"#效率工具对比\">#</a> 效率工具对比</h3>\n<p>![img](/Users/Shared/Target/5-4 持续集成与持续部署 /resource/assets/CICD-resource.png)</p>\n<p><a href=\"#%E5%A4%8D%E6%9D%82%E7%9A%84DevOps%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7\">点击查看</a>效率工具</p>\n<p><strong>1. Jenkins</strong></p>\n<blockquote>\n<p>Jenkins，原名 Hudson，2011 年改为现在的名字，它 是一个开源的实现持续集成的软件工具。官方网站：<span class=\"exturl\" data-url=\"aHR0cDovL2plbmtpbnMtY2kub3JnLw==\">http://jenkins-ci.org/</span>。</p>\n<p>Jenkins 能实时<strong>监控集成中存在的错误</strong>，提供<strong>详细的日志文件和提醒</strong>功能，还能用图表的形式形象地展示<strong>项目构建的趋势和稳定性</strong>。</p>\n</blockquote>\n<p><strong>Jenkins 特点:</strong></p>\n<ul>\n<li><strong>易安装</strong>：Jenkins 是一个独立的基于 Java 的程序，随时可以运行，包含 Windows，Mac OS X 和其他类 Unix 操作系统的软件包。仅仅一个 java -jar jenkins.war，从官网下载该文件后，直接运行，无需额外的安装，更无需安装数据库；</li>\n<li><strong>易配置</strong>：提供友好的 GUI 配置界面；</li>\n<li><strong>变更支持</strong>：Jenkins 能从代码仓库（Subversion/CVS）中获取并产生代码更新列表并输出到编译输出信息中；</li>\n<li><strong>支持永久链接</strong>：用户是通过 web 来访问 Jenkins 的，而这些 web 页面的链接地址都是永久链接地址，因此，你可以在各种文档中直接使用该链接；</li>\n<li>** 集成 E-Mail/RSS/IM：** 当完成一次集成时，可通过这些工具实时告诉你集成结果（据我所知，构建一次集成需要花费一定时间，有了这个功能，你就可以在等待结果过程中，干别的事情）；</li>\n<li><strong>JUnit/TestNG 测试报告</strong>：也就是用以图表等形式提供详细的测试报表功能；</li>\n<li><strong>支持分布式构建</strong>：Jenkins 可以把<strong>集成构建等工作分发到多台计算机中完成</strong>；</li>\n<li><strong>文件指纹信息</strong>：Jenkins 会保存哪次集成构建产生了哪些 jars 文件，哪一次集成构建使用了哪个版本的 jars 文件等构建记录；</li>\n<li><strong>支持第三方插件</strong>：使得 Jenkins 变得越来越强大；凭借更新中心中的数百个插件，Jenkins 几乎集成了持续集成和持续交付工具链中的所有工具。</li>\n<li><strong>Rest API</strong> - 可以访问控制您获取的数据量，获取 / 更新 config.xml，删除作业，检索所有构建，获取 / 更新作业说明，执行构建，禁用 / 启用作业</li>\n</ul>\n<p><strong>Jenkins 优点：</strong></p>\n<ul>\n<li>价格（免费）</li>\n<li>定制</li>\n<li>插件系统</li>\n<li>完全控制系统</li>\n</ul>\n<p><strong>Jenkins 缺点：</strong></p>\n<ul>\n<li>需要专用服务器（或多个服务器）。这导致额外的费用。对于服务器本身，DevOps 等...</li>\n<li>配置 / 定制所需的时间</li>\n</ul>\n<p><strong>2. Travis CI</strong></p>\n<p><strong>Travis CI</strong> 是一个托管的持续集成服务，用于构建和测试在 GitHub 上托管的软件项目。</p>\n<blockquote>\n<p><strong>Travis CI</strong> is a hosted continuous integration service used to build and test software projects hosted at GitHub</p>\n</blockquote>\n<p><strong>Travis CI 的特点：</strong></p>\n<ul>\n<li>\n<p>基于云：TravisCI 是一个<strong>基于云</strong>的系统 - 不需要专用服务器，您无需管理它。</p>\n</li>\n<li>\n<p>支持 Docker 运行测试</p>\n</li>\n<li>\n<p>使用 YAML 文件进行配置</p>\n</li>\n<li>\n<p>可选择 Linux 和 Mac OSX 上同时运行测试</p>\n</li>\n<li>\n<p>开箱即用的支持的语言</p>\n<p>Android，C，C＃，C ++，Clojure，Crystal，D，Dart，Erlang，Elixir，F＃，Go，Groovy，Haskell，Haxe，Java，JavaScript（使用 Node.js），Julia，Objective-C，Perl，Perl6， PHP，Python，R，Ruby，Rust，Scala，Smalltalk，Visual Basic</p>\n</li>\n<li>\n<p><strong>支持多环境构建矩阵</strong>：如 Python 2.7 , 3.4, 3.5 +  Django 1.8, 1.9, 1.10</p>\n<p>构建矩阵是一种工具，可以使用不同版本的语言和包运行测试。您可以以不同的方式自定义它。例如，某些环境的失败可以触发通知但不会使所有构建失败（这对包的开发版本有帮助）</p>\n</li>\n</ul>\n<p><strong>Travis CI 优点：</strong></p>\n<ul>\n<li>开箱即用构建矩阵</li>\n<li>快速启动</li>\n<li>轻量级 YAML 配置</li>\n<li>开源项目的免费计划</li>\n<li>无需专用服务器</li>\n</ul>\n<p><strong>Travis CI 缺点：</strong></p>\n<ul>\n<li>与 CircleCI 相比，价格更高，没有免费的企业计划</li>\n<li>定制（对于某些你需要第三方的东西）</li>\n</ul>\n<p><strong>3. Circle CI</strong></p>\n<p>在 GitHub 或 Bitbucket 上的软件存储库被授权并作为项目添加到<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaXJjbGVjaS5jb20v\"> circleci.com 之后</span>，每个代码更改都会在干净的容器或 VM 中触发自动化测试。</p>\n<p>CircleCI 在 2017 年被 Forrester 评为持续集成领导者，并被命名为多个最佳 DevOps 工具列表。CircleCI 成立于 2011 年，总部位于旧金山，拥有全球性的远程员工队伍，由 Scale Venture Partners，DFJ，Baseline Ventures，Top Tier Capital，Industry Ventures，Heavybit 和 Harrison Metal Capital 提供风险投资。</p>\n<p><strong>Circle CI 的特点：</strong></p>\n<ul>\n<li><strong>云 &amp; 本地化</strong>：CircleCI 是一个<strong>基于云</strong>的系统 - 不需要专用服务器，您无需管理它。 但是，它还<strong>提供了一个本地解决方案</strong>，允许您在私有云或数据中心中运行它。</li>\n<li><strong>商业 &amp; 免费</strong>：即使是商业帐户，它也<strong>有免费计划</strong></li>\n<li><strong>Rest API</strong> - 您可以访问项目，构建和工件（artifacts）。构建的结果将是工件或工件组。 工件可以是已编译的应用程序或可执行文件（例如，android APK）或元数据（例如，关于测试 ` 成功的信息）</li>\n<li><strong>按需安装</strong>：CircleCI 缓存<strong>必要的安装</strong>（requirements installation）。 它会检查第三方依赖项，而不是持续安装所需的环境</li>\n<li><strong>SSH 模式</strong>：您可以触发<strong> SSH 模式</strong>访问容器并进行自己的调查（如果出现任何问题）</li>\n<li><strong>最小化配置</strong>：这是一个完整的开箱即用解决方案，需要<strong>最少的配置 \\ 调整</strong></li>\n</ul>\n<p><strong>CircleCI 优点：</strong></p>\n<ul>\n<li>快速启动</li>\n<li>CircleCI 有一个免费的企业项目计划</li>\n<li>这很容易，也很快开始</li>\n<li>轻量级，易读的 YAML 配置</li>\n<li>您不需要任何专用服务器来运行 CircleCI</li>\n</ul>\n<p><strong>CircleCI 缺点：</strong></p>\n<ul>\n<li>\n<p>CircleCI 仅支持 2 个版本的 Ubuntu 免费（12.04 和 14.04）和 MacOS 作为付费部分</p>\n</li>\n<li>\n<p>尽管 CircleCI 可以使用并运行所有语言，但 tt 仅支持 “开箱即用” 的以下编程语言：Go（Golang），Haskell，Java，PHP，Python，Ruby / Rails，Scala</p>\n</li>\n<li>\n<p>如果您想进行自定义，可能会出现一些问题：您可能需要一些第三方软件来进行这些调整</p>\n</li>\n<li>\n<p>此外，虽然作为基于云的系统是一方的优势，它也可以停止支持任何软件，你将无法阻止</p>\n</li>\n</ul>\n<p>总结一下：</p>\n<table>\n<thead>\n<tr>\n<th>分类</th>\n<th>Jenkins</th>\n<th>Travis CI</th>\n<th>Circle CI</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>本地部署</td>\n<td>支持</td>\n<td>不支持</td>\n<td>支持</td>\n</tr>\n<tr>\n<td>REST API</td>\n<td>支持</td>\n<td>支持</td>\n<td>支持</td>\n</tr>\n<tr>\n<td>配置</td>\n<td>复杂，高度可配置</td>\n<td>YAML 文件</td>\n<td>YAML 文件</td>\n</tr>\n<tr>\n<td>按需安装</td>\n<td>是</td>\n<td>否</td>\n<td>是</td>\n</tr>\n<tr>\n<td>跨平台支持</td>\n<td>是</td>\n<td>Linux + MacOS</td>\n<td>Linux + MacOS (付费)</td>\n</tr>\n<tr>\n<td>多服务器</td>\n<td>是</td>\n<td>按需</td>\n<td>否</td>\n</tr>\n<tr>\n<td>快速构建</td>\n<td>手动配置复杂</td>\n<td>快 (需要写配置文件)</td>\n<td>最快</td>\n</tr>\n<tr>\n<td>基本环境</td>\n<td>Java</td>\n<td>云环境</td>\n<td>云环境</td>\n</tr>\n<tr>\n<td>费用</td>\n<td>免费</td>\n<td>特定免费 (69$/c)</td>\n<td>特定免费 (50$/c)</td>\n</tr>\n</tbody>\n</table>\n<p>Travis CI 的价格（非常感人）：</p>\n<p><img data-src=\"./assets/image-20190611100501785.png\" alt=\"image-20190611100501785\" /></p>\n<p>CirCle CI 的价格：</p>\n<p><img data-src=\"./assets/image-20190611100534676.png\" alt=\"image-20190611100534676\" /></p>\n<p>其他的一些持续集成的工具：CruiseControl，TeamCity，Continuum 等</p>\n<ul>\n<li>AnthillPro：商业的构建管理服务器，提供 C 功能</li>\n<li>Bamboo：商业的 CI 服务器，对于开源项目免费</li>\n<li>Build Forge：多功能商业构建管理工具，特点：高性能、分布式构建</li>\n<li>Cruise Control：基于 java 实现的持续集成构建工具</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL0NydWlzZUNvbnRyb2wuTkVU\">CruiseControl.NET</span>：基于 C# 实现的持续集成构建工具</li>\n<li>Lunt build：开源的自动化构建工具</li>\n<li>Para Build：商业的自动化软件构建管理服务器</li>\n</ul>\n<h2 id=\"jenkins\"><a class=\"anchor\" href=\"#jenkins\">#</a> Jenkins</h2>\n<h3 id=\"使用简介\"><a class=\"anchor\" href=\"#使用简介\">#</a> 使用简介</h3>\n<p>Jenkins 是开源 CI&amp;CD 软件领导者， 提供超过 1000 个插件来支持构建、部署、自动化， 满足任何项目的需要。</p>\n<p><img data-src=\"./assets/image-20190611103941326.png\" alt=\"image-20190611103941326\" /></p>\n<p>相关概念：</p>\n<ul>\n<li>\n<p>流水线：<strong>Jenkins Pipeline</strong>（或简称为 &quot;Pipeline&quot;）是一套插件，将持续交付的实现和实施集成到 Jenkins 中。</p>\n<p>Jenkins Pipeline 提供了一套可扩展的工具，用于将 “简单到复杂” 的交付流程实现为 “持续交付即代码”。Jenkins Pipeline 的定义通常被写入到一个文本文件（称为  <code>Jenkinsfile</code>  ）中，该文件可以被放入项目的源代码控制库中。</p>\n</li>\n<li>\n<p>节点：节点是一个机器，主要用于执行 jenkins 任务</p>\n</li>\n<li>\n<p>阶段：定义不同的执行任务，比如：构建、测试、发布 (部署)</p>\n</li>\n<li>\n<p>步骤：相当于告诉 Jenkins 现在要做些什么，比如 shell 命令。</p>\n</li>\n</ul>\n<p><img data-src=\"./assets/image-20190611163108298.png\" alt=\"image-20190611163108298\" /></p>\n<p>Jenkins 的界面</p>\n<p><img data-src=\"./assets/image-20190611163727975.png\" alt=\"image-20190611163727975\" /></p>\n<p>任务详情页面</p>\n<p><img data-src=\"./assets/image-20190611163855257.png\" alt=\"image-20190611163855257\" /></p>\n<p>Jenkins 任务日志</p>\n<h3 id=\"安装方式\"><a class=\"anchor\" href=\"#安装方式\">#</a> 安装方式</h3>\n<ol>\n<li>\n<p>环境要求</p>\n<ul>\n<li>机器要求：\n<ul>\n<li>256 MB 内存，建议大于 512 MB</li>\n<li>10 GB 的硬盘空间（用于 Jenkins 和 Docker 镜像）</li>\n</ul>\n</li>\n<li>需要安装以下软件：\n<ul>\n<li>Java 8 (JRE 或者 JDK 都可以)</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZG9ja2VyLmNvbS8=\">Docker</span> （导航到网站顶部的 Get Docker 链接以访问适合您平台的 Docker 下载）</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>常规安装</p>\n<ul>\n<li>\n<p>安装 JDK</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3JhY2xlLmNvbS90ZWNobmV0d29yay9qYXZhL2phdmFzZS9kb3dubG9hZHMvamRrOC1kb3dubG9hZHMtMjEzMzE1MS5odG1s\">官方地址</span></p>\n<p>下载对应的操作系统的 JDK，然后解压进行安装。以 Linux 为例：</p>\n<p>下载最新版本，上传到 Linux 服务器</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 上传到 /opt/jdk8 目录下</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># tar 解压 JDK 安装包</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /opt/jdk8</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">tar</span> zxvf jdk-8u211-linux-x64.tar.gz <span class=\"token parameter variable\">-C</span> /opt/jdk8 --strip-components <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># vi /etc/profile</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">JAVA_HOME</span><span class=\"token operator\">=</span>/opt/jdk8</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">JRE_HOME</span><span class=\"token operator\">=</span><span class=\"token variable\">$&#123;JAVA_HOME&#125;</span>/jre</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">CLASSPATH</span><span class=\"token operator\">=</span>.:<span class=\"token variable\">$&#123;JAVA_HOME&#125;</span>/lib:<span class=\"token variable\">$&#123;JRE_HOME&#125;</span>/lib</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token variable\">$&#123;JAVA_HOME&#125;</span>/bin:<span class=\"token environment constant\">$PATH</span></pre></td></tr></table></figure></li>\n<li>\n<p>安装 Jenkins</p>\n<p>下载 Jenkins 最新的 war 包：<span class=\"exturl\" data-url=\"aHR0cDovL21pcnJvcnMuamVua2lucy5pby93YXItc3RhYmxlL2xhdGVzdC9qZW5raW5zLndhcg==\">Latest</span></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /opt/jenkins <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">cd</span> /opt/jenkins</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">wget</span> <span class=\"token parameter variable\">-O</span> /opt/jenkins/jenkins.war http://mirrors.jenkins.io/war-stable/latest/jenkins.war</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> jenkins.war <span class=\"token parameter variable\">--httpPort</span><span class=\"token operator\">=</span><span class=\"token number\">8080</span></pre></td></tr></table></figure><p>就嗯可以打开，http://localhost:8080 了</p>\n<p>注意一段这样的话：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>*************************************************************</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>*************************************************************</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>*************************************************************</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Jenkins initial setup is required. An admin user has been created and a password generated.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Please use the following password to proceed to installation:</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>63196690ae7d47c49506480ee0e1af4a</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>This may also be found at: /root/.jenkins/secrets/initialAdminPassword</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>*************************************************************</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>*************************************************************</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>*************************************************************</pre></td></tr></table></figure><p>这里的 <code>63196690ae7d47c49506480ee0e1af4a</code>  就是初始的安装的管理员密码。</p>\n</li>\n</ul>\n</li>\n<li>\n<p>使用 Docker 安装</p>\n<ul>\n<li>\n<p>安装 Docker</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># From https://get.docker.com:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSL</span> https://get.docker.com <span class=\"token parameter variable\">-o</span> get-docker.sh</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sh</span> get-docker.sh</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#From https://test.docker.com:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSL</span> https://test.docker.com <span class=\"token parameter variable\">-o</span> test-docker.sh</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">sh</span> test-docker.sh</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># From the source repo (This will install latest from the test channel):</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">sh</span> install.sh</pre></td></tr></table></figure></li>\n<li>\n<p>配置 Docker 镜像加速，使用阿里云<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jci5jb25zb2xlLmFsaXl1bi5jb20vP3NwbT1hMmM0ZS4xMTE1Mzk0MC5ibG9nY29udDI5OTQxLjkuNTIwMjdlMjl3Mmp2OVA=\">容器加速服务</span></p>\n<p>左侧的加速器帮助页面就会显示为你独立分配的加速地址</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>例如：</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>公网Mirror：<span class=\"token punctuation\">[</span>系统分配前缀<span class=\"token punctuation\">]</span>.mirror.aliyuncs.com</pre></td></tr></table></figure><p>使用配置文件  <code>/etc/docker/daemon.json</code> （没有时新建该文件）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string\">\"registry-mirrors\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;your accelerate address>\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>重启 Docker Daemon 就可以了</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl daemon-reload</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>systemctl restart <span class=\"token function\">docker</span></pre></td></tr></table></figure><p><code>docker ps</code>  查看容器运行状态</p>\n<p><code>docker logs 容器ID/容器名称</code>  查看管理员初始密码</p>\n</li>\n<li>\n<p>安装 Docker-compose.yml 文件 (可选)</p>\n<p><strong>安装方法：</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#下载</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-L</span> https://github.com/docker/compose/releases/download/1.20.0/docker-compose-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-s</span><span class=\"token variable\">`</span></span>-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-m</span><span class=\"token variable\">`</span></span> <span class=\"token parameter variable\">-o</span> /usr/local/bin/docker-compose</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#安装</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">chmod</span> +x /usr/local/bin/docker-compose</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#查看版本</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">docker-compose</span> <span class=\"token parameter variable\">--version</span></pre></td></tr></table></figure></li>\n<li>\n<p>安装 Jenkins</p>\n<p><strong>版本选择：</strong></p>\n<p>Jenkins: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9yL2plbmtpbnMvamVua2lucy8=\">https://hub.docker.com/r/jenkins/jenkins/</span></p>\n<p>Jenkins with Blue Ocean: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9yL2plbmtpbnNjaS9ibHVlb2NlYW4=\">https://hub.docker.com/r/jenkinsci/blueocean</span></p>\n<blockquote>\n<p>Blue Ocean 重新思考 Jenkins 的用户体验，从头开始设计<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qZW5raW5zLmlvL3poL2RvYy9ib29rL3BpcGVsaW5lLw==\"> Jenkins Pipeline</span>, 但仍然与自由式作业兼容，Blue Ocean 减少了混乱而且进一步明确了团队中每个成员 Blue Ocean 的主要特性包括：</p>\n<ul>\n<li>持续交付 (CD) Pipeline 的 <strong>复杂可视化</strong> ，可以让您快速直观地理解管道状态。</li>\n<li><strong>Pipeline 编辑器</strong> - 引导用户通过直观的、可视化的过程来创建 Pipeline，从而使 Pipeline 的创建变得平易近人。</li>\n<li><strong>个性化</strong> 以适应团队中每个成员不同角色的需求。</li>\n<li>在需要干预和 / 或出现问题时 <strong>精确定位</strong> 。 Blue Ocean 展示 Pipeline 中需要关注的地方， 简化异常处理，提高生产力</li>\n<li><strong>本地集成分支和合并请求</strong>，在与 GitHub 和 Bitbucket 中的其他人协作编码时实现最大程度的开发人员生产力。****</li>\n</ul>\n</blockquote>\n<p><strong>安装命令：</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Jenkins</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token parameter variable\">-itd</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token parameter variable\">-u</span> root <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8080</span>:8080 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> jenkins-data:/var/jenkins_home <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /usr/bin/docker:/usr/bin/docker <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token parameter variable\">--name</span> jenkins-master <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  jenkins/jenkins</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># Jenkins blueocean</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token parameter variable\">-itd</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token parameter variable\">-u</span> root <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8080</span>:8080 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> jenkins-data:/var/jenkins_home <span class=\"token punctuation\">\\</span> </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /usr/bin/docker:/usr/bin/docker <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token parameter variable\">--name</span> jenkins-master <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  jenkinsci/blueocean</pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>\n<p>配置 Jenkins 插件加速</p>\n<p>进入 jenkins 系统管理 -&gt; 插件管理中 -&gt; 高级选项卡 -&gt; 升级站点，使用清华源：</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/current/update-center.json</pre></td></tr></table></figure><p><img data-src=\"./assets/70.png\" alt=\"ç³»ç»ç®¡ç\" /></p>\n<p><img data-src=\"./assets/70-20190611152837311.png\" alt=\"æä»¶ç®¡ç\" /></p>\n<p>关于官方所有的镜像列表：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL21pcnJvcnMuamVua2lucy1jaS5vcmcvc3RhdHVzLmh0bWw=\">http://mirrors.jenkins-ci.org/status.html</span></p>\n</li>\n<li>\n<p>环境配置</p>\n<ul>\n<li>Jenkins 的 URL 路径</li>\n<li>全局工具的配置：Docker, JDK (JAVA)...</li>\n</ul>\n</li>\n<li>\n<p>用户权限配置</p>\n<ul>\n<li>矩阵权限的配置</li>\n<li>添加管理员用户所有的权限</li>\n<li>添加<span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmplbmtpbnMtY2kub3JnL2Rpc3BsYXkvSkVOS0lOUy9BdXRob3JpemUrUHJvamVjdCtwbHVnaW4=\"> Authorize Project</span> 插件，并且在系统管理中进行配置。配置逻辑，就给用户当前项目的矩阵权限！</li>\n</ul>\n</li>\n<li>\n<p>与 gitlab 进行联接</p>\n<ul>\n<li>设置一个 SSH Key，方便 Jenkins 去拉取 Gitlab 中的项目</li>\n<li>GItlab 项目中去配置 SSH Key 的 Deploy 权限。 <code>Settings -&gt; Repository -&gt; Deploy keys -&gt; Public Deploy Keys</code></li>\n<li>Jenkins 添加 SSH 的私钥</li>\n</ul>\n<p>这样就完成了 Jenkins 可以访问 gitlab 的联接的过程。</p>\n<p>Jenkins 层面，需要去安装 Gitlab 相关插件。</p>\n</li>\n</ol>\n<h3 id=\"插件介绍\"><a class=\"anchor\" href=\"#插件介绍\">#</a> 插件介绍</h3>\n<ul>\n<li>\n<p>Publish over SSH</p>\n<p>这个是一个远程 Shell 工具，可以远程去执行一些 shell 命令</p>\n</li>\n<li>\n<p>HTTP Request Plugin</p>\n<p>跨平台调用，在构建前后可以通过该插件以 http 形式调用各种 api 接口实现和内部系统的联动</p>\n</li>\n<li>\n<p>Publish Over FTP</p>\n<p>用于远程使用 FTP 发布，比较合适于静态资源的发布。</p>\n<p><img data-src=\"./assets/20181225153134962.jpeg\" alt=\"img\" /></p>\n</li>\n<li>\n<p>Performance Plugin</p>\n</li>\n</ul>\n<p>​        该插件可以读取和解析测试框架输出的报告，并且在 Jenkins 上绘制性能和稳定性相关的图表。Performance Plugin 支持的测试框架有 JUnit、JMeter, Twitter 的 Lago 和 Taurus。下图是该插件输出的示例图：</p>\n<p><img data-src=\"./assets/3dee2f58ccdf7cf25fa86074c5485184a9f.jpg\" alt=\"img\" /></p>\n<p>​        <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wbHVnaW5zLmplbmtpbnMuaW8vcGVyZm9ybWFuY2U=\">https://plugins.jenkins.io/performance</span></p>\n<ul>\n<li>Gitlab Merge Request Builder Plugin</li>\n</ul>\n<p>​        Gitlab Merge Request Builder Plugin 可以方便的自动发起代码审查，它在创建 pull request 的时候，会自动带上关联任务的运行结果，以方便代码审查着确认改动的正确性。</p>\n<p>​        同时，这款插件还支持自动合并，既在代码审查通过后自动合并该 pull request 内容。</p>\n<p>​        <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RpbW9scy9qZW5raW5zLWdpdGxhYi1tZXJnZS1yZXF1ZXN0LWJ1aWxkZXItcGx1Z2lu\">https://github.com/timols/jenkins-gitlab-merge-request-builder-plugin</span></p>\n<ul>\n<li>JIRA Plugin</li>\n</ul>\n<p>​        JIRA Plugin 可以让 Jenkins 任务和 JIRA 集成起来，这样项目管理者可以通过 JIRA 了解项目进度，开发者也可以通过该插件直接更改 JIRA 上的 issue 状态。</p>\n<p>​        <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wbHVnaW5zLmplbmtpbnMuaW8vamlyYQ==\">https://plugins.jenkins.io/jira</span></p>\n<ul>\n<li>Kubernetes Plugin</li>\n</ul>\n<p>​        和最近大热的容器编排框架 Kubernetes 集成当然不能落下了。另外，Jenkins 对执行机的管理一直比较弱，无法做到快速的扩容和缩容。Kubernetes Plugin 通过引入 Kubernetes 的容器编排能力，让 Jenkins 执行机运行在 Kubernetes 环境中。</p>\n<p>​        <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2plbmtpbnNjaS9rdWJlcm5ldGVzLXBsdWdpbg==\">https://github.com/jenkinsci/kubernetes-plugin</span></p>\n<ul>\n<li>Build Pipeline plugin</li>\n</ul>\n<p>​        对一个系统的持续集成会包含很多个方面，如果将它们都杂糅在一个 Jenkins 任务中，会提高排查成本，也不利于整个持续集成的运作。Build Pipeline plugin 可以让项目管理员针对系统持续集成步骤设置一系列关联的任务，任务之间可以设置不同的触发条件，以确认何时需要人工介入。该插件可以让整个持续集成流程变得非常直观：</p>\n<p><img data-src=\"https://oscimg.oschina.net/oscnet/abf7ec185c847b72cd61181562f940557a2.jpg\" alt=\"img\" /></p>\n<p>​        <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2plbmtpbnNjaS9idWlsZC1waXBlbGluZS1wbHVnaW4=\">https://github.com/jenkinsci/build-pipeline-plugin</span></p>\n<h3 id=\"配置自动化任务\"><a class=\"anchor\" href=\"#配置自动化任务\">#</a> 配置自动化任务</h3>\n<p>两种执行方法：</p>\n<ol>\n<li>配置自由风格的项目</li>\n<li>配置 Pipeline 使用 Jenkinsfile</li>\n</ol>\n<p>需要注意的地方</p>\n<ul>\n<li>\n<p>SSH 插件：</p>\n<p>SSH</p>\n<p>SSH Agent</p>\n<p>SSH Pipeline Steps</p>\n<p>Publish Over SSH</p>\n</li>\n<li>\n<p>git 相关插件：</p>\n<p>Gitlab</p>\n<p>Github</p>\n</li>\n<li>\n<p>管理员界面配置：</p>\n<p><code>Settings -&gt; network -&gt; Outbound requests</code></p>\n<p>Allow requests to the local network from hooks and services 进行勾选</p>\n</li>\n</ul>\n<p>其他的一些用法：</p>\n<ul>\n<li>使用 Jenkins 配合 Docker Hub，把前端代码打包成镜像，再远程部署</li>\n<li>Jenkins 配合自建 Docker 容器服务，把前端代码打包，使用 Kubernetes 进行发布。</li>\n<li>使用 Docker 进行远程发布 (远程服务器上有 Docker 服务，并且设置了远程连接)</li>\n</ul>\n<h2 id=\"travisci\"><a class=\"anchor\" href=\"#travisci\">#</a> TravisCI</h2>\n<h3 id=\"使用简介-2\"><a class=\"anchor\" href=\"#使用简介-2\">#</a> 使用简介</h3>\n<p>Travis CI 只支持 Github，不支持其他代码托管服务。这意味着，你必须满足以下条件，才能使用 Travis CI。</p>\n<blockquote>\n<ul>\n<li>拥有 GitHub 帐号</li>\n<li>该帐号下面有一个项目</li>\n<li>该项目里面有可运行的代码</li>\n<li>该项目还包含构建或测试脚本</li>\n</ul>\n</blockquote>\n<p>Travis 简单的使用步骤:</p>\n<ul>\n<li>github 授权及面板</li>\n<li>获取 github 的 Tokens</li>\n<li>配置项目.travis.yml\n<ul>\n<li>Node 项目</li>\n<li>Script 脚本</li>\n<li>部署到 github pages</li>\n<li>钩子用法</li>\n</ul>\n</li>\n<li>其他</li>\n</ul>\n<p><strong>github 授权及面板</strong></p>\n<p>首先，访问官方网站 <span class=\"exturl\" data-url=\"aHR0cHM6Ly90cmF2aXMtY2kub3JnLw==\">travis-ci.org</span>，点击右上角的个人头像，使用 Github 账户登入 Travis CI。</p>\n<p>会进入到授权页面，这里跟微博、QQ 是一回事，主要是读取你的用户信息。</p>\n<p><img data-src=\"./assets/image-20190612205411602.png\" alt=\"image-20190612205411602\" /></p>\n<p>这里第二步在， <code>Dashboard</code>  这个选项卡中，点击 <code>Activate</code>  这个按钮</p>\n<p><img data-src=\"./assets/image-20190612212459194.png\" alt=\"image-20190612212459194\" /></p>\n<p>完了之后，Dashboard 会列出所有 Github 中有 <code>.travis.yml</code>  配置文件的仓库：</p>\n<p><img data-src=\"./assets/image-20190612212731186.png\" alt=\"image-20190612212731186\" /></p>\n<p>Travis 会列出 Github 上面你的所有仓库，以及你所属于的组织。此时，选择你需要 Travis 帮你构建的仓库，打开仓库旁边的开关。一旦激活了一个仓库，Travis 会监听这个仓库的所有变化。</p>\n<p><img data-src=\"./assets/image-20190612213022380.png\" alt=\"image-20190612213022380\" /></p>\n<ul>\n<li>\n<p><code>Settings</code>  中用于配置项目的构建条件</p>\n<p><img data-src=\"./assets/image-20190612214434173.png\" alt=\"image-20190612214434173\" /></p>\n</li>\n<li>\n<p><code>Requests</code>  可以查看构建记录</p>\n<p><img data-src=\"./assets/image-20190612214519926.png\" alt=\"image-20190612214519926\" /></p>\n</li>\n<li>\n<p><code>Caches</code>  主要是缓存文件</p>\n</li>\n<li>\n<p><code>Trigger build</code>  手动触发构建</p>\n</li>\n</ul>\n<p><strong>获取 github 的 token</strong></p>\n<p>在 settings-&gt;Developer settings-&gt;Personal access tokens-&gt;Generate new token</p>\n<p><img data-src=\"./assets/image-20190612225000955.png\" alt=\"image-20190612225000955\" /></p>\n<p><strong>配置项目的.travis.yml 文件</strong></p>\n<ul>\n<li>\n<p>设置项目语言</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">language</span><span class=\"token punctuation\">:</span> node_js</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">node_js</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"10\"</span></pre></td></tr></table></figure></li>\n<li>\n<p>Script 脚本</p>\n<p>Travis 的运行流程很简单，任何项目都会经过两个阶段。</p>\n<blockquote>\n<ul>\n<li>install 阶段：安装依赖</li>\n<li>script 阶段：运行脚本</li>\n</ul>\n</blockquote>\n<p>配置文件：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># S: Build Lifecycle</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">install</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">-</span> yarn install</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>// 钩子方法</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">before_script</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 无其他依赖项所以执行 npm run build 构建就行了</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">-</span> npm run build</pre></td></tr></table></figure><p>如果不需要安装，即跳过安装阶段，就直接设为 <code>true</code> 。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token literal-property property\">install</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr></table></figure><p><code>script</code>  字段用来指定构建或测试脚本。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token literal-property property\">script</span><span class=\"token operator\">:</span> bundle exec thor build</pre></td></tr></table></figure><p>如果有多个脚本，可以写成下面的形式。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token literal-property property\">script</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token operator\">-</span> command1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token operator\">-</span> command2</pre></td></tr></table></figure></li>\n<li>\n<p>部署到 github pages</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\"># 其他的一些配置项，可以参考：https://docs.travis-ci.com/user/deployment/pages/</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">provider</span><span class=\"token punctuation\">:</span> pages</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">skip_cleanup</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">local_dir</span><span class=\"token punctuation\">:</span> dist/</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">github_token</span><span class=\"token punctuation\">:</span> $GITHUB_TOKEN <span class=\"token comment\"># Set in the settings page of your repository, as a secure variable</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">keep_history</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> master</pre></td></tr></table></figure></li>\n<li>\n<p>钩子用法</p>\n<p>Travis 为上面这些阶段提供了 7 个钩子。</p>\n<ul>\n<li>before_install：install 阶段之前执行</li>\n<li>before_script：script 阶段之前执行</li>\n<li>after_failure：script 阶段失败时执行</li>\n<li>after_success：script 阶段成功时执行</li>\n<li>before_deploy：deploy 步骤之前执行</li>\n<li>after_deploy：deploy 步骤之后执行</li>\n<li>after_script：script 阶段之后执行</li>\n</ul>\n<p>完整的生命周期，从开始到结束是下面的流程。</p>\n<ol>\n<li>before_install</li>\n<li>install</li>\n<li>before_script</li>\n<li>script</li>\n<li>after<em>success or after</em>failure</li>\n<li>[OPTIONAL] before_deploy</li>\n<li>[OPTIONAL] deploy</li>\n<li>[OPTIONAL] after_deploy</li>\n<li>after_script</li>\n</ol>\n</li>\n</ul>\n<p>参考资料：</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vZG9tZW5pYy9lYzhiMGZjOGFiNDVmMzk0MDNkZA==\">Auto-deploying built products to gh-pages with Travis</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9vbmNsZXRvbS5pby8yMDE2L3RyYXZpcy1zc2gtZGVwbG95Lw==\">SSH deploys with Travis CI</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5ydWFueWlmZW5nLmNvbS9ibG9nLzIwMTcvMTIvdHJhdmlzX2NpX3R1dG9yaWFsLmh0bWw=\">持续集成服务 Travis CI 教程</span></li>\n</ul>\n<h3 id=\"配置nodejs应用\"><a class=\"anchor\" href=\"#配置nodejs应用\">#</a> 配置 Node.js 应用</h3>\n<p>配置一个 Vue 实例并发布到 github pages</p>\n<p>.travis.yml 文件：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">language</span><span class=\"token punctuation\">:</span> node_js</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">node_js</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"10\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># Travis-CI Caching</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">cache</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">directories</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">-</span> node_modules</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># S: Build Lifecycle</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key atrule\">install</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token punctuation\">-</span> yarn install</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key atrule\">before_script</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># 无其他依赖项所以执行 npm run build 构建就行了</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">-</span> npm run build</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token comment\"># 其他的一些配置项，可以参考：https://docs.travis-ci.com/user/deployment/pages/</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token key atrule\">provider</span><span class=\"token punctuation\">:</span> pages</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token key atrule\">skip_cleanup</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token key atrule\">local_dir</span><span class=\"token punctuation\">:</span> dist/</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token key atrule\">github_token</span><span class=\"token punctuation\">:</span> $GITHUB_TOKEN <span class=\"token comment\"># Set in the settings page of your repository, as a secure variable</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token key atrule\">keep_history</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> master</pre></td></tr></table></figure><h2 id=\"circleci\"><a class=\"anchor\" href=\"#circleci\">#</a> CircleCI</h2>\n<h3 id=\"使用简介-3\"><a class=\"anchor\" href=\"#使用简介-3\">#</a> 使用简介</h3>\n<ol>\n<li>\n<p>注册 CircleCI</p>\n<p>打开 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaXJjbGVjaS5jb20v\">CircleCI</span> 官方网站，使用您的 GitHub 帐户登录。</p>\n<p><img data-src=\"./assets/image-20190613093550553.png\" alt=\"image-20190613093550553\" /></p>\n<p>进行授权：</p>\n<p><img data-src=\"./assets/image-20190613093732415.png\" alt=\"image-20190613093732415\" /></p>\n</li>\n<li>\n<p>启动存储库</p>\n</li>\n</ol>\n<p>检查要在 CircleCI 上管理的存储库的开关按钮。</p>\n<p><img data-src=\"./assets/image-20190613094115350.png\" alt=\"image-20190613094115350\" /></p>\n<ol start=\"3\">\n<li>\n<p>编写 config.yml</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">...</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">...</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">...</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token punctuation\">...</span></pre></td></tr></table></figure><p>官方参考文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaXJjbGVjaS5jb20vZG9jcy8yLjAvY29uZmlndXJhdGlvbi1yZWZlcmVuY2UvI3ZlcnNpb24=\">https://circleci.com/docs/2.0/configuration-reference/#version</span></p>\n<p>来看一个完事版的配置</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">:</span><span class=\"token number\">14.04</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mongo<span class=\"token punctuation\">:</span>2.6.8</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>mongod<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>smallfiles<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> postgres<span class=\"token punctuation\">:</span>9.4.1</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\"># some containers require setting environment variables</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>          <span class=\"token key atrule\">POSTGRES_USER</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redis@sha256<span class=\"token punctuation\">:</span>54057dd7e125ca41afe526a877e8bd35ec2cdd33b9217e022ed37bdcf7d09673</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> rabbitmq<span class=\"token punctuation\">:</span>3.5.4</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token key atrule\">TEST_REPORTS</span><span class=\"token punctuation\">:</span> /tmp/test<span class=\"token punctuation\">-</span>reports</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> ~/my<span class=\"token punctuation\">-</span>project</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token punctuation\">-</span> checkout</pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> echo 127.0.0.1 devhost <span class=\"token punctuation\">|</span> sudo tee <span class=\"token punctuation\">-</span>a /etc/hosts</pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token comment\"># Create Postgres users and database</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token comment\"># Note the YAML heredoc '|' for nicer formatting</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>          sudo -u root createuser -h localhost --superuser ubuntu &amp;&amp;</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>          sudo createdb -h localhost test_db</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">restore_cache</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>          <span class=\"token key atrule\">keys</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token punctuation\">-</span> v1<span class=\"token punctuation\">-</span>my<span class=\"token punctuation\">-</span>project<span class=\"token punctuation\">-</span>&lt;<span class=\"token tag\">!--swig</span>￼0<span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span><span class=\"token punctuation\">></span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            - v1-my-project-</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>          <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token key atrule\">SSH_TARGET</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"localhost\"</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token key atrule\">TEST_ENV</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"linux\"</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            set -xu</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            mkdir -p $&#123;TEST_REPORTS&#125;</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            run-tests.sh</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            cp out/tests/*.xml $&#123;TEST_REPORTS&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>          set -xu</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>          mkdir -p /tmp/artifacts</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>          create_jars.sh $&#123;CIRCLE_BUILD_NUM&#125;</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>          cp *.jar /tmp/artifacts</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">save_cache</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> v1<span class=\"token punctuation\">-</span>my<span class=\"token punctuation\">-</span>project<span class=\"token punctuation\">-</span>&lt;<span class=\"token tag\">!--swig</span>￼1<span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span><span class=\"token punctuation\">></span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>          paths:</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            - ~/.m2</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>      <span class=\"token comment\"># Save artifacts</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">store_artifacts</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /tmp/artifacts</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>          <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span> build</pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>      <span class=\"token comment\"># Upload test results</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">store_test_results</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /tmp/test<span class=\"token punctuation\">-</span>reports</pre></td></tr><tr><td data-num=\"70\"></td><td><pre></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>  <span class=\"token key atrule\">deploy-stage</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">:</span><span class=\"token number\">14.04</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> /tmp/my<span class=\"token punctuation\">-</span>project</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy if tests pass and branch is Staging</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> ansible<span class=\"token punctuation\">-</span>playbook site.yml <span class=\"token punctuation\">-</span>i staging</pre></td></tr><tr><td data-num=\"79\"></td><td><pre></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>  <span class=\"token key atrule\">deploy-prod</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">:</span><span class=\"token number\">14.04</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>    <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> /tmp/my<span class=\"token punctuation\">-</span>project</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy if tests pass and branch is Master</pre></td></tr><tr><td data-num=\"87\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> ansible<span class=\"token punctuation\">-</span>playbook site.yml <span class=\"token punctuation\">-</span>i production</pre></td></tr><tr><td data-num=\"88\"></td><td><pre></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token key atrule\">workflows</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>  <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>  <span class=\"token key atrule\">build-deploy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>    <span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>          <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>            <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>              <span class=\"token key atrule\">ignore</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>                <span class=\"token punctuation\">-</span> develop</pre></td></tr><tr><td data-num=\"98\"></td><td><pre>                <span class=\"token punctuation\">-</span> /feature<span class=\"token punctuation\">-</span>.<span class=\"token important\">*/</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">deploy-stage</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>          <span class=\"token key atrule\">requires</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>            <span class=\"token punctuation\">-</span> build</pre></td></tr><tr><td data-num=\"102\"></td><td><pre>          <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>            <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>              <span class=\"token key atrule\">only</span><span class=\"token punctuation\">:</span> staging</pre></td></tr><tr><td data-num=\"105\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">deploy-prod</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>          <span class=\"token key atrule\">requires</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>            <span class=\"token punctuation\">-</span> build</pre></td></tr><tr><td data-num=\"108\"></td><td><pre>          <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>            <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>              <span class=\"token key atrule\">only</span><span class=\"token punctuation\">:</span> master</pre></td></tr></table></figure></li>\n<li>\n<p>设置 / 查看任务</p>\n<p><img data-src=\"./assets/image-20190613093327981.png\" alt=\"image-20190613093327981\" /></p>\n</li>\n</ol>\n<h3 id=\"配置nodejs应用-2\"><a class=\"anchor\" href=\"#配置nodejs应用-2\">#</a> 配置 Node.js 应用</h3>\n<p><code>.circleci/config.yml</code>  配置文件</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> circleci/node<span class=\"token punctuation\">:</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">only</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">-</span> master</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">add_ssh_keys</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>          <span class=\"token key atrule\">fingerprints</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">-</span> <span class=\"token string\">\"c5:20:8e:79:81:19:fd:c1:6c:c4:fb:41:58:92:9d:4f\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">-</span> checkout</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">restore_cache</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>          <span class=\"token key atrule\">keys</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\"># fallback to using the latest cache if no exact match is found</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">-</span> dependencies<span class=\"token punctuation\">-</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> yarn install</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">save_cache</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>          <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token punctuation\">-</span> node_modules</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> dependencies<span class=\"token punctuation\">-</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> build github pages</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> yarn build</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Prepare shell commands</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> chmod +x scripts/deploy.sh</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run deploy scripts</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> ./scripts/deploy.sh</pre></td></tr></table></figure><p>这里以发布到 github page 为示例：</p>\n<p>deploy.sh 文件的内容：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/sh</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># ideas used from https://gist.github.com/motemen/8595451</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># Based on https://github.com/eldarlabs/ghpages-deploy-script/blob/master/scripts/deploy-ghpages.sh</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># Used with their MIT license https://github.com/eldarlabs/ghpages-deploy-script/blob/master/LICENSE</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># abort the script if there is a non-zero error</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">-e</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># show where we are on the machine</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">pwd</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">remote</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">git</span> config remote.origin.url<span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'remote is: '</span><span class=\"token variable\">$remote</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># make a directory to put the gp-pages branch</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">mkdir</span> gh-pages-branch</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token builtin class-name\">cd</span> gh-pages-branch</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># now lets setup a new repo so we can update the gh-pages branch</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> user.email <span class=\"token string\">\"<span class=\"token variable\">$GH_EMAIL</span>\"</span> <span class=\"token operator\">></span> /dev/null <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> user.name <span class=\"token string\">\"<span class=\"token variable\">$GH_NAME</span>\"</span> <span class=\"token operator\">></span> /dev/null <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token function\">git</span> init</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token function\">git</span> remote <span class=\"token function\">add</span> <span class=\"token parameter variable\">--fetch</span> origin <span class=\"token string\">\"<span class=\"token variable\">$remote</span>\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'email is: '</span><span class=\"token variable\">$GH_EMAIL</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'name is: '</span><span class=\"token variable\">$GH_NAME</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'sitesource is: '</span><span class=\"token variable\">$siteSource</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\"># switch into the the gh-pages branch</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token function\">git</span> rev-parse <span class=\"token parameter variable\">--verify</span> origin/gh-pages <span class=\"token operator\">></span> /dev/null <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token function\">git</span> checkout gh-pages</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\"># delete any old site as we are going to replace it</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token comment\"># Note: this explodes if there aren't any, so moving it here for now</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token function\">git</span> <span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span> <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token function\">git</span> checkout <span class=\"token parameter variable\">--orphan</span> gh-pages</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\"># copy over or recompile the new site</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token function\">cp</span> <span class=\"token parameter variable\">-a</span> <span class=\"token string\">\"../<span class=\"token variable\">$&#123;siteSource&#125;</span>/.\"</span> <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token function\">ls</span> <span class=\"token parameter variable\">-la</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\"># stage any changes and new files</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token parameter variable\">-A</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\"># now commit, ignoring branch gh-pages doesn't seem to work, so trying skip</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token function\">git</span> commit --allow-empty <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"Deploy to GitHub pages [ci skip]\"</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token comment\"># and push, but send any output to /dev/null to hide anything sensitive</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token function\">git</span> push <span class=\"token parameter variable\">--force</span> <span class=\"token parameter variable\">--quiet</span> origin gh-pages</pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\"># go back to where we started and remove the gh-pages git repo we made and used</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\"># for deployment</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token builtin class-name\">cd</span> <span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span> gh-pages-branch</pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Finished Deployment!\"</span></pre></td></tr></table></figure><p>说明：</p>\n<p><strong>&gt;/dev/null 2&gt;&amp;1 的含义</strong></p>\n<p><strong>文件描述符</strong></p>\n<p>当执行 shell 命令时，会默认打开 3 个文件，每个文件有对应的文件描述符来方便我们使用：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">类型</th>\n<th style=\"text-align:left\">文件描述符</th>\n<th style=\"text-align:left\">默认情况</th>\n<th style=\"text-align:left\">对应文件句柄位置</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">标准输入（standard input）</td>\n<td style=\"text-align:left\">0</td>\n<td style=\"text-align:left\">从键盘获得输入</td>\n<td style=\"text-align:left\">/proc/slef/fd/0</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">标准输出（standard output）</td>\n<td style=\"text-align:left\">1</td>\n<td style=\"text-align:left\">输出到屏幕（即控制台）</td>\n<td style=\"text-align:left\">/proc/slef/fd/1</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">错误输出（error output）</td>\n<td style=\"text-align:left\">2</td>\n<td style=\"text-align:left\">输出到屏幕（即控制台）</td>\n<td style=\"text-align:left\">/proc/slef/fd/2</td>\n</tr>\n</tbody>\n</table>\n<p><code>&gt;</code>  代表重定向到哪里？</p>\n<p>例如： <code>echo &quot;123&quot; &gt; /home/123.txt</code> <br />\n <code>1</code>  表示 <code>stdout</code>  标准输出，系统默认值是 <code>1</code> ，所以 <code>&gt;/dev/null</code>  等同于 <code>1&gt;/dev/null</code> <br />\n <code>2</code>  表示 <code>stderr</code>  标准错误<br />\n <code>&amp;</code>  表示等同于的意思， <code>2&gt;&amp;1</code> ，表示 <code>2</code>  的输出重定向等同于 <code>1</code></p>\n<p>参考资料：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vdGlueXdhbi9wLzYwMjU0NjguaHRtbA==\">Shell 脚本 ———— /dev/null 2&gt;&amp;1 详解</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phY2t5ZWNoaW5hL2FydGljbGUvZGV0YWlscy81NDU4MjE0Ng==\">shell 中 &gt;/dev/null 2&gt;&amp;1</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l0aG9tZXIvYXJ0aWNsZS9kZXRhaWxzLzkyODgzNTM=\">Linux Shell 1&gt;/dev/null 2&gt;&amp;1 含义</span></p>\n<h2 id=\"扩展知识\"><a class=\"anchor\" href=\"#扩展知识\">#</a> 扩展知识</h2>\n<h3 id=\"自动化流程的发展趋势\"><a class=\"anchor\" href=\"#自动化流程的发展趋势\">#</a> 自动化流程的发展趋势</h3>\n<ol>\n<li>\n<p>集中化</p>\n<p>以集群为基础，服务采用 Saas 方式进行交付。所有折构建、测试、发布全集中进行管理。</p>\n</li>\n<li>\n<p>微服务 + 无服务的应用模式</p>\n<p>应用程序执行环境的管理被新的编程模型和平台取代后，团队的交付生产率得到了进一步的提升。一方面它免去了很多环境管理的工作，包括设备、网络、主机以及对应的软件和配置工作，使得软件运行时环境更加稳定。另一方面，它大大降低了团队采用 DevOps 的技术门槛。</p>\n<p>** 无服务器风格的架构（Serverless architecture）** 把 DevOps 技术在微服务领域的应用推向极致。当应用程序执行环境的管理被新的编程模型和平台取代后，团队的交付生产率得到了进一步的提升。一方面它免去了很多环境管理的工作，包括设备、网络、主机以及对应的软件和配置工作，使得软件运行时环境更加稳定。另一方面，它大大降低了团队采用 DevOps 的技术门槛。</p>\n<p>在微服务端到端交付流程上，Netflix 开源了自家的<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zcGlubmFrZXIuaW8v\"> Spinnaker</span>，Netflix 作为微服务实践的先锋，不断推出新的开源工具来弥补社区中微服务技术和最佳实践的缺失。而<span class=\"exturl\" data-url=\"aHR0cDovL3Byb2plY3RzLnNwcmluZy5pby9zcHJpbmctY2xvdWQv\"> Spring Cloud</span> 则为开发者提供了一系列工具，以便他们在所熟悉的 Spring 技术栈下使用这些服务协调技术 (coordination techniques)，如服务发现、负载均衡、熔断和健康检查。</p>\n</li>\n<li>\n<p>人工智能领域的应用</p>\n<p>DevOps 的最早实践来自于互联网企业的 Web 应用，相应的思想被引入企业级应用并促进了一系列工具的发展。在人工智能领域，<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudGVuc29yZmxvdy5vcmcv\">TensorFlow</span> 就是这样一个例子，它可以有多种 DevOps 友好的安装和部署方式 ，例如采用 Docker 进行部署。</p>\n<p>随着 Python 在大数据、人工智能、区块链、微服务以及 Docker 中的发展，可以预见 Python 在日后的领域仍然会发挥重要的作用。</p>\n</li>\n<li>\n<p>安全推动 DevOps 的发展</p>\n<p>全是 DevOps 永远绕不开的话题，也往往是新技术在传统行业（例如金融和电信）应用中的最大阻碍。一方面，组织结构的转型迫使企业要打破原先的部门墙，这意味着很多原先的控制流程不再适用。另一方面，由于大量的 DevOps 技术来源于开源社区，缺乏强大技术实力的企业在应用相关技术时不免会有所担忧。</p>\n</li>\n<li>\n<p>Windows 平台下.net 的技术潜力巨大</p>\n<p>长期以来，Windows 和.NET 平台下的 DevOps 一直都是一个被低估的领域。一方面，社区缺乏对 Windows Server 平台的兴趣。另一方面，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb21tdW5pdHkuc3BpY2V3b3Jrcy5jb20vbmV0d29ya2luZy9hcnRpY2xlcy8yNDYyLXNlcnZlci12aXJ0dWFsaXphdGlvbi1hbmQtb3MtdHJlbmRz\">Windows Server 却有接近 90% 的市场占用率</span>，在 Web 服务器领域则有<span class=\"exturl\" data-url=\"aHR0cHM6Ly93M3RlY2hzLmNvbS90ZWNobm9sb2dpZXMvb3ZlcnZpZXcvb3BlcmF0aW5nX3N5c3RlbS9hbGw=\"> 33.5% 的市场占有率</span>。</p>\n</li>\n<li>\n<p>非功能性自动化测试工具逐渐完善</p>\n<p>自动化测试水平往往是衡量 DevOps 技术能力高低的重要指标，尤其是针对生产环境应用程序的非功能性自动化测试工具。一直以来，技术雷达都在尝试从不同的角度宣扬自动化测试的重要性，从软件的开发阶段延展到了整个应用生命周期甚至整体 IT 资产的管理上。</p>\n</li>\n</ol>\n<h3 id=\"复杂的devops相关工具\"><a class=\"anchor\" href=\"#复杂的devops相关工具\">#</a> 复杂的 DevOps 相关工具</h3>\n<p><img data-src=\"./assets/devops-hero-1-87966cfbc9c5713ae047551c7b22985c.png\" alt=\"DevOps\" /></p>\n<h3 id=\"jenkins的一些应用场景\"><a class=\"anchor\" href=\"#jenkins的一些应用场景\">#</a> Jenkins 的一些应用场景</h3>\n<p>打包平台：</p>\n<p>使用 Jenkins 搭建 iOS/Android</p>\n<p>测试平台：</p>\n<p>jenkins + python + selenium</p>\n<p>Jmeter+maven+Jenkins 构建云性能测试平台</p>\n<p>Jenkins+PMD 构建自动化静态代码检测</p>\n<p>使用 jenkins+Emma 统计</p>\n<p>客户端单元测试覆盖率</p>\n<p>Jenkins+Ant+Java+Junit+SVN 执行 junit 单元测试</p>\n<p>jenkins+ant+jmeter 搭建持续集成的接口测试平台</p>\n<p>自动部署：</p>\n<p>Jenkins+GitLab + 蒲公英 + FTP</p>\n<p>jenkins 结合 ansible 用 shell 实现自动化部署和回滚</p>\n<p>持续集成：</p>\n<p>Tomcat+Sonar 搭建持续集成环境</p>\n<p>Maven+Nexus+Jenkins+git/SVN</p>\n<h3 id=\"jenkins的docker-composeyml创建文件\"><a class=\"anchor\" href=\"#jenkins的docker-composeyml创建文件\">#</a> Jenkins 的 Docker-compose.yml 创建文件</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>version: <span class=\"token string\">'3'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>services:</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  jenkins:</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    container_name: <span class=\"token string\">'jenkins'</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    image: jenkins/jenkins</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    restart: always</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    user: jenkins:<span class=\"token operator\">&lt;</span>这里填Docker用户组的ID，见下面<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    ports:</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    - <span class=\"token string\">\"8080:8080\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    - <span class=\"token string\">\"50000:50000\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    volumes:</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    - /home/jenkins/data:/var/jenkins_home</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    - /usr/bin/docker:/usr/bin/docker</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    - /var/run/docker.sock:/var/run/docker.sock</pre></td></tr></table></figure><p>上面的脚本使用注意：</p>\n<ol>\n<li>\n<p>创建本地 jenkins 数据目录</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /home/jenkins</pre></td></tr></table></figure></li>\n<li>\n<p>查看 docker 用户组的 ID</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> /etc/group <span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token function\">docker</span></pre></td></tr></table></figure></li>\n<li>\n<p>执行 <code>docker-compose up -d</code></p>\n</li>\n</ol>\n<h3 id=\"gitlab的docker启动配置文件\"><a class=\"anchor\" href=\"#gitlab的docker启动配置文件\">#</a> gitlab 的 docker 启动配置文件</h3>\n<p>项目地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NhbWVlcnNibi9kb2NrZXItZ2l0bGFi\">https://github.com/sameersbn/docker-gitlab</span></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'2'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">redis</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> sameersbn/redis<span class=\"token punctuation\">:</span>4.0.9<span class=\"token punctuation\">-</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>loglevel warning</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">-</span> /srv/docker/gitlab/redis<span class=\"token punctuation\">:</span>/var/lib/redis<span class=\"token punctuation\">:</span>Z</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">postgresql</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> sameersbn/postgresql<span class=\"token punctuation\">:</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">-</span> /srv/docker/gitlab/postgresql<span class=\"token punctuation\">:</span>/var/lib/postgresql<span class=\"token punctuation\">:</span>Z</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_USER=gitlab</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_PASS=password</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_NAME=gitlabhq_production</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_EXTENSION=pg_trgm</pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token key atrule\">gitlab</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> sameersbn/gitlab<span class=\"token punctuation\">:</span>11.11.2</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">-</span> redis</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">-</span> postgresql</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"10080:80\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"10022:22\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">-</span> /srv/docker/gitlab/gitlab<span class=\"token punctuation\">:</span>/home/git/data<span class=\"token punctuation\">:</span>Z</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">-</span> DEBUG=false</pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_ADAPTER=postgresql</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_HOST=postgresql</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_PORT=5432</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_USER=gitlab</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_PASS=password</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_NAME=gitlabhq_production</pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">-</span> REDIS_HOST=redis</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">-</span> REDIS_PORT=6379</pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">-</span> TZ=Asia/Kolkata</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_TIMEZONE=Kolkata</pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_HTTPS=false</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">-</span> SSL_SELF_SIGNED=false</pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token comment\"># 这里修改成服务器的 IP 或者域名</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_HOST=localhost</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_PORT=10080</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SSH_PORT=10022</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_RELATIVE_URL_ROOT=</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SECRETS_DB_KEY_BASE=long<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>random<span class=\"token punctuation\">-</span>alphanumeric<span class=\"token punctuation\">-</span>string</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SECRETS_SECRET_KEY_BASE=long<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>random<span class=\"token punctuation\">-</span>alphanumeric<span class=\"token punctuation\">-</span>string</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SECRETS_OTP_KEY_BASE=long<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>random<span class=\"token punctuation\">-</span>alphanumeric<span class=\"token punctuation\">-</span>string</pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t\t<span class=\"token comment\"># 这里给一个长度大于 8 的密码</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_ROOT_PASSWORD=12345678</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_ROOT_EMAIL=itheima@itcast.cn</pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_NOTIFY_ON_BROKEN_BUILDS=true</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_NOTIFY_PUSHER=false</pre></td></tr><tr><td data-num=\"68\"></td><td><pre></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_EMAIL=notifications@example.com</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_EMAIL_REPLY_TO=noreply@example.com</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_INCOMING_EMAIL_ADDRESS=reply@example.com</pre></td></tr><tr><td data-num=\"72\"></td><td><pre></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_BACKUP_SCHEDULE=daily</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_BACKUP_TIME=01<span class=\"token punctuation\">:</span><span class=\"token number\">00</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_ENABLED=false</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_DOMAIN=www.example.com</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_HOST=smtp.gmail.com</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_PORT=587</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_USER=mailer@example.com</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_PASS=password</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_STARTTLS=true</pre></td></tr><tr><td data-num=\"83\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_AUTHENTICATION=login</pre></td></tr><tr><td data-num=\"84\"></td><td><pre></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    <span class=\"token punctuation\">-</span> IMAP_ENABLED=false</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>    <span class=\"token punctuation\">-</span> IMAP_HOST=imap.gmail.com</pre></td></tr><tr><td data-num=\"87\"></td><td><pre>    <span class=\"token punctuation\">-</span> IMAP_PORT=993</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    <span class=\"token punctuation\">-</span> IMAP_USER=mailer@example.com</pre></td></tr><tr><td data-num=\"89\"></td><td><pre>    <span class=\"token punctuation\">-</span> IMAP_PASS=password</pre></td></tr><tr><td data-num=\"90\"></td><td><pre>    <span class=\"token punctuation\">-</span> IMAP_SSL=true</pre></td></tr><tr><td data-num=\"91\"></td><td><pre>    <span class=\"token punctuation\">-</span> IMAP_STARTTLS=false</pre></td></tr><tr><td data-num=\"92\"></td><td><pre></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_ENABLED=false</pre></td></tr><tr><td data-num=\"94\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AUTO_SIGN_IN_WITH_PROVIDER=</pre></td></tr><tr><td data-num=\"95\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_ALLOW_SSO=</pre></td></tr><tr><td data-num=\"96\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_BLOCK_AUTO_CREATED_USERS=true</pre></td></tr><tr><td data-num=\"97\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AUTO_LINK_LDAP_USER=false</pre></td></tr><tr><td data-num=\"98\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AUTO_LINK_SAML_USER=false</pre></td></tr><tr><td data-num=\"99\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_EXTERNAL_PROVIDERS=</pre></td></tr><tr><td data-num=\"100\"></td><td><pre></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CAS3_LABEL=cas3</pre></td></tr><tr><td data-num=\"102\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CAS3_SERVER=</pre></td></tr><tr><td data-num=\"103\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CAS3_DISABLE_SSL_VERIFICATION=false</pre></td></tr><tr><td data-num=\"104\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CAS3_LOGIN_URL=/cas/login</pre></td></tr><tr><td data-num=\"105\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CAS3_VALIDATE_URL=/cas/p3/serviceValidate</pre></td></tr><tr><td data-num=\"106\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CAS3_LOGOUT_URL=/cas/logout</pre></td></tr><tr><td data-num=\"107\"></td><td><pre></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GOOGLE_API_KEY=</pre></td></tr><tr><td data-num=\"109\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GOOGLE_APP_SECRET=</pre></td></tr><tr><td data-num=\"110\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GOOGLE_RESTRICT_DOMAIN=</pre></td></tr><tr><td data-num=\"111\"></td><td><pre></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_FACEBOOK_API_KEY=</pre></td></tr><tr><td data-num=\"113\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_FACEBOOK_APP_SECRET=</pre></td></tr><tr><td data-num=\"114\"></td><td><pre></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_TWITTER_API_KEY=</pre></td></tr><tr><td data-num=\"116\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_TWITTER_APP_SECRET=</pre></td></tr><tr><td data-num=\"117\"></td><td><pre></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GITHUB_API_KEY=</pre></td></tr><tr><td data-num=\"119\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GITHUB_APP_SECRET=</pre></td></tr><tr><td data-num=\"120\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GITHUB_URL=</pre></td></tr><tr><td data-num=\"121\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GITHUB_VERIFY_SSL=</pre></td></tr><tr><td data-num=\"122\"></td><td><pre></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GITLAB_API_KEY=</pre></td></tr><tr><td data-num=\"124\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GITLAB_APP_SECRET=</pre></td></tr><tr><td data-num=\"125\"></td><td><pre></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_BITBUCKET_API_KEY=</pre></td></tr><tr><td data-num=\"127\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_BITBUCKET_APP_SECRET=</pre></td></tr><tr><td data-num=\"128\"></td><td><pre></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_ASSERTION_CONSUMER_SERVICE_URL=</pre></td></tr><tr><td data-num=\"130\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_IDP_CERT_FINGERPRINT=</pre></td></tr><tr><td data-num=\"131\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_IDP_SSO_TARGET_URL=</pre></td></tr><tr><td data-num=\"132\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_ISSUER=</pre></td></tr><tr><td data-num=\"133\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_LABEL=\"Our SAML Provider\"</pre></td></tr><tr><td data-num=\"134\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_NAME_IDENTIFIER_FORMAT=urn<span class=\"token punctuation\">:</span>oasis<span class=\"token punctuation\">:</span>names<span class=\"token punctuation\">:</span>tc<span class=\"token punctuation\">:</span>SAML<span class=\"token punctuation\">:</span>2.0<span class=\"token punctuation\">:</span>nameid<span class=\"token punctuation\">-</span>format<span class=\"token punctuation\">:</span>transient</pre></td></tr><tr><td data-num=\"135\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_GROUPS_ATTRIBUTE=</pre></td></tr><tr><td data-num=\"136\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_EXTERNAL_GROUPS=</pre></td></tr><tr><td data-num=\"137\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_ATTRIBUTE_STATEMENTS_EMAIL=</pre></td></tr><tr><td data-num=\"138\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_ATTRIBUTE_STATEMENTS_NAME=</pre></td></tr><tr><td data-num=\"139\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_ATTRIBUTE_STATEMENTS_USERNAME=</pre></td></tr><tr><td data-num=\"140\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_ATTRIBUTE_STATEMENTS_FIRST_NAME=</pre></td></tr><tr><td data-num=\"141\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_ATTRIBUTE_STATEMENTS_LAST_NAME=</pre></td></tr><tr><td data-num=\"142\"></td><td><pre></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CROWD_SERVER_URL=</pre></td></tr><tr><td data-num=\"144\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CROWD_APP_NAME=</pre></td></tr><tr><td data-num=\"145\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CROWD_APP_PASSWORD=</pre></td></tr><tr><td data-num=\"146\"></td><td><pre></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AUTH0_CLIENT_ID=</pre></td></tr><tr><td data-num=\"148\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AUTH0_CLIENT_SECRET=</pre></td></tr><tr><td data-num=\"149\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AUTH0_DOMAIN=</pre></td></tr><tr><td data-num=\"150\"></td><td><pre></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AZURE_API_KEY=</pre></td></tr><tr><td data-num=\"152\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AZURE_API_SECRET=</pre></td></tr><tr><td data-num=\"153\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AZURE_TENANT_ID=</pre></td></tr></table></figure>",
            "tags": [
                "持续集成与部署",
                "持续集成",
                "持续部署"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/02/02/%E5%AE%B9%E5%99%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E6%93%8D%E4%BD%9C/",
            "url": "https://dmqweb.cn/2024/02/02/%E5%AE%B9%E5%99%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E6%93%8D%E4%BD%9C/",
            "title": "容器化运维操作",
            "date_published": "2024-02-02T06:24:04.000Z",
            "content_html": "<h1 id=\"5-6-容器化运维操作\"><a class=\"anchor\" href=\"#5-6-容器化运维操作\">#</a> 5-6 容器化运维操作</h1>\n<p>日趋复杂的运维开发环境，对虚拟服务器及应用服务的要求更加的多元化。我们需要更加容易扩展、性能优越、方便监控的管理服务，容器化应用、容器化运维应运而生。</p>\n<p><strong>【知己知彼】你将在学习本课程中学习到：</strong></p>\n<ol>\n<li>理解 / 安装 docker 容器技术</li>\n<li>秒级快速部署 mysql、nginx、tomcat 等服务</li>\n<li>使用容器技术发布 nodejs 应用</li>\n<li>…</li>\n</ol>\n<p><strong>【工欲善其事，必先利其器】你需要准备的环境（三选一）：</strong></p>\n<ul>\n<li>Linux 环境 (Centos 7 以上 / Debian 8 以上 / Ubuntu 16.04LTS 以上版本)</li>\n<li>Windows 64 位专业版 / 企业版 / 教育版 (Build 15063 以上)</li>\n<li>macOS Sierra 10.12 以上的版本</li>\n</ul>\n<blockquote>\n<p>如果，你有了上面的环境，就可以很快速的跟着我们的内容快速学习。</p>\n</blockquote>\n<h2 id=\"容器和docker\"><a class=\"anchor\" href=\"#容器和docker\">#</a> 容器和 Docker</h2>\n<h3 id=\"什么是容器化\"><a class=\"anchor\" href=\"#什么是容器化\">#</a> 什么是容器化？</h3>\n<p>容器化是将应用程序或服务、其依赖项及其配置（抽象化为部署清单文件）一起打包为容器映像的一种软件开发方法。</p>\n<p><img data-src=\"./assets/docker-containerized-appliction-blue-border_2.png\" alt=\"docker-containerized-appliction-blue-border_2\" /></p>\n<p>软件容器充当软件部署的标准单元，其中可以包含不同的代码和依赖项。 按照这种方式容器化软件，开发人员和 IT 专业人员只需进行极少修改或不修改，即可将其部署到不同的环境。</p>\n<p>容器化应用程序在容器主机上运行，而容器主机在 OS（Linux 或 Windows）上运行。因此，容器的占用比虚拟机 (VM) 映像小得多。</p>\n<p>容器化的特点：</p>\n<ul>\n<li>一致的运行环境</li>\n<li>可伸缩性</li>\n<li>更方便的移植</li>\n<li>隔离性</li>\n</ul>\n<h3 id=\"什么是docker\"><a class=\"anchor\" href=\"#什么是docker\">#</a> 什么是 Docker?</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21vYnkvbW9ieQ==\">Docker</span> 是用 GO 语言开发的应用容器引擎，基于容器化，沙箱机制的应用部署技术。可适用于自动化测试、打包，持续集成和发布应用程序等场景，包括阿里云，亚马逊在内的云计算服务商都采用了 docker 来打造 serverless 服务平台。它不仅仅可以部署项目，还可以用于数据库搭建，nginx 服务搭建，nodejs、php 等编程语言环境搭建。</p>\n<blockquote>\n<p>PS: docker 现已改名为 moby</p>\n</blockquote>\n<p>Docker 中的三个<strong>重要概念</strong>：</p>\n<ul>\n<li>\n<p>镜像 (image)：分片的（只读）文件系统，由 Dockerfile 创建</p>\n<p>独立、易扩展、更效率</p>\n</li>\n<li>\n<p>容器 (container)：由 Docker 进程创建和管理的：文件系统 +  系统资源 + 网络配置 + 日志管理</p>\n<p>docker 是 docker 镜像的运行环境，所以容器的概念就比较好理解了</p>\n</li>\n<li>\n<p>仓库 (registry)：用来远端存储 docker 镜像</p>\n<p>版本控制、变更管理、为持续集成与快速部署提供便利</p>\n</li>\n</ul>\n<h3 id=\"docker-vs-虚拟机\"><a class=\"anchor\" href=\"#docker-vs-虚拟机\">#</a> Docker vs 虚拟机</h3>\n<p><img data-src=\"./assets/docker-containerized-and-vm-transparent-bg.png\" alt=\"docker-containerized-and-vm-transparent-bg\" /></p>\n<ol>\n<li>容器是应用层的抽象，它将代码和依赖关系打包在一起。 多个容器可以在同一台机器上运行，并与其他容器共享操作系统内核，每个容器在用户空间中作为独立进程运行。 容器占用的空间比 VM 少（容器映像的大小通常为几十 MB），可以处理更多的应用程序，并且需要更少的 VM 和操作系统。</li>\n<li>虚拟机（VM）是物理硬件的抽象，将一台服务器转变为多台服务器。 管理程序允许多台 VM 在单台机器上运行。 每个 VM 都包含操作系统的完整副本，应用程序，必要的二进制文件和库 - 占用数十 GB。 虚拟机也可能很慢启动。</li>\n</ol>\n<p><strong>总结一下：</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">特性</th>\n<th style=\"text-align:left\">容器</th>\n<th style=\"text-align:left\">虚拟机</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">启动</td>\n<td style=\"text-align:left\">秒级</td>\n<td style=\"text-align:left\">分钟级</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">硬盘使用</td>\n<td style=\"text-align:left\">一般为  <code>MB</code></td>\n<td style=\"text-align:left\">一般为  <code>GB</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">性能</td>\n<td style=\"text-align:left\">接近原生</td>\n<td style=\"text-align:left\">弱于</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">系统支持量</td>\n<td style=\"text-align:left\">单机支持上千个容器</td>\n<td style=\"text-align:left\">一般几十个</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">开发 / 环境定制</td>\n<td style=\"text-align:left\">方便 (命令行、面向对象式)</td>\n<td style=\"text-align:left\">进入虚拟机</td>\n</tr>\n</tbody>\n</table>\n<p><strong>相同点：</strong></p>\n<ol>\n<li>文件隔离 / 文件共享（沙箱）</li>\n<li>资源隔离</li>\n<li>网络隔离</li>\n<li>支持多种宿主环境（扩展）</li>\n<li>快照 / 镜像（版本控制 / 变更管理）</li>\n</ol>\n<p><strong>不同点：</strong></p>\n<ol>\n<li>不同的资源管理 / 依赖 // 释放（虚拟机占用更多的系统资源）</li>\n<li>不同的应用运行环境</li>\n<li>Docker 是写时复制</li>\n<li>不同的日志方式 (Docker 收集日志，而虚拟机需要在虚拟系统里面看日志)</li>\n<li>不同的交互方式 (Docker 偏 shell，虚拟机偏 GUI)</li>\n</ol>\n<h3 id=\"docker的工作原理重点\"><a class=\"anchor\" href=\"#docker的工作原理重点\">#</a> Docker 的工作原理 (重点)</h3>\n<p><img data-src=\"./assets/work.png\" alt=\"work\" /></p>\n<p>Docker 是容器化部署技术，它主要作用在于通过运行容器来实现应用部署，而容器基于镜像运行。</p>\n<p>简单地说，就是将你的项目和依赖包 (基础镜像) 打成一个带有启动指令的项目镜像，然后在服务器创建一个容器，让镜像在容器内运行，从而实现项目的部署。</p>\n<p>服务器就是容器的宿主机，docker 容器与宿主机之间是相互隔离的。</p>\n<p>Docker 的基础是 Linux 容器（LXC：Linux Containers）等技术。</p>\n<p><strong>一般情况下：</strong></p>\n<p>Linux (服务器) -&gt; tomcat 安装 -&gt; Java 依赖 -&gt; maven 依赖 -&gt; 放置在 /usr/lib 目录 -&gt; 配置 tomcat 端口 / 目录 -&gt; 运行 tomcat 中的 startup.sh 脚本 -&gt; 配置网络、防火墙等 (后续) -&gt; 服务启动</p>\n<p><strong>Docker：</strong></p>\n<p>使用基于 java 的 tomcat 镜像 -&gt; docker run -&gt; 指定端口 / 挂载 webapp 目录 -&gt; 服务启动</p>\n<p>这其中，发生了什么？</p>\n<ol>\n<li>\n<p>Docker 会自己拉取镜像，若本地已经存在该镜像，则不用到网上去拉取</p>\n</li>\n<li>\n<p>创建新的容器</p>\n</li>\n<li>\n<p>分配文件系统并且挂着一个可读写的层，任何修改容器的操作都会被记录在这个读写层上，你可以保存这些修改成新的镜像，也可以选择不保存，那么下次运行改镜像的时候所有修改操作都会被消除</p>\n</li>\n<li>\n<p>分配网络 \\ 桥接接口，创建一个允许容器与本地主机通信的网络接口</p>\n</li>\n<li>\n<p>设置 ip 地址，从池中寻找一个可用的 ip 地址附加到容器上，换句话说，localhost 并不能访问到容器</p>\n</li>\n<li>\n<p>运行你指定的程序</p>\n</li>\n<li>\n<p>捕获并且提供应用输出，包括输入、输出、报错信息</p>\n</li>\n</ol>\n<p>Docker 的价值：</p>\n<p>从应用架构角度：统一复杂的构建环境；</p>\n<p>从应用部署角度：解决依赖不同、构建麻烦的问题，结合自动化工具（如 jenkins）提高效率。</p>\n<p>从集群管理角度：规范的服务<strong>调度</strong>，<strong>服务发现</strong>，<strong>负载均衡</strong></p>\n<h2 id=\"常见的应用场景介绍\"><a class=\"anchor\" href=\"#常见的应用场景介绍\">#</a> 常见的应用场景介绍</h2>\n<p>Docker 提供了轻量级的虚拟化，相比于虚拟机，可以在同一台机器上创建更多数量的容器。它常见的应用场景：1. 快速部署；2. 隔离应用； 3. 提高开发效率； 4. 版本控制； 5. 简化配置，整合资源；</p>\n<h3 id=\"快速部署\"><a class=\"anchor\" href=\"#快速部署\">#</a> 快速部署</h3>\n<p>我们尝试着来部署一个 mysql：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> mysql-test <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">MYSQL_ROOT_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token number\">123456</span> mysql</pre></td></tr></table></figure><p><img data-src=\"./assets/3.gif\" alt=\"3\" /></p>\n<p>同样的道理，我们来部署一个 nginx:</p>\n<p><img data-src=\"./assets/4.gif\" alt=\"4\" /></p>\n<p>注意：这里没有映射服务端口，所以在 <code>80</code>  端口是看不到 <code>index.html</code>  中的内容的。需要加入 <code>-p</code>  参数来映射端口！！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> web <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8000</span>:80 <span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;your_dir&#125;</span>:/usr/share/nginx/html nginx</pre></td></tr></table></figure><h3 id=\"隔离应用\"><a class=\"anchor\" href=\"#隔离应用\">#</a> 隔离应用</h3>\n<p>我们可以同时跑两个 mysql，两个 nginx，指定不同的端口进行映射：</p>\n<p>把 <code>mysql-test1</code>  映射到 <code>8001</code>  端口，把 <code>mysql-test2</code>  映射到 <code>8002</code>  端口。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> mysql-test1 <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8001</span>:3306 <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">MYSQL_ROOT_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token number\">123456</span> mysql</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> mysql-test2 <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8002</span>:3306 <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">MYSQL_ROOT_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token number\">123456</span> mysql</pre></td></tr></table></figure><p>把 web1 映射到 8100 端口，把 web2 映射到 8200 端口。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> web1 <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8100</span>:80 <span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;your_dir&#125;</span>:/usr/share/nginx/html nginx</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> web2 <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8200</span>:80 <span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;your_dir&#125;</span>:/usr/share/nginx/html nginx</pre></td></tr></table></figure><h3 id=\"提高开发效率\"><a class=\"anchor\" href=\"#提高开发效率\">#</a> 提高开发效率</h3>\n<ol>\n<li>\n<p>一致的运行环境</p>\n<p>由于 Docker 确保了执行环境的一致性，使得应用的迁移更加容易。Docker 可以在很多平台上运行，无论是物理机、虚拟机、公有云、私有云，甚至是笔记本，其运行结果是一致的。因此用户可以很轻易的将在一个平台上运行的应用，迁移到另一个平台上，而不用担心运行环境的变化导致应用无法正常运行的情况。</p>\n</li>\n<li>\n<p>更快速的启动时间</p>\n</li>\n</ol>\n<p>传统的虚拟机技术启动应用服务往往需要数分钟，而 Docker 容器应用，由于直接运行于宿主内核，无需启动完整的操作系统，因此可以做到秒级、甚至毫秒级的启动时间。大大的节约了开发、测试、部署的时间。</p>\n<ol start=\"3\">\n<li>\n<p>更高效的复用系统资源</p>\n<p>由于容器不需要进行硬件虚拟以及运行完整操作系统等额外开销，Docker 对系统资源的利用率更高。无论是应用执行速度、内存损耗或者文件存储速度，都要比传统虚拟机技术更高效。因此，相比虚拟机技术，一个相同配置的主机，往往可以运行更多数量的应用。</p>\n</li>\n<li>\n<p>仓库 / 镜像机制</p>\n<p>使用仓库可以方便的在任何有 docker 进程的虚拟机 / 服务器 / 主机上运行 docker 应用，环境的统一，让它们的部署变的非常的简单。</p>\n</li>\n</ol>\n<h3 id=\"版本控制\"><a class=\"anchor\" href=\"#版本控制\">#</a> 版本控制</h3>\n<p>Docker 容器还可以像 git 仓库一样，可以让你提交变更到 Docker 镜像中并通过不同的版本来管理它们，来看看下面的例子：</p>\n<p>我们之前创建了一个 <code>mysql</code> ，现在，我们使用 <code>commit</code>  命令就可以给它做一个快照，打上一个 <code>tag</code> 。</p>\n<p><img data-src=\"./assets/5.gif\" alt=\"5\" /></p>\n<p>在后面的课程中，我们会详细的介绍<a href=\"#Docker%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4(%E9%87%8D%E7%82%B9)\"> Docker 的常见命令</a></p>\n<h3 id=\"devops流程\"><a class=\"anchor\" href=\"#devops流程\">#</a> DevOps 流程</h3>\n<p>对开发和运维（<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvRGV2T3Bz\">DevOps</span>）人员来说，最希望的就是一次创建或配置，可以在任意地方正常运行。</p>\n<p>使用 Docker 可以通过定制应用镜像来实现持续集成、持续交付、部署。开发人员可以通过 <span class=\"exturl\" data-url=\"aHR0cHM6Ly95ZWFzeS5naXRib29rcy5pby9kb2NrZXJfcHJhY3RpY2UvaW1hZ2UvZG9ja2VyZmlsZQ==\">Dockerfile</span> 来进行镜像构建，并结合 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29udGludW91c19pbnRlZ3JhdGlvbg==\">持续集成 (Continuous Integration)</span> 系统进行集成测试，而运维人员则可以直接在生产环境中快速部署该镜像，甚至结合 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29udGludW91c19kZWxpdmVyeQ==\">持续部署 (Continuous Delivery/Deployment)</span> 系统进行自动部署。</p>\n<p>而且使用  <code>Dockerfile</code>  使镜像构建透明化，不仅仅开发团队可以理解应用运行环境，也方便运维团队理解应用运行所需条件，帮助更好的生产环境中部署该镜像。</p>\n<h2 id=\"使用docker\"><a class=\"anchor\" href=\"#使用docker\">#</a> 使用 Docker</h2>\n<h3 id=\"docker如何进行安装\"><a class=\"anchor\" href=\"#docker如何进行安装\">#</a> Docker 如何进行安装</h3>\n<h4 id=\"关于系统需求重点\"><a class=\"anchor\" href=\"#关于系统需求重点\">#</a> 关于系统需求 (重点)</h4>\n<ol>\n<li>平台类</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">操作系统</th>\n<th style=\"text-align:center\">x86_64</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZG9ja2VyLWZvci1tYWMvaW5zdGFsbC8=\">Docker Desktop for Mac (macOS)</span></td>\n<td style=\"text-align:center\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZG9ja2VyLWZvci13aW5kb3dzL2luc3RhbGwv\">Docker Desktop for Windows (Microsoft Windows 10)</span></td>\n<td style=\"text-align:center\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></td>\n</tr>\n</tbody>\n</table>\n<ol start=\"2\">\n<li>服务器</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">平台</th>\n<th style=\"text-align:left\">x86_64 / amd64</th>\n<th style=\"text-align:left\">ARM</th>\n<th style=\"text-align:left\">ARM64 / AARCH64</th>\n<th style=\"text-align:left\">IBM Power (ppc64le)</th>\n<th style=\"text-align:left\">IBM Z (s390x)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vaW5zdGFsbC9saW51eC9kb2NrZXItY2UvY2VudG9zLw==\">CentOS</span></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/centos/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/centos/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vaW5zdGFsbC9saW51eC9kb2NrZXItY2UvZGViaWFuLw==\">Debian</span></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/debian/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/debian/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/debian/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vaW5zdGFsbC9saW51eC9kb2NrZXItY2UvZmVkb3JhLw==\">Fedora</span></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/fedora/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/fedora/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vaW5zdGFsbC9saW51eC9kb2NrZXItY2UvdWJ1bnR1Lw==\">Ubuntu</span></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/ubuntu/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/ubuntu/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/ubuntu/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/ubuntu/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/ubuntu/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"linux重点\"><a class=\"anchor\" href=\"#linux重点\">#</a> Linux (重点)</h4>\n<p>对于中国用户：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSL</span> https://get.docker.com <span class=\"token operator\">|</span> <span class=\"token function\">bash</span> <span class=\"token parameter variable\">-s</span> <span class=\"token function\">docker</span> <span class=\"token parameter variable\">--mirror</span> Aliyun</pre></td></tr></table></figure><p>对于国外 vps：</p>\n<pre><code>curl -fsSL https://get.docker.com -o get-docker.sh\nsh get-docker.sh\n</code></pre>\n<blockquote>\n<p>脚本介绍：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RvY2tlci9kb2NrZXItaW5zdGFsbA==\">https://github.com/docker/docker-install</span></p>\n</blockquote>\n<h4 id=\"windows\"><a class=\"anchor\" href=\"#windows\">#</a> Windows</h4>\n<p>安装 Docker 的系统需求：</p>\n<ul>\n<li>系统版本：Windows 10 64bit: Pro, Enterprise or Education (Build 15063 or later).</li>\n<li>在 BIOS 中开启了虚拟化（virtualization），正常情况下会默认开启，去系统管理中看看有没有 Hyper-v 被安装了。</li>\n<li>CPU 特性：SLAT-capable.</li>\n<li>4GB 以上的内存</li>\n</ul>\n<blockquote>\n<p>如果不满足上面的需求，则需要使用<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vdG9vbGJveC9vdmVydmlldy8=\"> Docker Toolbox</span>，相当于是运行了一个 virtualbox 的虚拟镜像。</p>\n</blockquote>\n<h4 id=\"macos\"><a class=\"anchor\" href=\"#macos\">#</a> MacOS</h4>\n<p><strong>方法一官方 <code>dmg</code> ：</strong></p>\n<p>官方下载地址：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9lZGl0aW9ucy9jb21tdW5pdHkvZG9ja2VyLWNlLWRlc2t0b3AtbWFj\">Docker Descktop for Mac</span></p>\n<p>对系统的要求：</p>\n<blockquote>\n<p>Requires Apple Mac OS Sierra 10.12 or above. Download <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vdG9vbGJveC9vdmVydmlldy8=\">Docker Toolbox</span> for previous OS versions.</p>\n</blockquote>\n<p>只要系统是 Mac OS Sierra 10.12 以上即可。</p>\n<p>下载完 <code>Docker.dmg</code>  安装包之后，双击即可以安装，可能需要系统管理员权限，输入密码即可。</p>\n<p>运行过后，小图标：</p>\n<p><img data-src=\"./assets/2.gif\" alt=\"2\" /></p>\n<p>安装完之后，在终端工具中，使用 <code>docker version</code>  来查看 Docker 版本。</p>\n<p><img data-src=\"./assets/docker-version.jpg\" alt=\"docker-version\" /></p>\n<p><strong>方法二 brew cask：</strong></p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>brew update </pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>brew cask <span class=\"token function\">install</span> <span class=\"token function\">docker</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 删除的方法，还需要手动删除 Docker.app</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>brew cask uninstall <span class=\"token function\">docker</span></pre></td></tr></table></figure><p>上面的命令将会把 Docker 安装在 <code>Applications</code>  目录下。</p>\n<h3 id=\"docker国内加速\"><a class=\"anchor\" href=\"#docker国内加速\">#</a> Docker 国内加速</h3>\n<ol>\n<li>Docker 的 Toolbox 镜像站 (推荐)，主要是针对低版本的 windows 与 mac 用户：</li>\n</ol>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL21pcnJvcnMuYWxpeXVuLmNvbS9kb2NrZXItdG9vbGJveC8=\">http://mirrors.aliyun.com/docker-toolbox/</span></p>\n<ol start=\"2\">\n<li>Docker 镜像加速，主要是对 <code>docker pull</code>  拉取镜像操作进行网络加速优化：</li>\n</ol>\n<p>需要注册阿里云的账号，登录<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jci5jb25zb2xlLmFsaXl1bi5jb20v\">容器 Hub 服务</span>，在左侧的加速器帮助页面就会显示为你独立分配的加速地址。</p>\n<p><img data-src=\"./assets/image-20190524172015448.png\" alt=\"image-20190524172015448\" /></p>\n<h3 id=\"第一个docker应用hello-world\"><a class=\"anchor\" href=\"#第一个docker应用hello-world\">#</a> 第一个 Docker 应用 hello world</h3>\n<ol>\n<li>\n<p>查看 docker 版本</p>\n</li>\n<li>\n<p>运行第一个 Docker 应用</p>\n<p>使用 <code>docker run</code>  命令</p>\n</li>\n<li>\n<p>查看容器运行状态</p>\n<p>使用 <code>docker ps</code>  命令来查看正在运行的容器的状态， <code>-a</code>  参数来查看所有的已经运行的容器 (无论是否停止)</p>\n</li>\n</ol>\n<p><img data-src=\"./assets/1.gif\" alt=\"1\" /></p>\n<h3 id=\"docker常见命令重点\"><a class=\"anchor\" href=\"#docker常见命令重点\">#</a> Docker 常见命令 (重点)</h3>\n<ul>\n<li>\n<p><strong>创建 <code>run</code> </strong>， <code>-p</code>  映射宿主机的端口给镜像服务使用， <code>-v</code>  挂载宿主机的文件目录到镜像里面去，-it 是提供交互式的终端工具， <code>-d</code>  是让镜像容器在后台去持续运行， <code>--name</code>  指定容器的名称，exec 可以进入到容器里面去：</p>\n<pre><code>docker exec -it &lt;container_name&gt; /bin/bash\n\ndocker exec -it &lt;container_name&gt; /bin/sh\n</code></pre>\n</li>\n<li>\n<p><strong>启动 <code>start</code>  / 停止 <code>stop</code>  / 重启 <code>restart</code>  / 删除已停止容器 <code>rm</code> </strong></p>\n</li>\n<li>\n<p><strong>登录仓库 <code>login</code>  / 拉取镜像 <code>pull</code>  / 推送 <code>push</code>  / 提交镜像 <code>commit</code>  / 给指定容器标签 <code>tag</code> </strong></p>\n<p>docker hub 上去注册我们的账号，才能使用 login</p>\n<p>使用 docker commit 来给运行中的容器打 tag:</p>\n<pre><code>docker commit &lt;container_id&gt; &lt;namespace&gt;/&lt;image_name&gt;:tag\n</code></pre>\n<pre><code>docker commit e12b80defe8c itcast/mysql\n</code></pre>\n<p>使用 <code>pull</code> / <code>push</code>  命令来推送本地的镜像到远程仓库</p>\n<pre><code>docker pull/push &lt;namespace&gt;/&lt;image_name&gt;:tag\n</code></pre>\n</li>\n<li>\n<p>查看所有本地镜像 <code>images</code>  / 删除本地镜像 <code>rmi</code></p>\n<p>删除镜像之前，要停止 <code>stop</code>  并且删除 <code>rm</code>  运行中的容器。</p>\n</li>\n<li>\n<p>查看容器服务打印的日志 <code>logs</code>  / 检阅容器 <code>inspect</code>  (更详细的容器信息，硬件 / 网络 / 版本等)/ 进入容器 <code>exec</code></p>\n</li>\n<li>\n<p>查看版本 <code>version</code> /docker 进程信息 <code>info</code></p>\n</li>\n<li>\n<p>查看命令帮助：</p>\n</li>\n</ul>\n<pre><code>docker &lt;run/pull&gt; --help\n</code></pre>\n<h2 id=\"扩展知识\"><a class=\"anchor\" href=\"#扩展知识\">#</a> 扩展知识</h2>\n<h3 id=\"制作docker镜像重点\"><a class=\"anchor\" href=\"#制作docker镜像重点\">#</a> 制作 Docker 镜像 (重点)</h3>\n<p>Dockerfile 是一个由一堆命令 + 参数构成的脚本，使用  <code>docker build</code>  即可执行脚本构建镜像，自动的去做一些事，主要用于进行持续集成。</p>\n<p>一般，Dockerfile 共包括四部分：</p>\n<ul>\n<li>基础镜像信息</li>\n<li>维护者信息</li>\n<li>镜像操作指令</li>\n<li>容器启动时执行指令</li>\n</ul>\n<p>当 Node.js 遇见 Docker，下面介绍 Docker 在前端中的应用：</p>\n<p>一个简单的 Koa 应用：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> Koa <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'koa'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Koa</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// response</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token string\">'Hello Koa!!'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>Dockerfile 示例：</p>\n<figure class=\"highlight dockerfile\"><figcaption data-lang=\"Docker\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> node:10</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">LABEL</span> maintainer=itheima@itcast.cn</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 创建 app 目录</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> /app</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 把 package.json，package-lock.json (npm@5+) 或 yarn.lock 复制到工作目录 (相对路径)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">COPY</span> [<span class=\"token string\">\"package.json\"</span>,<span class=\"token string\">\"*.lock\"</span>,<span class=\"token string\">\"./\"</span>]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 打包 app 源码</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># 特别注意：要指定工作目录中的文件名</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">COPY</span> src ./src</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># 使用.dockerignore 文件，上面两个 COPY 合并成一个</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># COPY . .</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># 使用 Yarn 安装 app 依赖</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># 如果你需要构建生产环境下的代码，请使用：</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\"># --prod 参数</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">RUN</span> yarn --prod --registry=https://registry.npm.taobao.org</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># 对外暴露端口 -p 4000:3000</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">EXPOSE</span> 3000</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">CMD</span> [ <span class=\"token string\">\"node\"</span>, <span class=\"token string\">\"src/index.js\"</span> ]</span></pre></td></tr></table></figure><p>使用 <code>docker build</code>  打包：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> <span class=\"token variable\">$&#123;your_name&#125;</span>/<span class=\"token variable\">$&#123;image_name&#125;</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$&#123;tag&#125;</span> <span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><p>这里的 <code>your_name</code>  代表的是远程仓库中的用户名，或者仓库地址； <code>image_name</code>  为镜像名称， <code>tag</code>  是给镜像打的标签，用于版本控制。例如：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> itheima/node-demo:1.0 <span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><p>打包过程：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> itheima/node-demo:1.0 <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Sending build context to Docker daemon  <span class=\"token number\">17</span>.92kB</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Step <span class=\"token number\">1</span>/8 <span class=\"token builtin class-name\">:</span> FROM node:10</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> ---<span class=\"token operator\">></span> 5a401340b79f</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Step <span class=\"token number\">2</span>/8 <span class=\"token builtin class-name\">:</span> LABEL <span class=\"token assign-left variable\">maintainer</span><span class=\"token operator\">=</span>itheima@itcast.cn</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> ---<span class=\"token operator\">></span> Using cache</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> ---<span class=\"token operator\">></span> dd01419f30d5</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Step <span class=\"token number\">3</span>/8 <span class=\"token builtin class-name\">:</span> WORKDIR /app</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> ---<span class=\"token operator\">></span> Using cache</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> ---<span class=\"token operator\">></span> bb9a44851ec9</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Step <span class=\"token number\">4</span>/8 <span class=\"token builtin class-name\">:</span> COPY <span class=\"token builtin class-name\">.</span> <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> ---<span class=\"token operator\">></span> Using cache</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> ---<span class=\"token operator\">></span> b08ff37c5456</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>Step <span class=\"token number\">5</span>/8 <span class=\"token builtin class-name\">:</span> RUN <span class=\"token function\">ls</span> <span class=\"token parameter variable\">-la</span> /app</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> ---<span class=\"token operator\">></span> Using cache</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> ---<span class=\"token operator\">></span> 4e0e57e807a1</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>Step <span class=\"token number\">6</span>/8 <span class=\"token builtin class-name\">:</span> RUN <span class=\"token function\">yarn</span> <span class=\"token parameter variable\">--prod</span> <span class=\"token parameter variable\">--registry</span><span class=\"token operator\">=</span>https://registry.npm.taobao.org</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> ---<span class=\"token operator\">></span> Using cache</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> ---<span class=\"token operator\">></span> 96ab842b4766</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>Step <span class=\"token number\">7</span>/8 <span class=\"token builtin class-name\">:</span> EXPOSE <span class=\"token number\">3000</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre> ---<span class=\"token operator\">></span> Using cache</pre></td></tr><tr><td data-num=\"22\"></td><td><pre> ---<span class=\"token operator\">></span> 505dda4e680f</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>Step <span class=\"token number\">8</span>/8 <span class=\"token builtin class-name\">:</span> CMD <span class=\"token punctuation\">[</span> <span class=\"token string\">\"node\"</span>, <span class=\"token string\">\"src/index.js\"</span> <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre> ---<span class=\"token operator\">></span> Using cache</pre></td></tr><tr><td data-num=\"25\"></td><td><pre> ---<span class=\"token operator\">></span> f60e25a577de</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>Successfully built f60e25a577de</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>Successfully tagged itheima/node-demo:1.0</pre></td></tr></table></figure><p><strong>回顾前面的知识：</strong></p>\n<p>如何使用？</p>\n<p>还记得 <code>docker run</code>  命令吗？</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> nodedemo <span class=\"token parameter variable\">-p</span> <span class=\"token number\">3000</span>:3000 itheima/node-demo:1.0</pre></td></tr></table></figure><p>然后使用 <code>docker ps</code>  来看运行状态</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> nodedemo <span class=\"token parameter variable\">-p</span> <span class=\"token number\">3000</span>:3000 itheima/node-demo:1.0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>c863da9afea1558593843233aec08989184d8dafbb0f8443830d1e523104ab00</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>$ <span class=\"token function\">docker</span> <span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>CONTAINER ID        IMAGE                   COMMAND               CREATED             STATUS              PORTS                    NAMES</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>c863da9afea1        itheima/node-demo:1.0   <span class=\"token string\">\"node src/index.js\"</span>   <span class=\"token number\">2</span> seconds ago       Up <span class=\"token number\">1</span> second         <span class=\"token number\">0.0</span>.0.0:3000-<span class=\"token operator\">></span><span class=\"token number\">3000</span>/tcp   nodedemo</pre></td></tr></table></figure><h3 id=\"docker-compose介绍\"><a class=\"anchor\" href=\"#docker-compose介绍\">#</a> Docker-compose 介绍</h3>\n<p>通过 Docker-Compose 用户可以很容易地用一个配置文件定义一个多容器的应用，然后使用一条指令安装这个应用的所有依赖，完成构建。Docker-Compose 解决了容器与容器之间如何管理编排的问题。</p>\n<p><img data-src=\"./assets/docker-compose.png\" alt=\"docker-compose\" /></p>\n<p>Compose 中有两个重要的概念：</p>\n<ul>\n<li>服务 (service) ：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。</li>\n<li>项目 (project) ：由一组关联的应用容器组成的一个完整业务单元，在 docker-compose.yml 文件中定义。</li>\n</ul>\n<p>Docker Compose 是 Docker 的独立产品，因此需要安装 Docker 之后在单独安装 Docker Compose .</p>\n<p><strong>安装方法：</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#下载</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-L</span> https://github.com/docker/compose/releases/download/1.20.0/docker-compose-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-s</span><span class=\"token variable\">`</span></span>-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-m</span><span class=\"token variable\">`</span></span> <span class=\"token parameter variable\">-o</span> /usr/local/bin/docker-compose</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#安装</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">chmod</span> +x /usr/local/bin/docker-compose</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#查看版本</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">docker-compose</span> <span class=\"token parameter variable\">--version</span></pre></td></tr></table></figure><p><strong>常见使用：</strong></p>\n<p>前面的例子，使用 <code>docker-compose</code>  改写：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">mysql</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mysql</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">-</span>mysql</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8000:3306\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">-</span> MYSQL_ROOT_PASSWORD=123456</pre></td></tr></table></figure><p>在此文件的当前目录下，使用 <code>docker-compose up -d</code>  来执行。</p>\n<p>生命周期管理：</p>\n<p>创建： <code>run</code> / <code>up</code></p>\n<p>启动 / 停止 / 删除 / 重启： <code>start/stop/rm/restart</code></p>\n<p>检视 / 日志： <code>logs</code> / <code>ps</code></p>\n<p>看两个个复杂的应用：</p>\n<p>搭建本地 mongo + mongo-express 服务</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.1'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">mongo</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mongo</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">MONGO_INITDB_ROOT_USERNAME</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">MONGO_INITDB_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123456</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">mongo-express</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mongo<span class=\"token punctuation\">-</span>express</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">-</span> 8081<span class=\"token punctuation\">:</span><span class=\"token number\">8081</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token key atrule\">ME_CONFIG_MONGODB_ADMINUSERNAME</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">ME_CONFIG_MONGODB_ADMINPASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123456</span></pre></td></tr></table></figure><p>给公司搭建一个 git 服务器吧？！</p>\n<p>项目地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NhbWVlcnNibi9kb2NrZXItZ2l0bGFi\">https://github.com/sameersbn/docker-gitlab</span></p>\n<p>推荐服务器配置：适用于 10 人的小团队～～～～</p>\n<p>2core</p>\n<p>2GB+2GB(swap)</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'2'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">redis</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> sameersbn/redis<span class=\"token punctuation\">:</span>4.0.9<span class=\"token punctuation\">-</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>loglevel warning</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">-</span> /srv/docker/gitlab/redis<span class=\"token punctuation\">:</span>/var/lib/redis<span class=\"token punctuation\">:</span>Z</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">postgresql</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> sameersbn/postgresql<span class=\"token punctuation\">:</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">-</span> /srv/docker/gitlab/postgresql<span class=\"token punctuation\">:</span>/var/lib/postgresql<span class=\"token punctuation\">:</span>Z</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_USER=gitlab</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_PASS=password</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_NAME=gitlabhq_production</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_EXTENSION=pg_trgm</pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token key atrule\">gitlab</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> sameersbn/gitlab<span class=\"token punctuation\">:</span>11.11.0</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">-</span> redis</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">-</span> postgresql</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"10080:80\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"10022:22\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">-</span> /srv/docker/gitlab/gitlab<span class=\"token punctuation\">:</span>/home/git/data<span class=\"token punctuation\">:</span>Z</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">-</span> DEBUG=false</pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_ADAPTER=postgresql</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_HOST=postgresql</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_PORT=5432</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_USER=gitlab</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_PASS=password</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_NAME=gitlabhq_production</pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">-</span> REDIS_HOST=redis</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">-</span> REDIS_PORT=6379</pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">-</span> TZ=Asia/Kolkata</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_TIMEZONE=Kolkata</pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_HTTPS=false</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">-</span> SSL_SELF_SIGNED=false</pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_HOST=localhost</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_PORT=10080</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SSH_PORT=10022</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_RELATIVE_URL_ROOT=</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SECRETS_DB_KEY_BASE=long<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>random<span class=\"token punctuation\">-</span>alphanumeric<span class=\"token punctuation\">-</span>string</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SECRETS_SECRET_KEY_BASE=long<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>random<span class=\"token punctuation\">-</span>alphanumeric<span class=\"token punctuation\">-</span>string</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SECRETS_OTP_KEY_BASE=long<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>random<span class=\"token punctuation\">-</span>alphanumeric<span class=\"token punctuation\">-</span>string</pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_ROOT_PASSWORD=123456</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_ROOT_EMAIL=itheima@itcast.cn</pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token punctuation\">...</span></pre></td></tr></table></figure><p>docker-compose 在前端里面的使用：</p>\n<p>Nodejs + mongodb + koa + vue 的应用组合：</p>\n<p>特别注意：</p>\n<p>视频中，我们使用 vue 是在局部安装的，所以使用 npx 命令在进行创建。</p>\n<p>vue 官网推荐大家进行全局安装:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> i <span class=\"token parameter variable\">-g</span> @vue/cli</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 然后使用</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>vue create myproject</pre></td></tr></table></figure><p>docker-compose.yml</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">web</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> web<span class=\"token punctuation\">:</span><span class=\"token number\">1.0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8080:80\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> server<span class=\"token punctuation\">:</span><span class=\"token number\">1.0</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"3000:3000\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">-</span> mongodb</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">links</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">-</span> mongodb<span class=\"token punctuation\">:</span>db</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token key atrule\">mongodb</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mongo</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token key atrule\">MONGO_INITDB_ROOT_USERNAME</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token key atrule\">MONGO_INITDB_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123456</span></pre></td></tr></table></figure><p><code>depends_on</code>  决定了容器加载的先后顺序，这里 <code>mongdb</code> 、 <code>web</code>  先加载， <code>mongdb</code>  创建完成之后，再来创建 <code>server</code> 。</p>\n<h3 id=\"自学补充知识\"><a class=\"anchor\" href=\"#自学补充知识\">#</a> 自学补充知识</h3>\n<ol>\n<li>什么是 Kubernetes?</li>\n</ol>\n<p>Kubernetes, 中文意思是舵手或导航员，它是一个容器集群管理系统，主要职责是容器编排（Container Orchestration）—— 启动容器，自动化部署、扩展和管理容器应用，还有回收容器。</p>\n<p>文档: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9rdWJlcm5ldGVzLmlvL3poLw==\">https://kubernetes.io/zh/</span></p>\n<p>集群相关：<span class=\"exturl\" data-url=\"aHR0cDovL21lc29zLmFwYWNoZS5vcmcv\">Mesos</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RvY2tlci9zd2FybQ==\">Docker Swarm</span></p>\n<ol start=\"2\">\n<li>简单的 DevOps 流程介绍：</li>\n</ol>\n<p><img data-src=\"./assets/devOps-8692746.jpeg\" alt=\"devOps\" /></p>\n<p>参考链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvYXJ0aWNsZS8xMDcwNDY1\">从一张图看 Devops 全流程</span></p>\n<ol start=\"3\">\n<li>Docker 中的文件系统，深入理解原理：</li>\n</ol>\n<p><img data-src=\"./assets/%E4%B8%80%E5%9B%BE%E7%9C%8B%E5%B0%BDDocker%E5%AE%B9%E5%99%A8%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F.png\" alt=\"一图看尽Docker容器文件系统\" /></p>\n<ol start=\"4\">\n<li>\n<p>Docker 的一般开发流程介绍：</p>\n<ul>\n<li>寻找基础镜像</li>\n<li>基于基础镜像编写 Dockerfile 脚本</li>\n<li>根据 Dockerfile 脚本创建项目镜像</li>\n<li>将创建的镜像推送到 docker 仓库 (根据自身需要，可做可不做)</li>\n<li>基于项目镜像创建并运行 docker 容器 (实现最终部署)</li>\n</ul>\n<p>这里面如果一扩展，就变成了自动化开发流程，比如：加入版本控制 git -&gt; 使用 webhook -&gt; jenkins 自动打包  -&gt; docker 自动构建 -&gt; 推送镜像 -&gt; 生产环境部署</p>\n</li>\n</ol>\n<h2 id=\"课程资源\"><a class=\"anchor\" href=\"#课程资源\">#</a> 课程资源</h2>\n<p>Docker for Mac【系统：10.12 以上】: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb3dubG9hZC5kb2NrZXIuY29tL21hYy9zdGFibGUvRG9ja2VyLmRtZw==\">https://download.docker.com/mac/stable/Docker.dmg</span></p>\n<p>Docker for Windows【系统：专业版及企业版】: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb3dubG9hZC5kb2NrZXIuY29tL3dpbi9zdGFibGUvRG9ja2VyJTIwZm9yJTIwV2luZG93cyUyMEluc3RhbGxlci5leGU=\">https://download.docker.com/win/stable/Docker for Windows Installer.exe</span></p>\n<p>Docker ToolBox for Mac【系统：10.10.3 以上】: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb3dubG9hZC5kb2NrZXIuY29tL21hYy9zdGFibGUvRG9ja2VyVG9vbGJveC5wa2c=\">https://download.docker.com/mac/stable/DockerToolbox.pkg</span></p>\n<p>Docker ToolBox for Windows【系统：windows7 以上】：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb3dubG9hZC5kb2NrZXIuY29tL3dpbi9zdGFibGUvRG9ja2VyVG9vbGJveC5leGU=\">https://download.docker.com/win/stable/DockerToolbox.exe</span></p>\n",
            "tags": [
                "容器化运维操作",
                "容器化运维操作"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/02/02/%E4%BD%BF%E7%94%A8Jenkins%E9%85%8D%E5%90%88github%20hook%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/",
            "url": "https://dmqweb.cn/2024/02/02/%E4%BD%BF%E7%94%A8Jenkins%E9%85%8D%E5%90%88github%20hook%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/",
            "title": "jenkins配合git hook持续集成",
            "date_published": "2024-02-02T06:04:04.000Z",
            "content_html": "<h2 id=\"环境\"><a class=\"anchor\" href=\"#环境\">#</a> 环境</h2>\n<ul>\n<li>Centos 7.4</li>\n<li>JDK 1.8</li>\n</ul>\n<h2 id=\"主要步骤\"><a class=\"anchor\" href=\"#主要步骤\">#</a> 主要步骤</h2>\n<p>以下包含相关所有的步骤，可根据现有环境进行跳过</p>\n<ol>\n<li>安装 JDK</li>\n<li>安装 Centos</li>\n<li>Jenkins 和 Github 配置</li>\n<li>配置任务</li>\n</ol>\n<h3 id=\"安装jdk\"><a class=\"anchor\" href=\"#安装jdk\">#</a> 安装 JDK</h3>\n<p>Jenkins 需要 JDK 才可以运行，我们首先安装 JDK</p>\n<h4 id=\"下载\"><a class=\"anchor\" href=\"#下载\">#</a> 下载</h4>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5vcmFjbGUuY29tL3RlY2huZXR3b3JrL2phdmEvamF2YXNlL2Rvd25sb2Fkcy9qZGs4LWRvd25sb2Fkcy0yMTMzMTUxLmh0bWw=\">下载链接查看地址</span></p>\n<p>首先点击 Accept License Agreement，选择 Linux 对应版本</p>\n<p><strong>注</strong>若想要直接获取下载链接，使用 wget 进行下载是不行的，我们可以先点击链接进行下载，然后在 chrome 中的下载任务中查看下载链接进行复制。</p>\n<pre><code>cd /usr/local/src\nwget `your download url`\n</code></pre>\n<h4 id=\"解压\"><a class=\"anchor\" href=\"#解压\">#</a> 解压</h4>\n<pre><code>tar -zxvf jdk-8u91-linux-x64.tar.gz\n</code></pre>\n<h4 id=\"环境变量\"><a class=\"anchor\" href=\"#环境变量\">#</a> 环境变量</h4>\n<p>将以下内容追加到 /etc/profile 末尾，替换你对应的解压路径</p>\n<pre><code>JAVA_HOME=/usr/local/tools/jdk1.8.0_144\n\nJRE_HOME=$JAVA_HOME/jre\n\nPATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin\n\nCLASSPATH=:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib/dt.jar\n\nexport JAVA_HOME JRE_HOME PATH CLASSPATH\n</code></pre>\n<h4 id=\"启用配置\"><a class=\"anchor\" href=\"#启用配置\">#</a> 启用配置</h4>\n<pre><code>source /etc/profile\n</code></pre>\n<h4 id=\"查看版本\"><a class=\"anchor\" href=\"#查看版本\">#</a> 查看版本</h4>\n<pre><code>java -version\n</code></pre>\n<h3 id=\"安装centos\"><a class=\"anchor\" href=\"#安装centos\">#</a> 安装 Centos</h3>\n<p>使用 yum 进行安装</p>\n<pre><code>#安装自动选择最快源的插件\n$ yum install yum-fastestmirror -y\n#添加Jenkins源:\n$ sudo wget -O /etc/yum.repos.d/jenkins.repo http://jenkins-ci.org/redhat/jenkins.repo\n$ sudo rpm --import http://pkg.jenkins-ci.org/redhat/jenkins-ci.org.key\n #安装jenkins\n$ yum install jenkins\n</code></pre>\n<h4 id=\"启动\"><a class=\"anchor\" href=\"#启动\">#</a> 启动</h4>\n<pre><code>service jenkins start\n</code></pre>\n<h4 id=\"更改端口\"><a class=\"anchor\" href=\"#更改端口\">#</a> 更改端口</h4>\n<pre><code>vim /etc/sysconfig/jenkins\nservice jenkins restart\n</code></pre>\n<h3 id=\"jenkins和github配置\"><a class=\"anchor\" href=\"#jenkins和github配置\">#</a> Jenkins 和 Github 配置</h3>\n<p>这里的配置就比较多了，主要是在 github 上生成 key, 然后在 Jenkins 与项目进行绑定即可</p>\n<h4 id=\"初始化jenkins\"><a class=\"anchor\" href=\"#初始化jenkins\">#</a> 初始化 Jenkins</h4>\n<p>这几步非常简单，按照提示进行即可</p>\n<ol>\n<li>访问你的 IP:8080</li>\n<li>cat /var/lib/jenkins/secrets/initialAdminPassword 把密码输入进去</li>\n<li>Install suggested plugins 进行安装</li>\n<li>设置账户密码</li>\n</ol>\n<h3 id=\"配置github-webhooks\"><a class=\"anchor\" href=\"#配置github-webhooks\">#</a> 配置 Github webhooks</h3>\n<h4 id=\"在对项目有写权限的用户上获取token\"><a class=\"anchor\" href=\"#在对项目有写权限的用户上获取token\">#</a> 在对项目有写权限的用户上获取 token</h4>\n<p>进入 github –&gt; setting –&gt; Personal Access Token –&gt; Generate new token</p>\n<p><a href=\"http://callmedadaxin.github.io/images/jenkins-1.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-1.png\" alt=\"img\" /></a></p>\n<p>点击保存，获取 token, 并<strong>保存好你的 token</strong></p>\n<h4 id=\"设置webhooks\"><a class=\"anchor\" href=\"#设置webhooks\">#</a> 设置 webhooks</h4>\n<p>进入 GitHub 上指定的项目 –&gt; setting –&gt; WebHooks&amp;Services –&gt; add webhook –&gt; 输入刚刚部署 jenkins 的服务器的 IP</p>\n<p><a href=\"http://callmedadaxin.github.io/images/jenkins-2.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-2.png\" alt=\"img\" /></a></p>\n<h3 id=\"配置jenkins的git-plugin\"><a class=\"anchor\" href=\"#配置jenkins的git-plugin\">#</a> 配置 Jenkins 的 Git Plugin</h3>\n<p>新版 Jenkins 在初始的时候已经默认安装了 Git Plugin 和相关依赖的 Plugin，我们不用在重复进行安装，直接配置即可</p>\n<p>系统管理 –&gt; 系统设置 –&gt; GitHub –&gt; Add GitHub Sever</p>\n<p>填写 API URL 为<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS8=\"> https://api.github.com</span></p>\n<p><a href=\"http://callmedadaxin.github.io/images/jenkins-3.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-3.png\" alt=\"img\" /></a></p>\n<p>点击旁边的 Add 按钮，添加 Secret Text<br />\n<a href=\"http://callmedadaxin.github.io/images/jenkins-4.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-4.png\" alt=\"img\" /></a></p>\n<h3 id=\"配置任务\"><a class=\"anchor\" href=\"#配置任务\">#</a> 配置任务</h3>\n<h3 id=\"1新建\"><a class=\"anchor\" href=\"#1新建\">#</a> 1. 新建</h3>\n<p>回到主页 –&gt; 新建任务 –&gt; 新建一个自由风格的软件项目</p>\n<p><a href=\"http://callmedadaxin.github.io/images/jenkins-5.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-5.png\" alt=\"img\" /></a></p>\n<h3 id=\"2配置源码管理\"><a class=\"anchor\" href=\"#2配置源码管理\">#</a> 2. 配置源码管理</h3>\n<p><a href=\"http://callmedadaxin.github.io/images/jenkins-6.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-6.png\" alt=\"img\" /></a></p>\n<h3 id=\"3构建触发器构建环境\"><a class=\"anchor\" href=\"#3构建触发器构建环境\">#</a> 3. 构建触发器，构建环境</h3>\n<p><a href=\"http://callmedadaxin.github.io/images/jenkins-7.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-7.png\" alt=\"img\" /></a></p>\n<h3 id=\"4编写你的构建脚本\"><a class=\"anchor\" href=\"#4编写你的构建脚本\">#</a> 4. 编写你的构建脚本</h3>\n<p><a href=\"http://callmedadaxin.github.io/images/jenkins-8.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-8.png\" alt=\"img\" /></a></p>\n<p>保存，应用</p>\n<h2 id=\"问题记录\"><a class=\"anchor\" href=\"#问题记录\">#</a> 问题记录</h2>\n<ul>\n<li>项目会自动 clone 在 /var/lib/jenkins/workspace/</li>\n<li>执行的全局脚本确定已经软链到 /usr/bin, 否则访问不到</li>\n</ul>\n",
            "tags": [
                "jenkins配合git hook持续集成",
                "jenkins",
                "github hook"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/02/02/serviceWorker/",
            "url": "https://dmqweb.cn/2024/02/02/serviceWorker/",
            "title": "serviceWorker",
            "date_published": "2024-02-02T04:24:04.000Z",
            "content_html": "<h2 id=\"serviceworkerhtml\"><a class=\"anchor\" href=\"#serviceworkerhtml\">#</a> serviceWorker.html</h2>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Document<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 数据库</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>indexedDB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">//service worker</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">//service Worker 是后台运行的脚本，充当一个代理服务器，拦截用户发出的网络请求。还可以修改用户的请求或者直接向用户发出回应，使得用户可以在离线情况下使用网络应用。还可以在本地缓存资源文件，加快访问速度。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token string\">'serviceWorker'</span> <span class=\"token keyword\">in</span> navigator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>             window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'load'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>             navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./service-worker.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./service-worker.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">'注册成功'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'注册失败'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">// 为了节省内存，当 service-Worker 不使用时是休眠的，他也不回保存数据，所以重新启动时，为了拿到数据需要将数据放在 IndexedDb 中</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// 服务端部署消息，监听代码</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span><span class=\"token parameter\">data</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>source<span class=\"token operator\">===</span><span class=\"token string\">'service-worker'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>msg<span class=\"token punctuation\">,</span><span class=\"token string\">'serviceWorker发送来的消息'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"serviceworkerjs\"><a class=\"anchor\" href=\"#serviceworkerjs\">#</a> serviceWorker.js</h2>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//serviceWorker 是基于事件驱动的。</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//serviceWorker 安装事件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span><span class=\"token parameter\">event</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span><span class=\"token string\">'安装事件'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">'安装完成'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//serviceWorker 激活事件（当安装完成之后就开始激活）</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'active'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">let</span> cacheWhiteList <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'product-v2'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        caches<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cacheNames</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                cacheNames<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cacheName</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>cacheWhiteList<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>cacheName<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                        <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>cacheName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">//serviceWorker 与网页的通信</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'active'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        self<span class=\"token punctuation\">.</span>clients<span class=\"token punctuation\">.</span><span class=\"token function\">matchAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">client</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token literal-property property\">msg</span><span class=\"token operator\">:</span><span class=\"token string\">\"Hello serviceWorker\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token literal-property property\">source</span><span class=\"token operator\">:</span><span class=\"token string\">\"serviceWorker\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure>",
            "tags": [
                "JS",
                "JS",
                "serviceWorker"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/01/11/webworker/",
            "url": "https://dmqweb.cn/2024/01/11/webworker/",
            "title": "webWorker",
            "date_published": "2024-01-11T04:24:04.000Z",
            "content_html": "<p>#引言<br />\n首先我们知道 JS 中是没有并行，并发等概念的，这是因为 JS 是一门单线程的语言，其中的异步执行也是利用事件循环机制进行的，并不是严格意义上的异步。由于 JS 单线程的特性，使得 JS 在执行时如果遇到大量的任务就会使得过程运行缓慢。主渲染线程的延迟明显，使得用户体验较差.</p>\n<p>#web-worker<br />\nweb-worker 的作用就是用来缓解这一问题的</p>\n<p>利用 web-worker, 我们可以利用浏览器新开辟一个进程，将需要大量执行的过程在这个进程中执行，然后将结果返回给我们的主进程即可.</p>\n<p>#使用示例<br />\n #worker.html<br />\n&lt;!DOCTYPE html&gt;<br />\n&lt;html lang=&quot;en&quot;&gt;<br />\n&lt;head&gt;<br />\n&lt;meta charset=&quot;UTF-8&quot;&gt;<br />\n&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;<br />\n&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;<br />\n&lt;title&gt;Document&lt;/title&gt;<br />\n&lt;style&gt;<br />\n.p{<br />\nline-break: unset;<br />\n}<br />\n&lt;/style&gt;<br />\n&lt;a id=&quot;link&quot;&gt;&lt;/a&gt;<br />\n&lt;p class=&quot;p&quot;&gt;<br />\n&lt;%= sjdfl =%&gt;<br />\n&lt;/p&gt;<br />\n&lt;/head&gt;<br />\n&lt;body&gt;<br />\n&lt;script&gt;<br />\nconst \\u4e2d\\u6587 = ' 这是转义之后的字符 ';<br />\n// 使用 webworker, 分担主线程的压力<br />\n //const worker = new Worker ()<br />\n// 创建一个 worker<br />\nconst worker = new Worker('./worker.js')<br />\nconsole.log(worker);<br />\nworker.postMessage('sdfj');<br />\nworker.postMessage({method:'echo',argus:[1,2,3,4]})<br />\n// 主线程关闭 worker<br />\nsetTimeout(()=&gt;{<br />\nworker.terminate()<br />\n// worker.postMessage('close')<br />\n},1000)<br />\nworker.addEventListener('message',(e)=&gt;{<br />\nconsole.log(e.data);<br />\n})<br />\n/**</p>\n<ul>\n<li>主线程监听 worker 错误<br />\n<em> /<br />\nworker.onerror=(e)=&gt;{<br />\nworker.terminate()<br />\n console.error ('worker 错误 ');<br />\n}<br />\n/</em>*</li>\n<li>直接转移数据的控制权<br />\n<em> /<br />\n// 创建 4 字节的缓冲区<br />\n let abfer = new ArrayBuffer (4);<br />\n// 创建 32 位整数数组作为视图，引用缓冲区<br />\n let tes = new Int32Array (abfer);<br />\nconsole.log(tes,'ArrayBuffer');<br />\nworker.postMessage (abfer,[abfer]); // 转交控制权，主线程不再存储<br />\n /</em>*</li>\n<li>模拟文件下载功能<br />\n<em> /<br />\nconst blob = new Blob ([' 文件下载 ']);<br />\nconst link = document.getElementById('link');<br />\nlink.href = window.URL.createObjectURL(blob);;<br />\nlink.download = ' 测试文件.txt';<br />\nsetTimeout(()=&gt;{<br />\n// link.click();<br />\n},2000)<br />\n/</em>*</li>\n<li>创建 worker 线程加载 js 文件</li>\n<li>！！必须指定 script 标签的 type 为浏览器不知道的类型<br />\n<em> /<br />\n// const blob1 = new Blob(document.getElementById('scriptDom').textContent);<br />\n// const url1 = new window.URL.createObjectURL(blob1);<br />\n// const worker2 = new Worker(url1);<br />\n/</em>*</li>\n<li>使用 worker 线程，完成轮询<br />\n */<br />\n// 创建 worker<br />\nfunction createWorker(f){<br />\nconst fnBlob = new Blob(['('+f.toString()+')()'])<br />\nconst fnUrl = window.URL.createObjectURL(fnBlob);<br />\nreturn new Worker(fnUrl);<br />\n}<br />\nconst fnWorker = createWorker((e)=&gt;{<br />\nlet cache;<br />\n// setInterval(()=&gt;{<br />\nfetch('/data').then(res=&gt;{<br />\nif(cache != res){<br />\nconsole.log (' 变化了 ');<br />\n}<br />\n})<br />\n// },1000)<br />\n});<br />\n&lt;/script&gt;<br />\n&lt;script id=&quot;scriptDom&quot; type=&quot;app/worker&quot;&gt;<br />\nconsole.log (' 我是被 woeker 加载的文件 ');<br />\n&lt;/script&gt;<br />\n&lt;/body&gt;<br />\n&lt;/html&gt;</li>\n</ul>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>X-UA-Compatible<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>IE=edge<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Document<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\"></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token selector\">.p</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token property\">line-break</span><span class=\"token punctuation\">:</span> unset<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>link<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>p<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      &lt;%= sjdfl =%></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">const</span> \\u4e2d\\u6587 <span class=\"token operator\">=</span> <span class=\"token string\">'这是转义之后的字符'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">// 使用 webworker, 分担主线程的压力</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">// const worker = new Worker()</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">// 创建一个 worker</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">const</span> worker <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Worker</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./worker.js'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>worker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>worker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sdfj'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>worker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span><span class=\"token string\">'echo'</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">argus</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">// 主线程关闭 worker</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>worker<span class=\"token punctuation\">.</span><span class=\"token function\">terminate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">// worker.postMessage('close')</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>worker<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"37\"></td><td><pre> * 主线程监听 worker 错误</pre></td></tr><tr><td data-num=\"38\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>worker<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  worker<span class=\"token punctuation\">.</span><span class=\"token function\">terminate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'worker错误'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"44\"></td><td><pre> * 直接转移数据的控制权</pre></td></tr><tr><td data-num=\"45\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token comment\">// 创建 4 字节的缓冲区</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token keyword\">let</span> abfer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayBuffer</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">// 创建 32 位整数数组作为视图，引用缓冲区</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token keyword\">let</span> tes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Int32Array</span><span class=\"token punctuation\">(</span>abfer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>tes<span class=\"token punctuation\">,</span><span class=\"token string\">'ArrayBuffer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>worker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span>abfer<span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>abfer<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 转交控制权，主线程不再存储</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"53\"></td><td><pre> * 模拟文件下载功能</pre></td></tr><tr><td data-num=\"54\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token keyword\">const</span> blob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'文件下载'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token keyword\">const</span> link <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'link'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>link<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>link<span class=\"token punctuation\">.</span>download <span class=\"token operator\">=</span> <span class=\"token string\">'测试文件.txt'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>  <span class=\"token comment\">// link.click();</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"63\"></td><td><pre> * 创建 worker 线程加载 js 文件</pre></td></tr><tr><td data-num=\"64\"></td><td><pre> * ！！必须指定 script 标签的 type 为浏览器不知道的类型</pre></td></tr><tr><td data-num=\"65\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token comment\">// const blob1 = new Blob(document.getElementById('scriptDom').textContent);</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token comment\">// const url1 = new window.URL.createObjectURL(blob1);</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token comment\">// const worker2 = new Worker(url1);</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"70\"></td><td><pre> * 使用 worker 线程，完成轮询</pre></td></tr><tr><td data-num=\"71\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token comment\">// 创建 worker</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">createWorker</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">f</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>  <span class=\"token keyword\">const</span> fnBlob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'('</span><span class=\"token operator\">+</span>f<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token string\">')()'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>  <span class=\"token keyword\">const</span> fnUrl <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>fnBlob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Worker</span><span class=\"token punctuation\">(</span>fnUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token keyword\">const</span> fnWorker <span class=\"token operator\">=</span> <span class=\"token function\">createWorker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>  <span class=\"token keyword\">let</span> cache<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>  <span class=\"token comment\">// setInterval(()=>&#123;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/data'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>cache <span class=\"token operator\">!=</span> res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'变化了'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>  <span class=\"token comment\">// &#125;,1000)</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>  </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>scriptDom<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>app/worker<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'我是被woeker加载的文件'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>#worker.js</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 接受数据</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    self<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'我接受到了你的消息'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>data <span class=\"token operator\">===</span> <span class=\"token string\">'close'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        self<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'听你的我关闭'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        self<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// self.addEventListener('close',(e)=>&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//     console.log (' 关闭 ');</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// &#125;)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * worker 内部加载脚本</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * 只能加载，不能获取其中内容</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token function\">importScripts</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./main.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>#serviceWorker.js</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//serviceWorker 是基于事件驱动的。</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//serviceWorker 安装事件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span><span class=\"token parameter\">event</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span><span class=\"token string\">'安装事件'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">'安装完成'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//serviceWorker 激活事件（当安装完成之后就开始激活）</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'active'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">let</span> cacheWhiteList <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'product-v2'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        caches<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cacheNames</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                cacheNames<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cacheName</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>cacheWhiteList<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>cacheName<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                        <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>cacheName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">//serviceWorker 与网页的通信</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'active'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        self<span class=\"token punctuation\">.</span>clients<span class=\"token punctuation\">.</span><span class=\"token function\">matchAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">client</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token literal-property property\">msg</span><span class=\"token operator\">:</span><span class=\"token string\">\"Hello serviceWorker\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token literal-property property\">source</span><span class=\"token operator\">:</span><span class=\"token string\">\"serviceWorker\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure>",
            "tags": [
                "JS",
                "JS",
                "webWorker"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/01/10/%E6%AD%A3%E5%88%99/",
            "url": "https://dmqweb.cn/2024/01/10/%E6%AD%A3%E5%88%99/",
            "title": "正则编写方式",
            "date_published": "2024-01-10T04:24:04.000Z",
            "content_html": "<h2 id=\"正则表达式\"><a class=\"anchor\" href=\"#正则表达式\">#</a> 正则表达式</h2>\n<blockquote>\n<p>regular expression : RegExp</p>\n<p>用来处理字符串的规则</p>\n<ul>\n<li>只能处理字符串</li>\n<li>它是一个规则：可以验证字符串是否符合某个规则 (test) ，也可以把字符串中符合规则的内容捕获到 (exec /match ...)</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"good good study, day day up! \"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//=> 学正则就是用来制定规则 (是否包含数字)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=> false</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>str <span class=\"token operator\">=</span> <span class=\"token string\">\"2022-08-05\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>reg<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>[\"2019\",index:0,inputs:\"原始字符串\"]</span></pre></td></tr></table></figure><h2 id=\"编写正则表达式\"><a class=\"anchor\" href=\"#编写正则表达式\">#</a> <strong>编写正则表达式</strong></h2>\n<h3 id=\"创建方式有两种\"><a class=\"anchor\" href=\"#创建方式有两种\">#</a> 创建方式有两种</h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=> 字面量创建方式 (两个斜杆之间包起来的，都是用来描述规则的元字符)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg1 <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//=> 构造函数模式创建  两个参数：元字符字符串，修饰符字符串</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">let</span> reg2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\d+\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>正则表达式由两部分组成</p>\n<ul>\n<li>元字符</li>\n<li>修饰符</li>\n</ul>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* 常用的元字符 */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//=>1. 量词元字符：设置出现的次数</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">*</span>  零到多次</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">+</span>  一到多次</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">?</span>  零次或者一次</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#123;</span>n<span class=\"token punctuation\">&#125;</span>  <span class=\"token function\">出现n次</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n需为<span class=\"token number\">0</span>或者正整数</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span>n<span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#125;</span>  出现n到多次</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span>n<span class=\"token punctuation\">,</span>m<span class=\"token punctuation\">&#125;</span>  <span class=\"token function\">出现n到m次</span> <span class=\"token punctuation\">(</span>包含n和m<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//=>2. 特殊元字符：单个或者组合在一起代表特殊的含义</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\\    <span class=\"token function\">转义字符</span><span class=\"token punctuation\">(</span>普通<span class=\"token operator\">-</span><span class=\"token operator\">></span>特殊<span class=\"token operator\">-</span><span class=\"token operator\">></span>普通<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">.</span>    除\\<span class=\"token function\">n</span> <span class=\"token punctuation\">(</span>换行符<span class=\"token punctuation\">)</span> 以外的任意字符</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token operator\">^</span>    以哪一个元字符作为开始</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>$    以哪一个元字符作为结束</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\\n   换行符</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\\d   <span class=\"token number\">0</span><span class=\"token operator\">~</span><span class=\"token number\">9</span>之间的数字</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\\<span class=\"token constant\">D</span>   非<span class=\"token number\">0</span><span class=\"token operator\">~</span><span class=\"token number\">9</span><span class=\"token function\">之间的数字</span> <span class=\"token punctuation\">(</span>大写和小写的意思是相反的<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\\w   数字、字母、下划线中的任意一个字符</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\\s   <span class=\"token function\">一个空白字符</span> <span class=\"token punctuation\">(</span>包含空格、制表符、换页符等<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\\t   <span class=\"token function\">一个制表符</span> <span class=\"token punctuation\">(</span>一个TAb键<span class=\"token operator\">:</span>四个空格<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\\b   匹配一个单词的边界</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>x<span class=\"token operator\">|</span>y  <span class=\"token function\">x或者y中的一个字符</span>  <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">|</span><span class=\"token number\">5</span><span class=\"token operator\">|</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span>xyz<span class=\"token punctuation\">]</span> x或者y或者z中的一个字符  <span class=\"token punctuation\">[</span>adghve2375<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token operator\">^</span>xy<span class=\"token punctuation\">]</span> 除了x<span class=\"token operator\">/</span>y以外的任意字符</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">[</span>a<span class=\"token operator\">-</span>z<span class=\"token punctuation\">]</span> 指定a<span class=\"token operator\">-</span>z这个范围中的任意字符  <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span>9a<span class=\"token operator\">-</span>zA<span class=\"token operator\">-</span><span class=\"token constant\">Z_</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span>或者a<span class=\"token operator\">-</span>z或者<span class=\"token constant\">A</span><span class=\"token operator\">-</span><span class=\"token constant\">Z</span>或者_中的一个字符<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> \\w</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token operator\">^</span>a<span class=\"token operator\">-</span>z<span class=\"token punctuation\">]</span> 上一个取反<span class=\"token string\">\"非\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>    <span class=\"token function\">正则中的分组符号</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token operator\">?</span><span class=\"token operator\">:</span><span class=\"token punctuation\">)</span>  <span class=\"token function\">只匹配不捕获</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token operator\">?</span><span class=\"token operator\">=</span><span class=\"token punctuation\">)</span>  <span class=\"token function\">正向预查</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token operator\">?</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>  负向预查</pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">//=>3. 普通元字符：代表本身含义</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token operator\">/</span>jiangbing<span class=\"token operator\">/</span> 此正则匹配的就是<span class=\"token string\">\"jiangbing\"</span></pre></td></tr></table></figure><figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* 正则表达式常用的修饰符: img*/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter\">i</span> <span class=\"token operator\">=></span>ignoreCase  忽略单词大小写匹配</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter\">m</span> <span class=\"token operator\">=></span>multiline   可以进行多行匹配</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter\">g</span> <span class=\"token operator\">=></span>global      全局匹配</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> *\t/A/.test('lalala'); //=>fasle</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> *\t/A/i.test('lalala'); //=>true</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> */</span></pre></td></tr></table></figure><h3 id=\"元字符详细解析\"><a class=\"anchor\" href=\"#元字符详细解析\">#</a> <strong>元字符详细解析</strong></h3>\n<p><code>^$</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^\\d</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jiangbing\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2022jiangbing\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jiangbing2022\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr></table></figure><figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jiangbing\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2022jiangbing\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jiangbing2022\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr></table></figure><figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=>^/$ 两个都不加：字符串中包含符合规则的内容即可</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//=^/$ 两个都加：字符串只能是和规则一致的内容</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^\\d+$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//=> 举个例子：验证手机号码 (11 位，第一个数字是 1 即可)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^1\\d&#123;10&#125;$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>\\</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=>. 不是小数点，是除 \\n 外的任意字符</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^2.3$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2.3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2@3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"23\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//=> 基于转义字符，让其只能代表小数点</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^2\\.3$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2.3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2@3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"\\\\d\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^\\d$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//=>\\d 代表 0-9 的数字</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"str\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^\\\\d$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//=> 把特殊符号转换为普通的</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"str\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr></table></figure><p><code>x|y</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^18|29$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"18\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"29\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"129\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"189\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1829\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"829\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"182\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"82\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">//--- 直接 x|y 会存在很乱的优先级问题，一般我们写的时候都伴随着小括号进行分组，因为小括号改变处理的优先级 => 小括号：分组</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^(18|29)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"18\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"29\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"129\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"189\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//=> 只能是 18 或者 29 中的一个了</span></pre></td></tr></table></figure><p><code>[]</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//1. 中括号中出现的字符一般都代表本身的含义</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[@+]$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"+\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@@\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@+\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[\\d]$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\\d 在中括号中还是 0-9</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"9\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[\\\\d]$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\\d 已经被 \\ 转义</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"9\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">//2. 中括号中不存在多位数</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[18]$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"18\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[10-29]$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>1 或者 0-2 或者 9</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"9\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr></table></figure><h3 id=\"常用的正则表达式\"><a class=\"anchor\" href=\"#常用的正则表达式\">#</a> <strong>常用的正则表达式</strong></h3>\n<p>1. 验证是否为有效数字</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> *\t规则分析</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> *\t\t1. 可能出现 + - 号，也可能不出现  [+-]?</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *\t\t2. 一位 0-9 都可以，多位首位不能为 0  (\\d|([1-9]\\d+)</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *\t\t3. 小数点部分可能有可能没有，一旦有后面必须有小数点 + 数字  (\\.\\d+)?</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[+-]?(\\d|([1-9]\\d+))(\\.\\d+)?$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>2. 验证密码</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=> 数字、字母、下划线</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//=>6~16 位</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">let</span> val <span class=\"token operator\">=</span> userPassInp<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^\\w&#123;6,16&#125;$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">let</span> flag <span class=\"token operator\">=</span> reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>function checkPass (val)&#123;</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    if (val.length &lt;6 || val.length >16)&#123;</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        alert (' 长度必须介于 6-16 位之间！');</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        retrun;</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    &#125;</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    let area = ['a','b'...'_']; //=> 包含数字、字母、下划线</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    for (let i=0;i&lt;val.length;i++)&#123;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        let char = val [i];</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        if (!area.includes (char))&#123;</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            alert (\"格式不正确\");</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            return;</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        &#125;</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    &#125;</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>&#125;</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>*/</span></pre></td></tr></table></figure><p>3. 验证真实姓名</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> *\t1. 验证汉字  /^[\\u4E00-\\u9FA5]$/</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> *\t2. 名字长度 2~10 位</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *\t3. 可能有译名・汉字  (・[\\u4E00-\\u9FA5]&#123;2,10&#125;)&#123;0,2&#125;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[\\u4E00-\\u9FA5]&#123;2,10&#125;(·[\\u4E00-\\u9FA5]&#123;2,10&#125;)&#123;0,2&#125;$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>4. 验证邮箱</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^\\w+((-\\w+)|(\\.\\w+))*@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//=> \\w+((-\\w+)|(\\.\\w+))*</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 1. 开头是数字字母下划线 (1 到多位)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 2. 还可以是 \"- 数字字母下划线 或者。数字字母下划线\"，整体零到多次</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 邮箱的名字由 \"数字、字母、下划线、-、.\" 几部分组成，但是 -/. 不能连续出现也不能作为开始</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//=> @[A-Za-z0-9]+</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 1.@后面紧跟着：数字、字母 (1 - 多位)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">//=> ((\\.|-)[A-Za-z0-9]+)*</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 1. 对 @后面名字的补充</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// 多域名   .com.cn</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// 企业域名  zxt@zhufeng-peixun-office.com</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">//=> \\.[A-Za-z0-9]+</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">// 1. @xxx.com/ @xxx.cn 这个匹配的是最后的域名 (.com/.cn/.org/.edu/.net/.vip...)</span></pre></td></tr></table></figure><p>5. 身份证号码</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> *\t1. 一共 18 位</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> *\t2. 最后一位可能是 X</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *\t身份证前六位：省市县 130828</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> *\t中间八位：年月日</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> *\t最后四位:</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> *\t\t最后一位 => X 或者数字</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> *\t\t倒数第二位 => 偶数 女  奇数 男</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> *\t\t其余的是经过算法算出来的</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//let reg = /^\\d&#123;17&#125;(\\d|X)$/;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">//=> 小括号分组的第二个作用：分组捕获，不仅可以把大正则匹配的信息捕获到，还可以单独捕获到每个小分组的内容</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^(\\d&#123;6&#125;)(\\d&#123;4&#125;)(\\d&#123;2&#125;)(\\d&#123;2&#125;)\\d&#123;2&#125;(\\d)(\\d|X)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>reg<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"130828199012040617\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//=>['130828199012040617', '130828', '1990', '12', '04', '1', '7', index: 0, input: '130828199012040617', groups: undefined] 捕获结果是一个数组，包含每一个小分组单独获取的内容</span></pre></td></tr></table></figure><p><strong>正则两种创建方式的区别</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=> 构造函数因为传递的是字符串，\\ 需要写两个才代表斜杆</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\d+\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"g\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//=> 正则表达式中的部分内容是变量存储的值</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 1. 两个斜杆中间包起来的都是元字符 (如果正则中要包含某个变量的值，则不能使用字面量方式创建)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">let</span> type <span class=\"token operator\">=</span> <span class=\"token string\">'zhufeng'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^@\"+type+\"@$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@zhufeng@\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@\"\"\"typeeee\"@'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=true</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 2. 这种情况只能使用构造函数方式 (因为它传递的规则是字符串，只有这样才能进行字符拼接)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"^@\"</span><span class=\"token operator\">+</span>type<span class=\"token operator\">+</span><span class=\"token string\">\"@$\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@zhufeng@\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr></table></figure><hr />\n<h2 id=\"正则的捕获\"><a class=\"anchor\" href=\"#正则的捕获\">#</a> <strong>正则的捕获</strong></h2>\n<blockquote>\n<p>实现正则捕获的办法</p>\n<ul>\n<li>正则 RegExp.prototype 上的方法\n<ul>\n<li>exec</li>\n<li>test</li>\n</ul>\n</li>\n<li>字符串 String.prototype 上支持正则表达式处理的方法\n<ul>\n<li>replace</li>\n<li>match</li>\n<li>splite</li>\n<li>......</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"zhufeng2022yangfan2023qihang2024\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *\t基于 exec 实现正则的捕获</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *\t\t1. 捕获到的结果是 null 或者一个数组</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> *\t\t\t数组第一项：本次捕获到的内容</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> *\t\t\t其余项：对应小分组本次单独捕获的内容</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> *\t\t\tindex: 当前捕获内容在字符串中的起始索引</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> *\t\t\tinput: 原始字符串</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> *\t\t2. 每执行一次 exec，只能捕获到一个符合正则规则的，但是默认情况下，我们执行 100 遍，获取的结果永远都是第一个匹配到的，其余的捕获不到</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> *\t\t=>\"正则捕获的懒惰性\": 默认只捕获第一个</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>['2022', index: 7, input: 'zhufeng2022yangfan2023qihang2023']</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>//=> 实现正则捕获的前提是：当前正则要和字符串匹配，如果不匹配捕获的结果是 null</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>let reg = /^\\d+$/;</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>console.log (reg.test (str)); //=>fasle</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>console.log (reg.exec (str)); //=>null</span></pre></td></tr></table></figure><h3 id=\"懒做性的解决办法\"><a class=\"anchor\" href=\"#懒做性的解决办法\">#</a> 懒做性的解决办法</h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"zhufeng2022yangfan2023qihang2024\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/* </pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *  reg.lastIndex: 当前正则下一次匹配的起始索引位置</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *  懒惰性捕获的原因：默认情况下 lastIndex 的值不会被修改，每一次都是从字符串开始位置查找，所以找到的永远只是第一个</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> *  解决办法：全局修饰符 g</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">/* console.log (reg.lastIndex); //=>0 下面匹配捕获是从 str 索引零的位置开始找</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   console.log (reg.exec (str));</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   console.log (reg.lastIndex); //=>0 第一次匹配捕获完成，lastIndex 没有改变，所以下一次 exec 依然是从字符串最开始找，找到的永远是第一个匹配到的 </pre></td></tr><tr><td data-num=\"11\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">/* reg = /\\d+/g;</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   console.log (reg.exec (str)); //=>[\"2022\"...]</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   console.log (reg.lastIndex); //=>11 设置全局匹配修饰符 g 后，第一次匹配完，lastIndex 会自己修改</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   console.log (reg.exec (str)); //=>[\"2023\"...]</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   console.log (reg.lastIndex); //=>22</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   console.log (reg.exec (str)); //=>[\"2024\"...]</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   console.log (reg.lastIndex); //=>32</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   console.log (reg.exec (str)); //=>null  当全部捕获后，再次捕获的结果是 null，但是 lastIndex 又回归了初始值零，再次捕获又从第一个开始了...</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   console.log (reg.lastIndex); //=>0</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   console.log (reg.exec (str)); //=>[\"2019\"...] </pre></td></tr><tr><td data-num=\"23\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">/* reg = /\\d+/g;</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   if (reg.test (str)) &#123;</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   \t\t//=> 验证一下：只有正则和字符串匹配我们再捕获</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        console.log (reg.lastIndex); //=>11  基于 test 匹配验证后，lastIndex 已经被修改为第一次匹配后的结果，所以下一次捕获不再从头开始</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        console.log (reg.exec (str)); //=>[\"2023\"...]</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    &#125; </pre></td></tr><tr><td data-num=\"31\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">//=> 需求：编写一个 execAll，执行一次可以把所有匹配的结果捕获到 (前提正则一定要设置全局修饰符 g)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token operator\">~</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">function</span> <span class=\"token function\">execAll</span><span class=\"token punctuation\">(</span>str <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token comment\">//=>str: 需要匹配的字符串</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token comment\">//=>this: RegExp 的实例 (当前操作的正则)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token comment\">//=> 进来后第一件事，是验证当前正则是否设置了 g，不设置则不能在进行循环捕获了，否则会导致死循环</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token comment\">//=>ary 存储最后所有捕获的信息   res 存储每一次捕获的内容</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">let</span> ary <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            res <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token comment\">//=> 把每一次捕获的内容 res [0] 存放到数组中</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            ary<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token comment\">//=> 只要捕获的内容不为 null，则继续捕获下去</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            res <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">return</span> ary<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">:</span> ary<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>execAll <span class=\"token operator\">=</span> execAll<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">execAll</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token comment\">//=> 字符串中的 match 方法，可以在执行一次的情况下，捕获到所有匹配的数据 (前提：正则也得设置 g 才可以)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"正则的分组捕获\"><a class=\"anchor\" href=\"#正则的分组捕获\">#</a> 正则的分组捕获</h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=> 身份证号码</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"130828199012040112\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^(\\d&#123;6&#125;)(\\d&#123;4&#125;)(\\d&#123;2&#125;)(\\d&#123;2&#125;)\\d&#123;2&#125;(\\d)(?:\\d|X)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>['130828199012040112', '130828', '1990', '12', '04', '1', index: 0, input: '130828199012040112']</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>['130828199012040112', '130828', '1990', '12', '04', '1', index: 0, input: '130828199012040112']</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//=> 第一项：大正则匹配的结果</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//=> 其余项：每一个小分组单独匹配捕获的结果</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//=> 如果设置了分组 (改变优先级)，但是捕获的时候不需要单独捕获，可以基于？: 来处理</span></pre></td></tr></table></figure><figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=> 既要捕获到 &#123;数字&#125;，也想单独的把数字也获取到，例如：第一次找到 &#123;0&#125; 还需单独获取 0</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"&#123;0&#125;年&#123;1&#125;月&#123;2&#125;日\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t//=> 不设置 g 只匹配一次，exec 和 match 获取的结果一致 (既有大正则匹配的信息，也有小分组匹配的信息)</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tlet reg = /\\&#123;(\\d+)\\&#125;/;</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tconsole.log (reg.exec (str)); //=>['&#123;0&#125;','0',...]</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tconsole.log (str.match (reg)); //=>['&#123;0&#125;','0',...]</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\&#123;(\\d+)\\&#125;</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//console.log (str.match (reg)); //=> ['&#123;0&#125;', '&#123;1&#125;', '&#123;2&#125;']\t 多次匹配的情况下，match 只能把大正则匹配的内容获取到，小分组匹配的信息无法获取</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">let</span> aryBig <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    arySmall <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    res <span class=\"token operator\">=</span> reg<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>big<span class=\"token punctuation\">,</span>small<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> res<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    aryBig<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>big<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    arySmall<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>small<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    res <span class=\"token operator\">=</span> reg<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>aryBig<span class=\"token punctuation\">,</span>arySmall<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>['&#123;0&#125;', '&#123;1&#125;', '&#123;2&#125;'] (3) ['0', '1', '2']</span></pre></td></tr></table></figure><figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=> 分组的第三个作用: \"分组引用\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"book\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"good\"、\"look\"、\"moon\"、\"foot\"...</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[a-zA-Z]([a-zA-Z])\\1[a-zA-Z]$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=> 分组引用就是通过 \"\\ 数字\" 让其代表和对应分组出现一模一样的内容</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"book\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deep\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"some\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr></table></figure><h3 id=\"正则捕获的贪婪性\"><a class=\"anchor\" href=\"#正则捕获的贪婪性\">#</a> 正则捕获的贪婪性</h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"珠峰2022@2023培训\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//=> 正则捕获的贪婪性：默认情况下，正则捕获的时候，是按照当前正则所匹配的最长结果来获取的</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>[\"2019\",\"2022\"]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//=> 在量词元字符后面设置？: 取消捕获时候的贪婪性 (按照正则匹配的最短结果来获取) </span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+?</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>['2', '0', '2', '2', '2', '0', '2', '3']</span></pre></td></tr></table></figure><p><code>?\t问号在正则中的五大作用</code></p>\n<ul>\n<li>问号左边是非量词元字符：本身代表量词元字符，出现零到一次</li>\n<li>问号左边是量词元字符：取消捕获时候的贪婪性</li>\n<li>(?😃 只匹配不捕获</li>\n<li>(?=) 正向预查</li>\n<li>(?!) 负向预查</li>\n</ul>\n<h3 id=\"其他正则捕获的方法\"><a class=\"anchor\" href=\"#其他正则捕获的方法\">#</a> 其他正则捕获的方法</h3>\n<p>1.test 也能捕获 (本意是匹配)</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"&#123;0&#125;年&#123;1&#125;月&#123;2&#125;日\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\&#123;(\\d+)\\&#125;</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"0\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"1\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"2\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"2\"\t存储的是上次捕获的结果</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">//=>RegExp.$1~RegExp.$9: 获取当前本次正则匹配后，第一个到第九个分组的信息</span></pre></td></tr></table></figure><p>2.replace 字符串中实现替换的方法 (一般都是伴随正则一起使用的)</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"zhufeng@2022|zhufeng@2023\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//=> 把 \"zhufeng\" 替换成 \"珠峰\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 1. 不用正则，执行一次只能替换一个</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>str <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zhufeng\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"珠峰\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zhufeng\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"珠峰\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"珠峰 @2022 | 珠峰 @2023\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 2. 使用正则会简单点</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>str <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">zhufeng</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span><span class=\"token string\">\"珠峰\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"珠峰 @2022 | 珠峰 @2023\"</span></pre></td></tr></table></figure><figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"zhufeng@2022|zhufeng@2023\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//=> 把 \"zhufeng\" 替换成 \"zhufengpeixun\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>str <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zhufeng\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"zhufengpeixun\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zhufeng\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"zhufengpeixun\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"zhufengpeixunpeixun@2022|zhufeng@2023\" 每一次替换都是从字符串第一个位置开始找的 (类似于正则捕获的懒惰性)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//=> 基于正则 g 可以实现</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>str <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">zhufeng</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span><span class=\"token string\">\"zhufengpeixun\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"zhufengpeixun@2022|zhufengpeixun@2023\"</span></pre></td></tr></table></figure><p><strong>案例：把时间字符串进行处理</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> time <span class=\"token operator\">=</span> <span class=\"token string\">\"2022-08-09\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//=> 变为 \"2022 年 08 月 09 日\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^(\\d&#123;4&#125;)-(\\d&#123;1,2&#125;)-(\\d&#123;1,2&#125;)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//=> 这样可以实现</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//time = time.replace (reg,\"$1 年 $2 月 $3 日\");</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//console.log (time); //=>\"2022 年 08 月 09 日\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//=> 还可以这样处理 [str].replace ([reg],[function])</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// 1. 首先拿 reg 和 time 进行匹配捕获，能匹配到几次就会把传递的函数执行几次 (而且是匹配一次就执行一次)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 2. 不仅把方法执行，而且 replace 还给方法传递了实参信息 (和 exec 捕获的内容一致的信息：大正则匹配的内容，小分组匹配的信息....)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 3. 在函数中我们返回的是啥，就把当前大正则匹配的内容替换成啥</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\ttime = time.replace (reg,(big,$1,$2,$3)=>&#123;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    \t//=> 这里的 $1~$3 是我们自己设置的变量</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    \tconsole.log (big,$1,$2,$3); //=>\"2022-08-09 2022 08 09\"</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t&#125;);</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>time <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>arg</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">let</span>  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span>$1<span class=\"token punctuation\">,</span>$2<span class=\"token punctuation\">,</span>$3<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> arg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    $2<span class=\"token punctuation\">.</span>length<span class=\"token operator\">&lt;</span><span class=\"token number\">2</span> <span class=\"token operator\">?</span> $2<span class=\"token operator\">=</span><span class=\"token string\">\"0\"</span><span class=\"token operator\">+</span>$2 <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    $3<span class=\"token punctuation\">.</span>length<span class=\"token operator\">&lt;</span><span class=\"token number\">2</span> <span class=\"token operator\">?</span> $3<span class=\"token operator\">=</span><span class=\"token string\">\"0\"</span><span class=\"token operator\">+</span>$3 <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">return</span> $1<span class=\"token operator\">+</span><span class=\"token string\">\"年\"</span><span class=\"token operator\">+</span>$2<span class=\"token operator\">+</span><span class=\"token string\">\"月\"</span><span class=\"token operator\">+</span>$3<span class=\"token operator\">+</span><span class=\"token string\">\"日\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>单词首字母大写</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"good good study, day day up! \"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\b([a-zA-Z])[a-zA-Z]*\\b</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//=> 函数被执行了六次，每一次都把正则匹配信息传递给函数</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//=> 每一次 arg: ['good','g'] ['good','g'] ['good','g'] ['study','s']...</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>str <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>arg</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>content<span class=\"token punctuation\">,</span>$1<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> arg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    $1 <span class=\"token operator\">=</span> $1<span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    content <span class=\"token operator\">=</span> content<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">return</span> $1 <span class=\"token operator\">+</span> content<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"Good Good Study, Day Day Up! \"</span></pre></td></tr></table></figure><p><strong>验证一个字符串中哪个字母出现的次数最多，多少次？</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"zhufengpeixunzhoulaoshi\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *\t去重思维</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">let</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">,</span><span class=\"token parameter\">char</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> obj<span class=\"token punctuation\">[</span>char<span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> <span class=\"token string\">\"undefined\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        obj<span class=\"token punctuation\">[</span>char<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    obj<span class=\"token punctuation\">[</span>char<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">let</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">,</span> <span class=\"token parameter\">char</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> obj<span class=\"token punctuation\">[</span>char<span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> <span class=\"token string\">\"undefined\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        obj<span class=\"token punctuation\">[</span>char<span class=\"token punctuation\">]</span><span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    obj<span class=\"token punctuation\">[</span>char<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">let</span> max <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    res <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> key <span class=\"token keyword\">in</span> obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">let</span> item <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    item <span class=\"token operator\">></span> max <span class=\"token operator\">?</span> max <span class=\"token operator\">=</span> item <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> key <span class=\"token keyword\">in</span> obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">let</span> item <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>item <span class=\"token operator\">===</span> max<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        res<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">出现次数最多的字符是:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>res<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">，出现了</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>max<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">次</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=> 出现次数最多的字符是:h,u，出现了 3 次</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"37\"></td><td><pre> *\t排序</pre></td></tr><tr><td data-num=\"38\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>str <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span><span class=\"token function\">localeCompare</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">//console.log(str); //=>\"aeefghhhiilnnoopsuuuxzz\"</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">([a-zA-Z])\\1+</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">let</span> ary <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>['ee', 'hhh', 'ii', 'nn', 'oo', 'uuu', 'zz']</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>ary<span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> b<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> a<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ary<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>['hhh', 'uuu', 'ee', 'ii', 'nn', 'oo', 'zz']</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token keyword\">let</span> max <span class=\"token operator\">=</span> ary<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    res <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>ary<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> ary<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">let</span> item <span class=\"token operator\">=</span> ary<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;</span> max<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">出现次数最多的字符是:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>res<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">，出现了</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>max<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">次</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=> 出现次数最多的字符是:h,u，出现了 3 次</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"57\"></td><td><pre> *\t正则</pre></td></tr><tr><td data-num=\"58\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token keyword\">let</span> max <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    res <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    flag <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>str <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span><span class=\"token function\">localeCompare</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token comment\">// console.log(str); //=>\"aeefghhhiilnnoopsuuuxzz\"</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">--</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"([a-zA-Z])\\\\1&#123;\"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"&#125;\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"g\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token comment\">// i=3  /([a-zA-Z])\\1&#123;2&#125;/  \"hhh\" \"uuu\"</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    str<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">content<span class=\"token punctuation\">,</span> $1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        res<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>$1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        max <span class=\"token operator\">=</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        flag <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">出现次数最多的字符是:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>res<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">，出现了</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>max<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">次</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=> 出现次数最多的字符是:h,u，出现了 3 次</span></pre></td></tr></table></figure><p><strong>时间字符串格式化</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">~</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">/* </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     *  formatTime: 时间字符串的格式化处理</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">/* function formatTime () &#123;</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    \t// 1. 首先获取时间字符串中的年月日等信息</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        let timeAry = this.match (/\\d+/g);</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        //console.log (timeAry)//['2022', '8', '10', '16', '00', '43']</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        let template = \"&#123;0&#125; 年 &#123;1&#125; 月 &#123;2&#125; 日 &#123;3&#125; 时 &#123;4&#125; 分 &#123;5&#125; 秒\";</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        template = template.replace (/\\&#123;(\\d+)\\&#125;/g, (content, $1) => &#123;</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        \t//=>content: 当前本次大正则匹配的信息   $1: 本次小分组单独匹配的信息</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        \t// 以 $1 的值作为索引，到 timeAry 中找到对应的时间 (如果没有则用 \"00\" 补)</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        \tlet time = timeAry [$1] || \"00\";</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        \ttime.length &lt; 2 ? time = \"0\" + time : null;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            return time;</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        &#125;)</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        return template;</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    &#125;*/</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">//=> 简化版本</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">/* </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     *  formatTime: 时间字符串的格式化处理</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     *  @params</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     *      template: [string] 我们最后期望获取日期格式的模板</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     *      模板规则: &#123;0&#125;-> 年  &#123;1~5&#125;-> 月日时分秒</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>     *  @return</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>     *      [string] 格式化后的时间字符串</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>     *  by 江冰 on 2022-8-10 16:33:43</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">function</span> <span class=\"token function\">formatTime</span><span class=\"token punctuation\">(</span>template <span class=\"token operator\">=</span> <span class=\"token string\">\"&#123;0&#125;年&#123;1&#125;月&#123;2&#125;日 &#123;3&#125;时&#123;4&#125;分&#123;5&#125;秒\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">let</span> timeAry <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">return</span> template <span class=\"token operator\">=</span> template<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\&#123;(\\d+)\\&#125;</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> $1<span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">let</span> time <span class=\"token operator\">=</span> timeAry<span class=\"token punctuation\">[</span>$1<span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"00\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token keyword\">return</span> time<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span> <span class=\"token operator\">?</span> time <span class=\"token operator\">=</span> <span class=\"token string\">\"0\"</span> <span class=\"token operator\">+</span> time <span class=\"token operator\">:</span> time<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token comment\">/* 扩展到内置类 String.prototype 上 */</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">[</span><span class=\"token string\">\"formatTime\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">[</span>item<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">//=> 服务器获取的</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token comment\">// \"2022-8-10 16:00:43\"</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\">// \"2022/8/10 16:00:43\"</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token comment\">// \"2022/8/10\"</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\">//=> 想要转变为的格式</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">// \"08 月 10 日 16 时 00 分\"</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token comment\">// \"2022 年 8 月 10 日\"</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token comment\">// ...</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token keyword\">let</span> time <span class=\"token operator\">=</span> <span class=\"token string\">\"2022-8-10 16:00:43\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span><span class=\"token function\">formatTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>2022 年 08 月 10 日 16 时 00 分 43 秒</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span><span class=\"token function\">formatTime</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;0&#125;年&#123;1&#125;月&#123;2&#125;日\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>2022 年 08 月 10 日</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span><span class=\"token function\">formatTime</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;1&#125;-&#123;2&#125; &#123;3&#125;:&#123;4&#125;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>08-10 16:00</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>time <span class=\"token operator\">=</span> <span class=\"token string\">\"2022/8/13\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span><span class=\"token function\">formatTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>2022 年 08 月 13 日 00 时 00 分 00 秒</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span><span class=\"token function\">formatTime</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;0&#125;年&#123;1&#125;月&#123;2&#125;日\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>2022 年 08 月 13 日</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span><span class=\"token function\">formatTime</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;1&#125;-&#123;2&#125; &#123;3&#125;:&#123;4&#125;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>08-13 00:00</span></pre></td></tr></table></figure><p><em><strong>queryURLParams</strong></em></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">~</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">/* </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     *  queryURLParams: 获取 URl 地址问号和后面的参数信息 (可能也包含 HASH 值)</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     *  @params   </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     *  @return</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     *      [object] 把所有问号参数信息以键值对的方式存储起来并且返回</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     *  by 江冰 on 2022-8-10 16:33:43</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">function</span> <span class=\"token function\">queryURLParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">let</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">([^?=&amp;#]+)=([^?=&amp;#]+)</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> $1<span class=\"token punctuation\">,</span> $2<span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> obj<span class=\"token punctuation\">[</span>$1<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> $2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">#([^?=&amp;#]+)</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> $1<span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> obj<span class=\"token punctuation\">[</span><span class=\"token string\">'HASH'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> $1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">/* 扩展到内置类 String.prototype 上 */</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">[</span><span class=\"token string\">\"queryURLParams\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">[</span>item<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">let</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://www.zhufengpeixun.cn/?lx=1&amp;from=wx#video\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">.</span><span class=\"token function\">queryURLParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>&#123;lx: '1', from: 'wx', HASH: 'video'&#125;</span></pre></td></tr></table></figure><p><strong>千分符</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">~</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">/* </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     *  millimeter: 实现大数字的千分符处理</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     *  @params    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     *  @return</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     *      [string] 千分符后的字符串</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     *  by 江冰 on 2022-8-10 16:33:43</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token keyword\">function</span> <span class=\"token function\">millimeter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d&#123;1,3&#125;(?=(\\d&#123;3&#125;)+$)</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">content</span> <span class=\"token operator\">=></span> content <span class=\"token operator\">+</span> <span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">/* 扩展到内置类 String.prototype 上 */</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">[</span><span class=\"token string\">\"millimeter\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">[</span>item<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">let</span> num <span class=\"token operator\">=</span> <span class=\"token string\">\"15628954\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"15,628,954\" 千分符</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">.</span><span class=\"token function\">millimeter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"15,628,954\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">// 把字符串倒过来</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>num <span class=\"token operator\">=</span> num<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> num<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">let</span> prev <span class=\"token operator\">=</span> num<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        next <span class=\"token operator\">=</span> num<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    num <span class=\"token operator\">=</span> prev <span class=\"token operator\">+</span> <span class=\"token string\">\",\"</span> <span class=\"token operator\">+</span> next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>num <span class=\"token operator\">=</span> num<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"15,628,954\"</span></pre></td></tr></table></figure>",
            "tags": [
                "正则表达式",
                "正则"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/01/02/node.js%E5%86%85%E7%BD%AE%E6%A8%A1%E5%9D%97/",
            "url": "https://dmqweb.cn/2024/01/02/node.js%E5%86%85%E7%BD%AE%E6%A8%A1%E5%9D%97/",
            "title": "node.js内置模块",
            "date_published": "2024-01-01T18:24:04.000Z",
            "content_html": "<h1 id=\"05-nodejs内置模块上\"><a class=\"anchor\" href=\"#05-nodejs内置模块上\">#</a> 05 【nodejs 内置模块（上）】</h1>\n<h2 id=\"nodejs-的官方api文档\"><a class=\"anchor\" href=\"#nodejs-的官方api文档\">#</a> nodejs 的官方 API 文档</h2>\n<ul>\n<li>Node.js 的 API 文档（英文）： <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ub2RlanMub3JnL2RvY3MvbGF0ZXN0LXY4LngvYXBpL2luZGV4Lmh0bWw=\">https://nodejs.org/docs/latest-v8.x/api/index.html</span></li>\n<li>Node.js 的 API 文档（中文）：<span class=\"exturl\" data-url=\"aHR0cDovL25vZGVqcy5jbi9hcGkv\">http://nodejs.cn/api/</span></li>\n</ul>\n<p>关于 Node.js 的内置模块和常见 API，可以看官方文档。</p>\n<p>查阅文档时，稳定指数如下：</p>\n<ul>\n<li>红色：废弃。</li>\n<li>橙色：实验。表示当前版本可用，其他版本不确定。也许不向下兼容，建议不要在生产环境中使用该特性。</li>\n<li>绿色：稳定。与 npm 生态系统的兼容性是最高的优先级。</li>\n</ul>\n<h2 id=\"nodejs-中模块的分类\"><a class=\"anchor\" href=\"#nodejs-中模块的分类\">#</a> nodejs 中模块的分类</h2>\n<p>Node.js 应用由模块组成，采用 CommonJS 模块规范。Node.js 中的模块分为三种：</p>\n<ul>\n<li>内置模块</li>\n<li>第三方模块</li>\n<li>自定义模块</li>\n</ul>\n<p>下面简单介绍一下。</p>\n<h3 id=\"内置模块\"><a class=\"anchor\" href=\"#内置模块\">#</a> 内置模块</h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> process <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'process'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>require 方法用于加载模块。</p>\n<p>常见的内置模块包括：</p>\n<ul>\n<li>FS：文件系统模块</li>\n<li>path：路径模块</li>\n<li>OS：操作系统相关</li>\n<li>net：网络相关</li>\n<li>http</li>\n<li>...</li>\n</ul>\n<p>你可能会有疑问：Node.js 这么牛吗？还能直接和操作系统做交互？</p>\n<p>带着这个疑问，我们不妨简单看看 Node.js 的源码，以 os 模块举例：</p>\n<ul>\n<li>打开 os 模块的源码：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25vZGVqcy9ub2RlL2Jsb2IvbWFzdGVyL2xpYi9vcy5qcyVFRiVCQyU4QyVFNyVCRiVCQiVFNSU4OCVCMCVFNiU5QyU4MCVFNSVCQSU5NSVFOSU4MyVBOCVFRiVCQyU4QyVFNiU4OSVCRSVFNSU4OCVCMA==\">https://github.com/nodejs/node/blob/master/lib/os.js，翻到最底部，找到</span>  <code>cpus</code>  这个方法</li>\n<li>进而找到  <code>getCPUs()</code></li>\n<li>internalBinding ('os')：通过 internalBinding 可以调用系统底层的方法。internalBinding 主要是 JS 虚拟机在做的事情。</li>\n<li><code>internalBinding('os')</code>  的实现，在 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25vZGVqcy9ub2RlL2Jsb2IvbWFzdGVyL3NyYy9ub2RlX29zLmNj\">https://github.com/nodejs/node/blob/master/src/node_os.cc</span> 里，里面都是 C++ 的代码。比如有一个 <code>getCPUs</code>  方法。</li>\n</ul>\n<p>现在你知道了，JS 本身是没有能力获取底层系统资源的，这一切都是 JS 虚拟机在和底层做交互，然后通过 JS 的表现形式，暴露给应用层。</p>\n<p>另外，还有很多库，是直接使用 C/++ 编写的，通过编译之后，再提供给 JS 应用层调用，或者直接提供给 Node.js 层使用。</p>\n<p><strong>所有的编程语言底层都会回归 C/C++</strong>，甚至是汇编语言。</p>\n<h3 id=\"require-加载第三方包的机制\"><a class=\"anchor\" href=\"#require-加载第三方包的机制\">#</a> require 加载第三方包的机制</h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>require 加载第三方包的机制：</p>\n<p>（1）第三方包安装好后，这个包一般会存放在当前项目的 node_modules 文件夹中。我们找到这个包的 package.json 文件，并且找到里面的 main 属性对应的入口模块，这个入口模块就是这个包的入口文件。</p>\n<p>（2）如果第三方包中没有找到 package.json 文件，或者 package.json 文件中没有 main 属性，则默认加载第三方包中的 index.js 文件。</p>\n<p>（3）如果在 node_modules 文件夹中没有找到这个包，或者以上所有情况都没有找到，则会向上一级父级目录下查找 node_modules 文件夹，查找规则如上一致。</p>\n<p>（4）如果一直找到该模块的磁盘根路径都没有找到，则会报错：can not find module xxx。</p>\n<h3 id=\"自定义模块module\"><a class=\"anchor\" href=\"#自定义模块module\">#</a> 自定义模块（module）</h3>\n<p>每个文件就是一个模块，有自己的作用域。在一个文件里面定义的变量、函数、类，都是私有的，对其他文件不可见。</p>\n<p>举例：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> example <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./example.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>example<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 5</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>example<span class=\"token punctuation\">.</span><span class=\"token function\">addX</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 6</span></pre></td></tr></table></figure><h2 id=\"网络服务-http\"><a class=\"anchor\" href=\"#网络服务-http\">#</a> 网络服务 http</h2>\n<h3 id=\"http模块概览\"><a class=\"anchor\" href=\"#http模块概览\">#</a> http 模块概览</h3>\n<p>大多数 nodejs 开发者都是冲着开发 web server 的目的选择了 nodejs。正如官网所展示的，借助 http 模块，可以几行代码就搞定一个超迷你的 web server。</p>\n<p>在 nodejs 中， <code>http</code>  可以说是最核心的模块，同时也是比较复杂的一个模块。上手很简单，但一旦深入学习，不少初学者就会觉得头疼，不知从何入手。</p>\n<p>本文先从一个简单的例子出发，引出 <code>http</code>  模块最核心的四个实例。看完本文，应该就能够对 http 模块有个整体的认识。</p>\n<h3 id=\"一个简单的例子\"><a class=\"anchor\" href=\"#一个简单的例子\">#</a> 一个简单的例子</h3>\n<p>在下面的例子中，我们创建了 1 个 web 服务器、1 个 http 客户端</p>\n<ul>\n<li>服务器 server：接收来自客户端的请求，并将客户端请求的地址返回给客户端。</li>\n<li>客户端 client：向服务器发起请求，并将服务器返回的内容打印到控制台。</li>\n</ul>\n<p>代码如下所示，只有几行，但包含了不少信息量。下一小节会进行简单介绍。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//http server 例子</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">serverReq<span class=\"token punctuation\">,</span> serverRes</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> serverReq<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    serverRes<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span> <span class=\"token string\">'您访问的地址是：'</span> <span class=\"token operator\">+</span> url <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">//http client 例子</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">var</span> client <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://127.0.0.1:3000'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">clientRes</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    clientRes<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"例子解释\"><a class=\"anchor\" href=\"#例子解释\">#</a> 例子解释</h3>\n<p>在上面这个简单的例子里，涉及了 4 个实例。大部分时候，serverReq、serverRes 才是主角。</p>\n<ul>\n<li>server：http.Server 实例，用来提供服务，处理客户端的请求。</li>\n<li>client：http.ClientReques 实例，用来向服务端发起请求。</li>\n<li>serverReq/clientRes：其实都是 http.IncomingMessage 实例。serverReq 用来获取客户端请求的相关信息，如 request header；而 clientRes 用来获取服务端返回的相关信息，比如 response header。</li>\n<li>serverRes：http.ServerResponse 实例</li>\n</ul>\n<h3 id=\"关于httpincomingmessage-httpserverresponse\"><a class=\"anchor\" href=\"#关于httpincomingmessage-httpserverresponse\">#</a> 关于 http.IncomingMessage、http.ServerResponse</h3>\n<p>先讲下 http.ServerResponse 实例。作用很明确，服务端通过 http.ServerResponse 实例，来个请求方发送数据。包括发送响应表头，发送响应主体等。</p>\n<p>接下来是 http.IncomingMessage 实例，由于在 server、client 都出现了，初学者难免有点迷茫。它的作用是</p>\n<p>在 server 端：获取请求发送方的信息，比如请求方法、路径、传递的数据等。 在 client 端：获取 server 端发送过来的信息，比如请求方法、路径、传递的数据等。</p>\n<p>http.IncomingMessage 实例 有三个属性需要注意：method、statusCode、statusMessage。</p>\n<ul>\n<li>method：只在 server 端的实例有（也就是 serverReq.method）</li>\n<li>statusCode/statusMessage：只在 client 端 的实例有（也就是 clientRes.method）</li>\n</ul>\n<h2 id=\"网络服务-http-res\"><a class=\"anchor\" href=\"#网络服务-http-res\">#</a> 网络服务 http res</h2>\n<h3 id=\"概览\"><a class=\"anchor\" href=\"#概览\">#</a> 概览</h3>\n<p>http 模块四剑客之一的 <code>res</code> ，应该都不陌生了。一个 web 服务程序，接受到来自客户端的 http 请求后，向客户端返回正确的响应内容，这就是 <code>res</code>  的职责。</p>\n<p>返回的内容包括：状态代码 / 状态描述信息、响应头部、响应主体。下文会举几个简单的例子。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ok'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"例子\"><a class=\"anchor\" href=\"#例子\">#</a> 例子</h3>\n<p>在下面的例子中，我们同时设置了 状态代码 / 状态描述信息、响应头部、响应主体，就是这么简单。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 设置状态码、状态描述信息、响应主体</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ok'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/plain'</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"设置状态代码-状态描述信息\"><a class=\"anchor\" href=\"#设置状态代码-状态描述信息\">#</a> 设置状态代码、状态描述信息</h3>\n<p><code>res</code>  提供了 res.writeHead ()、res.statusCode/res.statusMessage 来实现这个目的。</p>\n<p>举例，如果想要设置 200/ok ，可以</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ok'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>也可以</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>res<span class=\"token punctuation\">.</span>statusCode <span class=\"token operator\">=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>res<span class=\"token punctuation\">.</span>statusMessage <span class=\"token operator\">=</span> <span class=\"token string\">'ok'</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>两者差不多，差异点在于</p>\n<ol>\n<li>res.writeHead () 可以提供额外的功能，比如设置响应头部。</li>\n<li>当响应头部发送出去后，res.statusCode/res.statusMessage 会被设置成已发送出去的 状态代码 / 状态描述信息。</li>\n</ol>\n<h3 id=\"设置响应头部\"><a class=\"anchor\" href=\"#设置响应头部\">#</a> 设置响应头部</h3>\n<p><code>res</code>  提供了 res.writeHead ()、response.setHeader () 来实现响应头部的设置。</p>\n<p>举例，比如想把  <code>Content-Type</code>  设置为  <code>text-plain</code> ，那么可以</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 方法一</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ok'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'text-plain'</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 方法二</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'text-plain'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>两者的差异点在哪里呢？</p>\n<ol>\n<li>res.writeHead () 不单单是设置 header。</li>\n<li>已经通过 res.setHeader () 设置了 header，当通过 res.writeHead () 设置同名 header，res.writeHead () 的设置会覆盖之前的设置。</li>\n</ol>\n<p>关于第 2 点差异，这里举个例子。下面代码，最终的  <code>Content-Type</code>  为  <code>text/plain</code> 。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">var</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'text/html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ok'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/plain'</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>而下面的例子，则直接报错。报错信息为  <code>Error: Can't set headers after they are sent.</code> 。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">var</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>    </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ok'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/plain'</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'text/html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"其他响应头部操作\"><a class=\"anchor\" href=\"#其他响应头部操作\">#</a> 其他响应头部操作</h3>\n<p>增、删、改、查 是配套的。下面分别举例说明下，例子太简单就直接上代码了。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 增</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 删</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>res<span class=\"token punctuation\">.</span><span class=\"token function\">removeHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 改</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'text/html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 覆盖</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 查</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>res<span class=\"token punctuation\">.</span><span class=\"token function\">getHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content-type'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>其中略显不同的是 res.getHeader (name)，name 用的是小写，返回值没做特殊处理。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'TEXT/HTML'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">getHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content-type'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// TEXT/HTML</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>res<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">getHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'content-type'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// text/plain</span></pre></td></tr></table></figure><p>此外，还有不那么常用的：</p>\n<ul>\n<li>res.headersSent：header 是否已经发送；</li>\n<li>res.sendDate：默认为 true。但为 true 时，会在 response header 里自动设置 Date 首部。</li>\n</ul>\n<h3 id=\"设置响应主体\"><a class=\"anchor\" href=\"#设置响应主体\">#</a> 设置响应主体</h3>\n<p>主要用到 res.write () 以及 res.end () 两个方法。</p>\n<p>res.write () API 的信息量略大，建议看下<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ub2RlanMub3JnL2FwaS9odHRwLmh0bWwjaHR0cF9yZXNwb25zZV93cml0ZV9jaHVua19lbmNvZGluZ19jYWxsYmFjaw==\">官方文档</span>。</p>\n<h4 id=\"responsewritechunk-encoding-callback\"><a class=\"anchor\" href=\"#responsewritechunk-encoding-callback\">#</a> response.write(chunk[, encoding][, callback])</h4>\n<ul>\n<li>chunk：响应主体的内容，可以是 string，也可以是 buffer。当为 string 时，encoding 参数用来指明编码方式。（默认是 utf8）</li>\n<li>encoding：编码方式，默认是 utf8。</li>\n<li>callback：当响应体 flushed 时触发。（TODO 这里想下更好的解释。。。）</li>\n</ul>\n<p>使用上没什么难度，只是有些注意事项：</p>\n<ol>\n<li>如果 res.write () 被调用时， res.writeHead () 还没被调用过，那么，就会把 header flush 出去。</li>\n<li>res.write () 可以被调用多次。</li>\n<li>当 res.write (chunk) 第一次被调用时，node 会将 header 信息 以及 chunk 发送到客户端。第二次调用 res.write (chunk) ，node 会认为你是要 streaming data（WTF，该怎么翻译）。。。</li>\n</ol>\n<blockquote>\n<p>Returns true if the entire data was flushed successfully to the kernel buffer. Returns false if all or part of the data was queued in user memory. 'drain' will be emitted when the buffer is free again.</p>\n</blockquote>\n<h4 id=\"responseenddata-encoding-callback\"><a class=\"anchor\" href=\"#responseenddata-encoding-callback\">#</a> response.end([data][, encoding][, callback])</h4>\n<p>掌握了 res.write () 的话，res.end () 就很简单了。res.end () 的用处是告诉 nodejs，header、body 都给你了，这次响应就到这里吧。</p>\n<p>有点像个语法糖，可以看成下面两个调用的组合。至于 callback，当响应传递结束后触发。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>res<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> encoding<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"超时处理\"><a class=\"anchor\" href=\"#超时处理\">#</a> 超时处理</h3>\n<p>接口：response.setTimeout (msecs, callback)</p>\n<p>关于 timeout 事件的说明，同样是言简意赅（WTF），话少信息量大，最好来个 demo TODO</p>\n<blockquote>\n<p>If no 'timeout' listener is added to the request, the response, or the server, then sockets are destroyed when they time out. If you assign a handler on the request, the response, or the server's 'timeout' events, then it is your responsibility to handle timed out sockets.</p>\n</blockquote>\n<h3 id=\"事件-closefinish\"><a class=\"anchor\" href=\"#事件-closefinish\">#</a> 事件 close/finish</h3>\n<ul>\n<li>close：response.end () 被调用前，连接就断开了。此时会触发这个事件。</li>\n<li>finish：响应 header、body 都已经发送出去（交给操作系统，排队等候传输），但客户端是否实际收到数据为止。（这个事件后，res 上就不会再有其他事件触发）</li>\n</ul>\n<h3 id=\"其他不常用属性方法\"><a class=\"anchor\" href=\"#其他不常用属性方法\">#</a> 其他不常用属性 / 方法</h3>\n<ul>\n<li>response.finished：一开始是 false，响应结束后，设置为 true。</li>\n<li>response.sendDate：默认是 true。是否自动设置 Date 头部。（按 HTTP 协议是必须要的，除非是调试用，不然不要设置为 false）</li>\n<li>response.headersSent：只读属性。响应头部是否已发送。</li>\n<li>response.writeContinue ()：发送 HTTP/1.1 100 Continue 消息给客户端，提示说服务端愿意接受客户端的请求，请继续发送请求正文（body)。（TODO 做个 demo 啥的是大大的好）</li>\n</ul>\n<h2 id=\"网络服务-http-req\"><a class=\"anchor\" href=\"#网络服务-http-req\">#</a> 网络服务 http req</h2>\n<h3 id=\"概览-2\"><a class=\"anchor\" href=\"#概览-2\">#</a> 概览</h3>\n<p>本文的重点会放在 <code>req</code>  这个对象上。前面已经提到，它其实是 http.IncomingMessage 实例，在服务端、客户端作用略微有差异</p>\n<ul>\n<li>服务端处：获取请求方的相关信息，如 request header 等。</li>\n<li>客户端处：获取响应方返回的相关信息，如 statusCode 等。</li>\n</ul>\n<p>服务端例子：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 下面的 req</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">var</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ok'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>客户端例子</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 下面的 res</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>http<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://127.0.0.1:3000'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>statusCode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"属性方法事件-分类\"><a class=\"anchor\" href=\"#属性方法事件-分类\">#</a> 属性 / 方法 / 事件 分类</h3>\n<p>http.IncomingMessage 的属性 / 方法 / 事件 不是特别多，按照是否客户端 / 服务端 特有的，下面进行简单归类。可以看到</p>\n<ul>\n<li>服务端处特有：url</li>\n<li>客户端处特有：statusCode、statusMessage</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">类型</th>\n<th style=\"text-align:center\">名称</th>\n<th style=\"text-align:center\">服务端</th>\n<th style=\"text-align:center\">客户端</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">事件</td>\n<td style=\"text-align:center\">aborted</td>\n<td style=\"text-align:center\">✓</td>\n<td style=\"text-align:center\">✓</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">事件</td>\n<td style=\"text-align:center\">close</td>\n<td style=\"text-align:center\">✓</td>\n<td style=\"text-align:center\">✓</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">属性</td>\n<td style=\"text-align:center\">headers</td>\n<td style=\"text-align:center\">✓</td>\n<td style=\"text-align:center\">✓</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">属性</td>\n<td style=\"text-align:center\">rawHeaders</td>\n<td style=\"text-align:center\">✓</td>\n<td style=\"text-align:center\">✓</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">属性</td>\n<td style=\"text-align:center\">statusCode</td>\n<td style=\"text-align:center\">✕</td>\n<td style=\"text-align:center\">✓</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">属性</td>\n<td style=\"text-align:center\">statusMessage</td>\n<td style=\"text-align:center\">✕</td>\n<td style=\"text-align:center\">✓</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">属性</td>\n<td style=\"text-align:center\">httpVersion</td>\n<td style=\"text-align:center\">✓</td>\n<td style=\"text-align:center\">✓</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">属性</td>\n<td style=\"text-align:center\">url</td>\n<td style=\"text-align:center\">✓</td>\n<td style=\"text-align:center\">✕</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">属性</td>\n<td style=\"text-align:center\">socket</td>\n<td style=\"text-align:center\">✓</td>\n<td style=\"text-align:center\">✓</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">方法</td>\n<td style=\"text-align:center\">.destroy()</td>\n<td style=\"text-align:center\">✓</td>\n<td style=\"text-align:center\">✓</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">方法</td>\n<td style=\"text-align:center\">.setTimeout()</td>\n<td style=\"text-align:center\">✓</td>\n<td style=\"text-align:center\">✓</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"服务端的例子\"><a class=\"anchor\" href=\"#服务端的例子\">#</a> 服务端的例子</h3>\n<h4 id=\"例子一获取httpversionmethodurl\"><a class=\"anchor\" href=\"#例子一获取httpversionmethodurl\">#</a> 例子一：获取 httpVersion/method/url</h4>\n<p>下面是一个典型的 HTTP 请求报文，里面最重要的内容包括：HTTP 版本、请求方法、请求地址、请求头部。</p>\n<figure class=\"highlight http\"><figcaption data-lang=\"HTTP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token request-line\"><span class=\"token method property\">GET</span> <span class=\"token request-target url\">/hello</span> <span class=\"token http-version property\">HTTP/1.1</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token header\"><span class=\"token header-name keyword\">Host</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">127.0.0.1:3000</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token header\"><span class=\"token header-name keyword\">Connection</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">keep-alive</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token header\"><span class=\"token header-name keyword\">Cache-Control</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">no-cache</span></span></pre></td></tr></table></figure><p>那么，如何获取上面提到的信息呢？很简单，直接上代码</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// getClientInfo.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">'1、客户端请求url：'</span> <span class=\"token operator\">+</span> req<span class=\"token punctuation\">.</span>url <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">'2、http版本：'</span> <span class=\"token operator\">+</span> req<span class=\"token punctuation\">.</span>httpVersion <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">'3、http请求方法：'</span> <span class=\"token operator\">+</span> req<span class=\"token punctuation\">.</span>method <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">'4、http请求头部'</span> <span class=\"token operator\">+</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ok'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>效果如下：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1</span>、客户端请求url：/hello</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2</span>、http版本：1.1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">3</span>、http请求方法：GET</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">4</span>、http headers：<span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"host\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"127.0.0.1:3000\"</span>,<span class=\"token string\">\"connection\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"keep-alive\"</span>,<span class=\"token string\">\"cache-control\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"no-cache\"</span>,\"user-age</pre></td></tr></table></figure><h4 id=\"例子二获取get请求参数\"><a class=\"anchor\" href=\"#例子二获取get请求参数\">#</a> 例子二：获取 get 请求参数</h4>\n<p>服务端代码如下：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// getClientGetQuery.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'url'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> querystring <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'querystring'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">var</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">var</span> urlObj <span class=\"token operator\">=</span> url<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">var</span> query <span class=\"token operator\">=</span> urlObj<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">var</span> queryObj <span class=\"token operator\">=</span> querystring<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>queryObj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ok'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>访问地址 <span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMTozMDAwL2hlbGxvP25pY2s9Y2h5aW5ncCZhbXA7aGVsbG89d29ybGQ=\">http://127.0.0.1:3000/hello?nick=chyingp&amp;hello=world</span></p>\n<p>服务端输出如下</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"nick\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"chyingp\"</span>,<span class=\"token string\">\"hello\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"world\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"例子三获取post请求参数\"><a class=\"anchor\" href=\"#例子三获取post请求参数\">#</a> 例子三：获取 post 请求参数</h4>\n<p>服务端代码如下</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// getClientPostBody.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'url'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> querystring <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'querystring'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">var</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">var</span> body <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    req<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">thunk</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        body <span class=\"token operator\">+=</span> thunk<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    req<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> <span class=\"token string\">'post body is: '</span> <span class=\"token operator\">+</span> body <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ok'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>通过 curl 构造 post 请求：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">'nick=casper&amp;hello=world'</span> http://127.0.0.1:3000</pre></td></tr></table></figure><p>服务端打印如下：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>post body is: <span class=\"token assign-left variable\">nick</span><span class=\"token operator\">=</span>casper<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">hello</span><span class=\"token operator\">=</span>world</pre></td></tr></table></figure><p>备注：post 请求中，不同的 <code>Content-type</code> ，post body 有不小差异，感兴趣的同学可以研究下。</p>\n<p>本例中的 post 请求，HTTP 报文大概如下</p>\n<figure class=\"highlight http\"><figcaption data-lang=\"HTTP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token request-line\"><span class=\"token method property\">POST</span> <span class=\"token request-target url\">/</span> <span class=\"token http-version property\">HTTP/1.1</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token header\"><span class=\"token header-name keyword\">Host</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">127.0.0.1:3000</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token header\"><span class=\"token header-name keyword\">Content-Type</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">application/x-www-form-urlencoded</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token header\"><span class=\"token header-name keyword\">Cache-Control</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">no-cache</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>nick=casper&amp;hello=world</pre></td></tr></table></figure><h2 id=\"网络服务-https\"><a class=\"anchor\" href=\"#网络服务-https\">#</a> 网络服务 https</h2>\n<h3 id=\"模块概览\"><a class=\"anchor\" href=\"#模块概览\">#</a> 模块概览</h3>\n<p>这个模块的重要性，基本不用强调了。在网络安全问题日益严峻的今天，网站采用 HTTPS 是个必然的趋势。</p>\n<p>在 nodejs 中，提供了 https 这个模块来完成 HTTPS 相关功能。从官方文档来看，跟 http 模块用法非常相似。</p>\n<p>本文主要包含两部分：</p>\n<ol>\n<li>通过客户端、服务端的例子，对 https 模块进行入门讲解。</li>\n<li>如何访问安全证书不受信任的网站。（以 12306 为例子）</li>\n</ol>\n<p>篇幅所限，本文无法对 HTTPS 协议 及 相关技术体系 做过多讲解，有问题欢迎留言交流。</p>\n<h3 id=\"客户端例子\"><a class=\"anchor\" href=\"#客户端例子\">#</a> 客户端例子</h3>\n<p>跟 http 模块的用法非常像，只不过请求的地址是 https 协议的而已，代码如下：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> https <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>https<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://www.baidu.com'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'status code: '</span> <span class=\"token operator\">+</span> res<span class=\"token punctuation\">.</span>statusCode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'headers: '</span> <span class=\"token operator\">+</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"服务端例子\"><a class=\"anchor\" href=\"#服务端例子\">#</a> 服务端例子</h3>\n<p>对外提供 HTTPS 服务，需要有 HTTPS 证书。如果你已经有了 HTTPS 证书，那么可以跳过证书生成的环节。如果没有，可以参考如下步骤</p>\n<h4 id=\"生成证书\"><a class=\"anchor\" href=\"#生成证书\">#</a> 生成证书</h4>\n<p><strong>1. 创建个目录存放证书。</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> cert</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">cd</span> cert</pre></td></tr></table></figure><p><strong>2. 生成私钥。</strong></p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl genrsa -out chyingp-key.pem 2048</pre></td></tr></table></figure><p><strong>3. 生成证书签名请求（csr 是 Certificate Signing Request 的意思）。</strong></p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl req -new \\</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  -sha256</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  -key chyingp-key.key.pem \\</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  -out chyingp-csr.pem \\</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  -subj \"/C=CN/ST=Guandong/L=Shenzhen/O=YH Inc/CN=www.chyingp.com\"</pre></td></tr></table></figure><p><strong>4. 生成证书。</strong></p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>openssl x509 \\</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  -req -in chyingp-csr.pem \\</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  -signkey chyingp-key.pem \\</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  -out chyingp-cert.pem</pre></td></tr></table></figure><h4 id=\"https服务端\"><a class=\"anchor\" href=\"#https服务端\">#</a> HTTPS 服务端</h4>\n<p>代码如下：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> https <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./cert/chyingp-key.pem'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 私钥</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token literal-property property\">cert</span><span class=\"token operator\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./cert/chyingp-cert.pem'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 证书</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">var</span> server <span class=\"token operator\">=</span> https<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">'这是来自HTTPS服务器的返回'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>由于我并没有 <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jaHlpbmdwLmNvbQ==\">www.chyingp.com</span> 这个域名，于是先配置本地 host</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>127.0.0.1 www.chyingp.com</pre></td></tr></table></figure><p>启动服务，并在浏览器里访问 <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jaHlpbmdwLmNvbTozMDAwLw==\">http://www.chyingp.com:3000</span>。注意，浏览器会提示你证书不可靠，点击 信任并继续访问 就行了。</p>\n<h2 id=\"url-接口代替内置模块url使用\"><a class=\"anchor\" href=\"#url-接口代替内置模块url使用\">#</a> URL 接口 (代替内置模块 url 使用)</h2>\n<blockquote>\n<p>nodejs 内置模块 <code>url</code>  有些方法要被废弃，我们使用 <code>URL类</code> 代替</p>\n</blockquote>\n<p>浏览器原生提供 <code>URL()</code>  接口，它是一个构造函数，用来构造、解析和编码 URL。一般情况下，通过 <code>window.URL</code>  可以拿到这个构造函数。</p>\n<h3 id=\"71-对比url模块和url类\"><a class=\"anchor\" href=\"#71-对比url模块和url类\">#</a> 7.1 对比 <code>url模块</code> 和 URL 类</h3>\n<table>\n<thead>\n<tr>\n<th>属性</th>\n<th>url 模块</th>\n<th>URL 类</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>protocol</td>\n<td><code>✅</code></td>\n<td><code>✅</code></td>\n</tr>\n<tr>\n<td>host</td>\n<td><code>✅</code></td>\n<td><code>✅</code></td>\n</tr>\n<tr>\n<td>port</td>\n<td><code>✅</code></td>\n<td><code>✅</code></td>\n</tr>\n<tr>\n<td>hostname</td>\n<td><code>✅</code></td>\n<td><code>✅</code></td>\n</tr>\n<tr>\n<td>search</td>\n<td><code>✅</code></td>\n<td><code>✅</code></td>\n</tr>\n<tr>\n<td>query</td>\n<td><code>✅</code></td>\n<td><code>-</code></td>\n</tr>\n<tr>\n<td>path</td>\n<td><code>✅</code></td>\n<td><code>-</code></td>\n</tr>\n<tr>\n<td>pathname</td>\n<td><code>✅</code></td>\n<td><code>✅</code></td>\n</tr>\n<tr>\n<td>href</td>\n<td><code>✅</code></td>\n<td><code>✅</code></td>\n</tr>\n<tr>\n<td>hash</td>\n<td><code>✅</code></td>\n<td><code>✅</code></td>\n</tr>\n<tr>\n<td>origin</td>\n<td>-</td>\n<td><code>✅</code></td>\n</tr>\n</tbody>\n</table>\n<p>可以看出来，只有三个字段不同，分别是 <code>query</code> , <code>path</code> , <code>origin</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>打印两个对象的输出</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//url 模块，url.parse ('link')</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token literal-property property\">protocol</span><span class=\"token operator\">:</span> <span class=\"token string\">'https:'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token literal-property property\">slashes</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token literal-property property\">auth</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token literal-property property\">host</span><span class=\"token operator\">:</span> <span class=\"token string\">'m.shop.com'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token literal-property property\">port</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token literal-property property\">hostname</span><span class=\"token operator\">:</span> <span class=\"token string\">'m.shop.com'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token literal-property property\">hash</span><span class=\"token operator\">:</span> <span class=\"token string\">'#detail'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token literal-property property\">search</span><span class=\"token operator\">:</span> <span class=\"token string\">'?id=4433&amp;name=%E6%9D%8E%E5%A4%87&amp;directCompanyId=&amp;mobile=18951431099'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token literal-property property\">query</span><span class=\"token operator\">:</span> <span class=\"token string\">'id=4433&amp;name=%E6%9D%8E%E5%A4%87&amp;directCompanyId=&amp;mobile=18951431099'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token literal-property property\">pathname</span><span class=\"token operator\">:</span> <span class=\"token string\">'/home/share'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token string\">'/home/share?id=4433&amp;name=%E6%9D%8E%E5%A4%87&amp;directCompanyId=&amp;mobile=18951431099'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token literal-property property\">href</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://m.shop.com/home/share?id=4433&amp;name=%E6%9D%8E%E5%A4%87&amp;directCompanyId=&amp;mobile=18951431099#detail'</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">// new URL()</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token literal-property property\">href</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://m.shop.com/home/share?id=4433&amp;name=%E6%9D%8E%E5%A4%87&amp;directCompanyId=&amp;mobile=18951431099#detail'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token literal-property property\">origin</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://m.shop.com'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token literal-property property\">protocol</span><span class=\"token operator\">:</span> <span class=\"token string\">'https:'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token literal-property property\">username</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token literal-property property\">password</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token literal-property property\">host</span><span class=\"token operator\">:</span> <span class=\"token string\">'m.shop.com'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token literal-property property\">hostname</span><span class=\"token operator\">:</span> <span class=\"token string\">'m.shop.com'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token literal-property property\">port</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token literal-property property\">pathname</span><span class=\"token operator\">:</span> <span class=\"token string\">'/home/share'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token literal-property property\">search</span><span class=\"token operator\">:</span> <span class=\"token string\">'?id=4433&amp;name=%E6%9D%8E%E5%A4%87&amp;directCompanyId=&amp;mobile=18951431099'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token literal-property property\">searchParams</span><span class=\"token operator\">:</span> URLSearchParams <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token string\">'id'</span> <span class=\"token operator\">=></span> <span class=\"token string\">'4433'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token string\">'name'</span> <span class=\"token operator\">=></span> <span class=\"token string\">'李备'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token string\">'directCompanyId'</span> <span class=\"token operator\">=></span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token string\">'mobile'</span> <span class=\"token operator\">=></span> <span class=\"token string\">'18951431099'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token literal-property property\">hash</span><span class=\"token operator\">:</span> <span class=\"token string\">'#detail'</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"构造函数\"><a class=\"anchor\" href=\"#构造函数\">#</a> 构造函数</h3>\n<p><code>URL()</code>  作为构造函数，可以生成 URL 实例。它接受一个表示 URL 的字符串作为参数。如果参数不是合法的 URL，会报错。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://www.example.com/index.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>url<span class=\"token punctuation\">.</span>href</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// \"http://www.example.com/index.html\"</span></pre></td></tr></table></figure><p>上面示例生成了一个 URL 实例，用来代表指定的网址。</p>\n<p>除了字符串， <code>URL()</code>  的参数也可以是另一个 URL 实例。这时， <code>URL()</code>  会自动读取该实例的 <code>href</code>  属性，作为实际参数。</p>\n<p>如果 URL 字符串是一个相对路径，那么需要表示绝对路径的第二个参数，作为计算基准。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> url1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index.html'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'http://example.com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>url1<span class=\"token punctuation\">.</span>href</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// \"http://example.com/index.html\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">var</span> url2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">'page2.html'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'http://example.com/page1.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>url2<span class=\"token punctuation\">.</span>href</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// \"http://example.com/page2.html\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">var</span> url3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">'..'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'http://example.com/a/b.html'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>url3<span class=\"token punctuation\">.</span>href</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// \"http://example.com/\"</span></pre></td></tr></table></figure><p>上面代码中，返回的 URL 实例的路径都是在第二个参数的基础上，切换到第一个参数得到的。最后一个例子里面，第一个参数是 <code>..</code> ，表示上层路径。</p>\n<h3 id=\"实例属性\"><a class=\"anchor\" href=\"#实例属性\">#</a> 实例属性</h3>\n<p>URL 实例的属性与 <code>Location</code>  对象的属性基本一致，返回当前 URL 的信息。</p>\n<ul>\n<li>URL.href：返回整个 URL</li>\n<li>URL.protocol：返回协议，以冒号 <code>:</code>  结尾</li>\n<li>URL.hostname：返回域名</li>\n<li>URL.host：返回域名与端口，包含 <code>:</code>  号，默认的 80 和 443 端口会省略</li>\n<li>URL.port：返回端口</li>\n<li>URL.origin：返回协议、域名和端口</li>\n<li>URL.pathname：返回路径，以斜杠 <code>/</code>  开头</li>\n<li>URL.search：返回查询字符串，以问号 <code>?</code>  开头</li>\n<li>URL.searchParams：返回一个 <code>URLSearchParams</code>  实例，该属性是 <code>Location</code>  对象没有的</li>\n<li>URL.hash：返回片段识别符，以井号 <code>#</code> 开头</li>\n<li>URL.password：返回域名前面的密码</li>\n<li>URL.username：返回域名前面的用户名</li>\n</ul>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://user:passwd@www.example.com:4097/path/a.html?x=111#part1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>url<span class=\"token punctuation\">.</span>href</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// \"http://user:passwd@www.example.com:4097/path/a.html?x=111#part1\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>url<span class=\"token punctuation\">.</span>protocol</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// \"http:\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>url<span class=\"token punctuation\">.</span>hostname</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// \"www.example.com\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>url<span class=\"token punctuation\">.</span>host</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// \"www.example.com:4097\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>url<span class=\"token punctuation\">.</span>port</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// \"4097\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>url<span class=\"token punctuation\">.</span>origin</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// \"http://www.example.com:4097\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>url<span class=\"token punctuation\">.</span>pathname</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">// \"/path/a.html\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>url<span class=\"token punctuation\">.</span>search</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">// \"?x=111\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>url<span class=\"token punctuation\">.</span>searchParams</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">// URLSearchParams &#123;&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>url<span class=\"token punctuation\">.</span>hash</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">// \"#part1\"</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>url<span class=\"token punctuation\">.</span>password</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">// \"passwd\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>url<span class=\"token punctuation\">.</span>username</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">// \"user\"</span></pre></td></tr></table></figure><p>这些属性里面，只有 <code>origin</code>  属性是只读的，其他属性都可写，并且会立即生效。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://example.com/index.html#part1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>url<span class=\"token punctuation\">.</span>pathname <span class=\"token operator\">=</span> <span class=\"token string\">'index2.html'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>url<span class=\"token punctuation\">.</span>href <span class=\"token comment\">// \"http://example.com/index2.html#part1\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>url<span class=\"token punctuation\">.</span>hash <span class=\"token operator\">=</span> <span class=\"token string\">'#part2'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>url<span class=\"token punctuation\">.</span>href <span class=\"token comment\">// \"http://example.com/index2.html#part2\"</span></pre></td></tr></table></figure><p>上面代码中，改变 URL 实例的 <code>pathname</code>  属性和 <code>hash</code>  属性，都会实时反映在 URL 实例当中。</p>\n<h2 id=\"urlsearchparams-对象代替内置模块querystring使用\"><a class=\"anchor\" href=\"#urlsearchparams-对象代替内置模块querystring使用\">#</a> URLSearchParams 对象 (代替内置模块 querystring 使用)</h2>\n<blockquote>\n<ol>\n<li>\n<p>nodejs 内置模块 <code>querystring</code>  有些方法要被废弃，我们使用 <code>URLSearchParams API </code> 构造代替</p>\n</li>\n<li>\n<p>如果你的 nodejs 版本大于 18，可以使用 <code>const querystring= require('node:querystring')</code> <br />\n``querystring <code>比</code>  URLSearchParams <code>性能更高，但不是 标准化的 API。使用</code>  URLSearchParams` 当性能不重要或 当需要与浏览器代码兼容时。</p>\n</li>\n<li>\n<p>还可以安装 <code>qs</code>  模块，使用方式和 <code>querystring</code>  一样</p>\n</li>\n</ol>\n</blockquote>\n<h3 id=\"概述\"><a class=\"anchor\" href=\"#概述\">#</a> 概述</h3>\n<p><code>URLSearchParams</code>  对象是浏览器的原生对象，用来构造、解析和处理 URL 的查询字符串（即 URL 问号后面的部分）。</p>\n<p>它本身也是一个构造函数，可以生成实例。参数可以为查询字符串，起首的问号 <code>?</code>  有没有都行，也可以是对应查询字符串的数组或对象。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 方法一：传入字符串</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token string\">'?foo=1&amp;bar=2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 等同于</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>search<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 方法二：传入数组</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 方法三：传入对象</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string-property property\">'foo'</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">,</span> <span class=\"token string-property property\">'bar'</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>URLSearchParams</code>  会对查询字符串自动编码。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string-property property\">'foo'</span><span class=\"token operator\">:</span> <span class=\"token string\">'你好'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>params<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// \"foo=%E4%BD%A0%E5%A5%BD\"</span></pre></td></tr></table></figure><p>上面代码中， <code>foo</code>  的值是汉字， <code>URLSearchParams</code>  对其自动进行 URL 编码。</p>\n<p>浏览器向服务器发送表单数据时，可以直接使用 <code>URLSearchParams</code>  实例作为表单数据。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">bar</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://example.com/api'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> params</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>上面代码中， <code>fetch</code>  命令向服务器发送命令时，可以直接使用 <code>URLSearchParams</code>  实例。</p>\n<p><code>URLSearchParams</code>  可以与 <code>URL()</code>  接口结合使用。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> foo <span class=\"token operator\">=</span> url<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string\">'somedefault'</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>上面代码中，URL 实例的 <code>searchParams</code>  属性就是一个 <code>URLSearchParams</code>  实例，所以可以使用 <code>URLSearchParams</code>  接口的 <code>get</code>  方法。</p>\n<p><code>URLSearchParams</code>  实例有遍历器接口，可以用 <code>for...of</code>  循环遍历。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string-property property\">'foo'</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">,</span> <span class=\"token string-property property\">'bar'</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> p <span class=\"token keyword\">of</span> params<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token string\">': '</span> <span class=\"token operator\">+</span> p<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// foo: 1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// bar: 2</span></pre></td></tr></table></figure><p><code>URLSearchParams</code>  没有实例属性，只有实例方法。</p>\n<h3 id=\"urlsearchparamstostring\"><a class=\"anchor\" href=\"#urlsearchparamstostring\">#</a> URLSearchParams.toString()</h3>\n<p><code>toString</code>  方法返回实例的字符串形式。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://example.com?foo=1&amp;bar=2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">.</span>search<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>params<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// \"foo=1&amp;bar=2'</span></pre></td></tr></table></figure><p>那么需要字符串的场合，会自动调用 <code>toString</code>  方法。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">version</span><span class=\"token operator\">:</span> <span class=\"token number\">2.0</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> location<span class=\"token punctuation\">.</span>pathname <span class=\"token operator\">+</span> <span class=\"token string\">'?'</span> <span class=\"token operator\">+</span> params<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>上面代码中， <code>location.href</code>  赋值时，可以直接使用 <code>params</code>  对象。这时就会自动调用 <code>toString</code>  方法。</p>\n<h3 id=\"urlsearchparamshas\"><a class=\"anchor\" href=\"#urlsearchparamshas\">#</a> URLSearchParams.has()</h3>\n<p><code>has()</code>  方法返回一个布尔值，表示查询字符串是否包含指定的键名。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string-property property\">'foo'</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">,</span> <span class=\"token string-property property\">'bar'</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>params<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>params<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span><span class=\"token string\">'baz'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// false</span></pre></td></tr></table></figure><h3 id=\"urlsearchparamsgeturlsearchparamsgetall\"><a class=\"anchor\" href=\"#urlsearchparamsgeturlsearchparamsgetall\">#</a> URLSearchParams.get()，URLSearchParams.getAll()</h3>\n<p><code>get()</code>  方法用来读取查询字符串里面的指定键。它接受键名作为参数。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token string\">'?foo=1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// \"1\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// null</span></pre></td></tr></table></figure><p>两个地方需要注意。第一，它返回的是字符串，如果原始值是数值，需要转一下类型；第二，如果指定的键名不存在，返回值是 <code>null</code> 。</p>\n<p>如果有多个的同名键， <code>get</code>  返回位置最前面的那个键值。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token string\">'?foo=3&amp;foo=2&amp;foo=1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// \"3\"</span></pre></td></tr></table></figure><p>上面代码中，查询字符串有三个 <code>foo</code>  键， <code>get</code>  方法返回最前面的键值 <code>3</code> 。</p>\n<p><code>getAll()</code>  方法返回一个数组，成员是指定键的所有键值。它接受键名作为参数。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token string\">'?foo=1&amp;foo=2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>params<span class=\"token punctuation\">.</span><span class=\"token function\">getAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// [\"1\", \"2\"]</span></pre></td></tr></table></figure><p>上面代码中，查询字符串有两个 <code>foo</code>  键， <code>getAll</code>  返回的数组就有两个成员。</p>\n<h3 id=\"urlsearchparamskeysurlsearchparamsvaluesurlsearchparamsentries\"><a class=\"anchor\" href=\"#urlsearchparamskeysurlsearchparamsvaluesurlsearchparamsentries\">#</a> URLSearchParams.keys()，URLSearchParams.values()，URLSearchParams.entries()</h3>\n<p>这三个方法都返回一个遍历器对象，供 <code>for...of</code>  循环遍历。它们的区别在于， <code>keys</code>  方法返回的是键名的遍历器， <code>values</code>  方法返回的是键值的遍历器， <code>entries</code>  返回的是键值对的遍历器。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a=1&amp;b=2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> p <span class=\"token keyword\">of</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// a</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// b</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> p <span class=\"token keyword\">of</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 1</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// 2</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> p <span class=\"token keyword\">of</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">// [\"a\", \"1\"]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">// [\"b\", \"2\"]</span></pre></td></tr></table></figure><p>如果直接对 <code>URLSearchParams</code>  进行遍历，其实内部调用的就是 <code>entries</code>  接口。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> p <span class=\"token keyword\">of</span> params<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// 等同于</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> p <span class=\"token keyword\">of</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"qs模块\"><a class=\"anchor\" href=\"#qs模块\">#</a> qs 模块</h2>\n<p>qs 是一个 npm 仓库所管理的包，可通过 npm install qs 命令进行安装.</p>\n<ol>\n<li>qs.parse () 将 URL 解析成对象的形式</li>\n<li>qs.stringify () 将对象 序列化成 URL 的形式，以 &amp; 进行拼接</li>\n</ol>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> qs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'qs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1</span><span class=\"token punctuation\">.</span>qs<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"username='admin'&amp;password='123456'\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>qs<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// Object &#123; username: \"admin\", password: \"123456\" &#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">2</span><span class=\"token punctuation\">.</span>qs<span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">const</span> a <span class=\"token operator\">=</span> qs<span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">username</span><span class=\"token operator\">:</span> <span class=\"token string\">'admin'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">password</span><span class=\"token operator\">:</span> <span class=\"token string\">'123456'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// username=admin&amp;password=123456</span></pre></td></tr></table></figure><figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>qs<span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> 和<span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>有什么区别<span class=\"token operator\">?</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">var</span> a <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">'hehe'</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span><span class=\"token number\">10</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>qs<span class=\"token punctuation\">.</span>stringify序列化结果如</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>name<span class=\"token operator\">=</span>hehe<span class=\"token operator\">&amp;</span>age<span class=\"token operator\">=</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>而<span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>stringify序列化结果如下：</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token string\">\"&#123;\"</span>a<span class=\"token string\">\":\"</span>hehe<span class=\"token string\">\",\"</span>age<span class=\"token string\">\":10&#125;\"</span></pre></td></tr></table></figure><h1 id=\"06-nodejs内置模块中\"><a class=\"anchor\" href=\"#06-nodejs内置模块中\">#</a> 06 【nodejs 内置模块（中）】</h1>\n<h2 id=\"1路劲处理模块-path\"><a class=\"anchor\" href=\"#1路劲处理模块-path\">#</a> 1. 路劲处理模块 path</h2>\n<h3 id=\"11-模块概览\"><a class=\"anchor\" href=\"#11-模块概览\">#</a> 1.1 模块概览</h3>\n<p>在 nodejs 中，path 是个使用频率很高，但却让人又爱又恨的模块。部分因为文档说的不够清晰，部分因为接口的平台差异性。</p>\n<p>将 path 的接口按照用途归类，仔细琢磨琢磨，也就没那么费解了。</p>\n<h3 id=\"12-获取路径文件名扩展名\"><a class=\"anchor\" href=\"#12-获取路径文件名扩展名\">#</a> 1.2 获取路径 / 文件名 / 扩展名</h3>\n<ul>\n<li>获取路径：path.dirname (filepath)</li>\n<li>获取文件名：path.basename (filepath)</li>\n<li>获取扩展名：path.extname (filepath)</li>\n</ul>\n<h4 id=\"121-获取所在路径\"><a class=\"anchor\" href=\"#121-获取所在路径\">#</a> 1.2.1 获取所在路径</h4>\n<p>例子如下：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> filepath <span class=\"token operator\">=</span> <span class=\"token string\">'/tmp/demo/js/test.js'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 输出：/tmp/demo/js</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">dirname</span><span class=\"token punctuation\">(</span>filepath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"122-获取文件名\"><a class=\"anchor\" href=\"#122-获取文件名\">#</a> 1.2.2 获取文件名</h4>\n<p>严格意义上来说，path.basename (filepath) 只是输出路径的最后一部分，并不会判断是否文件名。</p>\n<p>但大部分时候，我们可以用它来作为简易的 “获取文件名 “的方法。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 输出：test.js</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">basename</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/tmp/demo/js/test.js'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 输出：test</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">basename</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/tmp/demo/js/test/'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 输出：test</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">basename</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/tmp/demo/js/test'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>如果只想获取文件名，单不包括文件扩展呢？可以用上第二个参数。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 输出：test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">basename</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/tmp/demo/js/test.js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.js'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"123-获取文件扩展名\"><a class=\"anchor\" href=\"#123-获取文件扩展名\">#</a> 1.2.3 获取文件扩展名</h4>\n<p>简单的例子如下：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> filepath <span class=\"token operator\">=</span> <span class=\"token string\">'/tmp/demo/js/test.js'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 输出：.js</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">extname</span><span class=\"token punctuation\">(</span>filepath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>更详细的规则是如下：（假设 path.basename (filepath) === B ）</p>\n<ul>\n<li>从 B 的最后一个 <code>.</code>  开始截取，直到最后一个字符。</li>\n<li>如果 B 中不存在 <code>.</code> ，或者 B 的第一个字符就是 <code>.</code> ，那么返回空字符串。</li>\n</ul>\n<p>直接看<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ub2RlanMub3JnL2FwaS9wYXRoLmh0bWwjcGF0aF9wYXRoX2V4dG5hbWVfcGF0aA==\">官方文档</span>的例子</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>path<span class=\"token punctuation\">.</span><span class=\"token function\">extname</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index.html'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// returns '.html'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>path<span class=\"token punctuation\">.</span><span class=\"token function\">extname</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index.coffee.md'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// returns '.md'</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>path<span class=\"token punctuation\">.</span><span class=\"token function\">extname</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index.'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// returns '.'</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>path<span class=\"token punctuation\">.</span><span class=\"token function\">extname</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// returns ''</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>path<span class=\"token punctuation\">.</span><span class=\"token function\">extname</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.index'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// returns ''</span></pre></td></tr></table></figure><h3 id=\"13-路径组合\"><a class=\"anchor\" href=\"#13-路径组合\">#</a> 1.3 路径组合</h3>\n<ul>\n<li>path.join([...paths])</li>\n<li>path.resolve([...paths])</li>\n</ul>\n<h4 id=\"131-pathresolve-生成完成的绝对路径\"><a class=\"anchor\" href=\"#131-pathresolve-生成完成的绝对路径\">#</a> 1.3.1 path.resolve () 生成完成的绝对路径</h4>\n<p>语法格式：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>myPaths<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>解释：</p>\n<ul>\n<li>将路径或路径片段的序列解析为绝对路径。</li>\n<li>返回的路径是<strong>从右往左</strong>处理，后面的每个 myPath 被依次解析，直到构造出一个完整的绝对路径。</li>\n</ul>\n<blockquote>\n<p>你可以想象现在你在 shell 下面，从左到右运行一遍 <code>cd path</code>  命令，最终获取的绝对路径 / 文件名，就是这个接口所返回的结果了。</p>\n</blockquote>\n<p>代码举例：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">let</span> arr1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'/foo1/foo2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'dselegent'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'foo3'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> result1 <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>arr1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 打印结果：/foo1/foo2/dselegent/foo3</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">let</span> arr2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'/foo1/foo2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/dselegent'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'foo3'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">let</span> result2 <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>arr2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 打印结果：/dselegent/foo3</span></pre></td></tr></table></figure><figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 假设当前工作路径是 /Users/a/Documents/git-code/nodejs-learning-guide/examples/2016.11.08-node-path</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 输出 /Users/a/Documents/git-code/nodejs-learning-guide/examples/2016.11.08-node-path</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// 输出 /Users/a/Documents/git-code/nodejs-learning-guide/examples/2016.11.08-node-path</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 输出 /foo/bar/baz</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/foo/bar'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'./baz'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// 输出 /foo/bar/baz</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/foo/bar'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'./baz/'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">// 输出 /tmp/file</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/foo/bar'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/tmp/file/'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">// 输出 /Users/a/Documents/git-code/nodejs-learning-guide/examples/2016.11.08-node-path/www/js/mod.js</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'www'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'js/upload'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'../mod.js'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"132-pathjoin-将多个路径进行拼接\"><a class=\"anchor\" href=\"#132-pathjoin-将多个路径进行拼接\">#</a> 1.3.2 path.join () 将多个路径进行拼接</h4>\n<p>如果是我们手动拼接路径，容易出错。这个时候，可以利用 path.join () 方法将路径进行拼接。</p>\n<p>语法格式：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>paths<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>解释：使用平台特定的分隔符作为定界符将所有给定的 path 片段连接在一起，然后规范化生成的路径。</p>\n<p>代码举例：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> result1 <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'./app.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 返回：/Users/smyhvae/dselegent/app.js</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">const</span> result2 <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/foo1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'foo2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'./foo3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 返回：/foo1/foo2/foo3</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">const</span> result3 <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/foo1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'foo2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/foo3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 返回：/foo1/foo2/foo3</span></pre></td></tr></table></figure><h4 id=\"133-pathresolve-和-pathjoin-区别\"><a class=\"anchor\" href=\"#133-pathresolve-和-pathjoin-区别\">#</a> 1.3.3 path.resolve 和 path.join 区别</h4>\n<p>path.resolve 和 path.join 都是属于 path 核心模块下的方法，用来拼接路径。</p>\n<p>都可以拼接成一个完整路径.</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">var</span> dirname <span class=\"token operator\">=</span> <span class=\"token string\">'/User/Desktop'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> basename <span class=\"token operator\">=</span> <span class=\"token string\">'abc.txt'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>dirname<span class=\"token punctuation\">,</span> basename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// /User/Desktop/abc.txt</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>dirname<span class=\"token punctuation\">,</span> basename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// /User/Desktop/abc.txt</span></pre></td></tr></table></figure><p>如果 dirname 是以 ./ 、../、不加 / 开头的话，那么 resolve 会找到磁盘下的根目录</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">var</span> dirname <span class=\"token operator\">=</span> <span class=\"token string\">'../User/Desktop'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> basename <span class=\"token operator\">=</span> <span class=\"token string\">'abc.txt'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>dirname<span class=\"token punctuation\">,</span> basename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// ../User/Desktop/abc.txt</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>dirname<span class=\"token punctuation\">,</span> basename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// /Users/Desktop/node/User/Desktop/abc.txt</span></pre></td></tr></table></figure><p>如果 basename 是以 / 开头的，那么 resolve 就会直接返回 basename</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">var</span> dirname <span class=\"token operator\">=</span> <span class=\"token string\">'/User/Desktop'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> basename <span class=\"token operator\">=</span> <span class=\"token string\">'/abc.txt'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>dirname<span class=\"token punctuation\">,</span> basename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// /User/Desktop/abc.txt</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>dirname<span class=\"token punctuation\">,</span> basename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// /abc.txt</span></pre></td></tr></table></figure><h3 id=\"14-几个常见路径\"><a class=\"anchor\" href=\"#14-几个常见路径\">#</a> 1.4 几个常见路径</h3>\n<ul>\n<li><code>__dirname</code> ：这是一个常量，表示：当前执行文件所在<strong>完整目录</strong>。</li>\n<li><code>__filename</code> ：这是一个常量。表示：当前执行文件的<strong>完整目录 + 文件名</strong>。</li>\n<li><code>process.cwd</code> ：获取当前执行 Node 命令 时的目录名。</li>\n</ul>\n<p>代码举例：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>__filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span><span class=\"token function\">cwd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>运行结果：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">node</span> app.js</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>/Users/smyhvae/dselegent</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>/Users/smyhvae/dselegent/app.js</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>/Users/smyhvae/dselegent</pre></td></tr></table></figure><h2 id=\"2本地文件操作模块-fs\"><a class=\"anchor\" href=\"#2本地文件操作模块-fs\">#</a> 2. 本地文件操作模块 fs</h2>\n<blockquote>\n<h3 id=\"nodejs-中的同步和异步的区别\"><a class=\"anchor\" href=\"#nodejs-中的同步和异步的区别\">#</a> Node.js 中的同步和异步的区别</h3>\n<p>fs 模块对文件的几乎所有操作都有同步和异步两种形式。例如：readFile () 和 readFileSync ()。</p>\n<p>区别：</p>\n<ul>\n<li>同步调用会阻塞代码的执行，异步则不会。</li>\n<li>异步调用会将 读取任务 下达到任务队列，直到任务执行完成才会回调。</li>\n<li>异常处理方面：同步必须使用 try catch 方式，异步可以通过回调函数的第一个参数。【重要】</li>\n</ul>\n</blockquote>\n<h3 id=\"21-文件读取\"><a class=\"anchor\" href=\"#21-文件读取\">#</a> 2.1 文件读取</h3>\n<p><strong>同步读取</strong></p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> data<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    data <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./fileForRead.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'文件内容: '</span> <span class=\"token operator\">+</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'读取文件出错: '</span> <span class=\"token operator\">+</span> err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>输出如下：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>/usr/local/bin/node readFileSync.js</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>文件内容: hello world</pre></td></tr></table></figure><p><strong>异步读取</strong></p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./fileForRead.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'读取文件出错: '</span> <span class=\"token operator\">+</span> err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'文件内容: '</span> <span class=\"token operator\">+</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>输出如下</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>/usr/local/bin/node readFile.js</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>文件内容: hello world</pre></td></tr></table></figure><blockquote>\n<p><strong>fs/promises 从 Node.js 14 开始可用</strong><br />\n从 Node.js 14 开始，fs 模块提供了两种使用基于 promises 的文件系统的方法。这些 promises 可以通过  <code>require('fs').promises</code>  或  <code>require('fs/promises') </code> 获得。</p>\n</blockquote>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> readFile <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs/promises'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">const</span> contents <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf8'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>contents<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"22-文件写入\"><a class=\"anchor\" href=\"#22-文件写入\">#</a> 2.2 文件写入</h3>\n<p>备注：以下代码，如果文件不存在，则创建文件；如果文件存在，则覆盖文件内容；</p>\n<p><strong>异步写入</strong></p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./fileForWrite.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hello world'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'文件写入成功'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>同步写入</strong></p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./fileForWrite1.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hello world'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'文件写入成功'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>promises</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> writeFile <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs/promises'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">const</span> contents <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">writeFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hello world'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf8'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>contents<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token comment\">// When a request is aborted - err is an AbortError</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"23-文件是否存在\"><a class=\"anchor\" href=\"#23-文件是否存在\">#</a> 2.3 文件是否存在</h3>\n<p><code>fs.exists()</code>  已经是 <code>deprecated</code>  状态，现在可以通过下面代码判断文件是否存在。</p>\n<p><strong>异步本</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 检查文件是否存在于当前目录中</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>fs<span class=\"token punctuation\">.</span><span class=\"token function\">access</span><span class=\"token punctuation\">(</span><span class=\"token string\">'package.json'</span><span class=\"token punctuation\">,</span> fs<span class=\"token punctuation\">.</span>constants<span class=\"token punctuation\">.</span><span class=\"token constant\">F_OK</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'package.json不存在于当前目录中'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'package.json存在于当前目录中'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>fs<span class=\"token punctuation\">.</span><span class=\"token function\">access</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index.js'</span><span class=\"token punctuation\">,</span> fs<span class=\"token punctuation\">.</span>constants<span class=\"token punctuation\">.</span><span class=\"token constant\">F_OK</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index.js不存在于当前目录中'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index.js存在于当前目录中'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><code>fs.access()</code>  除了判断文件是否存在（默认模式），还可以用来判断文件的权限。</p>\n<p>备忘： <code>fs.constants.F_OK</code>  等常量无法获取（node v6.1，mac 10.11.4 下， <code>fs.constants</code>  是 <code>undefined</code> ）</p>\n<p><strong>同步</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> accessSync<span class=\"token punctuation\">,</span> constants <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token function\">accessSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'etc/passwd'</span><span class=\"token punctuation\">,</span> constants<span class=\"token punctuation\">.</span><span class=\"token constant\">R_OK</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'can read'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'no access!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>promises</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> access<span class=\"token punctuation\">,</span> constants <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'node:fs/promises'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">await</span> <span class=\"token function\">access</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/etc/passwd'</span><span class=\"token punctuation\">,</span> constants<span class=\"token punctuation\">.</span><span class=\"token constant\">R_OK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'can access'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cannot access'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"24-删除文件\"><a class=\"anchor\" href=\"#24-删除文件\">#</a> 2.4 删除文件</h3>\n<p><strong>异步版本</strong></p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>fs<span class=\"token punctuation\">.</span><span class=\"token function\">unlink</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./fileForUnlink.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'文件删除成功'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>同步版本</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> unlinkSync <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token function\">unlinkSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/tmp/hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'successfully deleted /tmp/hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token comment\">// handle the error</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>promises</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> unlink <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs/promises'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">await</span> <span class=\"token function\">unlink</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/tmp/hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'successfully deleted /tmp/hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token comment\">// handle the error</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"25-创建目录\"><a class=\"anchor\" href=\"#25-创建目录\">#</a> 2.5 创建目录</h3>\n<p><strong>异步版本</strong>（如果目录已存在，会报错）</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// fs.mkdir(path[, mode], callback)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>fs<span class=\"token punctuation\">.</span><span class=\"token function\">mkdir</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sub'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'创建目录成功'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>同步版本</strong></p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// fs.mkdirSync(path[, mode])</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    fs<span class=\"token punctuation\">.</span><span class=\"token function\">mkdirSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'创建目录成功'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">throw</span> e<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>promises</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> mkdir <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs/promises'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">const</span> createDir <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">mkdir</span><span class=\"token punctuation\">(</span>projectFolder<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">recursive</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">created </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>createDir<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"26-遍历目录\"><a class=\"anchor\" href=\"#26-遍历目录\">#</a> 2.6 遍历目录</h3>\n<p>同步版本，注意： <code>fs.readdirSync()</code>  只会读一层，所以需要判断文件类型是否目录，如果是，则进行递归遍历。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// fs.readdirSync(path[, options])</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">getFilesInDir</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dir</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">var</span> results <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">var</span> files <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readdirSync</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    files<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        file <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">var</span> stats <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">statSync</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>stats<span class=\"token punctuation\">.</span><span class=\"token function\">isFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            results<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>stats<span class=\"token punctuation\">.</span><span class=\"token function\">isDirectory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            results <span class=\"token operator\">=</span> results<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span> <span class=\"token function\">getFilesInDir</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">return</span> results<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">var</span> files <span class=\"token operator\">=</span> <span class=\"token function\">getFilesInDir</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>files<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"27-读取目录\"><a class=\"anchor\" href=\"#27-读取目录\">#</a> 2.7 读取目录</h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> readdir <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs/promises'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">const</span> files <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">readdir</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> file <span class=\"token keyword\">of</span> files<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"28-删除目录\"><a class=\"anchor\" href=\"#28-删除目录\">#</a> 2.8 删除目录</h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 删除目录 (前提没有文件在里面)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>fs<span class=\"token punctuation\">.</span><span class=\"token function\">rmdir</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./avatar'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err <span class=\"token operator\">&amp;&amp;</span> err<span class=\"token punctuation\">.</span>code <span class=\"token operator\">===</span> <span class=\"token string\">'ENOENT'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'目录不存在'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"29-删除整个目录\"><a class=\"anchor\" href=\"#29-删除整个目录\">#</a> 2.9 删除整个目录</h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fs\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>fs<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./avatar\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span>data</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// console.log(data)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    data<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        fs<span class=\"token punctuation\">.</span><span class=\"token function\">unlinkSync</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./avatar/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>item<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    fs<span class=\"token punctuation\">.</span><span class=\"token function\">rmdir</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./avatar\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">//2</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>fs<span class=\"token punctuation\">.</span><span class=\"token function\">readdir</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./avatar\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">let</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    data<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        arr<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">unlink</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./avatar/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>item<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    fs<span class=\"token punctuation\">.</span><span class=\"token function\">rmdir</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./avatar\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">//3</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>promises<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>fs<span class=\"token punctuation\">.</span><span class=\"token function\">readdir</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./image2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">unlink</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./image2/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>item<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token keyword\">await</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">rmdir</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./image2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"210-文件重命名\"><a class=\"anchor\" href=\"#210-文件重命名\">#</a> 2.10 文件重命名</h3>\n<p><strong>异步版本</strong></p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// fs.rename(oldPath, newPath, callback)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>fs<span class=\"token punctuation\">.</span><span class=\"token function\">rename</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./hello'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'./world'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'重命名成功'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>同步版本</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// fs.renameSync(oldPath, newPath)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>fs<span class=\"token punctuation\">.</span><span class=\"token function\">renameSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./world'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'./hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>promises</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> rename <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs/promises'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">await</span> <span class=\"token function\">rename</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./world'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'./hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">rename</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"211-获取文件状态\"><a class=\"anchor\" href=\"#211-获取文件状态\">#</a> 2.11 获取文件状态</h3>\n<p>1. 异步：fs.stat (path,callback):<br />\npath 是一个表示路径的字符串，callback 接收两个参数 (err,stats), 其中 stats 就是 fs.stats 的一个实例；</p>\n<p>2. 同步：fs.statSync (path)<br />\n 只接收一个 path 变量，fs.statSync (path) 其实是一个 fs.stats 的一个实例；</p>\n<p>方法</p>\n<ul>\n<li>stats.isFile () -- 是否文件</li>\n<li>stats.isDirectory () -- 是否目录</li>\n</ul>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// Node.js program to demonstrate the </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// fs.statSync() method </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Import the filesystem module </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// Getting information for a file </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>statsObj <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">statSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test_file.txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>statsObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Path is file:\"</span><span class=\"token punctuation\">,</span> statsObj<span class=\"token punctuation\">.</span><span class=\"token function\">isFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Path is directory:\"</span><span class=\"token punctuation\">,</span> statsObj<span class=\"token punctuation\">.</span><span class=\"token function\">isDirectory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// Getting information for a directory </span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>statsObj <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">statSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test_directory\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>statsObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Path is file:\"</span><span class=\"token punctuation\">,</span> statsObj<span class=\"token punctuation\">.</span><span class=\"token function\">isFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Path is directory:\"</span><span class=\"token punctuation\">,</span> statsObj<span class=\"token punctuation\">.</span><span class=\"token function\">isDirectory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>输出：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Stats <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token literal-property property\">dev</span><span class=\"token operator\">:</span><span class=\"token number\">3229478529</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token literal-property property\">mode</span><span class=\"token operator\">:</span><span class=\"token number\">33206</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token literal-property property\">nlink</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token literal-property property\">uid</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token literal-property property\">gid</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token literal-property property\">rdev</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token literal-property property\">blksize</span><span class=\"token operator\">:</span><span class=\"token number\">4096</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token literal-property property\">ino</span><span class=\"token operator\">:</span><span class=\"token number\">1970324837039946</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token literal-property property\">size</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token literal-property property\">blocks</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token literal-property property\">atimeMs</span><span class=\"token operator\">:</span><span class=\"token number\">1582306776282</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token literal-property property\">mtimeMs</span><span class=\"token operator\">:</span><span class=\"token number\">1582482953967</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token literal-property property\">ctimeMs</span><span class=\"token operator\">:</span><span class=\"token number\">1582482953968.2532</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token literal-property property\">birthtimeMs</span><span class=\"token operator\">:</span><span class=\"token number\">1582306776282.142</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token literal-property property\">atime</span><span class=\"token operator\">:</span><span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">02</span><span class=\"token operator\">-</span>21T17<span class=\"token operator\">:</span><span class=\"token number\">39</span><span class=\"token operator\">:</span><span class=\"token number\">36</span><span class=\"token punctuation\">.</span>282Z<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token literal-property property\">mtime</span><span class=\"token operator\">:</span><span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">02</span><span class=\"token operator\">-</span>23T18<span class=\"token operator\">:</span><span class=\"token number\">35</span><span class=\"token operator\">:</span><span class=\"token number\">53</span><span class=\"token punctuation\">.</span>967Z<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token literal-property property\">ctime</span><span class=\"token operator\">:</span><span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">02</span><span class=\"token operator\">-</span>23T18<span class=\"token operator\">:</span><span class=\"token number\">35</span><span class=\"token operator\">:</span><span class=\"token number\">53</span><span class=\"token punctuation\">.</span>968Z<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token literal-property property\">birthtime</span><span class=\"token operator\">:</span><span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">02</span><span class=\"token operator\">-</span>21T17<span class=\"token operator\">:</span><span class=\"token number\">39</span><span class=\"token operator\">:</span><span class=\"token number\">36</span><span class=\"token punctuation\">.</span>282Z</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>Path is file<span class=\"token operator\">:</span><span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>Path is directory<span class=\"token operator\">:</span><span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>Stats <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token literal-property property\">dev</span><span class=\"token operator\">:</span><span class=\"token number\">3229478529</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token literal-property property\">mode</span><span class=\"token operator\">:</span><span class=\"token number\">16822</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token literal-property property\">nlink</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token literal-property property\">uid</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token literal-property property\">gid</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token literal-property property\">rdev</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token literal-property property\">blksize</span><span class=\"token operator\">:</span><span class=\"token number\">4096</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token literal-property property\">ino</span><span class=\"token operator\">:</span><span class=\"token number\">562949953486669</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token literal-property property\">size</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token literal-property property\">blocks</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token literal-property property\">atimeMs</span><span class=\"token operator\">:</span><span class=\"token number\">1582482965037.8445</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token literal-property property\">mtimeMs</span><span class=\"token operator\">:</span><span class=\"token number\">1581074249467.7114</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token literal-property property\">ctimeMs</span><span class=\"token operator\">:</span><span class=\"token number\">1582482964979.8303</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token literal-property property\">birthtimeMs</span><span class=\"token operator\">:</span><span class=\"token number\">1582306776288.1958</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token literal-property property\">atime</span><span class=\"token operator\">:</span><span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">02</span><span class=\"token operator\">-</span>23T18<span class=\"token operator\">:</span><span class=\"token number\">36</span><span class=\"token operator\">:</span><span class=\"token number\">05</span><span class=\"token punctuation\">.</span>038Z<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token literal-property property\">mtime</span><span class=\"token operator\">:</span><span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">02</span><span class=\"token operator\">-</span>07T11<span class=\"token operator\">:</span><span class=\"token number\">17</span><span class=\"token operator\">:</span><span class=\"token number\">29</span><span class=\"token punctuation\">.</span>468Z<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token literal-property property\">ctime</span><span class=\"token operator\">:</span><span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">02</span><span class=\"token operator\">-</span>23T18<span class=\"token operator\">:</span><span class=\"token number\">36</span><span class=\"token operator\">:</span><span class=\"token number\">04</span><span class=\"token punctuation\">.</span>980Z<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token literal-property property\">birthtime</span><span class=\"token operator\">:</span><span class=\"token number\">2020</span><span class=\"token operator\">-</span><span class=\"token number\">02</span><span class=\"token operator\">-</span>21T17<span class=\"token operator\">:</span><span class=\"token number\">39</span><span class=\"token operator\">:</span><span class=\"token number\">36</span><span class=\"token punctuation\">.</span>288Z</pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>Path is file<span class=\"token operator\">:</span><span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>Path is directory<span class=\"token operator\">:</span><span class=\"token boolean\">true</span></pre></td></tr></table></figure><h3 id=\"212-追加文件内容\"><a class=\"anchor\" href=\"#212-追加文件内容\">#</a> 2.12 追加文件内容</h3>\n<blockquote>\n<p>fs.appendFile(file, data[, options], callback)</p>\n</blockquote>\n<ul>\n<li>file：可以是文件路径，也可以是文件句柄。（还可以是 buffer？）</li>\n<li>data：要追加的内容。string 或者 buffer。</li>\n<li>options\n<ul>\n<li>encoding：编码，默认是 <code>utf8</code></li>\n<li>mode：默认是 <code>0o666</code></li>\n<li>flag：默认是 <code>a</code></li>\n</ul>\n</li>\n</ul>\n<p>注意：如果 <code>file</code>  是文件句柄，那么</p>\n<ul>\n<li>开始追加数据前，file 需要已经打开。</li>\n<li>file 需要手动关闭。</li>\n</ul>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>fs<span class=\"token punctuation\">.</span><span class=\"token function\">appendFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./extra/fileForAppend.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hello'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'append成功'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"3事件机制模块-events\"><a class=\"anchor\" href=\"#3事件机制模块-events\">#</a> 3. 事件机制模块 events</h2>\n<p>Node.js 有多个内置的事件，我们可以通过引入 events 模块，并通过实例化 EventEmitter 类来绑定和监听事件，如下实例：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 引入 events 模块</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> EventEmitter <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'events'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 创建 eventEmitter 对象</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> event <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EventEmitter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>以下程序绑定事件处理程序：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 绑定事件及事件的处理程序</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>eventEmitter<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'eventName'</span><span class=\"token punctuation\">,</span> eventHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>我们可以通过程序触发事件：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 触发事件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>eventEmitter<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'eventName'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>EventEmitter </code> 的每个事件由一个事件名和若干个参数组成，事件名是一个字符串，通常表达一定的语义。对于每个事件， <code>EventEmitter </code> 支持 若干个事件监听器。</p>\n<p>当事件触发时，注册到这个事件的事件监听器被依次调用，事件参数作为回调函数参数传递。</p>\n<p>让我们以下面的例子解释这个过程：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 引入 events 模块</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> EventEmitter <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'events'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 创建 eventEmitter 对象</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> event <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EventEmitter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>event<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'someEvent'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arg1<span class=\"token punctuation\">,</span> arg2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'listener1'</span><span class=\"token punctuation\">,</span> arg1<span class=\"token punctuation\">,</span> arg2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>event<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'someEvent'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arg1<span class=\"token punctuation\">,</span> arg2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'listener2'</span><span class=\"token punctuation\">,</span> arg1<span class=\"token punctuation\">,</span> arg2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>event<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'someEvent'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'arg1 参数'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'arg2 参数'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>执行以上代码，运行的结果如下：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">node</span> event.js </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>listener1 arg1 参数 arg2 参数</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>listener2 arg1 参数 arg2 参数</pre></td></tr></table></figure><p>以上例子中，event 为事件 someEvent 注册了两个事件监听器，然后触发了 someEvent 事件。</p>\n<p>运行结果中可以看到两个事件监听器回调函数被先后调用。 这就是 <code>EventEmitter</code>  最简单的用法。</p>\n<p><code>EventEmitter </code> 提供了多个属性，如 <strong>on</strong> 和 <strong>emit</strong>。<strong>on</strong> 函数用于绑定事件函数，<strong>emit</strong> 属性用于触发一个事件</p>\n<h1 id=\"07-nodejs内置模块下\"><a class=\"anchor\" href=\"#07-nodejs内置模块下\">#</a> 07 【nodejs 内置模块（下）】</h1>\n<h2 id=\"1stream-模块\"><a class=\"anchor\" href=\"#1stream-模块\">#</a> 1.stream 模块</h2>\n<p><code>stream</code>  是 Node.js 提供的又一个仅在服务区端可用的模块，目的是支持 “流” 这种数据结构。</p>\n<p>什么是流？流是一种抽象的数据结构。想象水流，当在水管中流动时，就可以从某个地方（例如自来水厂）源源不断地到达另一个地方（比如你家的洗手池）。我们也可以把数据看成是数据流，比如你敲键盘的时候，就可以把每个字符依次连起来，看成字符流。这个流是从键盘输入到应用程序，实际上它还对应着一个名字：标准输入流（stdin）。</p>\n<p>如果应用程序把字符一个一个输出到显示器上，这也可以看成是一个流，这个流也有名字：标准输出流（stdout）。流的特点是数据是有序的，而且必须依次读取，或者依次写入，不能像 Array 那样随机定位。</p>\n<p>有些流用来读取数据，比如从文件读取数据时，可以打开一个文件流，然后从文件流中不断地读取数据。有些流用来写入数据，比如向文件写入数据时，只需要把数据不断地往文件流中写进去就可以了。</p>\n<p>在 Node.js 中，流也是一个对象，我们只需要响应流的事件就可以了： <code>data</code>  事件表示流的数据已经可以读取了， <code>end</code>  事件表示这个流已经到末尾了，没有数据可以读取了， <code>error</code>  事件表示出错了。</p>\n<h3 id=\"11-读取流\"><a class=\"anchor\" href=\"#11-读取流\">#</a> 1.1 读取流</h3>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 创建读取流</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> rs <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>rs<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'open'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'读取的文件已打开'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'读取流结束'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">chunk</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token comment\">// 每一批数据流入完成</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'单批数据流入:'</span> <span class=\"token operator\">+</span> chunk<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>chunk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>要注意， <code>data</code>  事件可能会有多次，每次传递的 <code>chunk</code>  是流的一部分数据。</p>\n<p><strong>读取视频</strong></p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 创建读取流</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> rs <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'video.mp4'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 每一批数据流入完成</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>rs<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">chunk</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'单批数据流入:'</span> <span class=\"token operator\">+</span> chunk<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>chunk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><img data-src=\"https://tva1.sinaimg.cn/large/0074UQWJgy1h3eigfl898j31750iztjs.jpg\" alt=\"\" /></p>\n<h3 id=\"12-写入流\"><a class=\"anchor\" href=\"#12-写入流\">#</a> 1.2 写入流</h3>\n<p>要以流的形式写入文件，只需要不断调用 <code>write()</code>  方法，最后以 <code>end()</code>  结束：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 创建写入流</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> ws <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 监听文件打开事件</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'open'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'文件打开'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 监听文件关闭事件</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>ws<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'文件写入完成，关闭'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">// 文件流式写入</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>ws<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'helloworld1!'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'内容1流入完成'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>ws<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'helloworld2!'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'内容2流入完成'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">// 文件写入完成</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>ws<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'文件写入关闭'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>pipe</code>  就像可以把两个水管串成一个更长的水管一样，两个流也可以串起来。一个 <code>Readable</code>  流和一个 <code>Writable</code>  流串起来后，所有的数据自动从 <code>Readable</code>  流进入 <code>Writable</code>  流，这种操作叫 <code>pipe</code> 。</p>\n<p>在 Node.js 中， <code>Readable</code>  流有一个 <code>pipe()</code>  方法，就是用来干这件事的。</p>\n<p>让我们用 <code>pipe()</code>  把一个文件流和另一个文件流串起来，这样源文件的所有数据就自动写入到目标文件里了，所以，这实际上是一个复制文件的程序：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 创建读取流</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> rs <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'video.mp4'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">let</span> ws <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'b.mp4'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>rs<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'读取流结束'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>rs<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>ws<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>pipe 原理</strong></p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 创建读取流</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> rs <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'video.mp4'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">let</span> ws <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'b.mp4'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>rs<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  ws<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'读取流结束'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 每一批数据流入完成</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>rs<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">chunk</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'单批数据流入:'</span> <span class=\"token operator\">+</span> chunk<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  ws<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>chunk<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'单批输入流入完成'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"2资源压缩模块-zib\"><a class=\"anchor\" href=\"#2资源压缩模块-zib\">#</a> 2. 资源压缩模块 zib</h2>\n<h3 id=\"21-概览\"><a class=\"anchor\" href=\"#21-概览\">#</a> 2.1 概览</h3>\n<p>做过 web 性能优化的同学，对性能优化大杀器<strong> gzip</strong> 应该不陌生。浏览器向服务器发起资源请求，比如下载一个 js 文件，服务器先对资源进行压缩，再返回给浏览器，以此节省流量，加快访问速度。</p>\n<p>浏览器通过 HTTP 请求头部里加上<strong> Accept-Encoding</strong>，告诉服务器，“你可以用 gzip，或者 defalte 算法压缩资源”。</p>\n<blockquote>\n<p>Accept-Encoding:gzip, deflate</p>\n</blockquote>\n<p>那么，在 nodejs 里，是如何对资源进行压缩的呢？答案就是<strong> Zlib</strong> 模块。=</p>\n<h3 id=\"22-压缩的例子\"><a class=\"anchor\" href=\"#22-压缩的例子\">#</a> 2.2 压缩的例子</h3>\n<p>非常简单的几行代码，就完成了本地文件的 gzip 压缩。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> zlib <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'zlib'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> gzip <span class=\"token operator\">=</span> zlib<span class=\"token punctuation\">.</span><span class=\"token function\">createGzip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">var</span> readstream <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./extra/fileForCompress.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">var</span> writestream <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./extra/fileForCompress.txt.gz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>readstream<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>gzip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>writestream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"23-解压的例子\"><a class=\"anchor\" href=\"#23-解压的例子\">#</a> 2.3 解压的例子</h3>\n<p>同样非常简单，就是个反向操作。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> zlib <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'zlib'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> gunzip <span class=\"token operator\">=</span> zlib<span class=\"token punctuation\">.</span><span class=\"token function\">createGunzip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">var</span> readstream  <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./extra/fileForCompress.txt.gz'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">var</span> writestream  <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./extra/fileForCompress1.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>readstream<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>gunzip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>writestream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"24-服务端gzip压缩\"><a class=\"anchor\" href=\"#24-服务端gzip压缩\">#</a> 2.4 服务端 gzip 压缩</h3>\n<p>首先判断 是否包含 <strong>accept-encoding</strong> 首部，且值为<strong> gzip</strong>。</p>\n<ul>\n<li>否：返回未压缩的文件。</li>\n<li>是：返回 gzip 压缩后的文件。</li>\n</ul>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> zlib <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'zlib'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> filepath <span class=\"token operator\">=</span> <span class=\"token string\">'./extra/fileForGzip.html'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">var</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">var</span> acceptEncoding <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">[</span><span class=\"token string\">'accept-encoding'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">var</span> gzip<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>acceptEncoding<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gzip'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!=</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// 判断是否需要 gzip 压缩</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        gzip <span class=\"token operator\">=</span> zlib<span class=\"token punctuation\">.</span><span class=\"token function\">createGzip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 记得响应 Content-Encoding，告诉浏览器：文件被 gzip 压缩过</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token string-property property\">'Content-Encoding'</span><span class=\"token operator\">:</span> <span class=\"token string\">'gzip'</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span>filepath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>gzip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span>filepath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token string\">'3000'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>将 js 大文件返回</strong></p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> zlib <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'zlib'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 这两个要写在 fs 模块后面</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> gzip <span class=\"token operator\">=</span> zlib<span class=\"token punctuation\">.</span><span class=\"token function\">createGzip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>http</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">let</span> rs <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/x-javascript;charset=utf-8'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token string-property property\">'Content-Encoding'</span><span class=\"token operator\">:</span> <span class=\"token string\">'gzip'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    rs<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>gzip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'server start'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"25-服务端字符串gzip压缩\"><a class=\"anchor\" href=\"#25-服务端字符串gzip压缩\">#</a> 2.5 服务端字符串 gzip 压缩</h3>\n<p>代码跟前面例子大同小异。这里采用了 <strong>zlib.gzipSync(str)</strong> 对字符串进行 gzip 压缩。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> zlib <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'zlib'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> responseText <span class=\"token operator\">=</span> <span class=\"token string\">'hello world'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">var</span> server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">var</span> acceptEncoding <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">[</span><span class=\"token string\">'accept-encoding'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>acceptEncoding<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gzip'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!=</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token string-property property\">'content-encoding'</span><span class=\"token operator\">:</span> <span class=\"token string\">'gzip'</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span>zlib<span class=\"token punctuation\">.</span><span class=\"token function\">gzipSync</span><span class=\"token punctuation\">(</span>responseText<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span>responseText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token string\">'3000'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"3数据加密模块-crypto\"><a class=\"anchor\" href=\"#3数据加密模块-crypto\">#</a> 3. 数据加密模块 crypto</h2>\n<p>crypto 模块的目的是为了提供通用的加密和哈希算法。用纯 JavaScript 代码实现这些功能不是不可能，但速度会非常慢。Nodejs 用 C/C++ 实现这些算法后，通过 cypto 这个模块暴露为 JavaScript 接口，这样用起来方便，运行速度也快。</p>\n<h3 id=\"31-hash例子\"><a class=\"anchor\" href=\"#31-hash例子\">#</a> 3.1 hash 例子</h3>\n<p>hash.digest ([encoding])：计算摘要。encoding 可以是 <code>hex</code> 、 <code>latin1</code>  或者 <code>base64</code> 。如果声明了 encoding，那么返回字符串。否则，返回 Buffer 实例。注意，调用 hash.digest () 后，hash 对象就作废了，再次调用就会出错。</p>\n<p>hash.update (data [, input_encoding])：input_encoding 可以是 <code>utf8</code> 、 <code>ascii</code>  或者 <code>latin1</code> 。如果 data 是字符串，且没有指定 input_encoding，则默认是 <code>utf8</code> 。注意，hash.update () 方法可以调用多次。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crypto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> content <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./test.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">var</span> hash <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createHash</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sha256'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">var</span> output<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>hash<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>output <span class=\"token operator\">=</span> hash<span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// 输出内容为：</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9</span></pre></td></tr></table></figure><p>也可以这样：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crypto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> input <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./test.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">var</span> hash <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createHash</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sha256'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>hash<span class=\"token punctuation\">.</span><span class=\"token function\">setEncoding</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>input<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>hash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 输出内容为：</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9</span></pre></td></tr></table></figure><p>hash.digest () 后，再次调用 digest () 或者 update ()</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crypto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> content <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./test.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">var</span> hash <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createHash</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sha256'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">var</span> output<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>hash<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>hash<span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 报错：Error: Digest already called</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>hash<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// 报错：Error: Digest already called</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>hash<span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"32-hmac例子\"><a class=\"anchor\" href=\"#32-hmac例子\">#</a> 3.2 HMAC 例子</h3>\n<p>HMAC 的全称是 Hash-based Message Authentication Code，也即在 hash 的加盐运算。</p>\n<p>具体到使用的话，跟 hash 模块差不多，选定 hash 算法，指定 “盐” 即可。</p>\n<p>例子 1：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crypto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> secret <span class=\"token operator\">=</span> <span class=\"token string\">'secret'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">var</span> hmac <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createHmac</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sha256'</span><span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">var</span> input <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./test.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>hmac<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> hmac<span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 输出：</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 734cc62f32841568f45715aeb9f4d7891324e6d948e4c6c60c0621cdac48623a</span></pre></td></tr></table></figure><p>例子 2：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crypto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> secret <span class=\"token operator\">=</span> <span class=\"token string\">'secret'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">var</span> hmac <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createHmac</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sha256'</span><span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">var</span> input <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./test.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>hmac<span class=\"token punctuation\">.</span><span class=\"token function\">setEncoding</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>input<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>hmac<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 输出：</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 734cc62f32841568f45715aeb9f4d7891324e6d948e4c6c60c0621cdac48623a</span></pre></td></tr></table></figure><h3 id=\"33-md5例子\"><a class=\"anchor\" href=\"#33-md5例子\">#</a> 3.3 MD5 例子</h3>\n<p>MD5（Message-Digest Algorithm）是计算机安全领域广泛使用的散列函数（又称哈希算法、摘要算法），主要用来确保消息的完整和一致性。常见的应用场景有密码保护、下载文件校验等。</p>\n<p><strong>特点</strong></p>\n<ol>\n<li>运算速度快：对 <code>jquery.js</code>  求 md5 值，57254 个字符，耗时 1.907ms</li>\n<li>输出长度固定：输入长度不固定，输出长度固定（128 位）。</li>\n<li>运算不可逆：已知运算结果的情况下，无法通过通过逆运算得到原始字符串。</li>\n<li>高度离散：输入的微小变化，可导致运算结果差异巨大。</li>\n<li>弱碰撞性：不同输入的散列值可能相同。</li>\n</ol>\n<p><strong>应用场景</strong></p>\n<ol>\n<li>文件完整性校验：比如从网上下载一个软件，一般网站都会将软件的 md5 值附在网页上，用户下载完软件后，可对下载到本地的软件进行 md5 运算，然后跟网站上的 md5 值进行对比，确保下载的软件是完整的（或正确的）</li>\n<li>密码保护：将 md5 后的密码保存到数据库，而不是保存明文密码，避免拖库等事件发生后，明文密码外泄。</li>\n<li>防篡改：比如数字证书的防篡改，就用到了摘要算法。（当然还要结合数字签名等手段）</li>\n</ol>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crypto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> md5 <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createHash</span><span class=\"token punctuation\">(</span><span class=\"token string\">'md5'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">var</span> result <span class=\"token operator\">=</span> md5<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 输出：0cc175b9c0f1b6a831c399e269772661</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"34-例子密码保护\"><a class=\"anchor\" href=\"#34-例子密码保护\">#</a> 3.4 例子：密码保护</h3>\n<p>前面提到，将明文密码保存到数据库是很不安全的，最不济也要进行 md5 后进行保存。比如用户密码是 <code>123456</code> ，md5 运行后，得到 <code>输出：e10adc3949ba59abbe56e057f20f883e</code> 。</p>\n<p>这样至少有两个好处：</p>\n<ol>\n<li>防内部攻击：网站主人也不知道用户的明文密码，避免网站主人拿着用户明文密码干坏事。</li>\n<li>防外部攻击：如网站被黑客入侵，黑客也只能拿到 md5 后的密码，而不是用户的明文密码。</li>\n</ol>\n<p>示例代码如下：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crypto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">cryptPwd</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">password</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">var</span> md5 <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createHash</span><span class=\"token punctuation\">(</span><span class=\"token string\">'md5'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">return</span> md5<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">var</span> password <span class=\"token operator\">=</span> <span class=\"token string\">'123456'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">var</span> cryptedPassword <span class=\"token operator\">=</span> <span class=\"token function\">cryptPwd</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>cryptedPassword<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 输出：e10adc3949ba59abbe56e057f20f883e</span></pre></td></tr></table></figure><p><strong>单纯对密码进行 md5 不安全</strong></p>\n<p>前面提到，通过对用户密码进行 md5 运算来提高安全性。但实际上，这样的安全性是很差的，为什么呢？</p>\n<p>稍微修改下上面的例子，可能你就明白了。相同的明文密码，md5 值也是相同的。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crypto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">cryptPwd</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">password</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">var</span> md5 <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createHash</span><span class=\"token punctuation\">(</span><span class=\"token string\">'md5'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">return</span> md5<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">var</span> password <span class=\"token operator\">=</span> <span class=\"token string\">'123456'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> <span class=\"token function\">cryptPwd</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 输出：e10adc3949ba59abbe56e057f20f883e</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span> <span class=\"token function\">cryptPwd</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// 输出：e10adc3949ba59abbe56e057f20f883e</span></pre></td></tr></table></figure><p>也就是说，当攻击者知道算法是 md5，且数据库里存储的密码值为 <code>e10adc3949ba59abbe56e057f20f883e</code>  时，理论上可以可以猜到，用户的明文密码就是 <code>123456</code> 。</p>\n<p>事实上，彩虹表就是这么进行暴力破解的：事先将常见明文密码的 md5 值运算好存起来，然后跟网站数据库里存储的密码进行匹配，就能够快速找到用户的明文密码。（这里不探究具体细节）</p>\n<p>那么，有什么办法可以进一步提升安全性呢？答案是：密码加盐。</p>\n<p><strong>密码加盐</strong></p>\n<p>“加盐” 这个词看上去很玄乎，其实原理很简单，就是在密码特定位置插入特定字符串后，再对修改后的字符串进行 md5 运算。</p>\n<p>例子如下。同样的密码，当 “盐” 值不一样时，md5 值的差异非常大。通过密码加盐，可以防止最初级的暴力破解，如果攻击者事先不知道” 盐 “值，破解的难度就会非常大。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crypto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">cryptPwd</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">password<span class=\"token punctuation\">,</span> salt</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 密码 “加盐”</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">var</span> saltPassword <span class=\"token operator\">=</span> password <span class=\"token operator\">+</span> <span class=\"token string\">':'</span> <span class=\"token operator\">+</span> salt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'原始密码：%s'</span><span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'加盐后的密码：%s'</span><span class=\"token punctuation\">,</span> saltPassword<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 加盐密码的 md5 值</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">var</span> md5 <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">createHash</span><span class=\"token punctuation\">(</span><span class=\"token string\">'md5'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">var</span> result <span class=\"token operator\">=</span> md5<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>saltPassword<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">digest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'加盐密码的md5值：%s'</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token function\">cryptPwd</span><span class=\"token punctuation\">(</span><span class=\"token string\">'123456'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'abc'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">// 输出：</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">// 原始密码：123456</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">// 加盐后的密码：123456:abc</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">// 加盐密码的 md5 值：51011af1892f59e74baf61f3d4389092</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token function\">cryptPwd</span><span class=\"token punctuation\">(</span><span class=\"token string\">'123456'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'bcd'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">// 输出：</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">// 原始密码：123456</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">// 加盐后的密码：123456:bcd</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">// 加盐密码的 md5 值：55a95bcb6bfbaef6906dbbd264ab4531</span></pre></td></tr></table></figure><h1 id=\"09-原生nodejs路由-获取参数-静态目录\"><a class=\"anchor\" href=\"#09-原生nodejs路由-获取参数-静态目录\">#</a> 09 【原生 nodejs 路由、获取参数、静态目录】</h1>\n<h2 id=\"1路由\"><a class=\"anchor\" href=\"#1路由\">#</a> 1. 路由</h2>\n<p><strong>index.js</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 启动服务</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./server.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 路由模块</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> route <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./route.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//api</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">const</span> apiRouter <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./api.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>apiRouter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>server<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>server.js</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 创建一个大对象存储所有的路由和 api</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> route <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 将所有路由和 api 合并的函数</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">routeObj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">,</span> routeObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  http</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">,</span> <span class=\"token string\">'http://127.0.0.1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      route<span class=\"token punctuation\">[</span>url<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'启动成功'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  use<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  start<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>route.js</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> type <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>type <span class=\"token operator\">?</span> type <span class=\"token operator\">:</span> <span class=\"token string\">'text/html'</span><span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">;charset=utf8</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  res<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">const</span> route <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token string\">'/login'</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> <span class=\"token string\">'./static/login.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token string\">'/home'</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> <span class=\"token string\">'./static/home.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token string\">'/favicon.ico'</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> <span class=\"token string\">'./static/favicon.ico'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'image/x-icon'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token string\">'/404'</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/html;charset=utf8'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./static/404.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> route<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>api.js</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> type <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>type <span class=\"token operator\">?</span> type <span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">;charset=utf8</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  res<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">const</span> apiRouter <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token string\">'/api/login'</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> <span class=\"token string\">'&#123; ok: 1 &#125;'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> apiRouter<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"2获取参数\"><a class=\"anchor\" href=\"#2获取参数\">#</a> 2. 获取参数</h2>\n<p><strong>api.js</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> type <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>type <span class=\"token operator\">?</span> type <span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">;charset=utf8</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  res<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">const</span> apiRouter <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">//get 请求</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token string\">'/api/login'</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">,</span> <span class=\"token string\">'http://127.0.0.1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">let</span> username <span class=\"token operator\">=</span> url<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'username'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">let</span> password <span class=\"token operator\">=</span> url<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>username <span class=\"token operator\">===</span> <span class=\"token string\">'ds'</span> <span class=\"token operator\">&amp;&amp;</span> password <span class=\"token operator\">===</span> <span class=\"token string\">'123'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token literal-property property\">ok</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token literal-property property\">ok</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token comment\">//post 请求</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token string\">'/api/loginpost'</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">,</span> <span class=\"token string\">'http://127.0.0.1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token comment\">// 这里使用最原始的方法获取 post 请求参数</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token comment\">// 通过 req 的 data 事件监听函数，每当接受到请求体的数据，就累加到 post 变量中</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    req<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">chunk</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      data <span class=\"token operator\">+=</span> chunk<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>       <span class=\"token comment\">// 在 end 事件触发后，通过 querystring.parse 将 post 解析为真正的 POST 请求格式，然后向客户端返回。</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    req<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      data <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>username <span class=\"token operator\">===</span> <span class=\"token string\">'ds'</span> <span class=\"token operator\">&amp;&amp;</span> data<span class=\"token punctuation\">.</span>password <span class=\"token operator\">===</span> <span class=\"token string\">'123'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">ok</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">ok</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> apiRouter<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>请求.js</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>login<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token comment\">//get 请求</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/api/login?username=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>username<span class=\"token punctuation\">.</span>value<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">&amp;password=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>password<span class=\"token punctuation\">.</span>value<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>          <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>          <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  loginpost<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">//post 请求</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/api/loginpost</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token literal-property property\">username</span><span class=\"token operator\">:</span> username<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token literal-property property\">password</span><span class=\"token operator\">:</span> password<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"3静态目录\"><a class=\"anchor\" href=\"#3静态目录\">#</a> 3. 静态目录</h2>\n<p><strong>server.js</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> route <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">routeObj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">,</span> routeObj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  http</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">,</span> <span class=\"token string\">'http://127.0.0.1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        route<span class=\"token punctuation\">[</span>url<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>          <span class=\"token comment\">// 使所有匹配不到的路径走 404 网页</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        route<span class=\"token punctuation\">[</span><span class=\"token string\">'/404'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'启动成功'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  use<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  start<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>route.js</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 根据文件后缀名自动获取响应头中 content-type</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> mime <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mime'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">,</span> type <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>type <span class=\"token operator\">?</span> type <span class=\"token operator\">:</span> <span class=\"token string\">'text/html'</span><span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">;charset=utf8</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  res<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">const</span> route <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token string\">'/login'</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> <span class=\"token string\">'./static/login.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token string\">'/home'</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> <span class=\"token string\">'./static/home.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token string\">'/404'</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">,</span> <span class=\"token string\">'http://127.0.0.1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     &lt;link href='/css/index.css'>&lt;/link > 根路径访问，就等于 127.0.0.1:3000/css/index.css。</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     这里将项目文件夹 F:// 项目 + static+/css/index.css 合并成文件路径，如果存在就读取该文件返回</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">let</span> pathname <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'static'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">readStaticFile</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> pathname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/html;charset=utf8'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./static/404.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">readStaticFile</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res<span class=\"token punctuation\">,</span> pathname</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token keyword\">let</span> houzhui <span class=\"token operator\">=</span> pathname<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token comment\">// 如果存在这些静态资源就用 fs 的写入方法返回回去，不走 404</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">existsSync</span><span class=\"token punctuation\">(</span>pathname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token comment\">//mime.getType(css)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> pathname<span class=\"token punctuation\">,</span> mime<span class=\"token punctuation\">.</span><span class=\"token function\">getType</span><span class=\"token punctuation\">(</span>houzhui<span class=\"token punctuation\">[</span>houzhui<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> route<span class=\"token punctuation\">;</span></pre></td></tr></table></figure>",
            "tags": [
                "node.js",
                "node.js"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/01/02/%E7%BC%93%E5%AD%98%E3%80%81%E5%86%85%E5%AD%98%E3%80%81CPU%E7%9F%A5%E8%AF%86%E7%82%B9%E8%A7%A3%E6%9E%90%E7%AC%94%E8%AE%B0/",
            "url": "https://dmqweb.cn/2024/01/02/%E7%BC%93%E5%AD%98%E3%80%81%E5%86%85%E5%AD%98%E3%80%81CPU%E7%9F%A5%E8%AF%86%E7%82%B9%E8%A7%A3%E6%9E%90%E7%AC%94%E8%AE%B0/",
            "title": "计组知识点",
            "date_published": "2024-01-01T18:24:04.000Z",
            "content_html": "<h1 id=\"一-缓存\"><a class=\"anchor\" href=\"#一-缓存\">#</a> 一、缓存</h1>\n<h2 id=\"1-定义\"><a class=\"anchor\" href=\"#1-定义\">#</a> 1、定义</h2>\n<blockquote>\n<blockquote>\n<h6 id=\"凡是为于速度相差较大的两种硬件之间用于协调两者数据传输速度差异的结构均可称之为cache-电脑高速缓冲存储器\"><a class=\"anchor\" href=\"#凡是为于速度相差较大的两种硬件之间用于协调两者数据传输速度差异的结构均可称之为cache-电脑高速缓冲存储器\">#</a> <strong>凡是为于速度相差较大的两种硬件之间，用于协调两者数据传输速度差异的结构，均可称之为 <code>Cache</code> </strong> (电脑高速缓冲存储器)</h6>\n</blockquote>\n<ul>\n<li>缓存的存在是为了解决 CPU 和内存之间存取速度的差异的</li>\n<li>内存中被 CPU 访问最频繁的数据和指令会被复制到 CPU 的缓存中（这其中的 “频繁” 是由专门的算法来定义的</li>\n<li>这样 CPU 就不用去很慢的内存中读取需要的数据和指令了</li>\n</ul>\n</blockquote>\n<h2 id=\"2-被扩充概念\"><a class=\"anchor\" href=\"#2-被扩充概念\">#</a> 2、被扩充概念</h2>\n<blockquote>\n<h6 id=\"如今缓存的概念已被扩充\"><a class=\"anchor\" href=\"#如今缓存的概念已被扩充\">#</a> 如今缓存的概念已被扩充</h6>\n<ul>\n<li><strong>CPU</strong> 与 <strong>主内存</strong> 之间 (就我们常说的缓存)</li>\n<li><strong>内存</strong> 与 <strong>硬盘</strong> 之间 (磁盘缓存)</li>\n<li><strong>硬盘</strong> 与 <strong>网络</strong>之间 (称为<strong> Internet</strong> 临时文件夹或网络内容缓存等)</li>\n</ul>\n</blockquote>\n<h2 id=\"3-缓存的作用\"><a class=\"anchor\" href=\"#3-缓存的作用\">#</a> 3、缓存的作用</h2>\n<blockquote>\n<h6 id=\"用于协调两者数据传输速度差异的结构\"><a class=\"anchor\" href=\"#用于协调两者数据传输速度差异的结构\">#</a> 用于协调两者数据传输速度差异的结构</h6>\n<p>实例:</p>\n<ul>\n<li>缓存 是 CPU 的一部分</li>\n<li>缓存 是硬盘控制器上的一块内存芯片</li>\n<li>硬盘上的缓存：当硬盘存取零碎数据时需要不断地在硬盘与内存之间交换数据</li>\n</ul>\n</blockquote>\n<h1 id=\"二-内存\"><a class=\"anchor\" href=\"#二-内存\">#</a> 二、内存</h1>\n<h2 id=\"1-什么是内存\"><a class=\"anchor\" href=\"#1-什么是内存\">#</a> 1、什么是内存？</h2>\n<blockquote>\n<p><strong>在计算机的组成结构中，有一个很重要的部分，就是存储器，那么他的具体概念是什么呢？</strong></p>\n<ol>\n<li>存储器是用来存储程序和数据的部件，对于计算机来说，有了存储器才有记忆功能，才能保证正常工作</li>\n<li>存储器的种类很多，按照其用途可以分为  <code>主存储器</code>  和  <code>辅助存储器</code></li>\n</ol>\n<ul>\n<li>主存储器又称为 <strong> <code>内存储器</code> </strong> (<strong>就是我们常说的内存</strong>)</li>\n<li>辅助存储器又成为 <strong> <code>外存储器</code> </strong> (<strong>简称外存</strong>)</li>\n<li>所以实际上有很多人容易弄混淆这个概念，以为存储器就是内存</li>\n</ul>\n</blockquote>\n<h2 id=\"2-内存与外存\"><a class=\"anchor\" href=\"#2-内存与外存\">#</a> 2、内存与外存</h2>\n<h3 id=\"i-外存-rom\"><a class=\"anchor\" href=\"#i-外存-rom\">#</a> Ⅰ - 外存 (ROM)</h3>\n<blockquote>\n<blockquote>\n<p><strong>外存通常是磁性介质或光盘：如硬盘、软盘、磁带、CD 等</strong></p>\n</blockquote>\n<ul>\n<li>能长期保存信息，且<strong>不依赖于电</strong>来保存信息，即断电不会失去保存的信息</li>\n<li>由于是机械部件带动，速度与 CPU 相比就显得慢得多</li>\n<li><strong> <code>ROM</code> </strong>（Read Only Memory） 只读内存，应用于硬盘存储</li>\n</ul>\n</blockquote>\n<h3 id=\"ii-内存-ram\"><a class=\"anchor\" href=\"#ii-内存-ram\">#</a> Ⅱ - 内存 (RAM)</h3>\n<blockquote>\n<blockquote>\n<p><strong>物理实质就是一组或多组具备数据输入输出和数据存储功能的集成电路</strong></p>\n</blockquote>\n<ul>\n<li>指的是主板上的存储不见，是 CPU 直接与之沟通并用其存储数据的不见</li>\n<li>存放当前 正在使用的 (<strong>即执行中</strong>) 的数据和程序</li>\n<li><strong>它的物理实质就是一组或多组具备数据输入输出和数据存储功能的集成电路</strong></li>\n<li>内存只用于暂时存放程序和数据，一旦关闭电源或者发生断电，其中的程序和数据就会丢失</li>\n<li>随机存储器  <strong> <code>RAM</code> </strong>（Random Access Memory）俗称内存</li>\n</ul>\n</blockquote>\n<h2 id=\"3-内存分类\"><a class=\"anchor\" href=\"#3-内存分类\">#</a> 3、内存分类</h2>\n<blockquote>\n<p>内存分为 <strong>静态 RAM</strong> 和 <strong>动态 RAM</strong></p>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/image-20211011121001215.png\" alt=\"image-20211011121001215\" /></p>\n<p><strong>静态 RAM</strong> 速度比 <strong>动态 RAM</strong> 快很多</p>\n<ol>\n<li>速度比较：静态 RAM &gt; 动态 RAM &gt; ROM；缓存 &gt; 内存 &gt; 外存。</li>\n</ol>\n</blockquote>\n<h3 id=\"i-静态ram\"><a class=\"anchor\" href=\"#i-静态ram\">#</a> Ⅰ - 静态 RAM</h3>\n<blockquote>\n<blockquote>\n<p><strong>静态 RAM，指 SRAM：只要有供电，它保存的数据就不会丢失，且为高速存储器，如 CPU 中的高速缓存（cache）</strong></p>\n</blockquote>\n<p>缓存通常使用的是静态 RAM, 不过由于静态 RAM 集成度低，因此便延申出一级缓存和二级缓存</p>\n<ul>\n<li>一级缓存为 静态 RAM</li>\n<li>二级缓存为告诉动态 RAM（比静态 RAM 慢，但比常规动态 RAM 要快）</li>\n</ul>\n</blockquote>\n<h3 id=\"ii-动态ram\"><a class=\"anchor\" href=\"#ii-动态ram\">#</a> Ⅱ - 动态 RAM</h3>\n<blockquote>\n<blockquote>\n<p><strong>动态 RAM，指 DRAM：有供电，还要根据它要求的刷新时间参数，才能保持存储的数据不丢失，如电脑中的内存条</strong></p>\n</blockquote>\n<p>现在使用的内存一般都是<strong>动态 RAM</strong></p>\n<ul>\n<li>因为静态 RAM 集成度相对较低：存储相同数据量，静态 RAM 的提及是动态 RAM 的 6 倍之多，且价格高</li>\n</ul>\n</blockquote>\n<h3 id=\"iii-动态ram-与-静态ram-的区别\"><a class=\"anchor\" href=\"#iii-动态ram-与-静态ram-的区别\">#</a> Ⅲ  -  动态 RAM 与 静态 RAM 的区别</h3>\n<blockquote>\n<ul>\n<li>动态 RAM 会周期地刷新，而 静态 RAM 不会进行刷新</li>\n<li>动态 RAM 是靠 MOSS 电路中的栅极电容来记忆信息的；静态 RAM 是靠双稳态触发器来记忆信息的</li>\n<li>由于电容上的电荷会泄露，需要定时给予补充。所以 动态 RAM 需要设置刷新电路，而静态不用</li>\n</ul>\n<h6 id=\"应用上的区别\"><a class=\"anchor\" href=\"#应用上的区别\">#</a> 应用上的区别</h6>\n<ul>\n<li>动态 RAM 比 静态 RAM 集成度高、功耗低，从而成本也低，适用于做大容量储存器，所以<strong>主内存通常采用动态 RAM</strong></li>\n<li>另外：内存还应用于显卡、声卡及 CMOS 等设备中，用于充当设备缓存或保存固定的程序及数据</li>\n<li><strong>高速缓冲存储器 (Cache) 则使用静态 RAM</strong></li>\n</ul>\n</blockquote>\n<h2 id=\"4-内存是如何工作的\"><a class=\"anchor\" href=\"#4-内存是如何工作的\">#</a> 4、内存是如何工作的？</h2>\n<blockquote>\n<blockquote>\n<p><strong>既然内存是用来存放当前 正在使用的 (即执行中) 的数据和程序，那么你可能会问：它是怎么工作的呢？</strong></p>\n</blockquote>\n<p>我们平常所提到的计算机内存指的是 <strong>动态内存 (即 DRAM)</strong> , 动态内存中所谓的 '<strong> 动态</strong> ' 指的是当我们将数据写入 DRAM 后，经过一段时间数据就会丢失，因此我们需要一个额外的电路进行内存刷新操作</p>\n<h6 id=\"具体工作过程是这样的\"><a class=\"anchor\" href=\"#具体工作过程是这样的\">#</a> 具体工作过程是这样的:</h6>\n<ul>\n<li>一个 DRAM 的存储单元存储的是 0 还是 1 取决于电容是否电荷.  <code>有电荷代表1、无电荷代表0</code></li>\n<li>但时间一长，代表 1 的电容会放电，代表 0 的电荷会吸收电荷 (<strong>这就是数据丢失的原因</strong>)</li>\n<li>刷新操作定期对电容进行检查，若电量大于满点亮的 <strong>1/2</strong> 则认为其代表 <strong>1</strong>, 并把电容充满</li>\n<li>定期刷新操作时，若电量小于 <strong>1/2</strong> 则认为其代表 <strong>0</strong>, 并把电容放电，籍此来保持数据的连续性</li>\n</ul>\n</blockquote>\n<hr />\n<h1 id=\"三-cpu\"><a class=\"anchor\" href=\"#三-cpu\">#</a> 三、CPU</h1>\n<h2 id=\"1-cpu的简单工作原理图\"><a class=\"anchor\" href=\"#1-cpu的简单工作原理图\">#</a> 1、CPU 的简单工作原理图</h2>\n<blockquote>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/image-20211009180308915.png\" alt=\"image-20211009180308915\" /></p>\n<p><strong>CPU 一般由控制单元、逻辑运算单元和存储单元 (寄存器) 组成（注意忽略了中断系统）</strong></p>\n<p>CPU 负责执行指令，是所有计算机硬件中速度最快的。一般用<strong>时钟周期</strong>（时钟频率）来衡量 CPU 的性能。</p>\n</blockquote>\n<h3 id=\"i-控制单元\"><a class=\"anchor\" href=\"#i-控制单元\">#</a> Ⅰ - 控制单元</h3>\n<blockquote>\n<ul>\n<li>在 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzIwMzkyMDQy\">节拍脉冲</span> 的作用下，将 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTclQTglOEIlRTUlQkElOEYlRTglQUUlQTElRTYlOTUlQjAlRTUlOTklQTgvMzIxOTUzNg==\">程序计数器</span> (Program Counter -- PC) 指向的 <strong>主存或多级高速缓存</strong> 中的  <code>指令地址</code>  送到地址总线</li>\n<li>接着获取 <strong>指令地址</strong> 所对应的指令并放入<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEMlODclRTQlQkIlQTQlRTUlQUYlODQlRTUlQUQlOTglRTUlOTklQTgvMzIxOTQ4Mw==\">指令寄存器</span> (Instruction Register -- IR) 中</li>\n<li>然后通过<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEMlODclRTQlQkIlQTQlRTglQUYlOTElRTclQTAlODElRTUlOTklQTgvMzI5NTI2MQ==\">指令译码器</span> (Instruction Decoder -- ID) 分析指令需要进行的操作</li>\n<li>最后通过<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOTMlOEQlRTQlQkQlOUMlRTYlOEUlQTclRTUlODglQjYlRTUlOTklQTgvMTkyMTcyNQ==\">操作控制器</span> (Operation Controller -- OC) 向其他设备发出 微操作控制信号</li>\n</ul>\n<p>也许你对上述过程中提到的名词感到陌生，下面将会列举出来</p>\n</blockquote>\n<h4 id=\"1-节拍脉冲是什么\"><a class=\"anchor\" href=\"#1-节拍脉冲是什么\">#</a> ① 节拍脉冲是什么？</h4>\n<blockquote>\n<p>时钟周期是由 CPU 时钟定义的定长时刻距离，是 CPU 作业的最小时刻单位，也称 <code>节拍脉冲</code> 或 T 周期。通常为节拍脉冲或 T 周期，既主频的倒数，它是处理操作的最基本的单位</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzIwMzkyMDQy\">原文地址</span></p>\n</blockquote>\n<h4 id=\"2-程序计数器\"><a class=\"anchor\" href=\"#2-程序计数器\">#</a> ②  程序计数器</h4>\n<blockquote>\n<blockquote>\n<h6 id=\"程序计数器是用于存放下一条指令所在单元的地址的地方\"><a class=\"anchor\" href=\"#程序计数器是用于存放下一条指令所在单元的地址的地方\">#</a> 程序计数器是用于存放下一条指令所在单元的地址的地方。</h6>\n</blockquote>\n<p>当执行一条指令时，首先需要根据 PC 中存放的指令地址，将指令由内存取到<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEMlODclRTQlQkIlQTQlRTUlQUYlODQlRTUlQUQlOTglRTUlOTklQTgvMzIxOTQ4Mw==\">指令寄存器</span>中，此过程称为 “取指令”。与此同时，PC 中的地址或自动加 1 或由转移指针给出下一条指令的地址。此后经过分析指令，执行指令。完成第一条指令的执行，而后根据 PC 取出第二条指令的地址，如此循环，执行每一条指令。</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTclQTglOEIlRTUlQkElOEYlRTglQUUlQTElRTYlOTUlQjAlRTUlOTklQTgvMzIxOTUzNg==\">原文地址</span></p>\n</blockquote>\n<h4 id=\"3-指令寄存器\"><a class=\"anchor\" href=\"#3-指令寄存器\">#</a> ③  指令寄存器</h4>\n<blockquote>\n<p>根据指令在存贮器中的地址（由指令地址计数器给出），把指令从存贮器中取出来之后，需要有一个专门用于存放指令的地方，以便对指令进行分析和执行。这个专门存放现行指令的部件就叫做指令寄存器。指令寄存器的位数应满足指令长度的要求 [2] 。</p>\n<p>指令寄存器与 CPU 的 8 根数据总线相连接。当<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTclQTglOEIlRTUlQkElOEYlRTglQUUlQTElRTYlOTUlQjAlRTUlOTklQTgvMzIxOTUzNg==\">程序计数器</span>访问存储器地址时，存储在该地址单元内的信息经 8 位数据总线送出，并储存在指令存器中</p>\n</blockquote>\n<h5 id=\"a-属性描述\"><a class=\"anchor\" href=\"#a-属性描述\">#</a> a) 属性描述</h5>\n<blockquote>\n<p>BSDL 语言中有一个重要的描述，即指令寄存器（Instruclion Register），它是由一些强制的、可选的和用户自定义的指令集合而成。</p>\n<p>关于这个指令寄存器的属性描述，必须包含 5 个要素：</p>\n<blockquote>\n<ul>\n<li>指令寄存器的长度、</li>\n<li>各种指令的名称、</li>\n<li>对应的操作码、</li>\n<li>指令寄存器的捕获操作码</li>\n<li>哪些指令是内部的</li>\n</ul>\n</blockquote>\n</blockquote>\n<h5 id=\"b-取指过程\"><a class=\"anchor\" href=\"#b-取指过程\">#</a> b) 取指过程</h5>\n<blockquote>\n<p>取指令阶段完成的任务是将现行指令从主存中取出来并送至指令寄存器中，具体操作如下</p>\n<ol>\n<li>将 <strong>程序计数器</strong> (PC) 中的内容送至存储器<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlOUMlQjAlRTUlOUQlODAlRTUlQUYlODQlRTUlQUQlOTglRTUlOTklQTgvMzIxOTYxOQ==\">地址寄存器</span>（MAR), 并送地址总线</li>\n<li>由控制单元 (CU) 经控制总线 (CB) 向存储器发 <strong>读命令</strong></li>\n<li>从主存中取出的指令通过数据总线 (DB), 送到存储器<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOTUlQjAlRTYlOEQlQUUlRTUlQUYlODQlRTUlQUQlOTglRTUlOTklQTgvMTk0NDIzMQ==\">数据寄存器</span>（MDR）</li>\n<li>将 MDR 的内容送至指令寄存器（R）中</li>\n<li>将 PC 的内容递增，为取下一条指令做好准备</li>\n</ol>\n<p>以上这些操作对任何一条指令来说都是必须要执行的操作，所以称为公共操作</p>\n</blockquote>\n<h4 id=\"4-指令译码器\"><a class=\"anchor\" href=\"#4-指令译码器\">#</a> ④ 指令译码器</h4>\n<blockquote>\n<p>指令译码器 (Instruction Decoder,ID) 是<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEUlQTclRTUlODglQjYlRTUlOTklQTgvMjIwNjEyNg==\">控制器</span>中的主要部件之一。</p>\n<ul>\n<li>计算机能且只能执行 “指令”。指令由<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOTMlOEQlRTQlQkQlOUMlRTclQTAlODEvMzIyMDQxOA==\">操作码</span>和<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlOUMlQjAlRTUlOUQlODAlRTclQTAlODEvMzIyMDQ1NA==\">地址码</span>组成。</li>\n<li>操作码表示要执行的操作性质，即执行什么操作，或做什么；地址码是操作码执行时的操作对象的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlOUMlQjAlRTUlOUQlODAvODA0MjA=\">地址</span>。</li>\n<li>计算机执行一条指定的指令时，必须首先分析这条指令的操作码是什么，以决定操作的性质和方法，然后才能控制计算机其他各部件协同完成指令表达的功能。</li>\n<li>这个分析工作由 <strong>指令译码器</strong> 来完成。</li>\n<li>指令执行通过 控制部件 进行 指令译码，标量指令由标量<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlQTQlODQlRTclOTAlODYlRTYlOUMlQkE=\">处理机</span>执行向量指令各 Cache 控制器监听总线所有操作，并对操作做相应处理（修改或作废），如<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS9NRVNJJUU1JThEJThGJUU4JUFFJUFFLzIyNzQyMzMx\"> MESI 协议</span>。</li>\n</ul>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEMlODclRTQlQkIlQTQlRTglQUYlOTElRTclQTAlODElRTUlOTklQTgvMzI5NTI2MQ==\">原文地址</span></p>\n</blockquote>\n<h4 id=\"5-操作控制器\"><a class=\"anchor\" href=\"#5-操作控制器\">#</a> ⑤ 操作控制器</h4>\n<blockquote>\n<p>操作控制器的功能就是根据指令<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOTMlOEQlRTQlQkQlOUMlRTclQTAlODE=\">操作码</span>和<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOTclQjYlRTUlQkElOEYlRTQlQkYlQTElRTUlOEYlQjc=\">时序信号</span>，产生各种操作<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEUlQTclRTUlODglQjYlRTQlQkYlQTElRTUlOEYlQjc=\">控制信号</span>，以</p>\n<p>便正确地建立<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOTUlQjAlRTYlOEQlQUUlRTklODAlOUElRTglQjclQUY=\">数据通路</span>，从而完成取指令和执行指令的控制。</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOTMlOEQlRTQlQkQlOUMlRTYlOEUlQTclRTUlODglQjYlRTUlOTklQTgvMTkyMTcyNQ==\">原文地址</span></p>\n</blockquote>\n<h5 id=\"a-指令执行过程\"><a class=\"anchor\" href=\"#a-指令执行过程\">#</a> a) 指令执行过程</h5>\n<blockquote>\n<p>1、取指令：根据指令地址（由 PC 提供），从<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlQUQlOTglRTUlODIlQTglRTUlOTklQTg=\">存储器</span>中取出所要执行的指令。</p>\n<p>2、分析指令：</p>\n<p>（1）<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTglQUYlOTElRTclQTAlODE=\">译码</span>分析。确定指令应完成的操作，产生相应操作的控制电位。去参与形成该指令功能所需要的全部控制命令（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlQkUlQUUlRTYlOTMlOEQlRTQlQkQlOUMvODE5MDI2OQ==\">微操作</span>控制信号）。</p>\n<p>（2）根据<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlQUYlQkIlRTUlOUQlODAlRTYlOTYlQjklRTUlQkMlOEY=\">寻址方式</span>的分析和指令功能要求，形成<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOTMlOEQlRTQlQkQlOUMlRTYlOTUlQjA=\">操作数</span>的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOUMlODklRTYlOTUlODglRTUlOUMlQjAlRTUlOUQlODA=\">有效地址</span>，并按此地址取出操作数（运算型指令）或形成转移地址（转移类指令），以实现程序转移。</p>\n<p>3、执行指令：根据指令分析所产生的操作<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOEUlQTclRTUlODglQjYlRTQlQkYlQTElRTUlOEYlQjc=\">控制信号</span>和形成的有效地址，按一定算法形成指令控制序列，控制有关部件完成指令规定的功能。</p>\n</blockquote>\n<h5 id=\"b-控制方式\"><a class=\"anchor\" href=\"#b-控制方式\">#</a> b) 控制方式</h5>\n<blockquote>\n<p>操作控制器常用的控制方式有<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlOTAlOEMlRTYlQUQlQTUlRTYlOEUlQTclRTUlODglQjYvOTY0OTg5Nw==\">同步控制</span>、异步控制、联合控制。</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlOTAlOEMlRTYlQUQlQTUlRTYlOEUlQTclRTUlODglQjYlRTYlOTYlQjklRTUlQkMlOEY=\">同步控制方式</span>：任何指令的运行或指令中各个<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlQkUlQUUlRTYlOTMlOEQlRTQlQkQlOUMvODE5MDI2OQ==\">微操作</span>的执行，均由确定的，具有统一基准时标的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTYlOTclQjYlRTUlQkElOEYlRTQlQkYlQTElRTUlOEYlQjc=\">时序信号</span>所控制。即所有的操作均由统一的时钟控制，在标准时间内完成。（在同步控制下，每个时序信号的结束就意味着安排完成的工作已经完成，随即开始执行后续的微操作或自动转向下条指令的运行。）</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlQkMlODIlRTYlQUQlQTUlRTYlOEUlQTclRTUlODglQjYlRTYlOTYlQjklRTUlQkMlOEY=\">异步控制方式</span>：没有统一的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlOTAlOEMlRTYlQUQlQTUlRTQlQkYlQTElRTUlOEYlQjcvODU1NTQwMg==\">同步信号</span>，采用问答方式进行时序协调，将前一操作的回答作为下一操作的启动信号。</p>\n<p>联合控制方式：将同步控制和异步控制相结合。其通常设计思想为：在功能部件内部采用同步方式或以同步方式为主的控制方式；在功能部件间采用异步方式。</p>\n</blockquote>\n<h3 id=\"ii-运算单元\"><a class=\"anchor\" href=\"#ii-运算单元\">#</a> Ⅱ - 运算单元</h3>\n<blockquote>\n<p>如果 <strong>控制单元</strong> 发出的控制信号存在<strong>算数运算</strong> (加减乘除、增 1、减 1、取反等) 或者 <strong>逻辑运算</strong> (与、或、非、异或), 那么<strong>需要通过运算单元获取存储单元的计算数据</strong>进行处理</p>\n</blockquote>\n<h3 id=\"iii-储存单元\"><a class=\"anchor\" href=\"#iii-储存单元\">#</a> Ⅲ - 储存单元</h3>\n<blockquote>\n<p>包括片内 <strong>缓存</strong> 和 <strong>寄存器组</strong>，是 CPU 中临时存放数据的地方</p>\n<ul>\n<li>CPU 直接访问主存数据大概需要花费数百个机器周期</li>\n<li>而访问 <strong>缓存</strong> 和 <strong>寄存器组</strong> 只需要若干个或者几十个机器周期</li>\n<li>因此会使用 <strong>缓存</strong> 和 <strong>寄存器组</strong> 来存储和获取临时数据 (即将被运算或者运算之后的数据), 从而提升运行效率</li>\n</ul>\n</blockquote>\n<h3 id=\"iv-指令周期\"><a class=\"anchor\" href=\"#iv-指令周期\">#</a> Ⅳ - 指令周期</h3>\n<blockquote>\n<p>计算机系统执行程序指令时需要花费时间，其中取出一条指令并执行这条指令的时间叫做 <strong>指令周期</strong></p>\n</blockquote>\n<hr />\n<h2 id=\"2-为什么需要缓存\"><a class=\"anchor\" href=\"#2-为什么需要缓存\">#</a> 2、为什么需要缓存</h2>\n<blockquote>\n<blockquote>\n<p><strong> <code>CPU</code> </strong> 负责运算， <code>内存</code>  负责暂时存储运算所涉及的东西， <code>高速缓存是CPU内部集成的小容量高速内存</code></p>\n<p><strong>高速缓存</strong>和内存的区别是，缓存容量极小，但是与<strong> CPU</strong> 关系密切，所以传输速度比内存快得多</p>\n</blockquote>\n<ul>\n<li>缓存只是内存中少部分数据的复制品，所以 CPU 到缓存中寻找数据时也会出现找不到的情况 (因为这些数据没用从内存复制到缓存中去)</li>\n<li>在这种缓存中找不到的情况下，CPU 还是会到内存中去找数据，这样系统的速度就会慢下来，不过<strong> CPU 会把这些数据复制到缓存中去</strong>，以便下一次不用再到内存中去取，以此提高系统运行效率</li>\n<li>不过随着时间的变化，被访问得最频繁得数据不是一成不变的，也许昨天访问的不频繁的数据今天就非常频繁地进行了访问；</li>\n<li>所以说缓存中的数据经常要按照一定的算法来更换，这样才能保证缓存中的数据是被访问的最频繁的</li>\n</ul>\n</blockquote>\n<hr />\n<h2 id=\"3-cpu的作用\"><a class=\"anchor\" href=\"#3-cpu的作用\">#</a> 3、CPU 的作用</h2>\n<h3 id=\"i-缩短延迟\"><a class=\"anchor\" href=\"#i-缩短延迟\">#</a> Ⅰ - 缩短延迟</h3>\n<blockquote>\n<p>访问缓存的时间应该尽可能缩短，可以通过多种的方式缩短这个时间:</p>\n<ul>\n<li>比如能够通过减少缓存的大小、关联性来降低缓存的延迟；</li>\n<li>或者方法预测、增加宽带等</li>\n</ul>\n</blockquote>\n<h3 id=\"ii-提高命中率\"><a class=\"anchor\" href=\"#ii-提高命中率\">#</a> Ⅱ - 提高命中率</h3>\n<blockquote>\n<p>所谓命中率是在高速缓存中找到内存引用的速率，我们希望能够首先通过缓存中获得信息以得到速度的优势；</p>\n<p>所以缓存需要最大限度地实现这一目标</p>\n<p>对于单个高速缓存来说：大小、关联性和块大小决定命中率</p>\n</blockquote>\n<h3 id=\"iii-降低更低级别内存下的开销\"><a class=\"anchor\" href=\"#iii-降低更低级别内存下的开销\">#</a> Ⅲ - 降低更低级别内存下的开销</h3>\n<blockquote>\n<p>高速缓存是内存层次结构的一部分，其性能会影响其他性能，处理其他内存花费的时间越长意味着系统性能越低</p>\n<p>也就是说尽可能地让处理在缓存中完成</p>\n</blockquote>\n<h3 id=\"iv-减少错失惩罚\"><a class=\"anchor\" href=\"#iv-减少错失惩罚\">#</a> Ⅳ - 减少错失惩罚</h3>\n<blockquote>\n<p>缓存中不能命中是无法避免的事情，但是我们可以减少处理未命中所需地时间以获得更好的处理器性能，通过提升命中率与不同的优化能有效降低错失惩罚</p>\n<p>高速缓存是 CPU 中十分重要的部分，占据了大量的资源开销和成本，如果咱看过 CPU 架构图的话就会发现缓存占据了至少 50% 的面积，绝对至关重要</p>\n</blockquote>\n<hr />\n<h2 id=\"4-时钟周期与指令周期\"><a class=\"anchor\" href=\"#4-时钟周期与指令周期\">#</a> 4、时钟周期与指令周期</h2>\n<blockquote>\n<p><strong> <code>CPU时钟周期</code> </strong> 是操作的最小时间单位，值是主频的倒数，现代计算机的主频可以达到几 GHZ.</p>\n<p>** <code>指令周期</code>  ** 是取出并执行一个指令的时间单位，一个指令需要多个 CPU 操作来执行，一般来说一个指令周期至少包含 2 个 CPU 时钟周期 (取指 + 执行)</p>\n<p>同一个硬件架构下不同 CPU 的时钟周期越高，相同时间内能够执行的指令越多，性能就越好；但在不同硬件架构下只比较 CPU 主频大小意义不大，处理器结构不同，指令集就不同，相同意义的指令所需的 CPU 时钟周期也就不同</p>\n<p>除了计算机架构不同外，在比较计算机整体性能的时候还需要考虑很多因素，例如<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU1JTg5JThEJUU3JUFCJUFGJUU2JTgwJUJCJUU3JUJBJUJG\">前端总线</span>（&quot;front side bus&quot;，FSB），<strong>内存的时钟周期</strong>，CPU<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3cvaW5kZXgucGhwP3RpdGxlPSVFOSU4MCU5QSVFNyU5NCVBOCVFNSVBRiU4NCVFNSVBRCU5OCVFNSU5OSVBOCZhbXA7YWN0aW9uPWVkaXQmYW1wO3JlZGxpbms9MQ==\"> 通用寄存器</span>的数据宽度和机器的一级、二级<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU3JUJDJTkzJUU1JUFEJTk4\">缓存</span>等。</p>\n</blockquote>\n<hr />\n<h2 id=\"5-存储单元寄存器\"><a class=\"anchor\" href=\"#5-存储单元寄存器\">#</a> 5、存储单元 (寄存器)</h2>\n<blockquote>\n<p>寄存器是 CPU 的内部组成单元，是 CPU 运算时取 <strong>指令</strong> 和 <strong>数据</strong> 的地方，速度很快.</p>\n<blockquote>\n<ul>\n<li>可以理解成对于 CPU 来说，<strong>对寄存器进行 读 / 写 是不需要时间的</strong></li>\n<li>或者说如果只是操作寄存器 (比如类似 mov BX,AX 之类的操作), 那么一秒钟执行的指令个数理论上等于主频，因为寄存器是 CPU 的一部分</li>\n</ul>\n</blockquote>\n<h6 id=\"寄存器可以用来暂存指令-数据和地址-在cpu中分为\"><a class=\"anchor\" href=\"#寄存器可以用来暂存指令-数据和地址-在cpu中分为\">#</a> 寄存器可以用来暂存指令、数据和地址。在 CPU 中分为</h6>\n<ul>\n<li><strong>通用寄存器</strong>：如指令寄存器 <code>IR</code> ;</li>\n<li><strong>特殊功能寄存器</strong>：如程序计数器 <code>PC 、sp</code>  等</li>\n</ul>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/image-20211012102032541.png\" alt=\"image-20211012102032541\" /></p>\n</blockquote>\n<hr />\n<h1 id=\"四-cpu的多级缓存高速缓存\"><a class=\"anchor\" href=\"#四-cpu的多级缓存高速缓存\">#</a> 四、CPU 的多级缓存 (高速缓存)</h1>\n<blockquote>\n<blockquote>\n<h6 id=\"高速缓存cache通常分为l1l2l3三级速度递减容量递增是为了弥补cpu与内存之间运算速度的差异而设置的硬件\"><a class=\"anchor\" href=\"#高速缓存cache通常分为l1l2l3三级速度递减容量递增是为了弥补cpu与内存之间运算速度的差异而设置的硬件\">#</a> 高速缓存（cache）通常分为 L1,L2,L3 三级，速度递减，容量递增，是为了弥补 CPU 与内存之间运算速度的差异而设置的硬件</h6>\n</blockquote>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/image-20211012100054332.png\" alt=\"image-20211012100054332\" /></p>\n<p>上图为最简单的高速缓存的配置，数据的读取和储存都将经过高速缓存，CPU 核心与高速缓存有一条特殊的快速通道：主存和高速缓存都连在系统总线上，这条总线还用于其他组件的通信</p>\n<p>高速缓存出现不久，系统变得越来越复杂，高速缓存与主存之间的速度差异越来越大，直到加入了另一级缓存：新加入的这级缓存比第一缓存更大而且更慢，同时经济上不合适，所以有了二级缓存、三级缓存</p>\n</blockquote>\n<h2 id=\"1-多级缓存出现的意义\"><a class=\"anchor\" href=\"#1-多级缓存出现的意义\">#</a> 1、多级缓存出现的意义</h2>\n<h3 id=\"i-为什么需要cpu-cache\"><a class=\"anchor\" href=\"#i-为什么需要cpu-cache\">#</a> Ⅰ - 为什么需要 CPU Cache</h3>\n<blockquote>\n<blockquote>\n<p><strong>CPU 的频率太快了，快到主存跟不上，这样在处理器时钟周期内，CPU 常常需要等待主存，浪费资源，所以 Cache 的出现，是为了缓解 CPU 和内存之间速度的不匹配问题（结构：cpu -&gt; cache -&gt; memort）</strong></p>\n</blockquote>\n<p>当 <strong>CPU</strong> 处理数据时，它会先到 <strong>Cache</strong> 中去寻找，如果数据因之前的操作已经读取而被暂存其中的话就不必再从主内存中读取数据</p>\n<ul>\n<li>由于 CPU 的运行速度一般比主内存的读取速度快。主存 <strong>时钟周期</strong> (访问主存储器所需要时间) 为数个 CPU 时钟周期</li>\n<li>因此如果要访问主内存的话，就必须等待数个 CPU 周期从而造成浪费</li>\n<li><strong>L1 缓存</strong> 的速度可以在 2-4 个 CPU 时钟频率内完成，速度很快</li>\n</ul>\n<p>Linux 下可以通过  <code>lscpu</code>  命令来查看 CPU 的信息，其中就包括 Cache 层次</p>\n</blockquote>\n<h3 id=\"ii-cpu-cache-有什么意义\"><a class=\"anchor\" href=\"#ii-cpu-cache-有什么意义\">#</a> Ⅱ - CPU Cache 有什么意义</h3>\n<blockquote>\n<ul>\n<li>时间局限性：如果某个数据被访问，那么在不久的将来他很可能被再次访问</li>\n<li>空间局限性：如果某个数据被访问，那么与他相邻的数据很快也可能被访问</li>\n</ul>\n</blockquote>\n<h2 id=\"2-原理\"><a class=\"anchor\" href=\"#2-原理\">#</a> 2、原理</h2>\n<blockquote>\n<blockquote>\n<p>提供 '<strong> 缓存</strong> ' 的目的是为了让数据访问的速度适应 CPU 的处理速度，多级 Cache 技术，利用使用一个大的二级 Cache 来处理一级 Cache 的缺失，从而降低缺失代价</p>\n</blockquote>\n<p>通常它不像系统主存那样使用 <strong> <code>DRAM(动态)</code> </strong> 技术，而是使用 <strong>昂贵但比较快速</strong> 的 <strong> <code>SRAM(静态)</code> </strong> 技术，其原理是:</p>\n<ul>\n<li>内存中 '<strong> 程序执行与数据访问的局域性行为</strong> ', 即一定程序执行时间和空间内，被访问的代码集中于一部分</li>\n<li>为了充分发挥缓存的作用，不仅依靠 '<strong> 暂存刚刚访问过的数据</strong> ', 还要使用硬件实现的指令 <strong>预测 与 数据预取技术</strong> --&gt; 尽可能把将要使用的数据预先从内存中取到缓存里</li>\n</ul>\n</blockquote>\n<h2 id=\"3-数据结构\"><a class=\"anchor\" href=\"#3-数据结构\">#</a> 3、数据结构</h2>\n<blockquote>\n<p>高速缓存的数据结构类似于 <strong> <code>拉链式的散列表</code> </strong>，<strong>Key</strong> 是内存地址，<strong> 值</strong>是内存数据的副本或是即将写入内存的数据</p>\n<p><img data-src=\"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/image-20211012101834104.png\" alt=\"image-20211012101834104\" /></p>\n<p>其中 <strong>Tag</strong> 可以理解为数据的内存地址，<strong>Data Block</strong> 是内存数据，<strong>Flag</strong> 用于标识数据状态</p>\n</blockquote>\n<h2 id=\"4-cpu的多级缓存\"><a class=\"anchor\" href=\"#4-cpu的多级缓存\">#</a> 4、CPU 的多级缓存</h2>\n<blockquote>\n<p>CPU 的核心数量、高频高低都会影响性能，但如果让 CPU 更聪明、更有效率的执行计算任务，那么缓存的作用就至关重要了</p>\n</blockquote>\n<h3 id=\"ii-一级缓存-l1-cache\"><a class=\"anchor\" href=\"#ii-一级缓存-l1-cache\">#</a> Ⅱ - 一级缓存 (L1 Cache)</h3>\n<blockquote>\n<blockquote>\n<h6 id=\"cpu一级缓存就是指-cpu-的第一层级的高速缓存-主要担当的工作是-缓存指令-和-缓存数据\"><a class=\"anchor\" href=\"#cpu一级缓存就是指-cpu-的第一层级的高速缓存-主要担当的工作是-缓存指令-和-缓存数据\">#</a> <strong>CPU 一级缓存</strong>，就是指 CPU 的第一层级的高速缓存，主要担当的工作是 <strong>缓存指令</strong> 和 <strong>缓存数据</strong> .</h6>\n</blockquote>\n<ul>\n<li>一级缓存的容量与结构对于 CPU 性能的影响十分巨大，但是由于它的结构相对复杂且还有成本问题</li>\n<li>一般来说，<strong> <code>CPU 的一级缓存比较小</code> </strong>，通常 CPU 的一级缓存也就能做到 <strong>256KB</strong> 左右的水平</li>\n</ul>\n</blockquote>\n<h3 id=\"ii-二级缓存-l2-cache\"><a class=\"anchor\" href=\"#ii-二级缓存-l2-cache\">#</a> Ⅱ - 二级缓存 (L2 Cache)</h3>\n<blockquote>\n<blockquote>\n<h6 id=\"cpu-二级缓存-就是指-cpu-的第二层级的高速缓存\"><a class=\"anchor\" href=\"#cpu-二级缓存-就是指-cpu-的第二层级的高速缓存\">#</a> CPU 二级缓存，就是指 CPU 的第二层级的高速缓存</h6>\n</blockquote>\n<ul>\n<li>二级缓存的容量会直接影响到 CPU 的性能，所以二级缓存的容量越大越好</li>\n<li>例如 intel 的第八代 i7-8700 处理器，共有六个核心数量，而每个核心都拥有 256KB 的二级缓存，属于各核心独享，这样二级缓存总数就达到了 1.5MB。</li>\n</ul>\n</blockquote>\n<h3 id=\"iii-三级缓存-l3-cache\"><a class=\"anchor\" href=\"#iii-三级缓存-l3-cache\">#</a> Ⅲ - 三级缓存 (L3 Cache)</h3>\n<blockquote>\n<p>CPU 三级缓存，就是指 CPU 的第三层级的高速缓存，起作用就是进一步降低内存的延迟，同时提升海量数据计算时的性能</p>\n<blockquote>\n<h6 id=\"和一级-二级缓存不同的是三级缓存时核心共享的能够将容量做很大\"><a class=\"anchor\" href=\"#和一级-二级缓存不同的是三级缓存时核心共享的能够将容量做很大\">#</a> 和一级、二级缓存不同的是，三级缓存时核心共享的，能够将容量做很大</h6>\n</blockquote>\n</blockquote>\n<h3 id=\"iv-缓存一致性mesi\"><a class=\"anchor\" href=\"#iv-缓存一致性mesi\">#</a> Ⅳ - 缓存一致性 (MESI)</h3>\n<blockquote>\n<p>CPU 种每个  <code>缓存行</code>  使用 <strong>四种</strong> 状态进行标记</p>\n</blockquote>\n<h4 id=\"1-m-modified-修改\"><a class=\"anchor\" href=\"#1-m-modified-修改\">#</a> ① M: Modified 修改</h4>\n<blockquote>\n<p>指的时该 <strong>缓存行</strong> 只被缓存在该 CPU 种，并且是 <code>被修改过</code> 的，<strong>因此他与主存的数据是不一致的</strong>，</p>\n<p>该缓存行中的数据需要在未来某个时间点 (<strong>允许其他 CPU 读取主存相应的内容之前</strong>) 写回主存，然后 <code>状态变成E (独享)</code></p>\n</blockquote>\n<h4 id=\"2-exclusive-独享\"><a class=\"anchor\" href=\"#2-exclusive-独享\">#</a> ② Exclusive 独享</h4>\n<blockquote>\n<p>缓存行 只被缓存在该 CPU 的缓存中，是 <code>未被修改过</code> 的，<strong> 与主存的数据是一致的</strong>.</p>\n<p>可以在任何时刻当有其他 CPU 读取该内存时，状态变成  <code>S(共享)</code></p>\n<p>当 CPU 修改缓存行的内容时，状态变成  <code>M(修改)</code></p>\n</blockquote>\n<h4 id=\"3-share-共享\"><a class=\"anchor\" href=\"#3-share-共享\">#</a> ③ Share 共享</h4>\n<blockquote>\n<p>意味着该 缓存行  <code>可能被多个 CPU 进行缓存</code> ，并且<strong>该缓存中的数据与主存数据是一致的</strong></p>\n<p>当有一个 CPU 修改 <strong>该缓存行</strong> 时，其他 CPU 是可以被作废的，变成  <code>I(无效的)</code></p>\n</blockquote>\n<h4 id=\"4-invalid-无效的\"><a class=\"anchor\" href=\"#4-invalid-无效的\">#</a> ④ Invalid 无效的</h4>\n<blockquote>\n<p>代表这个缓存是无效的，可能是有其他 CPU 修改了该缓存行</p>\n</blockquote>\n<h4 id=\"5对应的四个操作\"><a class=\"anchor\" href=\"#5对应的四个操作\">#</a> ⑤对应的四个操作</h4>\n<blockquote>\n<p>local read：读本地缓存<br />\n local write：写本地缓存<br />\n remote read：将内存中的数据读取过来<br />\n remote write：将数据写回主存</p>\n</blockquote>\n<h5 id=\"a-详细说明\"><a class=\"anchor\" href=\"#a-详细说明\">#</a> a) 详细说明</h5>\n<blockquote>\n<blockquote>\n<p><strong>在一个典型的多核系统中，每一个核都会有自己的缓存来共享总线，每一个 CPU 会发出读写（I/O）请求，而缓存的目的是为了减少 CPU 读写共享主存的次数；</strong></p>\n</blockquote>\n<ol>\n<li>一个缓存除了在无效（Invalid）状态，都可以满足 CPU 的读请求，一个无效（Invalid）的缓存行必须从主存中读取（变成 Share 或者 Exclusive 状态）来满足该 CPU 的读请求</li>\n<li>一个  <code>写请求</code>  只有在该缓存行是 <strong> <code>修改</code> </strong> 或者 <strong> <code>独享</code> </strong> 状态时才能被执行</li>\n</ol>\n<ul>\n<li>如果缓存行处于 <strong> <code>共享</code> </strong> 状态，必须<strong>先将其他缓存中的 该缓存行</strong> 变成  <code>无效</code>  状态</li>\n<li><strong>也即是不允许不同 CPU 同时修改同一缓存行，即使修改该缓存行中的不同数据也不允许</strong></li>\n<li>该操作经常作用广播的方式来完成，例如：Request For Ownership（RFO）</li>\n</ul>\n<ol start=\"3\">\n<li>缓存可以随时将一个 <strong>非修改</strong> 状态的缓存行作废，或者变成 <strong> <code>无效</code> </strong> 状态，而一个 ** <code>修改</code>  ** 状态的缓存行必须先被写回主存</li>\n<li>一个处于 <strong>共享</strong> 状态的 缓存行  也 <code>必须监听</code>  其他缓存中<strong>使该 缓存行  <code>无效</code>  或者  <code>独享</code>  该缓存行的请求</strong>，并将该 缓存行 变成 <strong> <code>无效</code> </strong></li>\n<li>一个处于 <strong>独享</strong> 状态的 缓存行 也 <code>必须监听</code> 其他缓存中 <strong>读主存中该缓存行的操作</strong>，一旦有这种操作，该缓存行需要变成 <code>共享</code> 状态</li>\n<li>对于  <code>修改</code>  和  <code>独享</code>  状态而言总是精确的，他们在该缓存行的真正状态是一致的。</li>\n</ol>\n<ul>\n<li>而  <code>共享</code>  状态可能是非一致的</li>\n<li>如果一个缓存将处于  <code>共享</code>  状态的缓存行作废了，而另一个缓存实际上可能已经独享了 该缓存行，但是该缓存却不会将该 缓存行 升迁为  <code>独享</code>  状态</li>\n<li>这是因为<strong>其他缓存不会广播他们作废掉该缓存行的通知</strong>，同样由于缓存并没有保存该缓存行的 copy 的数量，因此也没有办法确定自己是否已经独享（Share 了该缓存行）</li>\n</ul>\n<p>从上面的意义看来独享（Exclusive）状态时一种投机性的优化：如果一个 CPU 想修改一个处于共享（Share）状态的缓存航，总线事务需要将所有缓存行的 copy 变成 Invalid 状态，而修改独享（Exclusive）状态的缓存不需要使用总线事务</p>\n</blockquote>\n",
            "tags": [
                "计算机组成原理",
                "计算机组成原理",
                "缓存",
                "内存",
                "CPU"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/01/02/%E9%A1%B9%E7%9B%AE%E8%B4%A8%E9%87%8F%E6%A3%80%E6%B5%8B/",
            "url": "https://dmqweb.cn/2024/01/02/%E9%A1%B9%E7%9B%AE%E8%B4%A8%E9%87%8F%E6%A3%80%E6%B5%8B/",
            "title": "项目质量检测",
            "date_published": "2024-01-01T18:24:04.000Z",
            "content_html": "<h1 id=\"5-2-项目质量监测\"><a class=\"anchor\" href=\"#5-2-项目质量监测\">#</a> 5-2 项目质量监测</h1>\n<h2 id=\"课程介绍\"><a class=\"anchor\" href=\"#课程介绍\">#</a> 课程介绍</h2>\n<p>没有规矩不成方圆，所以我们写代码也要有 &quot;规矩&quot;，但是我们通常记不住所有的 &quot;规矩&quot;，因为人嘛，不可能不犯错。但是，这难不到我们程序员，我们让机器、代码、程序帮我们搞定，让它们来帮我们进行代码质量检查，以便提高的程序的健壮性。</p>\n<p>通常来说，项目的质量决定了：</p>\n<ul>\n<li>软件项目的<strong>命运</strong></li>\n<li>软件项目的<strong>可维护性</strong></li>\n<li>软件项目的<strong>运维成本</strong></li>\n<li>软件项目的<strong>扩展性</strong></li>\n</ul>\n<p><strong>为什么要进行代码质量检查？</strong></p>\n<p>代码检查很重要，原因有三：</p>\n<ol>\n<li><strong>避免低级 bug</strong>：一些常见代码问题，如果在编译或运行前不能及时发现，代码中的语法问题会直接导致编译或运行时错误，影响开发效率和代码质量；</li>\n<li><strong>统一代码习惯</strong>：每一个团队或个人都会有一些代码规范或者代码习惯，为了便于后期维护和阅读，我们编写的代码也需要符合一定的格式规范；\n<ul>\n<li>空格</li>\n<li>统一缩进</li>\n<li>命名规范</li>\n<li>...</li>\n</ul>\n</li>\n<li><strong>保证线上代码质量</strong>：在版本管理中，我们需要在提交或发布之前自动执行一些代码检查工作，确保我们的代码符合最终版本要求。</li>\n</ol>\n<p>如何让一个团队的人产出的代码都在一个基本水平底线之上呢？最初是靠制订规范。要确保规范得以执行只能靠人，所以文字规范成了 code review 的公共参照标准。** 单纯靠人的事最终都容易流于形式，所以需要工具加以保证。** 虽说工具并不能完全实现规范中的规则，但至少能够在一定程度上缓解代码不统一的局面。</p>\n<p><strong>本课程的学习路径：</strong></p>\n<ul>\n<li>Why</li>\n<li>What</li>\n<li>How</li>\n</ul>\n<p><strong>本课程的主要内容：</strong></p>\n<p>代码质量监测包括：代码规范（代码编写层面）、功能实现（测试层面）、Code Review（团队协作层面）。</p>\n<p>本课程，代码规范作为展开，以 eslint 为例子；代码质量中的功能实现，以 e2e test 为例子。</p>\n<p>关于，功能实现中的单元测试，5-3 课程中有具体的框架使用及介绍。</p>\n<ul>\n<li>代码 Lint—— 告别低级代码错误，简单的配置让程序来自动检查</li>\n<li>e2e test—— 了解什么是黑盒测试，如何进行 e2e test，即 End to End Test，端到端的测试。</li>\n<li>开源测试平台：Codecov 介绍 —— 配合 Ci 工具，让测试过程自动化，大大提升效率</li>\n</ul>\n<p><img data-src=\"assets/MacHi-2017-10-15-21-45-04.png\" alt=\"img\" /></p>\n<p>这些徽章都是可以点击的，第一个点进去是 <span class=\"exturl\" data-url=\"aHR0cHM6Ly90cmF2aXMtY2kub3JnLyVFRiVCQyU4Q3RyYXZpcy1jaQ==\">https://travis-ci.org/，travis-ci</span> 是一个 CI（Continuous integration，持续集成） 平台，主要提供集群编译、单测、集成测试的环境。 <code>.org</code>  的服务对公有仓库免费， <code>.com</code>  面向私人、团队、公司的项目提供商业支持（收费）。使用起来非常简单，使用 Github 帐号登录进去，就能看见开始界面。</p>\n<p>第二个徽章是 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb2RlY292LmlvLw==\">codecov.io</span>（单测覆盖率统计平台），接入过程也很简单，也是不同语言选择不同的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmNvZGVjb3YuaW8vZG9jcy9zdXBwb3J0ZWQtbGFuZ3VhZ2Vz\">配置文件</span>，codecov 可以无缝衔接 travis-ci，只需要在原来的配置文件上稍作修改即可，核心就是生成单测的结果文件。\\</p>\n<p><strong>本课程的学习准备：</strong></p>\n<ul>\n<li>IDE vscode，node &gt; 10.15</li>\n<li>包管理工具：yarn, cnpm</li>\n<li>Github 账号</li>\n</ul>\n<h2 id=\"代码质量检查\"><a class=\"anchor\" href=\"#代码质量检查\">#</a> 代码质量检查</h2>\n<h3 id=\"前端代码中的常见问题why-lint\"><a class=\"anchor\" href=\"#前端代码中的常见问题why-lint\">#</a> 前端代码中的常见问题 (Why Lint)</h3>\n<h4 id=\"书写风格\"><a class=\"anchor\" href=\"#书写风格\">#</a> 书写风格</h4>\n<p>这个问题不用作过多阐述，想必接手过他人代码的同学，多少都有些体会。简单来说，太过随意的代码会让强迫症患者难以容忍，难以阅读理解的代码有时甚至不如推倒重来。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// bad</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> once</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">,</span> upon</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">,</span> aTime<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// good</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">var</span> once<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    upon<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    aTime<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// bad</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">var</span> hero <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token literal-property property\">firstName</span><span class=\"token operator\">:</span> <span class=\"token string\">'Bob'</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">lastName</span><span class=\"token operator\">:</span> <span class=\"token string\">'Parr'</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">heroName</span><span class=\"token operator\">:</span> <span class=\"token string\">'Mr. Incredible'</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">superPower</span><span class=\"token operator\">:</span> <span class=\"token string\">'strength'</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">// good</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">var</span> hero <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token literal-property property\">firstName</span><span class=\"token operator\">:</span> <span class=\"token string\">'Bob'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token literal-property property\">lastName</span><span class=\"token operator\">:</span> <span class=\"token string\">'Parr'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token literal-property property\">heroName</span><span class=\"token operator\">:</span> <span class=\"token string\">'Mr. Incredible'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token literal-property property\">superPower</span><span class=\"token operator\">:</span> <span class=\"token string\">'strength'</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"代码规范\"><a class=\"anchor\" href=\"#代码规范\">#</a> 代码规范</h4>\n<p>什么样的代码是低质量或高质量的？好的代码可能会让你如读小说一般被吸引，糟糕的代码会让你看一眼就不想继续、甚至看半天而不知所云。</p>\n<p>有人可能认为初级程序员才会有这种问题，其实不然，一些工作经验两三年的同学写的代码依然如此。对于一些个人自学意识不够积极、没有团队规范性指引的同学，很容易习惯成 “学习半年、然后重复三年无长进” 的情况。</p>\n<p>Lint 会通过源代码去查找：</p>\n<ul>\n<li>\n<p>格式问题</p>\n</li>\n<li>\n<p>不遵守编码标准和惯例</p>\n</li>\n<li>\n<p>精确定位程序中可能存在的逻辑错误</p>\n</li>\n</ul>\n<h4 id=\"高度耦合\"><a class=\"anchor\" href=\"#高度耦合\">#</a> 高度耦合</h4>\n<p>这种问题其实是非常普遍的。一个函数几百行、一个文件数千行、一个类几十个方法、方法参数定义随意、没有任何注释、方法与变量命名无明确的语义、数据修改与变更穿插在各种方法中等等。 这样的编码方式，你要去理解它的逻辑往往真的很难，一般只能一块块一行行的去做阅读理解（可能还会开启边看边骂娘模式）。</p>\n<p>这主要原因在于开发者个人的基础知识能力、编码经验和意识等的不足。</p>\n<p>其实针对这种情况，常见的开源的编码规范都会有所提及。我的建议是这些同学应该好好温习一下面向对象编程、函数式编程、数据结构、常见设计模式，看一看各种开源的编码规范并尝试去真正的理解它们。当你回顾一个月前的代码时，发现可以改进或重构使得编码逻辑更为简洁清晰，说明你是在成长与进步的。</p>\n<p>经常看到有同学问这类问题：新项目正在选型，Vue.js、React、Angular 三大框架哪个合适？其实团队开发成员对这些都比较有经验，哪种都可以；如果团队成员前端开发经验大都不是太丰富或人员不够稳定，选择 Vue.js 最适合，为什么？因为它更简单简洁，容易上手。Vue.js 通过 prop、data、computed、method、watch 等各种钩子，一定程度上限定了编码方式与风格，使得初级开发者写出来的代码也不会太难看，这也是它越来越受社区推崇的原因之一。</p>\n<h3 id=\"代码质量监测def-lint-code\"><a class=\"anchor\" href=\"#代码质量监测def-lint-code\">#</a> 代码质量监测（Def: Lint Code）</h3>\n<p>那么，什么是代码质量监测？</p>\n<p>Lint 或者 Linter 是一种分析源代码以标记编程过程中（代码、样式、构建）书写的错误的工具或者过程。</p>\n<blockquote>\n<p><strong>Lint</strong>, or a <strong>linter</strong>, is a tool that analyzes <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU291cmNlX2NvZGU=\">source code</span> to flag programming errors, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU29mdHdhcmVfYnVn\">bugs</span>, stylistic errors, and suspicious constructs.[<span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGludF8oc29mdHdhcmUpI2NpdGVfbm90ZS0x\">1]</span> The term originates from a <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVW5peA==\">Unix</span> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl91dGlsaXR5X3NvZnR3YXJl\">utility</span> that examined <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ18ocHJvZ3JhbW1pbmdfbGFuZ3VhZ2Up\">C language</span> source code.[<span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGludF8oc29mdHdhcmUpI2NpdGVfbm90ZS1CZWxsTGFicy0y\">2]</span></p>\n</blockquote>\n<p>代码 Lint 是动态的监测代码编写的错误，以便我们能写出高质量的代码。</p>\n<blockquote>\n<p>与 Prettier 或者 Format 要区别开来，Lint 只会告诉你代码中的错误或者不符合规范的地方，而 Format 是用来对格式进行调整的。</p>\n</blockquote>\n<h3 id=\"如何进行代码质量监测how-to-lint\"><a class=\"anchor\" href=\"#如何进行代码质量监测how-to-lint\">#</a> 如何进行代码质量监测 (How to Lint)</h3>\n<p>为了统一团队的代码规范，除了一纸规范说明之外，还需要引入工具进行限制。虽说工具并不能完全实现规范中的规则，但至少能够在一定程度上缓解代码不统一的局面。</p>\n<p>相对于后端，前端代码规范的质量检查涉及到 HTML, CSS，Javascript ，如今还涉及到 SCSS，ES5，JSX,  React，Vue，Angular 等。</p>\n<p>常见的代码质量 Lint 工具：</p>\n<p>HTML / tpl:  <span class=\"exturl\" data-url=\"aHR0cDovL2h0bWxoaW50LmNvbS8=\">HTMLHint</span></p>\n<p>CSS / SCSS: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdHlsZWxpbnQuaW8v\">StyleLint</span></p>\n<p>JS / JSX: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lc2xpbnQub3JnLw==\">ESLint</span></p>\n<h3 id=\"3种常见的js检验工具比较\"><a class=\"anchor\" href=\"#3种常见的js检验工具比较\">#</a> 3 种常见的 Js 检验工具比较</h3>\n<p>常见三个可以使用的 js 校验器，但是怎么选择使用哪一个呢？接下来让我们看看这四种流行方案的特点、优点和不足：<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5qc2xpbnQuY29tLw==\">JSLint</span>、<span class=\"exturl\" data-url=\"aHR0cDovL2pzaGludC5jb20v\">JSHint</span>、<span class=\"exturl\" data-url=\"aHR0cDovL2VzbGludC5vcmcv\">ESLint</span>。</p>\n<p>四种工具用相同的基本方式工作。他们都有一套用户分析、报告 js 文件错误的规则。他们都可以通过 npm 安装。他们都可以通过命令行使用、作为 IDE 插件使用、也可以集成到编辑器中。他们四种均支持使用注释进行配置。</p>\n<h4 id=\"jslint\"><a class=\"anchor\" href=\"#jslint\">#</a> JSLint</h4>\n<p>JSLint 是其中最老的工具。在 2002 年 Douglas Crockford 开发了该工具，根据其经验，强制使用 js 语言中精粹的部分。如果你同意这些精粹，JSLint 能成为一个好的工具。</p>\n<p>JSLint 的缺点是不能配置和拓展。你根本不能禁掉需要特性，并且很多缺少文档。官方文档非常不友好，例如缺少如何将其集成到编辑的信息。</p>\n<p><strong>优点</strong></p>\n<ul>\n<li>参数配置完成，可以直接使用</li>\n</ul>\n<p><strong>缺点</strong></p>\n<ul>\n<li>JSLint 不存在配置文件，如果想改变参数设置，那就存在问题</li>\n<li>有限的配置选项，许多规则不能禁掉</li>\n<li>不能增加个性化规则</li>\n<li>没有文档记录规则</li>\n<li>很难弄清楚哪个规则引起的错误</li>\n</ul>\n<h4 id=\"jshint\"><a class=\"anchor\" href=\"#jshint\">#</a> JSHint</h4>\n<p>作为一个可配置的 JSLint 版本，JSHint 被开发出来。你可以配置每个规则，将其放到一个配置文件中，这样在大项目中可以容易使用。JSHint 对每个规则有好的文档，所以可以准确知道每个规则的作用。将其集成到编辑器也是简单的。</p>\n<p>JSHint 的一个小缺点是里面的松散默认配置。也即是你在使其可用之前必须将其启动。和 ESLint 相比，确定哪个规则用户开启或关闭错误信息，JSHint 是更加困难。</p>\n<p><strong>优点</strong></p>\n<ul>\n<li>大多是参数可以配置</li>\n<li>支持配置文件，在大项目中容易使用</li>\n<li>已经支持需要类库，像 jQuery、QUnit、NodeJS、Mocha 等</li>\n<li>支持基本的 ES6</li>\n</ul>\n<p><strong>缺点</strong></p>\n<ul>\n<li>难于知道哪个规则产生错误</li>\n<li>存在两类选项：强制选项和松散选项。使得配置有些混乱</li>\n<li>不支持自定义规则</li>\n</ul>\n<h4 id=\"eslint\"><a class=\"anchor\" href=\"#eslint\">#</a> ESLint</h4>\n<p>ESLint 是比较新出来的工具。它被设计的容易拓展、拥有大量的自定义规则、容易的通过插件来安装。它给出准确的输出，而且包括规则名，这样可以知道哪个规则造成了错误。</p>\n<p>ESLint 文档多少有些混乱。规则容易查找，以及被分为逻辑组，但是配置指南在有些地方容易弄混。然而它可以在一个地方提供链接去编辑集成、插件和样例。</p>\n<p><strong>优点</strong></p>\n<ul>\n<li>灵活：任何规则都可以开启闭合，以及有些规则有些额外配置</li>\n<li>很容易拓展和有需要可用插件</li>\n<li>容易理解产出</li>\n<li>包含了在其他检查器中不可用的规则，使得 ESLint 在错误检查上更有用</li>\n<li>支持 ES6，支持 JSX 的工具</li>\n<li>支持自定义报告</li>\n</ul>\n<p><strong>缺点</strong></p>\n<ul>\n<li>需要一些配置</li>\n<li>速度慢</li>\n</ul>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2pzY3MuaW5mby8=\">JSCS</span> 已经合并到 ESlint</p>\n</blockquote>\n<p>总结一下：</p>\n<table>\n<thead>\n<tr>\n<th>分类</th>\n<th>JSLint</th>\n<th>JSHint</th>\n<th>ESLint</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>初始配置</td>\n<td>有</td>\n<td>有</td>\n<td>可配置</td>\n</tr>\n<tr>\n<td>自定义</td>\n<td>命令行，有限</td>\n<td>可配置</td>\n<td>可配置</td>\n</tr>\n<tr>\n<td>配置文件</td>\n<td>否</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>ES6</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>JSX</td>\n<td>否</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>执行效率</td>\n<td>高</td>\n<td>中</td>\n<td>低</td>\n</tr>\n<tr>\n<td>输出友好度</td>\n<td>低</td>\n<td>中</td>\n<td>高</td>\n</tr>\n<tr>\n<td>Stars</td>\n<td>3.3k</td>\n<td>8.2k</td>\n<td>14.2k</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"lint工具介绍\"><a class=\"anchor\" href=\"#lint工具介绍\">#</a> Lint 工具介绍</h2>\n<p>Lint 是一种工具，可以分析源代码，并在出现错误或与团队编码约定不符时通知用户。在某些情况下，它还可以自动修复错误。</p>\n<p>虽然已经为不同语言开发了许多种 Lint，但是有些人可能遇到过以下问题。</p>\n<ul>\n<li>\n<p>这是我第一次使用这种语言进行编码，什么被认为是这种语言的一般编码风格？</p>\n</li>\n<li>\n<p>我正在使用 Lint 的默认设置，但错误验证过程太严格。</p>\n<p>我想更改设置，但是更改设置会更容易忽略某些错误吗？</p>\n</li>\n</ul>\n<p>即使对于单一语言，也提出了各种编码约定。因此，特别是首先，确定哪些编码约定更好地遵循可能是困难的。</p>\n<p>因此，让我们研究一下常用的开源软件上的 Lint 设置，看看正在使用哪种设置和编码约定。</p>\n<h3 id=\"eslint-2\"><a class=\"anchor\" href=\"#eslint-2\">#</a> ESLint</h3>\n<p>ESLint 是 JavaScript 的 linting 实用程序。</p>\n<p>ESLint 不依赖于特定的编码约定，用户也可以自由地启用或禁用各个编码约定。从这个意义上讲，它的一个主要特点是其高度可定制性。</p>\n<p>用户可以通过定义原始<span class=\"exturl\" data-url=\"aHR0cHM6Ly9lc2xpbnQub3JnL2RvY3MvcnVsZXMv\">规则来</span>灵活地设置编码标准，这些规则是 ESLint 中默认可用的编码规则。此外，第三方共享的着名编码约定，例如 “Google JavaScript Style Guide” 或 “Airbnb JavaScript Style Guide” 也可以重复使用。</p>\n<p>您甚至可以在遵循这些编码约定的同时启用 / 禁用特定文件的特定规则。</p>\n<p>如果您不知道要开始的设置，可以参考 ESLint 官方提供的 “ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lc2xpbnQub3JnL2RvY3MvdXNlci1ndWlkZS9nZXR0aW5nLXN0YXJ0ZWQ=\">入门</span> ” 指南，以使用建议的编码约定。</p>\n<p>核心概念：</p>\n<ul>\n<li>\n<p>配置文件：</p>\n<p><code>.eslintrc</code> ， <code>.eslintrc.js</code> ， <code>.eslintrc.yml</code></p>\n</li>\n<li>\n<p>Rules：</p>\n<ul>\n<li>“off” 或  <code>0</code>  - 关闭规则</li>\n<li>“warn” 或  <code>1</code>  - 开启规则，使用警告级别的错误：warn (不会导致程序退出)</li>\n<li>“error” 或  <code>2</code>  - 开启规则，使用错误级别的错误：error (当被触发的时候，程序会退出)</li>\n</ul>\n<p>看一个例子：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"rules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"semi\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"error\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"never\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token property\">\"quotes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"error\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"single\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>也可以写成：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"rules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"semi\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"never\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token property\">\"quotes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"single\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>Extends：</p>\n<p>使用别人提供的包， 如 google</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string\">\"extends\"</span>：<span class=\"token string\">\"google\"</span>，</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>通过使用上述说明，用户可以轻松使用 Google JavaScript 样式指南中的编码约定，而无需从头开始编写设置。</p>\n</li>\n<li>\n<p>Plugins:</p>\n<p>ESLint 提供的默认规则涵盖了基本规则，但 JavaScript 可以使用的范围非常广泛。因此，您可能希望规则不在默认规则中。在这种情况下，可以在 ESLint 中开发自己的独立规则。为了让第三方开发自己的规则，ESLint 允许使用<span class=\"exturl\" data-url=\"aHR0cHM6Ly9lc2xpbnQub3JnL2RvY3MvZGV2ZWxvcGVyLWd1aWRlL3dvcmtpbmctd2l0aC1wbHVnaW5z\">插件</span>。如果你在 npm 中搜索 eslint-plugin- *，你可以找到第三方提供的大量自定义插件。</p>\n<p>如果 ESLint 的默认规则未提供您要使用的规则，则建议您查找插件。</p>\n<p>与可共享配置类似，它很容易设置。例如，如果要对 React 代码执行静态分析，可以安装名为<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZXNsaW50LXBsdWdpbi1yZWFjdA==\"> eslint-plugin-react 的插件</span>，并使用以下设置来执行 React 语法特有的静态分析。</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"google\"</span>，</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string\">\"react\"</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">]</span>，</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token string\">\"rules\"</span>\"<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"semi\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"error\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"never\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"quotes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"error\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"single\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ul>\n<h4 id=\"起步与安装\"><a class=\"anchor\" href=\"#起步与安装\">#</a> 起步与安装</h4>\n<ol>\n<li>\n<p>在项目中去使用</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//npm init 指令会在项目根目录下生成 package.json 文件。</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>npm init</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//--save-dev 会把 eslint 安装到 package.json 文件中的 devDependencies 属性中，意思是只是开发阶段用到这个包，上线时就不需要这个包了。</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>npm install eslint --save-dev</pre></td></tr></table></figure><ul>\n<li>使用 <code>npm run</code></li>\n</ul>\n<p>新增 <code>package.json</code>  脚本，或者使用  <code>npx</code>  命令</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token string-property property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string-property property\">\"lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eslint src\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token string-property property\">\"lint:create\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eslint --init\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>然后使用 <code>run</code>  命令：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> run lint</pre></td></tr></table></figure><ul>\n<li>直接使用 <code>npx</code>  命令：</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>npx eslint <span class=\"token parameter variable\">--init</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>// 或者</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>./node_modules/.bin/eslint <span class=\"token parameter variable\">--init</span></pre></td></tr></table></figure></li>\n<li>\n<p>在全局使用</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-g</span> eslint</pre></td></tr></table></figure></li>\n</ol>\n<h4 id=\"eslint初始化\"><a class=\"anchor\" href=\"#eslint初始化\">#</a> ESLint 初始化</h4>\n<p>配置方法使用  <code>eslint --init</code>  方法</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜ npx eslint <span class=\"token parameter variable\">--init</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>? How would you like to use ESLint? <span class=\"token punctuation\">(</span>Use arrow keys<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  To check syntax only </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>❯ To check syntax and <span class=\"token function\">find</span> problems </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  To check syntax, <span class=\"token function\">find</span> problems, and enforce code style </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>? What <span class=\"token builtin class-name\">type</span> of modules does your project use? <span class=\"token punctuation\">(</span>Use arrow keys<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>❯ JavaScript modules <span class=\"token punctuation\">(</span>import/export<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  CommonJS <span class=\"token punctuation\">(</span>require/exports<span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  None of these </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>// 这里可以针对你的开发项目进行配置</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>? Which framework does your project use? </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  React </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  Vue.js </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>❯ None of these </pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>// 可以配置代码运行的地方，是浏览器还是Node环境？</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>? Where does your code run? </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>❯◉ Browser</pre></td></tr><tr><td data-num=\"21\"></td><td><pre> ◉ Node</pre></td></tr><tr><td data-num=\"22\"></td><td><pre> </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>// 最张在哪里缓存</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>? What <span class=\"token function\">format</span> <span class=\"token keyword\">do</span> you want your config <span class=\"token function\">file</span> to be in? <span class=\"token punctuation\">(</span>Use arrow keys<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>❯ JavaScript </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  YAML </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  JSON </pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>// 成功创建了配置文件</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>? What <span class=\"token function\">format</span> <span class=\"token keyword\">do</span> you want your config <span class=\"token function\">file</span> to be in? JavaScript</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>Successfully created .eslintrc.js <span class=\"token function\">file</span> <span class=\"token keyword\">in</span> /Users/itheima/Downloads/Demo</pre></td></tr></table></figure><p>配置文件 <code>.eslintrc.js</code> ：</p>\n<blockquote>\n<p>废弃的用法： <code>.eslintrc</code> ，eslint 使用配置的顺序： <code>.eslintrc.js</code>  &gt;  <code>.eslintrc.yaml</code>  &gt;  <code>.eslintrc.yml</code>  &gt;  <code>.eslintrc.json</code>  &gt;  <code>.eslintrc</code>  &gt;  <code>package.json</code></p>\n</blockquote>\n<p><code>.eslintrc.js</code>  文件：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string-property property\">\"env\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string-property property\">\"browser\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string-property property\">\"es6\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string-property property\">\"node\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token string-property property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eslint:recommended\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token string-property property\">\"globals\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token string-property property\">\"Atomics\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"readonly\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string-property property\">\"SharedArrayBuffer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"readonly\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token string-property property\">\"parserOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string-property property\">\"ecmaVersion\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2018</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token string-property property\">\"sourceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"module\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token string-property property\">\"rules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>再来看看， <code>yaml</code>  文件配置：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">browser</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">es6</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">node</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">extends</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'eslint:recommended'</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">globals</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">Atomics</span><span class=\"token punctuation\">:</span> readonly</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">SharedArrayBuffer</span><span class=\"token punctuation\">:</span> readonly</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key atrule\">parserOptions</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">ecmaVersion</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2018</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token key atrule\">sourceType</span><span class=\"token punctuation\">:</span> module</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>该文件导出一个对象，对象包含属性  <code>env</code> 、 <code>extends</code> 、 <code>parserOptions</code> 、 <code>plugins</code> 、 <code>rules</code>  五个属性：</p>\n<ul>\n<li>\n<p><code>env</code> ：指定脚本的运行环境。每种环境都有一组特定的预定义全局变量，（如：nodejs，browser，commonjs 等）中。</p>\n</li>\n<li>\n<p><code>parserOptions</code> ：用于指定想要支持的 JavaScript 语言选项</p>\n<ul>\n<li>\n<p><code>ecmaVersion</code>  - 默认设置为 3，5（默认）， 你可以使用 6、7、8 或 9 来指定你想要使用的 ECMAScript 版本。你也可以用使用年份命名的版本号指定为 2015（同 6），2016（同 7），或 2017（同 8）或 2018（同 9）</p>\n</li>\n<li>\n<p><code>sourceType</code>  - 设置为  <code>&quot;script&quot;</code>  (默认) 或  <code>&quot;module&quot;</code> （如果你的代码是 ECMAScript 模块)。</p>\n</li>\n<li>\n<pre><code>ecmaFeatures\n</code></pre>\n<p>- 这是个对象，表示你想使用的额外的语言特性:</p>\n<ul>\n<li><code>globalReturn</code>  - 允许在全局作用域下使用  <code>return</code>  语句</li>\n<li><code>impliedStrict</code>  - 启用全局 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvU3RyaWN0X21vZGU=\">strict mode</span> (如果  <code>ecmaVersion</code>  是 5 或更高)</li>\n<li><code>jsx</code>  - 启用 <span class=\"exturl\" data-url=\"aHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9qc3gv\">JSX</span></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><code>globals</code> ：执行代码时脚步需要访问的额外全局变量。</p>\n</li>\n<li>\n<p><code>rules</code> ：开启某些规则，也可以设置规则的等级。</p>\n</li>\n<li>\n<p><code>extends</code> : 对默认规则进行扩展，可以使用 <code>Airbnb</code> ，或者 <code>Standard</code>  规则。</p>\n</li>\n</ul>\n<h4 id=\"eslintignore\"><a class=\"anchor\" href=\"#eslintignore\">#</a> .eslintignore</h4>\n<p>可以在项目根目录创建，告诉 ESLint 忽略某些文件或者目录。相当于.gitignore 都是纯文本文件。<br />\n例如</p>\n<pre><code># 注释，忽略文件node_modules**/.jsbuild\n</code></pre>\n<p>常见的 eslintignore 内容：</p>\n<pre><code>node_modules/*\n**/node_modules/*\ndist/*\n/build/**\n/coverage/**\n/docs/**\n/jsdoc/**\n/templates/**\n/tests/bench/**\n/tests/fixtures/**\n/tests/performance/**\n/tmp/**\n/lib/rules/utils/unicode/is-combining-character.js\ntest.js\n!.eslintrc.js\n</code></pre>\n<h4 id=\"eslint的使用方法\"><a class=\"anchor\" href=\"#eslint的使用方法\">#</a> ESLint 的使用方法</h4>\n<ul>\n<li>\n<p>本地使用方法：</p>\n<p>如果你想让 ESLint 成为你项目构建系统的一部分，我们建议在本地安装。你可以使用 npm：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> eslint --save-dev</pre></td></tr></table></figure><p>紧接着你应该设置一个配置文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ ./node_modules/.bin/eslint <span class=\"token parameter variable\">--init</span></pre></td></tr></table></figure><p>之后，你可以在你项目根目录运行 ESLint：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ ./node_modules/.bin/eslint yourfile.js</pre></td></tr></table></figure><p>使用本地安装的 ESLint 时，你使用的任何插件或可分享的配置也都必须在本地安装。</p>\n</li>\n<li>\n<p>全局使用</p>\n<p>如果你想使 ESLint 适用于你所有的项目，我们建议你全局安装 ESLint。你可以使用 npm：</p>\n<pre><code>$ npm install -g eslint\n</code></pre>\n<p>紧接着你应该设置一个配置文件：</p>\n<pre><code>$ eslint --init\n</code></pre>\n<p>之后，你可以在任何文件或目录运行 ESLint：</p>\n<pre><code>$ eslint yourfile.js\n</code></pre>\n</li>\n</ul>\n<h4 id=\"常用eslint配置\"><a class=\"anchor\" href=\"#常用eslint配置\">#</a> 常用 ESlint 配置</h4>\n<p>ESLint 的规范：</p>\n<p>Standard: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N0YW5kYXJkL2VzbGludC1jb25maWctc3RhbmRhcmQ=\">https://github.com/standard/eslint-config-standard</span></p>\n<p>具体地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N0YW5kYXJkL2VzbGludC1jb25maWctc3RhbmRhcmQvYmxvYi9tYXN0ZXIvZXNsaW50cmMuanNvbg==\">eslintrc.json</span></p>\n<p>Airbnb: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FpcmJuYi9qYXZhc2NyaXB0\">https://github.com/airbnb/javascript</span></p>\n<ol>\n<li>\n<p>comma 逗号</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token string-property property\">\"comma-dangle\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"error\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"never\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Bad:</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> foo <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token string\">'123'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token literal-property property\">b</span><span class=\"token operator\">:</span> <span class=\"token string\">'321'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// wrong error</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Right:</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> foo <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token string\">'123'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token literal-property property\">b</span><span class=\"token operator\">:</span> <span class=\"token string\">'321'</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>quotes 引号</p>\n</li>\n<li>\n<p>semi 分号</p>\n</li>\n<li>\n<p>空行</p>\n</li>\n<li>\n<p>驼峰命名</p>\n</li>\n<li>\n<p>日志输出</p>\n</li>\n<li>\n<p>强等判断</p>\n</li>\n<li>\n<p>冗余的变量</p>\n</li>\n<li>\n<p>空格</p>\n<ul>\n<li>关键字后的空格</li>\n<li>函数名后的空格</li>\n<li>缩进</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"在ide中的配置\"><a class=\"anchor\" href=\"#在ide中的配置\">#</a> 在 IDE 中的配置</h4>\n<ul>\n<li>以下是 vscode 中插件配置：</li>\n</ul>\n<p><img data-src=\"./assets/image-20190626120020180.png\" alt=\"image-20190626120020180\" /></p>\n<p>配置文件：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"eslint.alwaysShowStatus\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"eslint.autoFixOnSave\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"editor.formatOnSave\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"eslint.validate\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token string\">\"javascriptreact\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token property\">\"language\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"html\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token property\">\"autoFix\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token property\">\"language\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"javascript\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token property\">\"autoFix\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token property\">\"eslint.options\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"html\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><p>快速修复配置：</p>\n<p>打开  <code>&quot;editor.formatOnSave&quot;:  true</code>  并且要打开 <code>eslint.validate</code>  如上面的配置，或者在 UI 界面里面设置。</p>\n<p><img data-src=\"assets/image-20190627124410671.png\" alt=\"image-20190627124410671\" /></p>\n<ul>\n<li>在 Webstorm 中的配置：</li>\n</ul>\n<p>使用 Configure Preferences</p>\n<p><img data-src=\"assets/image-20190626120415006.png\" alt=\"image-20190626120415006\" /></p>\n<p>相比于 vscode 就智能很多。</p>\n<h4 id=\"实战vue项目配置\"><a class=\"anchor\" href=\"#实战vue项目配置\">#</a> 实战 vue 项目配置</h4>\n<p>ESlint 配置文件：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token literal-property property\">root</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token literal-property property\">env</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token literal-property property\">node</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">extends</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token string\">'plugin:vue/essential'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token string\">'@vue/standard'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token string-property property\">'no-console'</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'production'</span> <span class=\"token operator\">?</span> <span class=\"token string\">'error'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'off'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token string-property property\">'no-debugger'</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'production'</span> <span class=\"token operator\">?</span> <span class=\"token string\">'error'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'off'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token literal-property property\">semi</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'never'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token literal-property property\">parserOptions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token literal-property property\">parser</span><span class=\"token operator\">:</span> <span class=\"token string\">'babel-eslint'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>需要安装的 VSCode 插件：</p>\n<ul>\n<li>vue (高亮语法)</li>\n<li>vetur (格式化，代码规范)</li>\n<li>Vue peek (组件跳转)</li>\n<li>vue beautify (vue 格式化)</li>\n<li>Vue VSCode Snippets 和 Vue Snippets (代码提示)</li>\n<li>Prettier (格式化 与 上面的 Vetur 其实是合作格式化)</li>\n</ul>\n<p>vscode 配置格式化：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"eslint.validate\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token string\">\"javascript\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token string\">\"javascriptreact\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"language\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"html\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"autoFix\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token property\">\"language\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vue\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token property\">\"autoFix\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token property\">\"vetur.format.defaultFormatter.js\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"prettier-eslint\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token comment\">// prettier</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token property\">\"prettier.trailingComma\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"es5\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token property\">\"prettier.semi\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token property\">\"prettier.jsxSingleQuote\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token property\">\"prettier.singleQuote\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token property\">\"prettier.eslintIntegration\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><p>配置 emmet:</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"emmet.syntaxProfiles\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"vue-html\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"html\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"vue\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"html\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><p>在 Vue-cli 工具中，可以使用 <code>npm run lint</code> :</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>// bash输出</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>➜ <span class=\"token function\">npm</span> run lint</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> vue-recipe@0.1.0 lint /Users/itheima/vue-demo</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">></span> vue-cli-service lint</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> DONE  No lint errors found<span class=\"token operator\">!</span></pre></td></tr></table></figure><p>来执行 vue cli 配置好了的 Lint 脚本：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"serve\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vue-cli-service serve\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vue-cli-service build\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"lint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vue-cli-service lint\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><blockquote>\n<p>vscode 中插件推荐使用：</p>\n<p>Vue, Vetur, Vue Peek, vue-beautify</p>\n</blockquote>\n<h4 id=\"实战react项目配置\"><a class=\"anchor\" href=\"#实战react项目配置\">#</a> 实战 react 项目配置</h4>\n<p>使用 <code>create-react-app</code>  创建 react 项目：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>npx create-react-app my-app</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">cd</span> my-app</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">npm</span> start</pre></td></tr></table></figure><blockquote>\n<p>如果 <code>npx</code>  命令没有，请全局安装 <code>create-react-app</code> ，使用 <code>npm install -g create-react-app</code></p>\n</blockquote>\n<p>然后是安装 eslint 相关依赖：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"eslint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.16.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"babel-eslint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^10.0.2\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"eslint-plugin-html\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^6.0.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token property\">\"eslint-plugin-react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.14.2\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>配置 eslint，或者使用 <code>eslint --init</code>  进行初始化：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string-property property\">\"env\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string-property property\">\"browser\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string-property property\">\"commonjs\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string-property property\">\"node\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string-property property\">\"es6\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token string-property property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token string\">\"eslint:recommended\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">\"plugin:react/recommended\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token string-property property\">\"globals\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string-property property\">\"Atomics\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"readonly\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token string-property property\">\"SharedArrayBuffer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"readonly\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token string-property property\">\"parserOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token string-property property\">\"ecmaFeatures\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token string-property property\">\"jsx\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token string-property property\">\"arrowFunctions\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token string-property property\">\"classes\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token string-property property\">\"modules\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token string-property property\">\"defaultParams\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token string-property property\">\"ecmaVersion\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2018</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token string-property property\">\"sourceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"module\"</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token string-property property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token string\">\"react\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token string-property property\">\"rules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token string-property property\">\"settings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token string-property property\">\"react\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token string-property property\">\"pragma\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"React\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token string-property property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"latest\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>几点配置需要注意：</p>\n<ul>\n<li>安装插件： <code>eslint-plugin-react</code></li>\n<li>配置 <code>extends</code> :  <code>&quot;plugin:react/recommended&quot;</code></li>\n<li>配置 <code>settings</code></li>\n</ul>\n<p>配置 Airbnb：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> --save-dev <span class=\"token function\">install</span> eslint-config-airbnb eslint-plugin-import eslint-plugin-jsx-a11y babel-eslint</pre></td></tr></table></figure><p>有三个依赖：</p>\n<ul>\n<li>eslint-config-airbnb</li>\n<li>eslint-plugin-import</li>\n<li>eslint-plugin-jsx-a11y</li>\n<li>Babel-eslint</li>\n</ul>\n<p>修改项目配置：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string-property property\">\"env\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token string-property property\">\"browser\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token string-property property\">\"commonjs\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token string-property property\">\"node\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token string-property property\">\"es6\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// 这里有变化 </span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token string-property property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">\"eslint:recommended\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token string\">\"plugin:react/recommended\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token string\">\"plugin:import/errors\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string\">\"plugin:jsx-a11y/recommended\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token string\">\"airbnb\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token string-property property\">\"globals\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token string-property property\">\"Atomics\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"readonly\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token string-property property\">\"SharedArrayBuffer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"readonly\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token string-property property\">\"parser\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"babel-eslint\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token string-property property\">\"parserOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token string-property property\">\"ecmaFeatures\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token string-property property\">\"jsx\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token string-property property\">\"arrowFunctions\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token string-property property\">\"classes\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token string-property property\">\"modules\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token string-property property\">\"defaultParams\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token string-property property\">\"ecmaVersion\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2018</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token string-property property\">\"sourceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"module\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token comment\">// 这里有变化 </span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token string-property property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token string\">\"jsx-a11y\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token string\">\"import\"</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token string-property property\">\"rules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token comment\">// 这里可以添加 jsx-ally 与 import 相关的自定义 rules</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token string-property property\">\"settings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token string-property property\">\"react\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token string-property property\">\"pragma\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"React\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token string-property property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"latest\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"stylelint\"><a class=\"anchor\" href=\"#stylelint\">#</a> StyleLint</h3>\n<p>官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdHlsZWxpbnQuaW8v\">https://stylelint.io/</span></p>\n<ul>\n<li>\n<p>安装依赖：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-D</span> stylelint-config-recommended stylelint-config-standard</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>// <span class=\"token function\">yarn</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> stylelint-config-recommended stylelint-config-standard <span class=\"token parameter variable\">-D</span></pre></td></tr></table></figure></li>\n<li>\n<p>配置忽略</p>\n<pre><code>// .stylelintignore   忽略stylelint检查的文件\n/src/**/*.css\n</code></pre>\n</li>\n<li>\n<p><code>.stylelintrc.js</code>  文件配置</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>module.exports = <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"stylelint-config-recommended\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"stylelint-config-standard\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"rules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"indentation\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>vscode 配置</p>\n<p>安装 <code>Prettier</code>  +  <code>stylelint</code>  插件，方便格式化代码。</p>\n<p><img data-src=\"assets/image-20190628004127626.png\" alt=\"image-20190628004127626\" /></p>\n<p>配置文件：</p>\n<pre><code>  &quot;[scss]&quot;: &#123;\n    &quot;editor.formatOnSave&quot;: true\n  &#125;,\n  // 打开scss的validate配置\n  &quot;scss.validate&quot;: true,\n</code></pre>\n</li>\n</ul>\n<h3 id=\"htmlhint\"><a class=\"anchor\" href=\"#htmlhint\">#</a> HTMLHint</h3>\n<p>官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9odG1saGludC5pby8=\">https://htmlhint.io</span></p>\n<p>github: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2h0bWxoaW50L0hUTUxIaW50\">https://github.com/htmlhint/HTMLHint</span></p>\n<ul>\n<li>\n<p>安装依赖：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> htmlhint --save-dev</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>// <span class=\"token function\">yarn</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> htmlhint <span class=\"token parameter variable\">-D</span></pre></td></tr></table></figure></li>\n<li>\n<p>配置忽略</p>\n<pre><code>// .stylelintignore   忽略stylelint检查的文件\n/src/**/*.css\n</code></pre>\n</li>\n<li>\n<p><code>.htmlhintrc</code>  文件配置</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>标签名必须小写</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>属性名必须小写</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>属性值必须放在双引号中</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>属性值一定不可为空</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>属性值一定不可重复</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Doctype 必须是 HTML 文档的第一行</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>标签必须成对</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>标签必须自封闭</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>特殊字符必须</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>ID 属性必须唯一</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>src 属性一定不可为空</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>title 属性必须出现在标签中</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>img 标签必须包含 alt 属性</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Doctype 必须是 HTML5</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>ID 和 Class 的命名规则必须统一</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>不该使用样式标签</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>不该使用行内样式</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>不该使用行内脚本</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>空格和制表符一定不可混合在行前</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>ID 和 Class 一定不可使用广告关键词</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>href 必须是绝对路径或者相对路径</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>属性值一定不可使用不安全字符</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>script 标签不该使用在头部</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token property\">\"tagname-lowercase\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token property\">\"attr-lowercase\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token property\">\"attr-value-double-quotes\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token property\">\"attr-value-not-empty\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token property\">\"attr-no-duplication\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token property\">\"doctype-first\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token property\">\"tag-pair\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token property\">\"empty-tag-not-self-closed\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token property\">\"spec-char-escape\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token property\">\"id-unique\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token property\">\"src-not-empty\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token property\">\"title-require\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token property\">\"alt-require\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token property\">\"doctype-html5\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token property\">\"id-class-value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dash\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token property\">\"style-disabled\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  <span class=\"token property\">\"inline-style-disabled\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  <span class=\"token property\">\"inline-script-disabled\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token property\">\"space-tab-mixed-disabled\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"space\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>  <span class=\"token property\">\"id-class-ad-disabled\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token property\">\"href-abs-or-rel\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token property\">\"attr-unsafe-chars\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token property\">\"head-script-disabled\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>vscode 配置</p>\n<p>安装 <code>Prettier</code> ， <code>HTMLHint</code>  插件，方便格式化代码。</p>\n<p><img data-src=\"./assets/image-20190628003752568.png\" alt=\"image-20190628003752568\" /></p>\n<p>用户配置文件：</p>\n<pre><code>  &quot;[html]&quot;: &#123;\n    &quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;\n  &#125;,\n  // 打开scss的validate配置\n  &quot;files.associations&quot;: &#123;\n  \t&quot;*.ext&quot;: &quot;html&quot;\n  &#125;,\n</code></pre>\n</li>\n</ul>\n<h2 id=\"e2e-test\"><a class=\"anchor\" href=\"#e2e-test\">#</a> e2e test</h2>\n<p>通常对 Web 应用程序执行两种类型的测试：<strong>单元测试</strong>和<strong>端到端</strong>（E2E）测试。</p>\n<p><strong>单元测试</strong></p>\n<p>在测试中使用 “单元” 的想法是将代码分解为易于测试的小部件。通常，单元是单个函数，但也可以是类或甚至是复杂的算法。</p>\n<p>单元测试的一个关键概念是函数的给定输入应始终产生相同的输出。</p>\n<p>例如，如果我们有一个函数添加了两个调用的数字， <code>add</code>  我们可以编写一个单元测试来确保我们作为参数提供的特定数字对总是返回我们期望的输出。</p>\n<p><code>add.spec.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// Function we want to test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">add</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> x <span class=\"token operator\">+</span> y<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// Unit test</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should add two numbers\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>任何时候我们运行该测试并且它不等于 5，我们可以得出一个错误已经输入我们的代码。</p>\n<p><strong>组件测试</strong></p>\n<p>在大多数 Vue.js 应用程序中，函数并不真正代表应用程序的原子组成。当然，我们可以对我们的方法进行单元测试，但我们真正关心的是生成的 HTML。</p>\n<p>因此，Vue.js app 测试中的单元是一个<em>组件</em>而不是一个函数。</p>\n<p>我们如何测试组件？我们以此为例：</p>\n<p><code>displayGreeting.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;div>Hello, &lt;/div></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>如前所述，对于给定输入（在这种情况下，支柱），单元测试必须返回一致的输出（在这种情况下，文本内容）。</p>\n<p>使用像 Vue Test Utils 这样的库，我们可以在内存中安装 Vue 组件并创建一个 “包装器” 对象。然后，我们可以查询包装器以对呈现的 HTML 进行断言。</p>\n<p><code>displayGreeting.spec.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> displayGreeting <span class=\"token keyword\">from</span> <span class=\"token string\">\"./displayGreeting.js\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"displays message\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">const</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"Michael\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">const</span> wrapper <span class=\"token operator\">=</span> <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span>displayGreeting<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">propsData</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> name <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>wrapper<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hello, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>name<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>单元测试优点：</p>\n<ul>\n<li>测试运行得很快</li>\n<li>测试是精确的，允许您识别确切的问题</li>\n</ul>\n<p>单元测试缺点：</p>\n<ul>\n<li>为应用程序的每个方面编写测试都非常耗时</li>\n<li>尽管单元测试通过，整个应用程序可能仍然无法正常工作</li>\n</ul>\n<h3 id=\"什么是e2e-test\"><a class=\"anchor\" href=\"#什么是e2e-test\">#</a> 什么是 e2e test?</h3>\n<p>e2e test（End to End test 端到端）测试是一种功能测试。与单元测试不同，不会将应用程序分解为更小的部分以进行测试 - 而是测试整个应用程序。</p>\n<p>e2e 测试与您的应用程序交互，就像真实用户一样。例如，您可以编写一个 E2E 测试：</p>\n<ol>\n<li>加载您的网站</li>\n<li>点击 “注册” 链接</li>\n<li>为注册表单中的输入提供一些有效的详细信息</li>\n<li>单击 “注册按钮”。</li>\n</ol>\n<p>如果身份验证令牌已存储在 Cookie 中并且应用程序重定向到配置文件页面，则应通过此测试。</p>\n<p>E2E 测试优点</p>\n<ul>\n<li>可以一次隐式测试很多东西</li>\n<li>e2e 测试可确保您拥有一个工作系统</li>\n</ul>\n<p>e2e 测试缺点：</p>\n<ul>\n<li>运行缓慢 - 通常需要 5 或 10 分钟才能运行一个站点</li>\n<li>测试很脆弱 - 一个无关紧要的变化，如改变组件逻辑，就需要重新设计 e2e test 了</li>\n<li>测试无法查明失败的原因</li>\n</ul>\n<p>所以，主要的业务流程可能会写 E2E，不过规模要小很多，主要目的是：</p>\n<ul>\n<li>便于给 PM 展示业务流程</li>\n<li>便于修改 Bug 之后的回归</li>\n</ul>\n<h3 id=\"e2e-test工具介绍\"><a class=\"anchor\" href=\"#e2e-test工具介绍\">#</a> e2e test 工具介绍</h3>\n<h4 id=\"cypress\"><a class=\"anchor\" href=\"#cypress\">#</a> Cypress</h4>\n<ol>\n<li>\n<p>安装 &amp; 桌面应用</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> cypress --save-dev</pre></td></tr></table></figure><p>或者直接下载桌面应用：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb3dubG9hZC5jeXByZXNzLmlvL2Rlc2t0b3A=\">https://download.cypress.io/desktop</span></p>\n</li>\n<li>\n<p>使用方式：</p>\n<pre><code>./node_modules/.bin/cypress open\n\n// npx\nnpx cypress open\n\n// yarn \nyarn run cypress open\n</code></pre>\n<p>或者添加  <code>package.json</code> :</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"cypress:open\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cypress open\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>使用 npm 命令： <code>npm run cypress:open</code></p>\n</li>\n</ol>\n<h4 id=\"nightwatch\"><a class=\"anchor\" href=\"#nightwatch\">#</a> Nightwatch</h4>\n<h4 id=\"teatcafe\"><a class=\"anchor\" href=\"#teatcafe\">#</a> TeatCafe</h4>\n<h3 id=\"e2e-test案例\"><a class=\"anchor\" href=\"#e2e-test案例\">#</a> e2e test 案例</h3>\n<h2 id=\"codecov\"><a class=\"anchor\" href=\"#codecov\">#</a> Codecov</h2>\n<h3 id=\"codecov简介\"><a class=\"anchor\" href=\"#codecov简介\">#</a> Codecov 简介</h3>\n<h3 id=\"codecov使用\"><a class=\"anchor\" href=\"#codecov使用\">#</a> Codecov 使用</h3>\n<h3 id=\"前端项目中的应用\"><a class=\"anchor\" href=\"#前端项目中的应用\">#</a> 前端项目中的应用</h3>\n<h2 id=\"补充学习\"><a class=\"anchor\" href=\"#补充学习\">#</a> 补充学习</h2>\n<h3 id=\"补充资料\"><a class=\"anchor\" href=\"#补充资料\">#</a> 补充资料</h3>\n<h4 id=\"代码质量管控的四个阶段\"><a class=\"anchor\" href=\"#代码质量管控的四个阶段\">#</a> <span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8yOTA4Njk1OQ==\">代码质量管控的四个阶段</span></h4>\n<p><img data-src=\"assets/v2-2f1a8ca0a919afd7e77859393c9e96f6_hd.png\" alt=\"img\" /></p>\n<p>我把代码质量管控通常需要经历的四个阶段，称之为 “四个现代化”：</p>\n<ul>\n<li>规范化 - 建立代码规范与 Code Review 制度</li>\n<li>自动化 - 使用工具自动检查代码质量</li>\n<li>流程化 - 将代码质量检查与代码流动过程绑定</li>\n<li>中心化 - 以团队整体为视角，集中管理代码规范，并实现质量状况透明化</li>\n</ul>\n<h4 id=\"软件测试的分类\"><a class=\"anchor\" href=\"#软件测试的分类\">#</a> 软件测试的分类</h4>\n<p><strong>第一部分：软件测试的分类</strong></p>\n<ul>\n<li>\n<p>按测试执行阶段划分</p>\n<p>单元测试、集成测试、系统测试、验收测试（正式验收测试、Alpha 测试、Beta 测试）</p>\n</li>\n<li>\n<p>按测试技术划分</p>\n<p>白盒测试、黑盒测试、灰盒测试</p>\n</li>\n<li>\n<p>被测试对象是否运行划分</p>\n<p>动态测试、静态测试（文档检查、代码走查、界面检查）</p>\n</li>\n<li>\n<p>按不同的测试手段划分</p>\n<p>手工测试、自动化测试 *</p>\n</li>\n<li>\n<p>按测试包含的内容划分</p>\n<p>功能测试、界面测试、安全测试、兼容性测试、易用性测试、性能测试、压力测试、负载测试、恢复测试</p>\n</li>\n<li>\n<p>其他测试</p>\n<p>冒烟测试、回归测试、探索性测试 / 自由测试（测试思维）</p>\n</li>\n</ul>\n<p><strong>第二部分：接下来对软件测试分类进行一个说明</strong></p>\n<p><img data-src=\"assets/v2-889a2848a1b2a8eeccae000be23c247a_hd.jpg\" alt=\"img\" /><img data-src=\"assets/v2-889a2848a1b2a8eeccae000be23c247a_hd.jpg\" alt=\"img\" /></p>\n<p><img data-src=\"assets/v2-f831b8041976b50aad7c2425aada44e2_hd-1561454378198.jpg\" alt=\"img\" /><img data-src=\"assets/v2-f831b8041976b50aad7c2425aada44e2_hd.jpg\" alt=\"img\" /></p>\n<p><strong>第三部分：测试工具</strong></p>\n<p>SVN，Git——&gt; 版本控制管理工具</p>\n<p>禅道 ——&gt;Bug 管理工具</p>\n<p>Fiddler——&gt; 抓包，定位问题你</p>\n<p>postman，jmeter，soapui——&gt; 接口测试</p>\n<p>Loadrunner，Jmeter——&gt; 性能，压力测试</p>\n<h4 id=\"what-is-linting\"><a class=\"anchor\" href=\"#what-is-linting\">#</a> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvODUwMzU1OS93aGF0LWlzLWxpbnRpbmc=\">What is “Linting”?</span></h4>\n<h4 id=\"react中的配置资料\"><a class=\"anchor\" href=\"#react中的配置资料\">#</a> React 中的配置资料</h4>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BzZ3JvZmYwNC9jb25maWd1cmUtZXNsaW50LXByZXR0aWVyLWFuZC1mbG93LWluLXZzLWNvZGUtZm9yLXJlYWN0LWRldmVsb3BtZW50LWM5ZDk1ZGIwNzIxMw==\">Configure ESLint, Prettier, and Flow in VS Code for React Development</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnNpZGVjaS5jb20vaG93LXRoZS1yZWFjdC1kZXZlbG9wZXItdGVhbS11c2VzLWVzbGludC0yODI4NTY0ODE0ZGE=\">React 开发团队如何使用 ESLint</span></p>\n<h3 id=\"完整的eslint文件配置属性的解释\"><a class=\"anchor\" href=\"#完整的eslint文件配置属性的解释\">#</a> 完整的 ESLint 文件配置属性的解释</h3>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * ESLint 的 JSON 文件是允许 JavaScript 注释的，但在 gist 里显示效果不好，所以我把.json 文件后缀改为了.js</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> * ESLint 配置文件优先级：</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> * .eslintrc.js (输出一个配置对象)</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> * .eslintrc.yaml</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * .eslintrc.yml</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> * .eslintrc.json（ESLint 的 JSON 文件允许 JavaScript 风格的注释）</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> * .eslintrc（可以是 JSON 也可以是 YAML）</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> *  package.json（在 package.json 里创建一个 eslintConfig 属性，在那里定义你的配置）</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * 你可以通过在项目根目录创建一个.eslintignore 文件告诉 ESLint 去忽略特定的文件和目录</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * .eslintignore 文件是一个纯文本文件，其中的每一行都是一个 glob 模式表明哪些路径应该忽略检测</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token comment\">//ESLint 默认使用 Espree 作为其解析器</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token comment\">// 同时 babel-eslint 也是用得最多的解析器</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token property\">\"parser\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"espree\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token comment\">//parser 解析代码时的参数</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token property\">\"parserOption\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token comment\">// 指定要使用的 ECMAScript 版本，默认值 5</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token property\">\"ecmaVersion\"</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">// 设置为 script (默认) 或 module（如果你的代码是 ECMAScript 模块)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token property\">\"sourceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"script\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token comment\">// 这是个对象，表示你想使用的额外的语言特性，所有选项默认都是 false</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token property\">\"ecmafeatures\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token comment\">// 允许在全局作用域下使用 return 语句</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token property\">\"globalReturn\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token comment\">// 启用全局 strict 模式（严格模式）</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token property\">\"impliedStrict\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token comment\">// 启用 JSX</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token property\">\"jsx\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token comment\">// 启用对实验性的 objectRest/spreadProperties 的支持</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token property\">\"experimentalObjectRestSpread\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  <span class=\"token comment\">// 指定环境，每个环境都有自己预定义的全局变量，可以同时指定多个环境，不矛盾</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token property\">\"env\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token comment\">// 效果同配置项 ecmaVersion 一样</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token property\">\"es6\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token property\">\"browser\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token property\">\"node\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token property\">\"commonjs\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token property\">\"mocha\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token property\">\"jquery\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>     <span class=\"token comment\">// 如果你想使用来自某个插件的环境时，确保在 plugins 数组里指定插件名</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>     <span class=\"token comment\">// 格式为：插件名 / 环境名称（插件名不带前缀）</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token property\">\"react/node\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>  <span class=\"token comment\">// 指定环境为我们提供了预置的全局变量</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>  <span class=\"token comment\">// 对于那些我们自定义的全局变量，可以用 globals 指定</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>  <span class=\"token comment\">// 设置每个变量等于 true 允许变量被重写，或 false 不允许被重写</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  <span class=\"token property\">\"globals\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token property\">\"globalVar1\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token property\">\"globalVar2\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>  <span class=\"token comment\">//ESLint 支持使用第三方插件</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>  <span class=\"token comment\">// 在使用插件之前，你必须使用 npm 安装它</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>  <span class=\"token comment\">// 全局安装的 ESLint 只能使用全局安装的插件</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  <span class=\"token comment\">// 本地安装的 ESLint 不仅可以使用本地安装的插件还可以使用全局安装的插件</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>  <span class=\"token comment\">//plugin 与 extend 的区别：extend 提供的是 eslint 现有规则的一系列预设</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>  <span class=\"token comment\">// 而 plugin 则提供了除预设之外的自定义规则，当你在 eslint 的规则里找不到合适的的时候</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>  <span class=\"token comment\">// 就可以借用插件来实现了</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>  <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token string\">\"eslint-plugin-airbnb\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    <span class=\"token comment\">// 插件名称可以省略 eslint-plugin - 前缀</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token string\">\"react\"</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>  <span class=\"token comment\">// 具体规则配置</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>  <span class=\"token comment\">//off 或 0-- 关闭规则</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>  <span class=\"token comment\">//warn 或 1-- 开启规则，警告级别 (不会导致程序退出)</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>  <span class=\"token comment\">//error 或 2-- 开启规则，错误级别 (当被触发的时候，程序会退出)</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>  <span class=\"token property\">\"rules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>    <span class=\"token property\">\"eqeqeq\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"warn\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    <span class=\"token comment\">// 你也可以使用对应的数字定义规则严重程度</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>    <span class=\"token property\">\"curly\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>    <span class=\"token comment\">// 如果某条规则有额外的选项，你可以使用数组字面量指定它们</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    <span class=\"token comment\">// 选项可以是字符串，也可以是对象</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>    <span class=\"token property\">\"quotes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"error\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"double\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>    <span class=\"token property\">\"one-var\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"error\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>      <span class=\"token property\">\"var\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"always\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>      <span class=\"token property\">\"let\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"never\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>      <span class=\"token property\">\"const\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"never\"</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>    <span class=\"token comment\">// 配置插件提供的自定义规则的时候，格式为：不带前缀插件名 / 规则 ID</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>    <span class=\"token property\">\"react/curly\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"error\"</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>  <span class=\"token comment\">//ESLint 支持在配置文件添加共享设置</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>  <span class=\"token comment\">// 你可以添加 settings 对象到配置文件，它将提供给每一个将被执行的规则</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>  <span class=\"token comment\">// 如果你想添加的自定义规则而且使它们可以访问到相同的信息，这将会很有用，并且很容易配置</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>  <span class=\"token property\">\"settings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>    <span class=\"token property\">\"sharedData\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hello\"</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>  <span class=\"token comment\">//Eslint 检测配置文件步骤：</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>  <span class=\"token comment\">//1. 在要检测的文件同一目录里寻找.eslintrc.* 和 package.json</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>  <span class=\"token comment\">//2. 紧接着在父级目录里寻找，一直到文件系统的根目录</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>  <span class=\"token comment\">//3. 如果在前两步发现有 root：true 的配置，停止在父级目录中寻找.eslintrc</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>  <span class=\"token comment\">//4. 如果以上步骤都没有找到，则回退到用户主目录～/.eslintrc 中自定义的默认配置</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>  <span class=\"token property\">\"root\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>  <span class=\"token comment\">//extends 属性值可以是一个字符串或字符串数组</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>  <span class=\"token comment\">// 数组中每个配置项继承它前面的配置</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>  <span class=\"token comment\">// 可选的配置项如下</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>  <span class=\"token comment\">//1. 字符串 eslint：recommended，该配置项启用一系列核心规则，这些规则报告一些常见问题，即在 (规则页面) 中打勾的规则</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>  <span class=\"token comment\">//2. 一个可以输出配置对象的可共享配置包，如 eslint-config-standard</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>    <span class=\"token comment\">// 可共享配置包是一个导出配置对象的简单的 npm 包，包名称以 eslint-config - 开头，使用前要安装</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>    <span class=\"token comment\">//extends 属性值可以省略包名的前缀 eslint-config-</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>  <span class=\"token comment\">//3. 一个输出配置规则的插件包，如 eslint-plugin-react</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>    <span class=\"token comment\">// 一些插件也可以输出一个或多个命名的配置</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>    <span class=\"token comment\">//extends 属性值为，plugin：包名 / 配置名称</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>  <span class=\"token comment\">//4. 一个指向配置文件的相对路径或绝对路径</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>  <span class=\"token comment\">//5. 字符串 eslint：all，启用当前安装的 ESLint 中所有的核心规则</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>    <span class=\"token comment\">// 该配置不推荐在产品中使用，因为它随着 ESLint 版本进行更改。使用的话，请自己承担风险</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>  <span class=\"token property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>    <span class=\"token string\">\"eslint:recommended\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>    <span class=\"token string\">\"standard\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>    <span class=\"token string\">\"plugin:react/recommended\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>    <span class=\"token string\">\"./node_modules/coding-standard/.eslintrc-es6\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>    <span class=\"token string\">\"eslint:all\"</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>  <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "项目质量检测",
                "质量检测"
            ]
        },
        {
            "id": "https://dmqweb.cn/2023/12/21/%E6%9C%80%E5%A4%A7%E5%AE%89%E5%85%A8%E6%95%B0/",
            "url": "https://dmqweb.cn/2023/12/21/%E6%9C%80%E5%A4%A7%E5%AE%89%E5%85%A8%E6%95%B0/",
            "title": "最大安全数与最大安全整数",
            "date_published": "2023-12-21T04:24:04.000Z",
            "content_html": "<p>#Number.MAX_VALUE 最大数<br />\n Number.MAX_VALUE 静态数据属性表示在 JavaScript 中可表示的最大数值，数值为：2 的 1024 次方 - 1，或大约 1.7976931348623157E+308。<br />\n（原因是由于：一个字节（byte）8 比特（bit），但是数字类型占用一个字节，JS 最大用 1kb（1024 个字节）来存储 number）<br />\n大于最大数的数据会被返回：Infinity</p>\n<p>#Number.MAX_SAFE_INTEGER 最大安全整数<br />\n Number.MAX_SAFE_INTEGER 为：（253 – 1），表示能够一对一匹配到浮点数的最大整数。</p>\n<p>对于更大的整数，请考虑使用 BigInt。</p>\n<p>双精度浮点格式只有 52 位用于表示尾数，因此它只能安全地表示介于 -(253 – 1) 和 253 – 1 之间的整数。本文中，“安全” 指的是能够精确表示整数并正确比较它们。例如，Number.MAX_SAFE_INTEGER + 1 === Number.MAX_SAFE_INTEGER + 2 的结果将为真，这在数学上是不正确的。有关更多信息，请参阅 Number.isSafeInteger ()。</p>\n<p>由于 MAX_SAFE_INTEGER 是 Number 的静态属性，你应该始终将其使用为 Number.MAX_SAFE_INTEGER，而不是一个数字值的属性。</p>\n",
            "tags": [
                "JS",
                "JS",
                "最大安全数",
                "最大安全整数"
            ]
        },
        {
            "id": "https://dmqweb.cn/2023/12/11/typedArray/",
            "url": "https://dmqweb.cn/2023/12/11/typedArray/",
            "title": "JS中类型化数组typedArray",
            "date_published": "2023-12-11T04:24:04.000Z",
            "content_html": "<p>#JS 中类型化数组（typed array）<br />\nJavaScript 的类型化数组是一种特殊的数组，可以存储和操作固定类型的数据，如整数、浮点数、字节等。相比于普通的 JavaScript 数组，类型化数组有以下几个优点：</p>\n<p>更加高效：类型化数组在内存中是连续存储的，这意味着它们可以更快地被读取和写入。此外，它们还允许我们直接访问底层的二进制数据，而不需要进行类型转换或拷贝操作。<br />\n更加节省空间：由于类型化数组只能存储固定类型的数据，因此它们使用的内存空间可以更加紧凑。例如，使用 Int8Array 数组可以将每个元素压缩为 1 个字节，而使用普通的 JavaScript 数组则需要至少 8 个字节来存储一个数字。<br />\n更加易于处理二进制数据：类型化数组可以帮助我们更加方便地处理二进制数据，如音频、视频、图像等。这些数据通常以二进制格式存储，而类型化数组可以直接读取和操作这些数据，而不需要进行复杂的解析和转换操作。<br />\n总之，类型化数组可以带来更高效、更紧凑、更直接的二进制数据处理体验，是 JavaScript 中处理二进制数据时非常有用的工具。虽然普通的 JavaScript 数组也可以存储二进制数据，但它们没有类型化数组那样的高效和直接性。因此，在需要处理大量二进制数据时，使用类型化数组会更加合适。</p>\n<p>Int8Array:<br />\n①只能存储 8 位有符号整数（-128 到 127），②使用固定大小的内存来存储数据，每个元素占用一个字节（8 位）③元素连续存储</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 以长度参数构造对象</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> int8 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Int8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>int8<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">42</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>int8<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 42</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>int8<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>int8<span class=\"token punctuation\">.</span><span class=\"token constant\">BYTES_PER_ELEMENT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 数组所占用的字节数</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 以数组构造对象</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">var</span> arr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Int8Array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">21</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>arr<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 31</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// 从另一数组构造对象</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">var</span> x <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Int8Array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">21</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">var</span> y <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Int8Array</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 21</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// 从 ArrayBuffer 构造对象</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">var</span> buffer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayBuffer</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">var</span> z <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Int8Array</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>还有：Uint8Array 等类型<br />\n forEach 的回调函数中不传参数</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">dfs</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">root</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">,</span><span class=\"token string\">'还好'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    root<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>dfs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//forEach 回调不传参数，默认传的参数就是 item 项</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "JS",
                "JS",
                "typedArray"
            ]
        },
        {
            "id": "https://dmqweb.cn/2023/12/08/DataView/",
            "url": "https://dmqweb.cn/2023/12/08/DataView/",
            "title": "DataView",
            "date_published": "2023-12-08T04:24:04.000Z",
            "content_html": "<p>#DataView 视图：<br />\nDataView 是 JavaScript 中的一个类型化数组视图，用于以不同的字节序（如大端序或小端序）和不同的数据类型（如整数、浮点数等）来读取和写入 ArrayBuffer 中的二进制数据。与 TypedArray 不同，DataView 可以指定任意的字节偏移量和长度，可以更加灵活地操作二进制数据。</p>\n<p>以下是一个使用 DataView 读取 ArrayBuffer 中的二进制数据的示例：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javascriptCopy Code<span class=\"token comment\">// 创建一个包含 8 字节的 ArrayBuffer</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> buffer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayBuffer</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 使用一个 DataView 视图来读取和写入数据</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">const</span> dataView <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataView</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 写入数据</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>dataView<span class=\"token punctuation\">.</span><span class=\"token function\">setInt16</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">42</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 在第 1 和第 2 个字节中写入 42</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>dataView<span class=\"token punctuation\">.</span><span class=\"token function\">setInt32</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 在第 3 到第 6 个字节中写入 -100</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 读取数据</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>dataView<span class=\"token punctuation\">.</span><span class=\"token function\">getInt16</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 输出 42</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>dataView<span class=\"token punctuation\">.</span><span class=\"token function\">getInt32</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 输出 -100</span></pre></td></tr></table></figure><p>在上述示例中，我们创建了一个长度为 8 字节的 ArrayBuffer。然后，我们使用一个 DataView 视图来操作这个 ArrayBuffer，分别在前两个字节和后四个字节中写入两个不同的数据，然后通过 DataView 的方法来读取这些数据。</p>\n<p>需要注意的是，DataView 的方法名都以数据类型名称开头，并以字节偏移量作为第一个参数。例如，setInt16 (offset, value) 方法将一个 16 位整数值写入到指定偏移量处，而 getInt32 (offset) 方法则从指定偏移量处读取一个 32 位整数值。这些方法还可以接受一个可选的第二个参数，用于指定字节序，以帮助正确地解释二进制数据。</p>\n<p>总之，DataView 提供了一种灵活和可定制的方式来读取和写入 ArrayBuffer 中的二进制数据，可以指定不同的字节序和数据类型，并支持任意偏移量和长度。</p>\n",
            "tags": [
                "JS",
                "JS",
                "DataView"
            ]
        },
        {
            "id": "https://dmqweb.cn/2023/12/08/NaN/",
            "url": "https://dmqweb.cn/2023/12/08/NaN/",
            "title": "NaN历史遗留问题",
            "date_published": "2023-12-08T04:24:04.000Z",
            "content_html": "<p>#NaN 历史遗留问题<br />\n由于历史遗留问题，NaN 的内部做了 hash 处理，使得每一次 NaN 返回的结果都不同。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">NaN</span> <span class=\"token operator\">===</span> <span class=\"token number\">NaN</span> <span class=\"token comment\">//false;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Object<span class=\"token punctuation\">.</span><span class=\"token function\">is</span><span class=\"token punctuation\">(</span><span class=\"token number\">NaN</span><span class=\"token punctuation\">,</span><span class=\"token number\">NaN</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//true</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 除此之外，延申:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">+</span><span class=\"token number\">0</span> <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">0</span> <span class=\"token comment\">// 返回 true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Object<span class=\"token punctuation\">.</span><span class=\"token function\">is</span><span class=\"token punctuation\">(</span><span class=\"token operator\">+</span><span class=\"token number\">0</span> <span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 返回 false</span></pre></td></tr></table></figure>",
            "tags": [
                "JS",
                "JS",
                "NaN问题"
            ]
        },
        {
            "id": "https://dmqweb.cn/2023/12/07/Blob/",
            "url": "https://dmqweb.cn/2023/12/07/Blob/",
            "title": "Blob",
            "date_published": "2023-12-07T04:24:04.000Z",
            "content_html": "<p>#Blob:<br />\nBlob（Binary Large Object）对象是 JavaScript 中用来表示二进制数据的对象，通常用于存储和操作文件或其他类型的二进制数据。Blob 对象可以表示大型数据对象，比如图像、视频、音频文件等。</p>\n<p>Blob 对象通常由两部分组成：数据和数据的类型。数据部分包含实际的二进制数据，而类型部分描述了数据的 MIME 类型，例如 “image/png” 或 “application/pdf”。</p>\n<p>Blob 对象可以通过 new Blob () 构造函数创建，传入一个数组作为参数，数组中包含要存储的二进制数据。另外，你还可以通过传入一个可选的对象参数，来指定数据的 MIME 类型。例如：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>javascriptCopy Codevar binaryData <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0x48</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x65</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6c</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x6f</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 用十六进制表示的字符串 \"Hello\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> blob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>binaryData<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text/plain\"</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>在上面的例子中，我们使用 new Blob () 创建了一个包含 “Hello” 文本数据的 Blob 对象，并指定了它的 MIME 类型为 “text/plain”。</p>\n<p>Blob 对象可以被用于多种用途，比如：</p>\n<p>通过 URL.createObjectURL () 方法创建一个临时的 URL，用于在页面中显示或下载文件，一般配置 a 标签（download 属性）。<br />\n作为 XMLHttpRequest 的响应数据类型，用于接收和处理文件或二进制数据。<br />\n作为 FormData 对象的值，用于将二进制数据发送到服务器。<br />\n总之，Blob 对象在 JavaScript 中提供了一种方便的方式来处理和操作二进制数据，特别适合于文件操作和网络通信中的数据传输</p>\n",
            "tags": [
                "JS",
                "JS",
                "Blob"
            ]
        },
        {
            "id": "https://dmqweb.cn/2023/12/04/JS%E7%AE%97%E6%B3%95/",
            "url": "https://dmqweb.cn/2023/12/04/JS%E7%AE%97%E6%B3%95/",
            "title": "JS算法书籍",
            "date_published": "2023-12-04T04:24:04.000Z",
            "content_html": "<h1 id=\"目录\"><a class=\"anchor\" href=\"#目录\">#</a> 目录</h1>\n<p>1.1　JavaScript 数据结构与算法</p>\n<p>1.2　环境搭建</p>\n<p>1.2.1　最简单的环境搭建</p>\n<p>1.2.2　使用 Web 服务器</p>\n<p>1.2.3　Node.js http-server</p>\n<p>1.3　JavaScript 基础</p>\n<p>1.3.1　变量</p>\n<p>1.3.2　运算符</p>\n<p>1.3.3　真值和假值</p>\n<p>1.3.4　相等运算符（<mark>和</mark> =）</p>\n<p>1.4　控制结构</p>\n<p>1.4.1　条件语句</p>\n<p>1.4.2　循环</p>\n<p>1.5　函数</p>\n<p>1.6　JavaScript 面向对象编程</p>\n<p>1.7　调试工具</p>\n<p>使用 VSCode 进行调试</p>\n<p>1.8　小结</p>\n<p>第 2 章　ECMAScript 和 TypeScript 概述</p>\n<p>2.1　ECMAScript 还是 JavaScript</p>\n<p>2.1.1　ES6、ES2015、ES7、ES2016、ES8、ES2017 和 ES.Next</p>\n<p>2.1.2　使用 Babel.js</p>\n<p>2.2　ECMAScript 2015 + 的功能</p>\n<p>2.2.1　用 let 替代 var 声明变量</p>\n<p>2.2.2　模板字面量</p>\n<p>2.2.3　箭头函数</p>\n<p>2.2.4　函数的参数默认值</p>\n<p>2.2.5　声明展开和剩余参数</p>\n<p>2.2.6　增强的对象属性</p>\n<p>2.2.7　使用类进行面向对象编程</p>\n<p>2.2.8　乘方运算符</p>\n<p>2.2.9　模块</p>\n<p>2.3　介绍 TypeScript</p>\n<p>2.3.1　类型推断</p>\n<p>2.3.2　接口</p>\n<p>2.3.3　其他 TypeScript 功能</p>\n<p>2.3.4　TypeScript 中对 JavaScript 文件的编译时检查</p>\n<p>2.4　小结</p>\n<p>第 3 章　数组</p>\n<p>3.1　为什么用数组</p>\n<p>3.2　创建和初始化数组</p>\n<p>访问元素和迭代数组</p>\n<p>3.3　添加元素</p>\n<p>3.3.1　在数组末尾插入元素</p>\n<p>3.3.2　在数组开头插入元素</p>\n<p>3.4　删除元素</p>\n<p>3.4.1　从数组末尾删除元素</p>\n<p>3.4.2　从数组开头删除元素</p>\n<p>3.5　在任意位置添加或删除元素</p>\n<p>3.6　二维和多维数组</p>\n<p>3.6.1　迭代二维数组的元素</p>\n<p>3.6.2　多维数组</p>\n<p>3.7　JavaScript 的数组方法参考</p>\n<p>3.7.1　数组合并</p>\n<p>3.7.2　迭代器函数</p>\n<p>3.7.3　ECMAScript 6 和数组的新功能</p>\n<p>3.7.4　排序元素</p>\n<p>3.7.5　搜索</p>\n<p>3.7.6　输出数组为字符串</p>\n<p>3.8　类型数组</p>\n<p>3.9　TypeScript 中的数组</p>\n<p>3.10　小结</p>\n<p>第 4 章　栈</p>\n<p>4.1　创建一个 JavaScript 数据结构和算法库</p>\n<p>4.2　栈数据结构</p>\n<p>4.2.1　创建一个基于数组的栈</p>\n<p>4.2.2　向栈添加元素</p>\n<p>4.2.3　从栈移除元素</p>\n<p>4.2.4　查看栈顶元素</p>\n<p>4.2.5　检查栈是否为空</p>\n<p>4.2.6　清空栈元素</p>\n<p>4.2.7　使用 Stack 类</p>\n<p>4.3　创建一个基于 JavaScript 对象的 Stack 类</p>\n<p>4.3.1　向栈中插入元素</p>\n<p>4.3.2　验证一个栈是否为空和它的大小</p>\n<p>4.3.3　从栈中弹出元素</p>\n<p>4.3.4　查看栈顶的值并将栈清空</p>\n<p>4.3.5　创建 toString 方法</p>\n<p>4.4　保护数据结构内部元素</p>\n<p>4.4.1　下划线命名约定</p>\n<p>4.4.2　用 ES2015 的限定作用域 Symbol 实现类</p>\n<p>4.4.3　用 ES2015 的 WeakMap 实现类</p>\n<p>4.4.4　ECMAScript 类属性提案</p>\n<p>4.5　用栈解决问题</p>\n<p>从十进制到二进制</p>\n<p>4.6　小结</p>\n<p>第 5 章　队列和双端队列</p>\n<p>5.1　队列数据结构</p>\n<p>5.1.1　创建队列</p>\n<p>5.1.2　使用 Queue 类</p>\n<p>5.2　双端队列数据结构</p>\n<p>5.2.1　创建 Deque 类</p>\n<p>5.2.2　使用 Deque 类</p>\n<p>5.3　使用队列和双端队列来解决问题</p>\n<p>5.3.1　循环队列 —— 击鼓传花游戏</p>\n<p>5.3.2　回文检查器</p>\n<p>5.3.3　JavaScript 任务队列</p>\n<p>5.4　小结</p>\n<p>第 6 章　链表</p>\n<p>6.1　链表数据结构</p>\n<p>创建链表</p>\n<p>6.2　双向链表</p>\n<p>6.2.1　在任意位置插入新元素</p>\n<p>6.2.2　从任意位置移除元素</p>\n<p>6.3　循环链表</p>\n<p>6.3.1　在任意位置插入新元素</p>\n<p>6.3.2　从任意位置移除元素</p>\n<p>6.4　有序链表</p>\n<p>有序插入元素</p>\n<p>6.5　创建 StackLinkedList 类</p>\n<p>6.6　小结</p>\n<p>第 7 章　集合</p>\n<p>7.1　构建数据集合</p>\n<p>7.2　创建集合类</p>\n<p>7.2.1　has (element) 方法</p>\n<p>7.2.2　add 方法</p>\n<p>7.2.3　delete 和 clear 方法</p>\n<p>7.2.4　size 方法</p>\n<p>7.2.5　values 方法</p>\n<p>7.2.6　使用 Set 类</p>\n<p>7.3　集合运算</p>\n<p>7.3.1　并集</p>\n<p>7.3.2　交集</p>\n<p>7.3.3　差集</p>\n<p>7.3.4　子集</p>\n<p>7.4　ECMAScript 2015——Set 类</p>\n<p>ES2015 Set 类的运算</p>\n<p>7.5　多重集或袋</p>\n<p>7.6　小结</p>\n<p>第 8 章　字典和散列表</p>\n<p>8.1　字典</p>\n<p>8.1.1　创建字典类</p>\n<p>8.1.2　使用 Dictionary 类</p>\n<p>8.2　散列表</p>\n<p>8.2.1　创建散列表</p>\n<p>8.2.2　使用 HashTable 类</p>\n<p>8.2.3　散列表和散列集合</p>\n<p>8.2.4　处理散列表中的冲突</p>\n<p>8.2.5　创建更好的散列函数</p>\n<p>8.3　ES2015 Map 类</p>\n<p>8.4　ES2105 WeakMap 类和 WeakSet 类</p>\n<p>8.5　小结</p>\n<p>第 9 章　递归</p>\n<p>9.1　理解递归</p>\n<p>9.2　计算一个数的阶乘</p>\n<p>9.2.1　迭代阶乘</p>\n<p>9.2.2　递归阶乘</p>\n<p>9.3　斐波那契数列</p>\n<p>9.3.1　迭代求斐波那契数</p>\n<p>9.3.2　递归求斐波那契数</p>\n<p>9.3.3　记忆化斐波那契数</p>\n<p>9.4　为什么要用递归？它更快吗</p>\n<p>9.5　小结</p>\n<p>第 10 章　树</p>\n<p>10.1　树数据结构</p>\n<p>10.2　树的相关术语</p>\n<p>10.3　二叉树和二叉搜索树</p>\n<p>10.3.1　创建 BinarySearchTree 类</p>\n<p>10.3.2　向二叉搜索树中插入一个键</p>\n<p>10.4　树的遍历</p>\n<p>10.4.1　中序遍历</p>\n<p>10.4.2　先序遍历</p>\n<p>10.4.3　后序遍历</p>\n<p>10.5　搜索树中的值</p>\n<p>10.5.1　搜索最小值和最大值</p>\n<p>10.5.2　搜索一个特定的值</p>\n<p>10.5.3　移除一个节点</p>\n<p>10.6　自平衡树</p>\n<p>10.6.1　Adelson-Velskii-Landi 树（AVL 树）</p>\n<p>10.6.2　红黑树</p>\n<p>10.7　小结</p>\n<p>第 11 章　二叉堆和堆排序</p>\n<p>11.1　二叉堆数据结构</p>\n<p>11.1.1　创建最小堆类</p>\n<p>11.1.2　创建最大堆类</p>\n<p>11.2　堆排序算法</p>\n<p>11.3　小结</p>\n<p>第 12 章　图</p>\n<p>12.1　图的相关术语</p>\n<p>有向图和无向图</p>\n<p>12.2　图的表示</p>\n<p>12.2.1　邻接矩阵</p>\n<p>12.2.2　邻接表</p>\n<p>12.2.3　关联矩阵</p>\n<p>12.3　创建 Graph 类</p>\n<p>12.4　图的遍历</p>\n<p>12.4.1　广度优先搜索</p>\n<p>12.4.2　深度优先搜索</p>\n<p>12.5　最短路径算法</p>\n<p>12.5.1　Dijkstra 算法</p>\n<p>12.5.2　Floyd-Warshall 算法</p>\n<p>12.6　最小生成树</p>\n<p>12.6.1　Prim 算法</p>\n<p>12.6.2　Kruskal 算法</p>\n<p>12.7　小结</p>\n<p>第 13 章　排序和搜索算法</p>\n<p>13.1　排序算法</p>\n<p>13.1.1　冒泡排序</p>\n<p>13.1.2　选择排序</p>\n<p>13.1.3　插入排序</p>\n<p>13.1.4　归并排序</p>\n<p>13.1.5　快速排序</p>\n<p>13.1.6　计数排序</p>\n<p>13.1.7　桶排序</p>\n<p>13.1.8　基数排序</p>\n<p>13.2　搜索算法</p>\n<p>13.2.1　顺序搜索</p>\n<p>13.2.2　二分搜索</p>\n<p>13.2.3　内插搜索</p>\n<p>13.3　随机算法</p>\n<p>Fisher-Yates 随机</p>\n<p>13.4　小结</p>\n<p>第 14 章　算法设计与技巧</p>\n<p>14.1　分而治之</p>\n<p>二分搜索</p>\n<p>14.2　动态规划</p>\n<p>14.2.1　最少硬币找零问题</p>\n<p>14.2.2　背包问题</p>\n<p>14.2.3　最长公共子序列</p>\n<p>14.2.4　矩阵链相乘</p>\n<p>14.3　贪心算法</p>\n<p>14.3.1　最少硬币找零问题</p>\n<p>14.3.2　分数背包问题</p>\n<p>14.4　回溯算法</p>\n<p>14.4.1　迷宫老鼠问题</p>\n<p>14.4.2　数独解题器</p>\n<p>14.5　函数式编程简介</p>\n<p>14.5.1　函数式编程与命令式编程</p>\n<p>14.5.2　ES2015 + 和函数式编程</p>\n<p>14.5.3　JavaScript 函数式工具箱 ——map、filter 和 reduce</p>\n<p>14.5.4　JavaScript 函数式类库和数据结构</p>\n<p>14.6　小结</p>\n<p>第 15 章　算法复杂度</p>\n<p>15.1　大表示法</p>\n<p>15.1.1　理解大 O 表示法</p>\n<p>15.1.2　时间复杂度比较</p>\n<p>15.1.3　NP 完全理论概述</p>\n<p>15.2　用算法娱乐身心</p>\n<p>15.3　小结</p>\n<h1 id=\"结构\"><a class=\"anchor\" href=\"#结构\">#</a> 结构</h1>\n<p>第 1 章 “JavaScript 简介”，讲述了 JavaScript 的基础知识，可以帮助你更好地学习数据结构和算法，同时还介绍了如何搭建开发环境来运行书中的代码示例。</p>\n<p>第 2 章 “ECMAScript 和 TypeScript 概述”，介绍了 2015 年后新增的一些 JavaScript 功能，以及 TypeScript 的基本功能。TypeScript 是 JavaScript 的一个超集。</p>\n<p>第 3 章 “数组”，介绍了如何使用数组这种最基础且最常用的数据结构。这一章演示了如何对数组声明、初始化、添加和删除其中的元素，还讲述了如何使用 JavaScript 语言本身支持的数组方法。</p>\n<p>第 4 章 “栈”，介绍了栈这种数据结构，演示了如何创建栈以及怎样添加和删除元素，还讨论了如何用栈解决计算机科学中的一些问题。</p>\n<p>第 5 章 “队列和双端队列”，详述了队列这种数据结构，演示了如何创建队列，以及如何添加和删除队列中的元素。此外，这一章也介绍了一种特殊的队列 —— 双端队列数据结构。这一章还讨论了如何用队列解决计算机科学中的一些问题，以及栈和队列的主要区别。</p>\n<p>第 6 章 “链表”，讲解如何用对象和指针从头创建链表这种数据结构。这一章除了讨论如何声明、创建、添加和删除链表元素之外，还介绍了不同类型的链表，例如双向链表和循环链表。</p>\n<p>第 7 章 “集合”，介绍了集合这种数据结构，讨论了如何用集合存储非重复性的元素。此外，还详述了对集合的各种操作以及相应代码的实现。</p>\n<p>第 8 章 “字典和散列表”，深入讲解字典、散列表及它们之间的区别。这一章介绍了这两种数据结构是如何声明、创建和使用的，还探讨了如何解决散列冲突，以及如何创建更高效的散列函数。</p>\n<p>第 9 章 “递归”，介绍了递归的概念，描述了声明式和递归式算法之间的区别。</p>\n<p>第 10 章 “树”，讲解了树这种数据结构和它的相关术语，重点讨论了二叉搜索树，以及如何在树中搜索、遍历、添加和删除节点。这一章还介绍了自平衡树，包括 AVL 树和红黑树。</p>\n<p>第 11 章 “二叉堆和堆排序”，介绍了最小堆和最大堆数据结构，以及怎样使用堆作为一个优先队列，还讨论了著名的堆排序算法。</p>\n<p>第 12 章 “图”，介绍了图这种数据结构和它的适用范围。这一章讲述了图的常用术语和不同表示方式，探讨了如何使用深度优先搜索算法和广度优先搜索算法遍历图，以及它们的适用范围。</p>\n<p>第 13 章 “排序和搜索算法”，探讨了常用的排序算法，如冒泡排序（包括改进版）、选择排序、插入排序、归并排序和快速排序。这一章还介绍了计数排序和基数排序这两种分布式排序算法，搜索算法中的顺序搜索和二分搜索，以及怎样随机排列一个数组。</p>\n<p>第 14 章 “算法设计与技巧”，介绍了一些算法技巧和著名的算法，以及 JavaScript 函数式编程。</p>\n<p>第 15 章 “算法复杂度”，介绍了大表示法的概念，以及本书实现算法的复杂度列表。这一章还介绍了 NP 完全问题和启发式算法。最后，讲解了提升算法能力的诀窍。</p>\n<h6 id=\"阅读须知\"><a class=\"anchor\" href=\"#阅读须知\">#</a> 阅读须知</h6>\n<p>尽管本书第 1 章对 JavaScript 进行了简单介绍，你仍然需要了解基本的 JavaScript 知识和编程逻辑。</p>\n<p>要测试本书提供的代码示例，你需要一个代码编辑器（例如 Atom 或 Visual Studio Code）以便阅读代码，还需要一个浏览器（Chrome、Firefox 或 Edge）。</p>\n<p>你也可以访问 https://javascript-ds-algorithms-book.firebaseapp.com/，在线测试代码。同样，记得打开浏览器中的开发者工具，这样你就可以看到控制台上的输出结果了。</p>\n<h6 id=\"下载示例代码\"><a class=\"anchor\" href=\"#下载示例代码\">#</a> 下载示例代码</h6>\n<p>你可以用你的账户从 http://www.packtpub.com 下载所有已购买 Packt 图书的示例代码文件。如果你从其他地方购买了本书，可以访问 http://www.packtpub.com/support 并注册，我们将通过电子邮件把文件发送给你。</p>\n<p>下载代码文件的步骤如下：</p>\n<p>(1) 在 www.packtpub.com 登录或注册；</p>\n<p>(2) 选择 SUPPORT 标签页；</p>\n<p>(3) 点击 Code Downloads &amp; Errata；</p>\n<p>(4) 在 Search 框中输入书名并根据屏幕上的指示操作。</p>\n<p>文件下载后，请使用以下软件的最新版本解压：</p>\n<p>Windows 系统请使用 WinRAR 或 7-Zip</p>\n<p>Mac 系统请使用 Zipeg、iZip 或 UnRarX</p>\n<p>Linux 系统请使用 7-Zip 或 PeaZip</p>\n<p>本书的代码包在 GitHub 的托管地址是 https://github.com/PacktPublishing/Learning-JavaScript-Data-Structures-and-Algorithms-Third-Edition。只要代码有更新，它就会被更新到 GitHub 仓库中去。</p>\n<p>其他图书或视频的代码包也可以到 https://github.com/PacktPublishing/ 查阅。别错过！</p>\n<h6 id=\"排版约定\"><a class=\"anchor\" href=\"#排版约定\">#</a> 排版约定</h6>\n<p>在本书中，你会发现一些不同的文本样式。</p>\n<p>正文中的代码这样表示：“可能你在网上的一些例子里看到过 JavaScript 的 include 语句，或者放在 head 标签中的 JavaScript 代码。”</p>\n<p>代码段的格式如下：</p>\n<p>class Stack { constructor() { this.items = []; // {1} } }</p>\n<p>如果我们想让你重点关注代码段中的某个部分，会加粗显示：</p>\n<p>const stack = new Stack(); console.log(stack.isEmpty()); // outputs true</p>\n<p>所有的命令行输入或输出的格式如下：</p>\n<p>npm install http-server -g</p>\n<p>新术语、重点词汇，以及你可以在屏幕上看到的词（例如，菜单或对话框里的词）以黑体标示。举个例子：“从 Administration 面板中选择 System info。”</p>\n<p>此图标表示警告或需要特别注意的内容。</p>\n<p>此图标表示提示或者技巧。</p>\n<h1 id=\"第-1-章-javascript简介\"><a class=\"anchor\" href=\"#第-1-章-javascript简介\">#</a> 第 1 章　JavaScript 简介</h1>\n<p>JavaScript 是一门非常强大的编程语言。它是最流行的编程语言之一，也是互联网上最卓越的语言之一。在 GitHub（世界上最大的代码托管站点）上，托管了 400 000 多个 JavaScript 代码仓库（用 JavaScript 开发的项目数量也是最多的，参看 http://githut.info）。使用 JavaScript 的项目数量还在逐年增长。</p>\n<p>JavaScript 不仅可用于前端开发，也适用于后端开发，而 Node.js 就是其背后的技术。Node 包的数量也呈指数级增长。JavaScript 同样可以用于移动开发领域，并且是 Apache Cordova 中最流行的语言之一。Apache Cordova 是一个能让开发者使用 HTML、CSS 和 JavaScript 等语言的混合式框架，你可以通过它来搭建应用，并且生成供 Android 系统使用的 APK 文件和供 iOS（苹果系统）使用的 IPA 文件。当然，也别忘了桌面端应用开发。我们可以使用一个名为 Electron 的 JavaScript 框架来编写同时兼容 Linux、Mac OS 和 Windows 的桌面端应用。JavaScript 还可以用于嵌入式设备以及物联网（IoT）设备。正如你所看到的，到处都有 JavaScript 的身影！</p>\n<p>要成为一名 Web 开发工程师，掌握 JavaScript 必不可少。</p>\n<p>本章，你会学到 JavaScript 的语法和一些必要的基础，这样就可以开始开发自己的数据结构和算法了。本章内容如下：</p>\n<p>环境搭建和 JavaScript 基础</p>\n<p>控制结构和函数</p>\n<p>JavaScript 面向对象编程</p>\n<p>调试工具</p>\n<p>1.1　JavaScript 数据结构与算法</p>\n<p>在本书中，你将学习最常用的数据结构和算法。为什么用 JavaScript 来学习这些数据结构和算法呢？我们已经回答了这个问题。JavaScript 非常受欢迎，作为函数式编程语言，它非常适合用来学习数据结构和算法。通过它来学习数据结构比 C、Java 或 Python 这些标准语言更简单，学习新东西也会变得很有趣。谁说数据结构和算法只为 C、Java 这样的语言而生？在前端开发当中，你可能也需要实现这些语言。</p>\n<p>学习数据结构和算法十分重要。首要原因是数据结构和算法可以很高效地解决常见问题，这对你今后所写代码的质量至关重要（也包括性能；要是用了不恰当的数据结构或算法，很可能会产生性能问题）。其次，对于计算机科学，算法是最基础的概念。最后，如果你想入职最好的 IT 公司（如谷歌、亚马逊、微软、eBay 等），数据结构和算法是面试问题的重头戏。</p>\n<p>让我们开始学习吧！</p>\n<p>1.2　环境搭建</p>\n<p>相比其他语言，JavaScript 的优势之一在于不用安装或配置任何复杂的环境就可以开始学习。每台计算机上都已具备所需的环境，哪怕使用者从未写过一行代码。有浏览器足矣！</p>\n<p>为了运行书中的示例代码，建议你做好如下准备：安装 Chrome 或 Firefox 浏览器（选择一个你最喜欢的即可），选择一个喜欢的编辑器（如 Visual Studio Code），以及一个 Web 服务器（XAMPP 或其他你喜欢的，这一步是可选的）。Chrome、Firefox、VS Code 和 XAMPP 在 Windows、Linux 和 Mac OS 上均可以使用。</p>\n<p>1.2.1　最简单的环境搭建</p>\n<p>浏览器是最简单的 JavaScript 开发环境。现代浏览器（Chrome、Firefox、Safari 和 Edge）都拥有一个叫作开发者工具的功能。如要使用 Chrome 中的开发者工具，可以点击右上角的菜单，选择 More Tools | Developer Tools，如下图所示。</p>\n<p>打开开发者工具，里面有一个 Console 标签页，可以在其中编写你的 JavaScript 代码，如下图所示（需要按下 Enter 键来执行源代码）。</p>\n<p>1.2.2　使用 Web 服务器</p>\n<p>你可能想要安装的第二个环境也很简单，但是需要安装一个 Web 服务器。如果一个 HTML 文件只包含简单的、不向服务器发送任何请求的 JavaScript 代码（Ajax 调用），那么你可以右键点击它并选择在浏览器中直接打开。本书中需要编写的代码都很简单，可以通过这种方式执行。但是，安装一个 Web 服务器总是有好处的。</p>\n<p>有很多开源和免费的 Web 服务器可供选择。如果你熟悉 PHP 的话，XAMPP 会是不错的选择，它可用于 Linux、Windows 和 Mac OS。</p>\n<p>由于我们会专注于服务端和浏览器上的 JavaScript，可以在 Chrome 上安装一个简单的 Web 服务器，它是一个叫作 Web Server for Chrome 的扩展。安装好之后，可以在浏览器地址栏中输入 chrome://apps 来找到它。</p>\n<p>打开 Web Server 扩展后，可以点击 CHOOSE FOLDER 来选择需要在哪个文件夹中开启服务器。你可以新建一个文件夹来执行要在本书中实现的代码，也可以下载本书的源代码并将其解压缩到你喜欢的目录下，然后就能通过设定的 URL（默认是 http://127.0.0.1:8887）来访问它了。</p>\n<p>本书中的所有示例都可以通过访问 http://127.0.0.1:8887/examples 来执行。你会看到一个包含所有示例列表的 index.html 文件，如下图所示。</p>\n<p>执行示例代码的时候，始终牢记打开开发者工具并切换到 Console 标签页来查看输出结果。Web Server for Chrome 扩展也是用 JavaScript 开发的。为了获得更好的开发体验，建议使用该扩展来执行本书的示例代码，或者安装下一节将学习到的 Node.js http-server。</p>\n<p>1.2.3　Node.js http-server</p>\n<p>第三种选择就是 100% 的 JavaScript！搭建这个环境需要安装 Node.js。首先要到 http://nodejs.org/ 下载和安装 Node.js。然后，打开终端应用（如果你用的是 Windows 操作系统，打开 Node.js 的命令行，它随 Node.js 一同安装了），输入如下命令。</p>\n<p>npm install http-server -g</p>\n<p>最好手动输入这些命令，复制粘贴可能会出错。我们也可以用管理员身份执行上述命令。对于 Linux 和 Mac OS，使用如下命令。</p>\n<p>sudo npm install http-server -g</p>\n<p>这条命令会在你的机器上安装一个 JavaScript 服务器：http-server。要启动服务器并在终端应用上运行本书中的示例代码，请将工作路径更改至示例代码文件夹，然后输入 http-server，如下图所示。</p>\n<p>为执行示例，打开浏览器，通过 http-server 命令指定的端口访问。</p>\n<p>下载代码文件的具体步骤已经在前言中介绍过了，请翻回去看一看。本书的代码包在 GitHub 上的托管地址是 https://github.com/PacktPublishing/Learning-Java-Script-Data-Structures-and-Algorithms-Third-Edition。其他图书或视频的代码包也可以到 https://github.com/PacktPublishing/ 查阅。别错过！</p>\n<p>1.3　JavaScript 基础</p>\n<p>在深入学习各种数据结构和算法前，让我们先大概了解一下 JavaScript。本节教大家一些相关的基础知识，有利于学习后面各章。</p>\n<p>首先来看在 HTML 中编写 JavaScript 的两种方式。第一种方式如下面的代码所示。创建一个 HTML 文件（01-HelloWorld.html），把代码写进去。在这个例子里，我们在 HTML 文件中声明了 script 标签，然后把 JavaScript 代码都写进这个标签。</p>\n<p>&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; alert('Hello, World!'); &lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</p>\n<p>尝试使用 Web Server for Chrome 扩展或 http-server 来执行上述代码，并在浏览器中查看输出结果。</p>\n<p>第二种方式，我们需要创建一个 JavaScript 文件（比如 01-HelloWorld.js），在里面写入如下代码。</p>\n<p>alert('Hello, World!');</p>\n<p>然后，我们的 HTML 文件看起来如下所示。</p>\n<p>&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;script src=&quot;01-HelloWorld.js&quot;&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</p>\n<p>第二个例子展示了如何将一个 JavaScript 文件引入 HTML 文件。</p>\n<p>无论执行这两个例子中的哪个，输出都是一样的。不过第二个例子是最佳实践。</p>\n<p>可能你在网上的一些例子里看到过 JavaScript 的 include 语句，或者放在 head 标签中的 JavaScript 代码。作为最佳实践，我们会在关闭 body 标签前引入 JavaScript 代码。这样浏览器就会在加载脚本之前解析和显示 HTML，有利于提升页面的性能。</p>\n<p>1.3.1　变量</p>\n<p>变量保存的数据可以在需要时设置、更新或提取。赋给变量的值都有对应的类型。JavaScript 的类型有数、字符串、布尔值、函数和对象，还有 undefined 和 null，以及数组、日期和正则表达式。</p>\n<p>尽管 JavaScript 有多种变量类型，然而不同于 C/C++、C# 或 Java，它并不是一种强类型语言。在强类型语言中，声明变量时需要指定变量的类型（例如，在 Java 中声明一个整型变量，要使用 intnum = 1;）。在 JavaScript 中，我们只需要使用关键字 var，而不必指定变量类型。因此，JavaScript 不是强类型语言。然而，对于是否要将可选的静态类型（<span class=\"exturl\" data-url=\"aHR0cDovL2dpdGh1Yi5jb20vZHNsb212L3R5cGVkLW9iamVjdHMtZXM3JUVGJUJDJTg5JUU1JThBJUEwJUU1JTg1JUE1JUU2JTlDJUFBJUU2JTlEJUE1JUU3JTlBJTg0SmF2YVNjcmlwdCVFNiVBMCU4NyVFNSU4NyU4NiVFRiVCQyU4OEVDTUFTY3JpcHQlRUYlQkMlODklRUYlQkMlOEMlRTUlQjclQjIlRTclQkIlOEYlRTYlOUMlODklRTQlQkElODYlRTQlQjglODAlRTQlQkElOUIlRTglQUUlQTglRTglQUUlQkElRTQlQkIlQTUlRTUlOEYlOEElRTQlQjglODAlRTQlQjglQUElRTUlQTQlODQlRTQlQkElOEUlRTglOEQlODklRTclQTglQkYlRTclOEElQjYlRTYlODAlODElRTclOUElODQlRTYlQTAlODclRTUlODclODYlRTMlODAlODIlRTUlQTYlODIlRTYlOUUlOUMlRTklOUMlODAlRTglQTYlODElRTUlOUMlQTglRTUlODYlOTlKYXZhU2NyaXB0JUU2JTk3JUI2JUU1JUFGJUI5JUU1JThGJTk4JUU5JTg3JThGJUU4JUFFJUJFJUU1JUFFJTlBJUU3JUIxJUJCJUU1JTlFJThCJUVGJUJDJThDJUU0JUI5JTlGJUU1JThGJUFGJUU0JUJCJUE1JUU0JUJEJUJGJUU3JTk0JUE4VHlwZVNjcmlwdCVFMyU4MCU4MiVFNiU4OCU5MSVFNCVCQiVBQyVFNCVCQyU5QSVFNSU5QyVBOCVFNiU5QyVBQyVFNyVBQiVBMCVFNyVBOCU4RCVFNSU5MCU4RSVFNSVBRCVBNiVFNCVCOSVBMCVFNiU5QyU4OSVFNSU4NSVCM0VDTUFTY3JpcHQlRTUlOTIlOENUeXBlU2NyaXB0JUU3JTlBJTg0JUU1JTg2JTg1JUU1JUFFJUI5JUUzJTgwJTgy\">http://github.com/dslomv/typed-objects-es7）加入未来的 JavaScript 标准（ECMAScript），已经有了一些讨论以及一个处于草稿状态的标准。如果需要在写 JavaScript 时对变量设定类型，也可以使用 TypeScript。我们会在本章稍后学习有关 ECMAScript 和 TypeScript 的内容。</span></p>\n<p>下面的例子介绍如何在 JavaScript 里使用变量。</p>\n<p 7=\"\">var num = 1; // {1} num = 3; // {2} var price = 1.5; // {3} var myName = 'Packt'; // {4} var trueValue = true; // {5} var nullVar = null; // {6} var und; //</p>\n<p>在行 {1}，我们展示了如何声明一个 JavaScript 变量（声明了一个数值类型）。虽然关键字 var 不是必需的，但最好每次声明一个新变量时都加上。</p>\n<p>在行 {2}，我们更新了已有变量。JavaScript 不是强类型语言。这意味着你可以声明一个变量并初始化成一个数值类型的值，然后把它更新成字符串或者其他类型的值，不过这并不是一个好做法。</p>\n<p>在行 {3}，我们又声明了一个数值类型的变量，不过这次是十进制浮点数。在行 {4}，声明了一个字符串；在行 {5}，声明了一个布尔值；在行 {6}，声明了一个 null；在行 {7}，声明了 undefined 变量。null 表示变量没有值，undefined 表示变量已被声明，但尚未赋值。</p>\n<p>如果想看声明的每个变量的值，可以使用 console.log，如下所示。</p>\n<p>console.log('num: ' + num); console.log('myName: ' + myName); console.log('trueValue: ' + trueValue); console.log('price: ' + price); console.log('nullVar: ' + nullVar); console.log('und: ' + und);</p>\n<p>console.log 方法不只是接收这样的参数。除了 console.log ('num: ' + num)，我们还可以使用 console.log ('num: ', num) 的形式。第一种写法会将结果合并为一个字符串，而第二种写法则允许我们为其添加一个描述，并在变量为对象时将其内容以可视化的方式输出。</p>\n<p>书中的示例代码会使用三种方式输出 JavaScript 的值。第一种是 alert ('My text here')，将输出到浏览器的警示窗口；第二种是 console.log ('My text here')，将把文本输出到调试工具（谷歌开发者工具或是 Firebug，根据你使用的浏览器而定）的 Console 标签页；第三种是通过 document.write ('My text here') 直接输出到 HTML 页面里并用浏览器呈现。可以选择你喜欢的方式来调试。</p>\n<p>稍后会讨论函数和对象。</p>\n<p>变量作用域</p>\n<p>作用域是指，在编写的算法函数中，我们能访问变量（在使用函数作用域时，也可以是一个函数）的地方。有局部变量和全局变量两种。</p>\n<p>让我们看一个例子。</p>\n<p 5=\"\">var myVariable = 'global'; myOtherVariable = 'global'; function myFunction() { var myVariable = 'local'; return myVariable; } function myOtherFunction() { myOtherVariable = 'local'; return myOtherVariable; } console.log(myVariable); // {1} console.log(myFunction()); // {2} console.log(myOtherVariable); // {3} console.log(myOtherFunction()); // {4} console.log(myOtherVariable); //</p>\n<p>上面的代码可解释如下。</p>\n<p>行 {1} 输出 global，因为它是一个全局变量。</p>\n<p>行 {2} 输出 local，因为 myVariable 是在 myFunction 函数中声明的局部变量，所以作用域仅在 myFunction 内。</p>\n<p>行 {3} 输出 global，因为我们引用了在第二行初始化了的全局变量 myOtherVariable。</p>\n<p>行 {4} 输出 local。在 myOtherFunction 函数里，因为没有使用 var 关键字修饰，所以这里引用的是全局变量 myOtherVariable 并将它赋值为 local。</p>\n<p>因此，行 {5} 会输出 local（因为在 myOtherFunction 里修改了 myOtherVariable 的值）。</p>\n<p>你可能听其他人提过在 JavaScript 里应该尽量少用全局变量，这是对的。通常，代码质量可以用全局变量和函数的数量来考量（数量越多越糟）。因此，尽可能避免使用全局变量。</p>\n<p>1.3.2　运算符</p>\n<p>在编程语言里执行任何运算都需要运算符。在 JavaScript 里有算术运算符、赋值运算符、比较运算符、逻辑运算符、位运算符、一元运算符和其他运算符。我们来看一下这些运算符。</p>\n<p>var num = 0; // {1} num = num + 2; num = num * 3; num = num / 2; num++; num--; num += 1; // {2} num -= 2; num *= 3; num /= 2; num %= 3; console.log('num == 1 : ' + (num == 1)); // {3} console.log('num === 1 : ' + (num === 1)); console.log('num != 1 : ' + (num != 1)); console.log('num &gt; 1 : ' + (num &gt; 1)); console.log('num &lt; 1 : ' + (num &lt; 1)); console.log('num &gt;= 1 : ' + (num &gt;= 1)); console.log('num &lt;= 1 : ' + (num &lt;= 1)); console.log('true &amp;&amp; false : ' + (true &amp;&amp; false)); // {4} console.log('true || false : ' + (true || false)); console.log('!true : ' + (!true));</p>\n<p>在行 {1}，我们用了算术运算符。下表列出了这些运算符及其描述。</p>\n<p>算术运算符</p>\n<p>描述</p>\n<ul>\n<li></li>\n</ul>\n<p>加法</p>\n<ul>\n<li></li>\n</ul>\n<p>减法</p>\n<ul>\n<li></li>\n</ul>\n<p>乘法</p>\n<p>/</p>\n<p>除法</p>\n<p>%</p>\n<p>取余（除法的余数）</p>\n<p>++</p>\n<p>递增</p>\n<p>--</p>\n<p>递减</p>\n<p>在行 {2}，我们使用了赋值运算符。下表列出了赋值运算符及其描述。</p>\n<p>赋值运算符</p>\n<p>描述</p>\n<p>=</p>\n<p>赋值</p>\n<p>+=</p>\n<p>加赋值 (x += y) == (x = x + y)</p>\n<p>-=</p>\n<p>减赋值 (x -= y) == (x = x - y)</p>\n<p>*=</p>\n<p>乘赋值 (x *= y) == (x = x * y)</p>\n<p>/=</p>\n<p>除赋值 (x /= y) == (x = x /y)</p>\n<p>%=</p>\n<p>取余赋值 (x %= y) == (x = x % y)</p>\n<p>在行 {3}，我们使用了比较运算符。下表列出了比较运算符及其描述。</p>\n<p>比较运算符</p>\n<p>描述</p>\n<p>==</p>\n<p>相等</p>\n<p>===</p>\n<p>全等</p>\n<p>!=</p>\n<p>不等</p>\n<blockquote></blockquote>\n<p>大于</p>\n<blockquote>\n<p>=</p>\n</blockquote>\n<p>大于等于</p>\n<p>&lt;</p>\n<p>小于</p>\n<p>&lt;=</p>\n<p>小于等于</p>\n<p>在行 {4}，我们使用了逻辑运算符。下表列出了逻辑运算符及其描述。</p>\n<p>逻辑运算符</p>\n<p>描述</p>\n<p>&amp;&amp;</p>\n<p>与</p>\n<p>||</p>\n<p>或</p>\n<p>!</p>\n<p>非</p>\n<p>JavaScript 也支持位运算符，如下所示。</p>\n<p>console.log('5 &amp; 1:', (5 &amp; 1)); console.log('5 | 1:', (5 | 1)); console.log('~ 5:', (~5)); console.log('5 ^ 1:', (5 ^ 1)); console.log('5 &lt;&lt; 1:', (5 &lt;&lt; 1)); console.log('5 &gt;&gt; 1:', (5 &gt;&gt; 1));</p>\n<p>下表对位运算符做了更详细的描述。</p>\n<p>位运算符</p>\n<p>描述</p>\n<p>&amp;</p>\n<p>与</p>\n<p>|</p>\n<p>或</p>\n<p>~</p>\n<p>非</p>\n<p>^</p>\n<p>异或</p>\n<p>&lt;&lt;</p>\n<p>左移</p>\n<blockquote>\n<blockquote></blockquote>\n</blockquote>\n<p>右移</p>\n<p>typeof 运算符可以返回变量或表达式的类型。我们看下面的代码。</p>\n<p>console.log('typeof num:', typeof num); console.log('typeof Packt:', typeof 'Packt'); console.log('typeof true:', typeof true); console.log('typeof [1,2,3]:', typeof [1,2,3]); console.log('typeof {name:John}:', typeof {name:'John'});</p>\n<p>输出如下。</p>\n<p>typeof num: number typeof Packt: string typeof true: boolean typeof [1,2,3]: object typeof {name:John}: object</p>\n<p>根据标准，在 JavaScript 中有两种数据类型。</p>\n<p>原始数据类型：null、undefined、字符串、数、布尔值和 Symbol1。</p>\n<p>派生数据类型 / 对象：JavaScript 对象，包括函数、数组和正则表达式。</p>\n<p>1Symbol 是 ES6 新引入的数据类型，表示独一无二的值，详见 4.4.2 节。—— 编者注</p>\n<p>JavaScript 还支持 delete 运算符，可以删除对象里的属性。看看下面的代码。</p>\n<p name:=\"\" John=\"\">var myObj = {name: 'John', age: 21}; delete myObj.age; console.log (myObj); // 输出对象</p>\n<p>这些运算符在后面的算法学习中可能会用到。</p>\n<p>1.3.3　真值和假值</p>\n<p>在 JavaScript 中，true 和 false 有些复杂。在大多数编程语言中，布尔值 true 和 false 仅仅表示 true/false 结果。在 JavaScript 中，如 Packt 这样的字符串值，也可以看作 true。</p>\n<p>下表能帮助我们更好地理解 true 和 false 在 JavaScript 中是如何转换的。</p>\n<p>数值类型</p>\n<p>转换成布尔值</p>\n<p>undefined</p>\n<p>false</p>\n<p>null</p>\n<p>false</p>\n<p>布尔值</p>\n<p>true 是 true，false 是 false</p>\n<p>数</p>\n<p>+0、-0 和 NaN 都是 false，其他都是 true</p>\n<p>字符串</p>\n<p>如果字符串是空的（长度是 0）就是 false，其他都是 true（长度大于等于 1）</p>\n<p>对象</p>\n<p>true</p>\n<p>我们来看一些代码，用输出来验证上面的总结。</p>\n<p>function testTruthy (val) { return val ? console.log ('truthy') : console.log ('falsy'); } testTruthy (true); //true testTruthy (false); //false testTruthy (new Boolean (false)); //true (对象始终为 true) testTruthy (''); //false testTruthy ('Packt'); //true testTruthy (new String ('')); //true (对象始终为 true) testTruthy (1); //true testTruthy (-1); //true testTruthy (NaN); //false testTruthy (new Number (NaN)); //true (对象始终为 true) testTruthy ({}); //true (对象始终为 true) var obj = { name: 'John' }; testTruthy (obj); //true testTruthy (<span class=\"exturl\" data-url=\"aHR0cDovL29iai5uYW1l\">obj.name</span>); //true testTruthy (obj.age); //age (属性不存在)</p>\n<p>1.3.4　相等运算符（<mark>和</mark> =）</p>\n<p>这两个相等运算符的使用可能会引起一些困惑。</p>\n<p>使用 == 时，不同类型的值也可以被看作相等。这样的结果可能会使那些资深的 JavaScript 开发者都感到困惑。我们用下面的表格给大家分析一下不同类型的值用相等运算符比较后的结果。</p>\n<p>类型（x）</p>\n<p>类型（y）</p>\n<p>结果</p>\n<p>null</p>\n<p>undefined</p>\n<p>true</p>\n<p>undefined</p>\n<p>null</p>\n<p>true</p>\n<p>数</p>\n<p>字符串</p>\n<p>x == toNumber(y)</p>\n<p>字符串</p>\n<p>数</p>\n<p>toNumber(x) == y</p>\n<p>布尔值</p>\n<p>任何类型</p>\n<p>toNumber(x) == y</p>\n<p>任何类型</p>\n<p>布尔值</p>\n<p>x == toNumber(y)</p>\n<p>字符串或数</p>\n<p>对象</p>\n<p>x == toPrimitive(y)</p>\n<p>对象</p>\n<p>字符串或数</p>\n<p>toPrimitive(x) == y</p>\n<p>如果 x 和 y 的类型相同，JavaScript 会用 equals 方法比较这两个值或对象。没有列在这个表格中的其他情况都会返回 false。</p>\n<p>toNumber 和 toPrimitive 方法是内部的，并根据以下表格对其进行估值。</p>\n<p>toNumber 方法对不同类型返回的结果如下。</p>\n<p>值类型</p>\n<p>结果</p>\n<p>undefined</p>\n<p>NaN</p>\n<p>null</p>\n<p>+0</p>\n<p>布尔值</p>\n<p>如果是 true，返回 1；如果是 false，返回 + 0</p>\n<p>数</p>\n<p>数对应的值</p>\n<p>toPrimitive 方法对不同类型返回的结果如下。</p>\n<p>值类型</p>\n<p>结果</p>\n<p>对象</p>\n<p>如果对象的 valueOf 方法的结果是原始值，返回原始值；如果对象的 toString 方法返回原始值，就返回这个值；其他情况都返回一个错误</p>\n<p>用例子来验证一下表格中的结果。首先，我们知道下面的代码输出 true（字符串长度大于 1）。</p>\n<p>console.log('packt' ? true : false);</p>\n<p>那么下面这行代码的结果呢？</p>\n<p>console.log('packt' == true);</p>\n<p>输出是 false，为什么会这样呢？</p>\n<p>首先，布尔值会被 toNumber 方法转成数，因此得到 packt == 1。</p>\n<p>其次，用 toNumber 转换字符串值。因为字符串包含字母，所以会被转成 NaN，表达式就变成了 NaN == 1，结果就是 false。</p>\n<p>那么下面这行代码的结果呢？</p>\n<p>console.log('packt' == false);</p>\n<p>输出也是 false，为什么呢？</p>\n<p>首先，布尔值会被 toNumber 方法转成数，因此得到 packt == 0。</p>\n<p>其次，用 toNumber 转换字符串值。因为字符串包含字母，所以会被转成 NaN，表达式就变成了 NaN == 0，结果就是 false。</p>\n<p>那么 === 运算符呢？简单多了。如果比较的两个值类型不同，比较的结果就是 false。如果比较的两个值类型相同，结果会根据下表判断。</p>\n<p>类型（x）</p>\n<p>值</p>\n<p>结果</p>\n<p>数</p>\n<p>x 和 y 的值相同（但不是 NaN）</p>\n<p>true</p>\n<p>字符串</p>\n<p>x 和 y 是相同的字符</p>\n<p>true</p>\n<p>布尔值</p>\n<p>x 和 y 都是 true 或 false</p>\n<p>true</p>\n<p>对象</p>\n<p>x 和 y 引用同一个对象</p>\n<p>true</p>\n<p>如果 x 和 y 类型不同，结果就是 false。我们来看一些例子。</p>\n<p>console.log ('packt' === true); //false console.log ('packt' === 'packt'); //true var person1 = {name:'John'}; var person2 = {name:'John'}; console.log (person1 === person2); //false，不同的对象</p>\n<p>1.4　控制结构</p>\n<p>JavaScript 的控制结构与 C 和 Java 里的类似。条件语句支持 if...else 和 switch。循环支持 while、do...while 和 for。</p>\n<p>1.4.1　条件语句</p>\n<p>首先看一下如何构造 if...else 条件语句。有几种方式。</p>\n<p>如果想让一个脚本在仅当条件（表达式）是 true 时执行，可以使用 if 语句，如下所示。</p>\n<p console.log(num等于=\"\" 1);=\"\">var num = 1; if (num === 1)</p>\n<p>如果想在条件为 true 的时候执行脚本 A，在条件为 false（else）的时候执行脚本 B，可以使用 if...else 语句，如下所示。</p>\n<p console.log(num不等于=\"\" 1,=\"\" num的值是=\"\" +=\"\" num);=\"\">var num = 0; if (num === 1) { console.log ('num 等于 1'); } else</p>\n<p>if...else 语句也可以用三元运算符替换，例如下面的 if...else 语句。</p>\n<p num++;=\"\">if (num === 1) { num--; } else</p>\n<p>可以用三元运算符替换为：</p>\n<p>(num === 1) ? num-- : num++;</p>\n<p>如果我们有多个脚本，可以多次使用 if...else，根据不同的条件执行不同的语句。</p>\n<p console.log(月份不是一月、二月或三月);=\"\">var month = 5; if (month === 1) { console.log (' 一月 '); } else if (month === 2) { console.log (' 二月 '); } else if (month === 3) { console.log (' 三月 '); } else</p>\n<p>最后，还有 switch 语句。如果要判断的条件和上面的一样（但要和不同的值进行比较），可以使用 swtich 语句。</p>\n<p case=\"\" 1:=\"\" console.log(January);=\"\" break;=\"\" case=\"\" 2:=\"\" console.log(February);=\"\" break;=\"\" case=\"\" 3:=\"\" console.log(March);=\"\" break;=\"\" default:=\"\" console.log(Month=\"\" is=\"\" not=\"\" January,=\"\" February=\"\" or=\"\" March);=\"\">var month = 5; switch (month)</p>\n<p>对于 switch 语句来说，case 和 break 关键字的用法很重要。case 判断当前 switch 的值是否和 case 分支语句的值相等。break 会中止 switch 语句的执行。没有 break 会导致执行完当前的 case 后，继续执行下一个 case，直到遇到 break 或 switch 执行结束。最后，还有 default 关键字，在表达式不匹配前面任何一种情形的时候，就执行 default 中的代码（如果有对应的，就不会执行）。</p>\n<p>1.4.2　循环</p>\n<p>在处理数组元素时会经常用到循环（数组是第 3 章的主要内容）。在我们的算法中也会经常用到 for 循环。</p>\n<p>JavaScript 中的 for 循环与 C 和 Java 中的一样。循环的计数值通常是一个数，然后和另一个值比较（如果条件成立就会执行 for 循环中的代码），之后这个数值会递增或递减。</p>\n<p>在下面的代码里，我们用了一个 for 循环。当 i 小于 10 时，会在控制台中输出其值。i 的初始值是 0，因此这段代码会输出 0 到 9。</p>\n<p console.log(i);=\"\">for (var i = 0; i &lt; 10; i++)</p>\n<p>我们要关注的下一种循环是 while 循环。当 while 的条件判断成立时，会执行循环内的代码。下面的代码里，有一个初始值为 0 的变量 i，我们希望在 i 小于 10（即小于等于 9）时输出它的值。输出会是 0 到 9。</p>\n<p console.log(i);=\"\" i++;=\"\">var i = 0; while (i &lt; 10)</p>\n<p>do...while 循环和 while 循环很相似。区别是：在 while 循环里，先进行条件判断再执行循环体中的代码，而在 do...while 循环里，是先执行循环体中的代码再判断循环条件。do...while 循环至少会让循环体中的代码执行一次。下面的代码同样会输出 0 到 9。</p>\n<p>var i = 0; do { console.log(i); i++; } while (i &lt; 10);</p>\n<p>1.5　函数</p>\n<p>在用 JavaScript 编程时，函数很重要。我们的例子里也用到了函数。</p>\n<p>下面的代码展示了函数的基本语法。它没有用到参数或 return 语句。</p>\n<p console.log(Hello!);=\"\">function sayHello()</p>\n<p>要执行这段代码，只需要使用下面的语句。</p>\n<p>sayHello();</p>\n<p>我们也可以传递参数给函数。参数是会被函数使用的变量。下面的代码展示了如何在函数中使用参数。</p>\n<p console.log(text);=\"\">function output(text)</p>\n<p>我们可以通过以下代码使用该函数。</p>\n<p>output('Hello!');</p>\n<p>你可以传递任意数量的参数，如下所示。</p>\n<p>output('Hello!', 'Other text');</p>\n<p>在这个例子中，函数只使用了传入的第一个参数，第二个参数被忽略。</p>\n<p>函数也可以返回一个值，例如：</p>\n<p return=\"\" num1=\"\" +=\"\" num2;=\"\">function sum(num1, num2)</p>\n<p>这个函数计算了给定两个数之和，并返回结果。我们可以这样使用：</p>\n<p>var result = sum (1, 2); output (result); // 输出 3</p>\n<p>1.6　JavaScript 面向对象编程</p>\n<p>JavaScript 里的对象就是普通名值对的集合。创建一个普通对象有两种方式。第一种方式是：</p>\n<p>var obj = new Object();</p>\n<p>第二种方式是：</p>\n<p>var obj = {};</p>\n<p>我们也可以这样创建一个完整的对象：</p>\n<p>obj = { name: { first: 'Gandalf', last: 'the Grey' }, address: 'Middle Earth' };</p>\n<p>可以看到，声明 JavaScript 对象时，键值对中的键就是对象的属性，值就是对应属性的值。在本书中，我们创建的所有的类，如 Stack、Set、LinkedList、Dictionary、Tree、Graph 等，都是 JavaScript 对象。</p>\n<p>在面向对象编程（OOP）中，对象是类的实例。一个类定义了对象的特征。我们会创建很多类来表示算法和数据结构。例如我们如下声明一个类（构造函数）来表示书。</p>\n<p this.title=\"\" class=\"title;thispages pages;thisisbn\">function Book(title, pages, isbn)</p>\n<p>用下面的代码实例化这个类。</p>\n<p>var book = new Book('title', 'pag', 'isbn');</p>\n<p>然后，我们可以访问和修改对象的属性。</p>\n<p>console.log (book.title); // 输出书名 book.title = 'new title'; // 修改书名 console.log (book.title); // 输出新的书名</p>\n<p>类可以包含函数（通常也称为方法）。可以声明和使用函数 / 方法，如下所示。</p>\n<p>Book.prototype.printTitle = function() { console.log(this.title); }; book.printTitle();</p>\n<p>我们也可以直接在类的定义里声明函数。</p>\n<p>function Book(title, pages, isbn) { this.title = title; this.pages = pages; this.isbn = isbn; this.printIsbn = function() { console.log(this.isbn); }; } book.printIsbn();</p>\n<p>在 prototype 的例子里，printTitle 函数只会创建一次，在所有实例中共享。如果在类的定义里声明，就像前面的例子一样，则每个实例都会创建自己的函数副本。使用 prototype 方法可以节约内存和降低实例化的开销。不过 prototype 方法只能声明 public 函数和属性，而类定义可以声明只在类的内部访问的 private 函数和属性。ECMAScript 2015（ES6）引入了一套既像类定义又基于原型的简化语法。稍后我们会进一步讨论。</p>\n<p>1.7　调试工具</p>\n<p>除了学会如何用 JavaScript 编程外，还需要了解如何调试代码。调试对于找到代码中的错误十分有帮助，也能让你低速执行代码，从而看到所有发生的事情（方法被调用的栈、变量赋值等）。极力推荐你花一些时间学习一下如何调试书中的源代码，查看算法的每一步（这样也会让你对算法有深刻的理解）。</p>\n<p>Firefox、Safari、Edge 和 Chrome 都支持调试。有一个了解谷歌开发者工具的好教程，地址是 https://developer.chrome.com/devtools/docs/javascript-debugging。</p>\n<p>除了你喜好的编辑器外，这里推荐其他几个工具，可以提升编写 JavaScript 的效率。</p>\n<p>WebStorm：这是一个很强大的 IDE，支持最新的 Web 技术和框架。它不是免费的，但你可以下载一个 30 天试用版本体验一下。</p>\n<p>Sublime Text：这是一个轻量级的文本编辑器，可以自定义插件。你可以购买它的许可证来支持这个工具的开发，也可以免费使用（试用版不会过期）。</p>\n<p>Atom：这也是一个轻量级的文本编辑器，由 GitHub 创建。它为 JavaScript 提供了很好的支持，也可以自定义插件。</p>\n<p>Visual Studio Code：这是一个免费、开源的代码编辑器，由微软使用 TypeScript 开发。它使用 IntelliSense 提供 JavaScript 代码自动补全功能，并在编辑器内直接提供了内置的调试功能。同样可以自定义其插件。</p>\n<p>上述所有编辑器都同时支持 Windows、Linux 和 Mac OS。</p>\n<p>使用 VSCode 进行调试</p>\n<p>要直接在 VSCode 中调试 JavaScript 或 ECMAScript 代码，首先需要安装 Debugger for Chrome 扩展。</p>\n<p>然后，启动 Web Server for Chrome 扩展，并在浏览器中打开链接来查看本书的示例代码（默认的 URL 是 http://127.0.0.1:8887/examples）。</p>\n<p>下图展示了如何直接在编辑器中进行调试。</p>\n<p>(1) 在编辑器中，打开想要调试的 JavaScript 文件，将鼠标指针移至行号附近，点击添加一个断点（如图中的 1 所示）。调试器将在这里停止，然后可以对代码进行分析。</p>\n<p>(2) 当 Web Server 启动并运行之后，点击 Debug 界面（如图中的 2 所示），选择 Chrome（如图中的 3 所示），并点击运行图标来初始化调试进程。</p>\n<p>(3) Chrome 将自动启动。导航至我们需要调试代码的示例。一旦调试器搜索到添加了断点的那行代码，进程将停止，编辑器将获取焦点。</p>\n<p>(4) 我们可以使用顶部工具栏来控制代码的调试方式（如图中的 4 所示）。可以选择继续执行，进入方法的调用，跳至下一行代码，以及重新执行或停止执行。这和在 Chrome 等浏览器中使用调试工具是一样的。</p>\n<p>(5) 使用内置调试功能的好处是，我们可以在编辑器中做所有的事情（编写代码、调试和测试）。我们也可以在其中查看声明的变量和调用栈，可以监听变量和表达式（如图中的 5 所示），可以将鼠标指针悬停在变量上以查看它当前的值（如图中的 6 所示），还可以查看控制台的输出（如图中的 7 所示）。</p>\n<p>本书的源代码是使用 Visual Studio Code 开发的，也包含了启动项的配置，所以你可以直接在 VSCode 中调试和测试代码（所有的细节都包含在.vscode/launch.json 文件中）。运行本书源代码时推荐使用的扩展也列在了.vscode/extensions.json 文件中。</p>\n<p>1.8　小结</p>\n<p>本章主要讲述了如何搭建开发环境，有了这个环境就可以编写和运行书中的示例代码。</p>\n<p>本章也讲了 JavaScript 语言的基础知识，这些知识会在接下来的数据结构和算法学习过程中用到。</p>\n<p>下一章，我们将学习 2015 年以来 JavaScript 中新增的功能，以及如何借助 TypeScript 来利用静态类型和错误检查。</p>\n<h1 id=\"第-2-章-ecmascript和typescript概述\"><a class=\"anchor\" href=\"#第-2-章-ecmascript和typescript概述\">#</a> 第 2 章　ECMAScript 和 TypeScript 概述</h1>\n<p>JavaScript 语言每年都在进化。从 2015 年起，每年都有一个新版本发布，我们称其为 ECMAScript。JavaScript 是一门非常强大的语言，也用于企业级开发。在这类开发中（以及其他类型的应用中），类型变量是一个非常有用的功能。作为 JavaScript 的一个超集，TypeScript 给我们提供了这样的功能。</p>\n<p>本章，你将学习到自 2015 年起加入 JavaScript 的一些功能以及在项目中使用有类型版本的 JavaScript 的好处。本章内容涵盖如下几个方面：</p>\n<p>介绍 ECMAScript</p>\n<p>浏览器与服务器中的 JavaScript</p>\n<p>介绍 TypeScript</p>\n<p>2.1　ECMAScript 还是 JavaScript</p>\n<p>当我们使用 JavaScript 时，常会在图书、博客和视频课程中看到 ECMAScript 这个术语。那么 ECMAScript 和 JavaScript 有什么关系，又有什么区别呢？</p>\n<p>ECMA 是一个将信息标准化的组织。长话短说：很久以前，JavaScript 被提交到 ECMA 进行标准化，由此诞生了一个新的语言标准，也就是我们所知道的 ECMAScript。JavaScript 是该标准（最流行）的一个实现。</p>\n<p>2.1.1　ES6、ES2015、ES7、ES2016、ES8、ES2017 和 ES.Next</p>\n<p>我们知道，JavaScript 是一种主要在浏览器中运行的语言（也可以运行于 NodeJS 服务端、桌面端和移动端设备中），每个浏览器都可以实现自己版本的 JavaScript 功能（稍后你将在本书中学习）。这个具体的实现是基于 ECMAScript 的，因此浏览器提供的功能大都相同（我们的 JavaScript 代码可以在所有浏览器中运行）。然而，不同的浏览器之间，每个功能的行为也会存在细微的差别。</p>\n<p>目前为止，本章给出的所有代码都是基于 2009 年 12 月发布的 ECMAScript 5（即 ES5，其中的 ES 是 ECMAScript 的简称）。ECMAScript 2015（ES2015）在 2015 年 6 月标准化，距离它的上个版本过去了近 6 年。在 ES2015 发布前，ES6 的名字已经变得流行了。</p>\n<p>负责起草 ECMAScript 规范的委员会决定把定义新标准的模式改为每年更新一次，新的特性一旦通过就加入标准。因此，ECMAScript 第六版更名为 ECMAScript 2015（ES6）。</p>\n<p>2016 年 6 月，ECMAScript 第七版被标准化，称为 ECMAScript 2016 或 ES2016（ES7）。</p>\n<p>2017 年 6 月，ECMAScript 第八版被标准化。我们称它为 ECMAScript 2017 或 ES2017（ES8）。在写作本书时，这是最新的 ES 版本。</p>\n<p>你可能在某些地方见过 ES.Next。这种说法用来指代下一个版本的 ECMAScript。</p>\n<p>本节，我们会学习 ES2015 及之后版本中引入的一些新功能，它们对开发数据结构和算法都会有帮助。</p>\n<p>兼容性列表</p>\n<p>一定要明白，即便 ES2015 到 ES2017 已经发布，也不是所有的浏览器都支持新特性。为了获得更好的体验，最好使用你选择的浏览器的最新版本。</p>\n<p>通过以下链接，你可以检查在各个浏览器中哪些特性可用。</p>\n<p>ES2015（ES6）：<span class=\"exturl\" data-url=\"aHR0cDovL2thbmdheC5naXRodWIuaW8vY29tcGF0LXRhYmxlL2VzNi8=\">http://kangax.github.io/compat-table/es6/</span></p>\n<p>ES2016+：<span class=\"exturl\" data-url=\"aHR0cDovL2thbmdheC5naXRodWIuaW8vY29tcGF0LXRhYmxlL2VzMjAxNnBsdXMv\">http://kangax.github.io/compat-table/es2016plus/</span></p>\n<p>在 ES5 之后，最大的 ES 发布版本是 ES2015。根据上面链接中的兼容性表格来看，它的大部分功能在现代浏览器中都可以使用。即使有些 ES2016 + 的特性尚未支持，我们也可以现在就开始用新语法和新功能。</p>\n<p>对于开发团队交付的 ES 功能实现，Firefox 默认开启支持。</p>\n<p>在谷歌 Chrome 浏览器中，你可以访问 chrome://flags/#enable-javascript-harmony，开启 Experimental JavaScript 标志，启用新功能，如下图所示。</p>\n<p>在微软 Edge 浏览器中，你可以导航至 about:flags 页面并选择 Enable experimental JavaScript features 标志（和 Chrome 中的方法相似）。</p>\n<p>即使开启了 Chrome 或 Edge 浏览器的实验性 JavaScript 功能标志，ES2016 + 的部分特性也可能不受支持，Firefox 同样如此。要了解各个浏览器所支持的特性，请查看兼容性列表。</p>\n<p>2.1.2　使用 Babel.js</p>\n<p>Babel 是一个 JavaScript 转译器，也称为源代码编译器。它将使用了 ECMAScript 语言特性的 JavaScript 代码转换成只使用广泛支持的 ES5 特性的等价代码。</p>\n<p>使用 Babel.js 的方式多种多样。一种是根据设置文档（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWJlbGpzLmlvL2RvY3Mvc2V0dXAvJUVGJUJDJTg5JUU4JUJGJTlCJUU4JUExJThDJUU1JUFFJTg5JUU4JUEzJTg1JUUzJTgwJTgyJUU1JThGJUE2JUU0JUI4JTgwJUU3JUE3JThEJUU2JTk2JUI5JUU1JUJDJThGJUU2JTk4JUFGJUU3JTlCJUI0JUU2JThFJUE1JUU1JTlDJUE4JUU2JUI1JThGJUU4JUE3JTg4JUU1JTk5JUE4JUU0JUI4JUFEJUU4JUFGJTk1JUU3JTk0JUE4JUVGJUJDJTg4aHR0cHM6Ly9iYWJlbGpzLmlvL3JlcGwvJUVGJUJDJTg5JUVGJUJDJThDJUU1JUE2JTgyJUU0JUI4JThCJUU1JTlCJUJFJUU2JTg5JTgwJUU3JUE0JUJBJUUzJTgwJTgy\">https://babeljs.io/docs/setup/）进行安装。另一种方式是直接在浏览器中试用（https://babeljs.io/repl/），如下图所示。</span></p>\n<p>针对后续章节中出现的所有例子，我们都将提供一个在 Babel 中运行和测试的链接。</p>\n<p>2.2　ECMAScript 2015 + 的功能</p>\n<p>本节，我们将演示如何使用 ES2015 的一些新功能。这既对日常的 JavaScript 编码有用，也可以简化本书后面章节中的例子。</p>\n<p>我们将介绍以下功能。</p>\n<p>使用 let 和 const 声明变量</p>\n<p>模板字面量</p>\n<p>解构</p>\n<p>展开运算符</p>\n<p>箭头函数：=&gt;</p>\n<p>类</p>\n<p>模块</p>\n<p>2.2.1　用 let 替代 var 声明变量</p>\n<p>到 ES5 为止，我们可以在代码中任意位置声明变量，甚至重写已声明的变量，代码如下。</p>\n<p>var framework = 'Angular'; var framework = 'React'; console.log(framework);</p>\n<p>上面代码的输出是 React，该值被赋给最后声明的 framework 变量。这段代码中有两个同名的变量，这是非常危险的，可能会导致错误的输出。</p>\n<p>C、Java、C# 等其他语言不允许这种行为。ES2015 引入了一个 let 关键字，它是新的 var，这意味着我们可以直接把 var 关键字都替换成 let。以下代码就是一个例子。</p>\n<p>let language = 'JavaScript!'; // {1} let language = 'Ruby!'; // {2} - 抛出错误 console.log (language);</p>\n<p>行 {2} 会抛出错误，因为在同一作用域中已经声明过 language 变量（行 {1}）。后面会讨论 let 和变量作用域。</p>\n<p>你可以访问 http://t.cn/EGbEFux，测试和执行上面的代码。</p>\n<p>ES2015 还引入了 const 关键字。它的行为和 let 关键字一样，唯一的区别在于，用 const 定义的变量是只读的，也就是常量。</p>\n<p>举例来说，考虑如下代码：</p>\n<p>const PI = 3.141593; PI = 3.0; // 抛出错误 console.log (PI);</p>\n<p>当我们试图把一个新的值赋给 PI，甚至只是用 var PI 或 let PI 重新声明时，代码就会抛出错误，告诉我们 PI 是只读的。</p>\n<p>下面来看 const 的另一个例子。我们将使用 const 来声明一个对象。</p>\n<p>constjsFramework = { name: 'Angular' };</p>\n<p>尝试改变 jsFramework 变量的 name 属性。</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2pzRnJhbWV3b3JrLm5hbWU=\">jsFramework.name</span> = 'React';</p>\n<p>如果试着执行这段代码，它会正常工作。但是 const 声明的变量是只读的！为什么这里可以执行上面的代码呢？对于非对象类型的变量，比如数、布尔值甚至字符串，我们不可以改变变量的值。当遇到对象时，只读的 const 允许我们修改或重新赋值对象的属性，但变量本身的引用（内存中的引用地址）不可以修改，也就是不能对这个变量重新赋值。</p>\n<p>如果像下面这样尝试给 jsFramework 变量重新赋值，编译器会抛出异常（&quot;jsFramework&quot; is read-only）。</p>\n<p>// 错误，不能重新指定对象的引用 jsFramework = {name: 'Vue'};</p>\n<p>你可以访问 http://t.cn/EGbnYXG 执行上面的例子。</p>\n<p>let 和 const 的变量作用域</p>\n<p>我们通过下面这个例子（<span class=\"exturl\" data-url=\"aHR0cDovL3NpbmEubHQvZlFOVyVFRiVCQyU4OSVFNiU5RCVBNSVFNyU5MCU4NiVFOCVBNyVBM2xldCVFNiU4OCU5NmNvbnN0JUU1JTg1JUIzJUU5JTk0JUFFJUU1JUFEJTk3JUU1JUEzJUIwJUU2JTk4JThFJUU3JTlBJTg0JUU1JThGJTk4JUU5JTg3JThGJUU1JUE2JTgyJUU0JUJEJTk1JUU1JUI3JUE1JUU0JUJEJTlDJUUzJTgwJTgy\">http://sina.lt/fQNW）来理解 let 或 const 关键字声明的变量如何工作。</span></p>\n<p 12=\"\">let movie = 'Lord of the Rings'; // {1} //var movie = 'Batman v Superman'; // 抛出错误，movie 变量已声明 function starWarsFan () { const movie = 'Star Wars'; // {2} return movie; } function marvelFan () { movie = 'The Avengers'; // {3} return movie; } function blizzardFan () { const isFan = true; let phrase = 'Warcraft'; // {4} console.log ('Before if: ' + phrase); if (isFan) { let phrase = 'initial text'; // {5} phrase = 'For the Horde!'; // {6} console.log ('Inside if: ' + phrase); } phrase = 'For the Alliance!'; // {7} console.log ('After if: ' + phrase); } console.log (movie); // {8} console.log (starWarsFan ()); // {9} console.log (marvelFan ()); // {10} console.log (movie); // {11} blizzardFan (); //</p>\n<p>以上代码的输出如下。</p>\n<p>Lord of the Rings Star Wars The Avengers The Avengers Before if: Warcraft Inside if: For the Horde! After if: For the Alliance!</p>\n<p>现在，我们来讨论得到这些输出的原因。</p>\n<p>我们在行 {1} 声明了一个 movie 变量并赋值为 Lord of the Rings，然后在行 {8} 输出它的值。你在本章已经学过，这个变量拥有全局作用域。</p>\n<p>我们在行 {9} 执行了 starWarsFan 函数。在这个函数里，我们也声明了一个 movie 变量（行 {2}）。这个函数的输出是 Star Wars，因为行 {2} 的变量拥有局部作用域，也就是说它只在函数内部可见。</p>\n<p>我们在行 {10} 执行了 marvelFan 函数。在这个函数里，我们改变了 movie 变量的值（行 {3}）。这个变量是行 {1} 声明的全局变量。因此，行 {11} 的全局变量输出和行 {10} 的输出相同，都是 The Avengers。</p>\n<p>最后，我们在行 {12} 执行了 blizzardFan 函数。在这个函数里，我们声明了一个拥有函数内作用域的 phrase 变量（行 {4}）。然后，又声明了一个 phrase 变量（行 {5}），但这个变量的作用域只在 if 语句内。</p>\n<p>我们在行 {6} 改变了 phrase 的值。由于还在 if 语句内，值发生改变的是在行 {5} 声明的变量。</p>\n<p>然后，我们在行 {7} 再次改变了 phrase 的值，但由于不是在 if 语句内，行 {4} 声明的变量的值改变了。</p>\n<p>作用域的行为与在 Java 或 C 等其他编程语言中一样。然而，这是 ES2015（ES6）才引入到 JavaScript 的。</p>\n<p>注意，在本节展示的代码中，我们混用了 let 和 const。应该使用哪一个呢？有些开发者（和一些检查工具）倾向于在变量的引用不会改变时使用 const。但是，这是个人喜好问题，没有哪个是错的！</p>\n<p>2.2.2　模板字面量</p>\n<p>模板字面量真的很棒，因为我们创建字符串的时候不必再拼接值。</p>\n<p>举例来说，考虑如下 ES5 代码。</p>\n<p>const book = {name: ' 学习 JavaScript 数据结构与算法 '}; console.log (' 你正在阅读 ' + <span class=\"exturl\" data-url=\"aHR0cDovL2Jvb2submFtZQ==\">book.name</span> + '.,\\n 这是新的一行 \\n 这也是 ');</p>\n<p>我们可以用如下代码改进上面这个 console.log 输出的语法。</p>\n<p>console.log( <code>你正在阅读$&#123;book.name&#125;。 这是新的一行 这也是。</code> );</p>\n<p>模板字面量用一对 ` 包裹。要插入变量的值，只要把变量放在 ${} 里就可以了，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS1ib29rLXpmNWZsNmUxNGN4dDlhMXpidHYzai5uYW1l\">就像例子中的 book.name</span>。</p>\n<p>模板字面量也可以用于多行的字符串，再也不需要用 \\n 了。只要按下键盘上的 Enter 就可以换一行，就像上面例子里的这是新的一行。</p>\n<p>这个功能对简化我们例子的输出非常有用！</p>\n<p>你可以访问 http://t.cn/EGb17Xt 执行上面的例子。</p>\n<p>2.2.3　箭头函数</p>\n<p>ES2015 的箭头函数极大地简化了函数的语法。考虑如下例子。</p>\n<p>var circleAreaES5 = function circleArea(r) { var PI = 3.14; var area = PI * r * r; return area; }; console.log(circleAreaES5(2));</p>\n<p>上面这段代码的语法可以简化为如下代码。</p>\n<p>const circleArea = r =&gt; { // {1} const PI = 3.14; const area = PI * r * r; return area; }; console.log(circleArea(2));</p>\n<p>这个例子最大的区别在于行 {1}，我们可以省去 function 关键字，只用 =&gt;。</p>\n<p>如果函数只有一条语句，还可以变得更简单，连 return 关键字都可以省去。看看下面的代码。</p>\n<p>const circleArea2 = r =&gt; 3.14 * r * r; console.log(circleArea2(2));</p>\n<p>如果函数不接收任何参数，我们就使用一对空的圆括号，这在 ES5 中经常出现。</p>\n<p>const hello = () =&gt; console.log('hello!'); hello();</p>\n<p>你可以访问 http://t.cn/EGb1fte 执行上面的例子。</p>\n<p>2.2.4　函数的参数默认值</p>\n<p>在 ES2015 里，函数的参数还可以定义默认值。下面是一个例子。</p>\n<p>function sum (x = 1, y = 2, z = 3) { return x + y + z; } console.log (sum (4, 2)); // 输出 9</p>\n<p>由于我们没有传入参数 z，它的值默认为 3。因此，4 + 2 + 3 == 9。</p>\n<p>在 ES2015 之前，上面的函数只能写成下面这样。</p>\n<p if=\"\" (x=\"\">function sum(x, y, z)</p>\n<p>也可以写成下面这样。</p>\n<p var=\"\" x=\"\" class=\"argumentslength argumentslength argumentslength\" 0=\"\" &amp;&amp;=\"\" arguments[0]=\"\" !=\"=\" undefined=\"\" ?=\"\" arguments[0]=\"\" :=\"\" 1;=\"\" var=\"\" y=\"\" 1=\"\" &amp;&amp;=\"\" arguments[1]=\"\" !=\"=\" undefined=\"\" ?=\"\" arguments[1]=\"\" :=\"\" 2;=\"\" var=\"\" z=\"\" 2=\"\" &amp;&amp;=\"\" arguments[2]=\"\" !=\"=\" undefined=\"\" ?=\"\" arguments[2]=\"\" :=\"\" 3;=\"\" return=\"\" x=\"\" +=\"\" y=\"\" +=\"\" z;=\"\">function sum()</p>\n<p>JavaScript 函数中有一个内置的对象，叫作 arguments 对象。它是一个数组，包含函数被调用时传入的参数。即使不知道参数的名称，我们也可以动态获取并使用这些参数。</p>\n<p>有了 ES2015 的参数默认值，代码可以少写好几行。</p>\n<p>你可以访问 http://t.cn/EGb1QHS 执行上面的例子。</p>\n<p>2.2.5　声明展开和剩余参数</p>\n<p>在 ES5 中，我们可以用 apply () 函数把数组转化为参数。为此，ES2015 有了展开运算符（...）。举例来说，考虑我们上一节声明的 sum 函数。可以执行如下代码来传入参数 x、y 和 z。</p>\n<p>let params = [3, 4, 5]; console.log(sum(...params));</p>\n<p>以上代码和下面的 ES5 代码的效果是相同的。</p>\n<p>console.log(sum.apply(undefined, params));</p>\n<p>在函数中，展开运算符（...）也可以代替 arguments，当作剩余参数使用。考虑如下这个例子。</p>\n<p>function restParamaterFunction (x, y, ...a) { return (x + y) * a.length; } console.log(restParamaterFunction(1, 2, &quot;hello&quot;, true, 7));</p>\n<p>以上代码和下面代码的效果是相同的（同样输出 9）。</p>\n<p>function restParamaterFunction (x, y) { var a = Array.prototype.slice.call(arguments, 2); return (x + y) * a.length; } console.log(restParamaterFunction(1, 2, 'hello', true, 7));</p>\n<p>你可以访问 http://t.cn/EGbBP4e 执行展开运算符的例子，访问 http://t.cn/EGbBqXf 执行剩余参数的例子。</p>\n<p>2.2.6　增强的对象属性</p>\n<p>ES2015 引入了数组解构的概念，可以用来一次初始化多个变量。考虑如下例子。</p>\n<p>let [x, y] = ['a', 'b'];</p>\n<p>以上代码和下面代码的效果是相同的。</p>\n<p>let x = 'a'; let y = 'b';</p>\n<p>数组解构也可以用来进行值的互换，而不需要创建临时变量，如下所示。</p>\n<p>[x, y] = [y, x];</p>\n<p>以上代码和下面代码的效果是相同的。</p>\n<p>var temp = x; x = y; y = temp;</p>\n<p>这对你学习排序算法会很有用，因为互换值的情况很常见。</p>\n<p>还有一个称为属性简写的功能，它是对象解构的另一种方式。考虑如下例子。</p>\n<p x:=\"\" a,y:b=\"\">let [x, y] = ['a', 'b']; let obj = { x, y }; console.log(obj); //</p>\n<p>以上代码和下面代码的效果是相同的。</p>\n<p x:=\"\" a,y:b=\"\">var x = 'a'; var y = 'b'; var obj2 = { x: x, y: y }; console.log(obj2); //</p>\n<p>本节要讨论的最后一个功能是简写方法名（shorthand method name）。这使得开发者可以在对象中像属性一样声明函数。下面是一个例子。</p>\n<p>const hello = { name: 'abcdef', printHello() { console.log('Hello'); } }; console.log(hello.printHello());</p>\n<p>以上代码也可以写成下面这样。</p>\n<p>var hello = { name: 'abcdef', printHello: function printHello() { console.log('Hello'); } }; console.log(hello.printHello());</p>\n<p>你可以访问以下 URL 执行上面三个例子。</p>\n<p>数组解构：<span class=\"exturl\" data-url=\"aHR0cDovL3QuY24vRUdiQllZVA==\">http://t.cn/EGbBYYT</span></p>\n<p>变量互换：<span class=\"exturl\" data-url=\"aHR0cDovL3QuY24vRUdiQnN3Uw==\">http://t.cn/EGbBswS</span></p>\n<p>属性简写：<span class=\"exturl\" data-url=\"aHR0cDovL3QuY24vRUdiclVKaQ==\">http://t.cn/EGbrUJi</span></p>\n<p>2.2.7　使用类进行面向对象编程</p>\n<p>ES2015 还引入了一种更简洁的声明类的方式。你已经在 1.6 节学习了像下面这样声明一个 Book 类的方式。</p>\n<p>function Book(title, pages, isbn) { // {1} this.title = title; this.pages = pages; this.isbn = isbn; } Book.prototype.printTitle = function() { console.log(this.title); };</p>\n<p>我们可以用 ES2015 把语法简化，如下所示。</p>\n<p>class Book { // {2} constructor(title, pages, isbn) { this.title = title; this.pages = pages; this.isbn = isbn; } printIsbn() { console.log(this.isbn); } }</p>\n<p>只需要使用 class 关键字，声明一个有 constructor 函数和诸如 printIsbn 等其他函数的类。ES2015 的类是基于原型语法的语法糖。行 {1} 声明 Book 类的代码与行 {2} 声明的代码具有相同的效果和输出。</p>\n<p>let book = new Book ('title', 'pag', 'isbn'); console.log (book.title); // 输出图书标题 book.title = 'new title'; // 更新图书标题 console.log (book.title); // 输出图书标题</p>\n<p>你可以访问 http://t.cn/EGbroRC 执行上面的例子。</p>\n<p>继承</p>\n<p>ES2015 中，类的继承也有简化的语法。我们看一个例子。</p>\n<p>class ITBook extends Book {// {1} constructor (title, pages, isbn, technology) { super (title, pages, isbn); // {2} this.technology = technology; } printTechnology () { console.log (this.technology); } } let jsBook = new ITBook (' 学习 JS 算法 ', '200', '1234567890', 'JavaScript'); console.log (jsBook.title); console.log (jsBook.printTechnology ());</p>\n<p>我们可以用 extends 关键字扩展一个类并继承它的行为（行 {1}）。在构造函数中，我们也可以通过 super 关键字引用父类的构造函数（行 {2}）。</p>\n<p>尽管在 JavaScript 中声明类的新方式所用的语法与 Java、C、C++ 等其他编程语言很类似，但 JavaScript 面向对象编程还是基于原型实现的。</p>\n<p>你可以访问 http://sina.lt/fQPa 执行上面的例子。</p>\n<p>使用属性存取器</p>\n<p>ES2015 也可以为类属性创建存取器函数。虽然不像其他面向对象语言（封装概念），类的属性不是私有的，但最好还是遵循一种命名模式。</p>\n<p>下面的例子是一个声明了 get 和 set 函数的类。</p>\n<p>class Person { constructor (name) { this._name = name; // {1} } get name() { // {2} return this._name; } set name(value) { // {3} this._name = value; } } let lotrChar = new Person('Frodo'); console.log(<span class=\"exturl\" data-url=\"aHR0cDovL2xvdHJDaGFyLm5hbWU=\">lotrChar.name</span>); // {4} <span class=\"exturl\" data-url=\"aHR0cDovL2xvdHJDaGFyLm5hbWU=\">lotrChar.name</span> = 'Gandalf'; // {5} console.log(<span class=\"exturl\" data-url=\"aHR0cDovL2xvdHJDaGFyLm5hbWU=\">lotrChar.name</span>); lotrChar._name = 'Sam'; // {6} console.log(<span class=\"exturl\" data-url=\"aHR0cDovL2xvdHJDaGFyLm5hbWU=\">lotrChar.name</span>);</p>\n<p>要声明 get 和 set 函数，只需要在我们要暴露和使用的函数名前面加上 get 或 set 关键字（行 {2} 和行 {3}）。我们可以用相同的名字声明类属性，或者在属性名前面加下划线（行 {1}），让这个属性看起来像是私有的。</p>\n<p>然后，只要像普通的属性一样，引用它们的名字（行 {4} 和行 {5}），就可以执行 get 和 set 函数了。</p>\n<p>_name 并非真正的私有属性，我们仍然可以引用它（行 {6}）。本书后面的章节还会谈到这一点。</p>\n<p>你可以访问 http://t.cn/EGbd6GL 执行上面的例子。</p>\n<p>2.2.8　乘方运算符</p>\n<p>乘方运算符在进行数学计算时非常有用。作为示例，我们使用公式计算一个圆的面积。</p>\n<p>const area = 3.14 * r * r;</p>\n<p>也可以使用 Math.pow 函数来写出具有相同功能的代码。</p>\n<p>const area = 3.14 * Math.pow(r, 2);</p>\n<p>ES2016 中引入了 ** 运算符，用来进行指数运算。我们可以像下面这样使用指数运算符计算一个圆的面积。</p>\n<p>const area = 3.14 * (r ** 2);</p>\n<p>你可以访问 http://t.cn/EGbdT0r 执行上面的例子。</p>\n<p>ES2015 + 还提供了一些其他功能，包括列表迭代器、类型数组、Set、Map、WeakSet、WeakMap、尾调用、for..of、Symbol、Array.prototype.includes、尾逗号、字符串补全、静态对象方法，等等。我们在后续章节会学习到其中的一些功能。</p>\n<p>你可以在 https://developer.mozilla.org/zh-CN/docs/Web/JavaScript 查阅 JavaScript 和 ECMAScript 的完整功能列表。</p>\n<p>2.2.9　模块</p>\n<p>Node.js 开发者已经很熟悉用 require 语句（CommonJS 模块）进行模块化开发了。同样，还有一个流行的 JavaScript 模块化标准，叫作异步模块定义（AMD）。RequireJS 是 AMD 最流行的实现。ES2015 在 JavaScript 标准中引入了一种官方的模块功能。让我们来创建并使用模块吧。</p>\n<p>要创建的第一个模块包含两个用来计算几何图形面积的函数。在一个文件（17-CalcArea.js）中添加如下代码。</p>\n<p 1=\"\">const circleArea = r =&gt; 3.14 * (r ** 2); const squareArea = s =&gt; s * s; export { circleArea, squareArea }; //</p>\n<p>这表示我们暴露出了这两个函数，以便其他文件使用（行 {1}）。只有被导出的成员才对其他模块或文件可见。</p>\n<p>在本示例的主文件（17-ES2015-ES6-Modules.js）中，我们会用到在 17-CalcArea.js 文件中声明的函数。下面的代码片段展示了如何使用这两个函数。</p>\n<p>import { circleArea, squareArea } from './17-CalcArea'; // {2} console.log(circleArea(2)); console.log(squareArea(2));</p>\n<p>首先，需要在文件中导入要使用的函数（行 {2}），之后就可以调用它们了。</p>\n<p>如果需要使用 circleArea 函数，也可以只导入这个函数。</p>\n<p>import { circleArea } from './17-CalcArea';</p>\n<p>基本上，模块就是在单个文件中声明的 JavaScript 代码。我们可以用 JavaScript 代码直接从其他文件中导入函数、变量和类（不需要像几年前 JavsScript 还不够流行的时候那样，事先在 HTML 中按顺序引入若干文件）。模块功能让我们在创建代码库或开发大型项目时能够更好地组织代码。</p>\n<p>我们可以像下面这样，在导入成员后对其重命名。</p>\n<p>import { circleArea as circle } from './17-CalcArea';</p>\n<p>也可以在导出函数时就对其重命名。</p>\n<p>export { circleArea as circle, squareArea as square };</p>\n<p>这种情况下，在导入被导出的成员时，需要使用导出时重新命名的名字，而不是原来内部使用的名字。</p>\n<p>import { circle, square } from './17-CalcArea';</p>\n<p>同样，我们也可以使用其他方式在另一个模块中导入函数。</p>\n<p>import * as area from './17-CalcArea'; console.log(area.circle(2)); console.log(area.square(2));</p>\n<p>这种情况下，可以把整个模块当作一个变量来导入，然后像使用类的属性和方法那样调用被导出的成员。</p>\n<p>还可以在需要被导出的函数或变量前添加 export 关键字。这样就不需要在文件末尾写导出声明了。</p>\n<p>export const circleArea = r =&gt; 3.14 * (r ** 2); export const squareArea = s =&gt; s * s;</p>\n<p>假设模块中只有一个成员，而且需要将其导出。可以像下面这样使用 export default 关键字。</p>\n<p>export default class Book { constructor(title) { this.title = title; } printTitle() { console.log(this.title); } }</p>\n<p>可以使用如下代码在另一个模块中导入上面的类。</p>\n<p>import Book from './17-Book'; const myBook = new Book('some title'); myBook.printTitle();</p>\n<p>注意，在这种情况下，我们不需要将类名包含在花括号（{}）中。只在模块有多个成员被导出时使用花括号。</p>\n<p>在后面的章节中，我们需要使用模块来创建数据结构和算法库。</p>\n<p>要了解更多有关 ES2015 模块的信息，请查阅 http://exploringjs.com/es6/ch_modules.html。你也可以下载本书的源代码包来查看本示例的完整代码。</p>\n<p>在浏览器中使用 Node.js 运行 ES2015 模块</p>\n<p>我们尝试像下面这样直接执行 node 指令来运行 17-ES2015-ES6-Modules.js 文件。</p>\n<p>cd path-source-bundle/examples/chapter01 node 17-ES2015-ES6-Modules</p>\n<p>我们会得到错误信息 SyntaxError: Unexpected token import。这是因为在写作本书的时候，Node.js 还不支持原生的 ES2015 模块。Node.js 使用的是 CommonJS 模块的 require 语法。这表示我们需要转译 ES2015 代码，使得 Node 可以理解。有不同的工具可以完成这项任务。简单起见，我们将使用 Babel 命令行工具。</p>\n<p>完整的 Babel 安装和使用细节可以在 https://babeljs.io/docs/setup 和 https://babeljs.io/docs/usage/cli/ 查阅。</p>\n<p>最好的方式是创建一个本地项目，并在其中进行 Babel 的配置。遗憾的是，这些细节不在本书的讨论范围之内（这应该是 Babel 相关图书的主题）。为了使本例保持简单，我们将用 npm 安装在全局使用的 Babel 命令行工具。</p>\n<p>npm install -g babel-cli</p>\n<p>如果你使用的是 Linux 或 Mac OS，可能需要在命令前加上 sudo 指令来获取管理员权限（sudo npm install -g babel-cli）。</p>\n<p>在 chapter01 目录中，我们需要用 Babel 将之前创建的 3 个 JavaScript 模块文件转译成 CommonJS 代码，使得 Node.js 可以执行它们。我们会用以下命令将转译后的代码放在 chapter01/lib 目录中。</p>\n<p>babel 17-CalcArea.js --out-dir lib babel 17-Book.js --out-dir lib babel 17-ES2015-ES6-Modules.js --out-dir lib</p>\n<p>接下来，创建一个叫作 17-ES2015-ES6-Modules-node.js 的 JavaScript 文件，这样就可以在其中使用 area 函数和 Book 类了。</p>\n<p>const area = require('./lib/17-CalcArea'); const Book = require('./lib/17-Book'); console.log(area.circle(2)); console.log(area.square(2)); const myBook = new Book('some title'); myBook.printTitle();</p>\n<p>代码基本是一样的，区别在于 Node.js（目前）不支持 import 语法，需要使用 require 关键字。</p>\n<p>可以使用下面的命令来执行代码。</p>\n<p>node 17-ES2015-ES6-Modules-node</p>\n<p>在下图中能看到使用的命令和输出结果，这样就可以确认代码能够用 Node.js 运行。</p>\n<p>在 Node.js 中使用原生的 ES2015 导入功能</p>\n<p>如果能在 Node.js 中使用原生的 ES2015 导入功能，而不用转译的话就更好了。从 Node 8.5 版本开始，我们可以将 ES2015 导入作为实验功能来开启。</p>\n<p>要演示这个示例，我们将在 chapter01 中创建一个新的目录，叫作 17-ES2015-Modules-node。将 17-CalcArea.js、17-Book.js 和 17-ES2015- ES6-Modules.js 文件复制到此目录中，然后将文件的扩展名由 js 修改为 mjs（.mjs 是本例成功运行的必要条件）。在 17-ES2015-ES6-Modules.mjs 文件中更新导入语句，像下面这样添加.mjs 扩展名。</p>\n<p>import * as area from './17-CalcArea.mjs'; import Book from './17-Book.mjs';</p>\n<p>我们将在 node 命令后添加 --experimental-modules 来执行代码，如下所示。</p>\n<p>cd 17-ES2015-Modules-node node --experimental-modules 17-ES2015-ES6-Modules.mjs</p>\n<p>在下图中，我们可以看到命令和输入结果。</p>\n<p>在写作本书的时候，可支持 ES2015 导入功能的 Node.js 版本是 Node 10 LTS。</p>\n<p>更多有关 Node.js 支持原生 ES2015 导入功能的信息可以在 https://github.com/nodejs/node-eps/blob/master/002-es-modules.md 查阅。</p>\n<p>在浏览器中运行 ES2015 模块</p>\n<p>要在浏览器中运行 ES2015 的代码，有几种不同的方式。第一种是生成传统的代码包（即转译成 ES5 代码的 JavaScript 文件）。我们可以使用流行的代码打包工具，如 Browserify 或 Webpack。通过这种方法，我们会创建可直接发布的文件（包），并且可以在 HTML 文件中像引入其他 JavaScript 代码一样引入它。</p>\n<p>&lt;script src=&quot;./lib/17-ES2015-ES6-Modules-bundle.js&quot;&gt;&lt;/script&gt;</p>\n<p>浏览器对 ES2015 模块的支持最终于 2017 年初实现了。在写作本书的时候，它还是实验性的功能，并没有得到所有现代浏览器的支持。目前对该功能的支持情况（以及在实验性模式下开启它的方法）可以在 http://caniuse.com/#feat=es6-module 查阅，如下图所示。</p>\n<p>要在浏览器中使用 import 关键字，首先需要在代码的 import 语句后加上.js 文件扩展名，如下所示。</p>\n<p>import * as area from './17-CalcArea.js'; import Book from './17-Book.js';</p>\n<p>其次，只需要在 script 标签中增加 type=&quot;module&quot; 就可以导入我们创建的模块了。</p>\n<p>&lt;script type=&quot;module&quot; src=&quot;17-ES2015-ES6-Modules.js&quot;&gt;&lt;/script&gt;</p>\n<p>如果执行代码并打开 Developer Tools | Network 标签页，就会看到我们创建的所有文件都被加载了。</p>\n<p>如果要保证不支持该功能的浏览器向后兼容，可以使用 nomodule。</p>\n<p>&lt;script nomodule src=&quot;./lib/17-ES2015-ES6-Modules-bundle.js&quot;&gt;&lt;/script&gt;</p>\n<p>在大多数现代浏览器都支持该功能之前，我们仍然需要使用打包工具将代码转译至 ES2015+。</p>\n<p>要了解更多有关在浏览器中运行 ES2015 模块的信息，请阅读 https://medium.com/dev-channel/es6-modules-in-chrome-canary-m60-ba588dfb8ab7 和 https://jakearchibald.com/2017/es-modules-in-browsers/。</p>\n<p>ES2015 + 的向后兼容性</p>\n<p>需要把现有的 JavaScript 代码更新到 ES2015 吗？答案是：只要你愿意就行！ES2015 + 是 JavaScript 语言的超集，所有符合 ES5 规范的特性都可以继续使用。不过，你可以开始使用 ES2015 + 的新语法，让代码变得更加简单易读。</p>\n<p>在本书接下来的章节中，我们会尽可能地使用 ES2015+。假设我们想根据本书内容创建一个数据结构和算法库。这通常需要支持想在浏览器（ES5）和 Node.js 环境下使用该代码库的开发者。目前可以采取的方法是，将我们的代码转译成通用模块定义（UMD）。要了解更多有关 UMD 的信息，请访问 https://github.com/umdjs/umd。我们会在第 4 章学习使用 Babel 将 ES2015 代码转译成 UMD 的更多方法。</p>\n<p>对于所有使用模块的示例，源代码包除了 ES2015 + 语法之外还提供了转译后的版本，因此你可以在任意浏览器中运行源代码。</p>\n<p>2.3　介绍 TypeScript</p>\n<p>TypeScript 是一个开源的、渐进式包含类型的 JavaScript 超集，由微软创建并维护。创建它的目的是让开发者增强 JavaScript 的能力并使应用的规模扩展变得更容易。它的主要功能之一是为 JavaScript 变量提供类型支持。在 JavaScript 中提供类型支持可以实现静态检查，从而更容易地重构代码和寻找 bug。最后，TypeScript 会被编译为简单的 JavaScript 代码。</p>\n<p>考虑到本书的范围，有了 TypeScript，就可以使用一些 JavaScript 中没有提供的面向对象的概念了，例如接口和私有属性（这在开发数据结构和排序算法时非常有用）。当然，我们也可以利用在一些数据结构中非常重要的类型功能。</p>\n<p>所有这些功能在编译时都是可用的。只要我们在写代码，就将其编译成普通的 JavaScript 代码（ES5、ES2015 + 和 CommonJS 等）。</p>\n<p>要开始使用 TypeScript，我们需要用 npm 来安装它。</p>\n<p>npm install -g typescript</p>\n<p>接下来，需要创建一个以.ts 为扩展名的文件，比如 hello-world.ts。</p>\n<p>let myName = 'Packt'; myName = 10;</p>\n<p>以上是简单的 ES2015 代码。现在，我们用 tsc 命令来编译它。</p>\n<p>tsc hello-world</p>\n<p>在终端输出中，我们会看到下面的警告。</p>\n<p>hello-world.ts(2,1): error TS2322: Type '10' is not assignable to type 'string'.</p>\n<p>这表示类型 10 不可赋值给字符串类型。但是如果检查创建文件的目录，我们会发现一个包含如下内容的 hello-world.js 文件。</p>\n<p>var myName = 'Packt'; myName = 10;</p>\n<p>上面生成的是 ES5 代码。即使在终端输出了错误信息（实际上是警告，而不是错误），TypeScript 编译器还是会生成 ES5 代码。这表明尽管 TypeScript 在编译时进行了类型和错误检测，但并不会阻止编译器生成 JavaScript 代码。这意味着开发者在写代码时可以利用这些验证结果写出具有较少错误和 bug 的 JavaScript 代码。</p>\n<p>2.3.1　类型推断</p>\n<p>在使用 TypeScript 的时候，我们会经常看到下面这样的代码。</p>\n<p>let age: number = 20; let existsFlag: boolean = true; let language: string = 'JavaScript';</p>\n<p>TypeScript 允许我们给变量设置一个类型，不过上面的写法太啰唆了。TypeScript 有一个类型推断机制，也就是说 TypeScript 会根据为变量赋的值自动给该变量设置一个类型。我们用更简洁的语法改写上面的代码。</p>\n<p>let age = 20; // 数 let existsFlag = true; // 布尔值 let language = 'JavaScript'; // 字符串</p>\n<p>在上面的代码中，TypeScript 仍然知道 age 是一个数、existsFlag 是一个布尔值，以及 language 是一个字符串。因此不需要显式地给这些变量设置类型。</p>\n<p>那么，什么时候需要给变量设置类型呢？如果声明了一个变量但没有设置其初始值，推荐为其设置一个类型，如下所示。</p>\n<p>let favoriteLanguage: string; let langs = ['JavaScript', 'Ruby', 'Python']; favoriteLanguage = langs[0];</p>\n<p>如果没有为变量设置类型，它的类型会被自动设置为 any，意思是可以接收任何值，就像在普通 JavaScript 中一样。</p>\n<p>2.3.2　接口</p>\n<p>在 TypeScript 中，有两种接口的概念。第一种就像给变量设置一个类型，如下所示。</p>\n<p console.log(person.name);=\"\">interface Person { name: string; age: number; } function printName(person: Person)</p>\n<p>第一种 TypeScript 接口的概念是把接口看作一个实际的东西。它是对一个对象必须包含的属性和方法的描述。</p>\n<p>这使得 VSCode 这样的编辑器能通过 IntelliSense 实现自动补全，如下图所示。</p>\n<p>现在，试着使用 printName 函数。</p>\n<p>const john = { name: 'John', age: 21 }; const mary = { name: 'Mary', age: 21, phone: '123-45678' }; printName(john); printName(mary);</p>\n<p>上面的代码没有任何编译错误。像 printName 函数希望的那样，变量 john 有一个 name 和 age。变量 mary 除了 name 和 age 之外，还有一个 phone 的信息。</p>\n<p>为什么这样的代码可以工作呢？TypeScript 有一个名为鸭子类型的概念：如果它看起来像鸭子，像鸭子一样游泳，像鸭子一样叫，那么它一定是一只鸭子！在本例中，变量 mary 的行为和 Person 接口定义的一样，那么它就是一个 Person。这是 TypeScript 的一个强大功能。</p>\n<p>再次运行 tsc 命令之后，我们会在 hello-world.js 文件中得到下面的结果。</p>\n<p>function printName(person) { console.log(<span class=\"exturl\" data-url=\"aHR0cDovL3BlcnNvbi5uYW1l\">person.name</span>); } var john = { name: 'John', age: 21 }; var mary = { name: 'Mary', age: 21, phone: '123-45678' };</p>\n<p>上面的代码只是普通的 JavaScript。代码补全以及类型和错误检查只在编译时是可用的。</p>\n<p>第二种 TypeScript 接口的概念和面向对象编程相关，与其他面向对象语言（如 Java、C# 和 Ruby 等）中的概念是一样的。接口就是一份合约。在这份合约里，我们可以定义实现这份合约的类或接口的行为。试想 ECMAScript 标准，ECMAScript 就是 JavaScript 语言的一个接口。它告诉 JavaScript 语言需要有怎样的功能，但不同的浏览器可以有不同的实现方式。</p>\n<p>考虑下面的代码：</p>\n<p>interface Comparable { compareTo(b): number; } class MyObject implements Comparable { age: number; compareTo(b): number { if (this.age === b.age) { return 0; } return this.age &gt; b.age ? 1 : -1; } }</p>\n<p>Comparable 接口告诉 MyObject 类，它需要实现一个叫作 compareTo 的方法，并且该方法接收一个参数。在该方法内部，我们可以实现需要的逻辑。在本例中，我们比较了两个数，但也可以用不同的逻辑来比较两个字符串，甚至是包含不同属性的更复杂的对象。该接口的行为在 JavaScript 中并不存在，但它在进行一些工作（如开发排序算法）时非常有用。</p>\n<p>泛型</p>\n<p>另一个对数据结构和算法有用的强大 TypeScript 特性是泛型这一概念。我们修改一下 Comparable 接口，以便定义 compareTo 方法作为参数接收的对象是什么类型。</p>\n<p compareTo(b:=\"\" T):=\"\" number;=\"\">interface Comparable&lt;T&gt;</p>\n<p>用尖括号向 Comparable 接口动态地传入 T 类型，可以指定 compareTo 函数的参数类型。</p>\n<p>class MyObject implements Comparable&lt;MyObject&gt; { age: number; compareTo(b: MyObject): number { if (this.age === b.age) { return 0; } return this.age &gt; b.age ? 1 : -1; } }</p>\n<p>这是个很有用的功能，可以确保我们在比较相同类型的对象。利用这个功能，我们还可以使用编辑器的代码补全。</p>\n<p>2.3.3　其他 TypeScript 功能</p>\n<p>以上是对 TypeScript 的简单介绍。TypeScript 文档是学习所有其他功能以及了解本章话题相关细节的好地方，可以在 https://www.typescriptlang.org/docs/home.html 找到。</p>\n<p>TypeScript 也有一个在线体验功能（和 Babel 类似），可以在里面运行一些代码示例，地址是 https://www.typescriptlang.org/play/index.html。</p>\n<p>本书的源代码包中有一个额外的资源，那就是我们会在本书中开发完成的 JavaScript 数据结构和算法库的 TypeScript 版本！</p>\n<p>2.3.4　TypeScript 中对 JavaScript 文件的编译时检查</p>\n<p>一些开发者还是更习惯使用普通的 JavaScript 语言，而不是 TypeScript 来进行开发。但是在 JavaScript 中使用一些类型和错误检测功能也是很不错的！</p>\n<p>好消息是 TypeScript 提供了一个特殊的功能，允许我们在编译时对代码进行错误检测和类型检测！要使用它的话，需要在计算机上全局安装 TypeScript。使用时，只需要在 JavaScript 文件的第一行添加一句 // @ts-check，如下图所示。</p>\n<p>向代码中添加 JSDoc（JavaScript 文档）之后，类型检测将被启用。如果试着向 circle（或 circleArea）方法中传入一个字符串，会得到一个编译错误。</p>\n<p>2.4　小结</p>\n<p>本章，我们学习了 ECMAScript 2015 + 的一些新功能，会让后续例子的语法变得更加简练。本章还介绍了 TypeScript 以帮助我们利用静态类型和错误检测。</p>\n<p>下一章，我们要学习第一种数据结构：数组。许多语言都对数组有原生的支持，包括 JavaScript。</p>\n<h1 id=\"第-3-章-数组\"><a class=\"anchor\" href=\"#第-3-章-数组\">#</a> 第 3 章　数组</h1>\n<p>几乎所有的编程语言都原生支持数组类型，因为数组是最简单的内存数据结构。JavaScript 里也有数组类型，尽管它的第一个版本并没有支持数组。本章，我们将深入学习数组数据结构和它的能力。</p>\n<p>数组存储一系列同一种数据类型的值。虽然在 JavaScript 里，也可以在数组中保存不同类型的值，但我们还是遵守最佳实践，避免这么做（大多数语言都没这个能力）。</p>\n<p>3.1　为什么用数组</p>\n<p>假如有这样一个需求：保存所在城市每个月的平均温度。可以这么做：</p>\n<p>const averageTempJan = 31.9; const averageTempFeb = 35.3; const averageTempMar = 42.4; const averageTempApr = 52; const averageTempMay = 60.8;</p>\n<p>当然，这肯定不是最好的方案。按照这种方式，如果只存一年的数据，我们能管理 12 个变量。若要多存几年的平均温度呢？幸运的是，我们可以用数组来解决，更加简洁地呈现同样的信息。</p>\n<p>const averageTemp = []; averageTemp[0] = 31.9; averageTemp[1] = 35.3; averageTemp[2] = 42.4; averageTemp[3] = 52; averageTemp[4] = 60.8;</p>\n<p>数组 averageTemp 里的内容如下图所示。</p>\n<p>3.2　创建和初始化数组</p>\n<p>用 JavaScript 声明、创建和初始化数组很简单，就像下面这样。</p>\n<p 3=\"\">let daysOfWeek = new Array(); // {1} daysOfWeek = new Array(7); // {2} daysOfWeek = new Array('Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'); //</p>\n<p>使用 new 关键字，就能简单地声明并初始化一个数组（行 {1}）。用这种方式，还可以创建一个指定长度的数组（行 {2}）。另外，我们也可以直接将数组元素作为参数传递给它的构造器（行 {3}）。</p>\n<p>然而，用 new 创建数组并不是最好的方式。如果你想在 JavaScript 中创建一个数组，只用中括号（[]）的形式就行了，如下所示。</p>\n<p>let daysOfWeek = [];</p>\n<p>也可使用一些元素初始化数组，如下所示。</p>\n<p>let daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];</p>\n<p>如果想知道数组里已经存了多少个元素（它的大小），可以使用数组的 length 属性。以下代码的输出是 7。</p>\n<p>console.log(daysOfWeek.length);</p>\n<p>访问元素和迭代数组</p>\n<p>要访问数组里特定位置的元素，可以用中括号传递数值位置，得到想知道的值或者赋新的值。假如我们想输出数组 daysOfWeek 里的所有元素，可以通过循环迭代数组、打印元素，如下所示。</p>\n<p console.log(daysOfWeek[i]);=\"\">for (let i = 0; i &lt; daysOfWeek.length; i++)</p>\n<p>我们来看另一个例子：求斐波那契数列的前 20 个数。已知斐波那契数列中的前两项是 1，从第三项开始，每一项都等于前两项之和。</p>\n<p>const fibonacci = []; // {1} fibonacci[1] = 1; // {2} fibonacci[2] = 1; // {3} for (let i = 3; i &lt; 20; i++) { fibonacci[i] = fibonacci[i - 1] + fibonacci[i - 2]; // {4} } for (let i = 1; i &lt; fibonacci.length; i++) { // {5} console.log(fibonacci[i]); // {6} }</p>\n<p>下面是上述代码的解释。</p>\n<p>在行 {1} 处，我们声明并创建了一个数组。</p>\n<p>在行 {2} 和行 {3}，把斐波那契数列中的前两个数分别赋给了数组的第二和第三个位置。（在 JavaScript 中，数组第一位的索引始终是 0。因为斐波那契数列中不存在 0，所以这里直接略过，从第二位开始分别保存斐波那契数列中对应位置的元素。）</p>\n<p>然后，我们需要做的就是想办法得到斐波那契数列中第三到第二十个位置上的数（前两个值我们已经初始化过了）。我们可以用循环来处理，把数组中前两位上的元素相加，结果赋给当前位置上的元素（行 {4}—— 从数组中的索引 3 到索引 19）。</p>\n<p>最后，看看输出（行 {6}），我们只需要循环迭代数组的各个元素（行 {5}）。</p>\n<p>示例代码里，我们用 console.log 来输出数组中对应索引位置的值（行 {5} 和行 {6}），也可以直接用 console.log（fibonacci）输出数组。大多数浏览器都可以用这种方式，清晰地输出数组。</p>\n<p>现在如果想知道斐波那契数列其他位置上的值是多少，要怎么办呢？ 很简单，把之前循环条件中的终止变量从 20 改成你希望的值就可以了。</p>\n<p>3.3　添加元素</p>\n<p>在数组中添加和删除元素也很容易，但有时也会很棘手。假如我们有一个数组 numbers，初始化成了 0 到 9。</p>\n<p>let numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];</p>\n<p>3.3.1　在数组末尾插入元素</p>\n<p>如果想要给数组添加一个元素（比如 10），只要把值赋给数组中最后一个空位上的元素即可。</p>\n<p>numbers[numbers.length] = 10;</p>\n<p>在 JavaScript 中，数组是一个可以修改的对象。如果添加元素，它就会动态增长。在 C 和 Java 等其他语言里，我们要决定数组的大小，想添加元素就要创建一个全新的数组，不能简单地往其中添加所需的元素。</p>\n<p>使用 push 方法</p>\n<p>另外，还有一个 push 方法，能把元素添加到数组的末尾。通过 push 方法，我们能添加任意个元素。</p>\n<p>numbers.push(11); numbers.push(12, 13);</p>\n<p>如果输出 numbers 的话，就会看到从 0 到 13 的值。</p>\n<p>3.3.2　在数组开头插入元素</p>\n<p>现在，我们希望在数组中插入一个新元素（数 - 1），不像之前那样插入到最后，而是放到数组的开头。为了实现这个需求，首先要腾出数组里第一个元素的位置，把所有的元素向右移动一位。我们可以循环数组中的元素，从最后一位（长度值就是数组的末尾位置）开始，将对应的前一个元素（i-1）的值赋给它（i），依次处理，最后把我们想要的值赋给第一个位置（索引 0）上。我们可以将这段逻辑写成一个函数，甚至将该方法直接添加在 Array 的原型上，使所有数组的实例都可以访问到该方法。下面的代码表现了这段逻辑。</p>\n<p>Array.prototype.insertFirstPosition = function(value) { for (let i = this.length; i &gt;= 0; i--) { this[i] = this[i - 1]; } this[0] = value; }; numbers.insertFirstPosition(-1);</p>\n<p>下图描述了我们刚才的操作过程。</p>\n<p>使用 unshift 方法</p>\n<p>在 JavaScript 里，数组有一个方法叫 unshift，可以直接把数值插入数组的开头（此方法背后的逻辑和 insertFirstPosition 方法的行为是一样的）。</p>\n<p>numbers.unshift(-2); numbers.unshift(-4, -3);</p>\n<p>那么，用 unshift 方法，我们就可以在数组的开始处添加值 - 2，然后添加 - 3、-4 等。这样数组就会输出数 - 4 到 13。</p>\n<p>3.4　删除元素</p>\n<p>目前为止，我们已经学习了如何给数组的开始和结尾位置添加元素。下面来看一下怎样从数组中删除元素。</p>\n<p>3.4.1　从数组末尾删除元素</p>\n<p>要删除数组里最靠后的元素，可以用 pop 方法。</p>\n<p>numbers.pop();</p>\n<p>通过 push 和 pop 方法，就能用数组来模拟栈，你将在下一章看到这部分内容。</p>\n<p>现在，数组输出的数是 - 4 到 12，数组的长度是 17。</p>\n<p>3.4.2　从数组开头删除元素</p>\n<p>如果要移除数组里的第一个元素，可以用下面的代码。</p>\n<p numbers[i]=\"\">for (let i = 0; i &lt; numbers.length; i++)</p>\n<p>下图呈现了这段代码的执行过程。</p>\n<p>我们把数组里所有的元素都左移了一位，但数组的长度依然是 17，这意味着数组中有额外的一个元素（值是 undefined）。在最后一次循环里，i+1 引用了数组里还未初始化的一个位置。在 Java、C/C + 或 C# 等一些语言里，这样写可能会抛出异常，因此不得不在 numbers.length- 1 处停止循环。</p>\n<p>可以看到，我们只是把数组第一位的值用第二位覆盖了，并没有删除元素（因为数组的长度和之前还是一样的，并且多了一个未定义元素）。</p>\n<p>要从数组中移除这个值，还可以创建一个包含刚才所讨论逻辑的方法，叫作 removeFirstPosition。但是，要真正从数组中移除这个元素，我们需要创建一个新的数组，将所有不是 undefined 的值从原来的数组复制到新的数组中，并且将这个新的数组赋值给我们的数组。要完成这项工作，也可以像下面这样创建一个 reIndex 方法。</p>\n<p>Array.prototype.reIndex = function (myArray) { const newArray = []; for (let i = 0; i &lt; myArray.length; i++ ) { if (myArray [i] !== undefined) { //console.log (myArray [i]); newArray.push (myArray [i]); } } return newArray; } // 手动移除第一个元素并重新排序 Array.prototype.removeFirstPosition = function () { for (let i = 0; i &lt; this.length; i++) { this [i] = this [i + 1]; } return this.reIndex (this); }; numbers = numbers.removeFirstPosition ();</p>\n<p>上面的代码只应该用作示范，不应该在真实项目中使用。要从数组开头删除元素，我们应该始终使用 shift 方法，这将在下一节中展示。</p>\n<p>使用 shift 方法</p>\n<p>要删除数组的第一个元素，可以用 shift 方法实现。</p>\n<p>numbers.shift();</p>\n<p>假如本来数组中的值是从 - 4 到 12，长度为 17。执行了上述代码后，数组就只有 - 3 到 12 了，长度也会减小到 16。</p>\n<p>通过 shift 和 unshift 方法，我们就能用数组模拟基本的队列数据结构，第 5 章会讲到。</p>\n<p>3.5　在任意位置添加或删除元素</p>\n<p>目前为止，我们已经学习了如何添加元素到数组的开头或末尾，以及怎样删除数组开头和结尾位置上的元素。那么如何在数组中的任意位置上删除或添加元素呢？</p>\n<p>我们可以使用 splice 方法，简单地通过指定位置 / 索引，就可以删除相应位置上指定数量的元素。</p>\n<p>numbers.splice(5,3);</p>\n<p>这行代码删除了从数组索引 5 开始的 3 个元素。这就意味着 numbers [5]、numbers [6] 和 numbers [7] 从数组中删除了。现在数组里的值变成了 - 3、-2、-1、0、1、5、6、7、8、9、10、11 和 12（2、3、4 已经被移除）。</p>\n<p>对于 JavaScript 数组和对象，我们还可以用 delete 运算符删除数组中的元素，例如 delete numbers [0]。然而，数组位置 0 的值会变成 undefined，也就是说，以上操作等同于 numbers [0] = undefined。因此，我们应该始终使用 splice、pop 或 shift（马上就会学到）方法来删除数组元素。</p>\n<p>现在，我们想把数 2、3、4 插入数组里，放到之前删除元素的位置上，可以再次使用 splice 方法。</p>\n<p>numbers.splice(5, 0, 2, 3, 4);</p>\n<p>splice 方法接收的第一个参数，表示想要删除或插入的元素的索引值。第二个参数是删除元素的个数（这个例子里，我们的目的不是删除元素，所以传入 0）。第三个参数往后，就是要添加到数组里的值（元素 2、3、4）。输出会发现值又变成了从 - 3 到 12。</p>\n<p>最后，执行以下这行代码。</p>\n<p>numbers.splice(5, 3, 2, 3, 4);</p>\n<p>输出的值是从 - 3 到 12。原因在于，我们从索引 5 开始删除了 3 个元素，但也从索引 5 开始添加了元素 2、3、4。</p>\n<p>3.6　二维和多维数组</p>\n<p>还记得本章开头平均气温测量的例子吗？现在我打算再用一下这个例子，不过把记录的数据改成数天内每小时的气温。现在我们已经知道可以用数组来保存这些数据，那么要保存两天内每小时的气温数据就可以这样做。</p>\n<p>let averageTempDay1 = [72, 75, 79, 79, 81, 81]; let averageTempDay2 = [81, 79, 75, 75, 73, 72];</p>\n<p>然而，这不是最好的方法，还可以做得更好。我们可以使用矩阵（二维数组，或数组的数组）来存储这些信息。矩阵的行保存每天的数据，列对应小时级别的数据。</p>\n<p>let averageTemp = []; averageTemp[0] = [72, 75, 79, 79, 81, 81]; averageTemp[1] = [81, 79, 75, 75, 73, 73];</p>\n<p>JavaScript 只支持一维数组，并不支持矩阵。但是，我们可以像上面的代码一样，用数组套数组，实现矩阵或任一多维数组。代码也可以写成如下这样。</p>\n<p>// day 1 averageTemp[0] = []; averageTemp[0][0] = 72; averageTemp[0][1] = 75; averageTemp[0][2] = 79; averageTemp[0][3] = 79; averageTemp[0][4] = 81; averageTemp[0][5] = 81; // day 2 averageTemp[1] = []; averageTemp[1][0] = 81; averageTemp[1][1] = 79; averageTemp[1][2] = 75; averageTemp[1][3] = 75; averageTemp[1][4] = 73; averageTemp[1][5] = 73;</p>\n<p>上面的代码里，我们分别指定了每天和每小时的数据。数组中的内容如下图所示。</p>\n<p>每行就是每天的数据，每列是当天不同时段的气温。</p>\n<p>3.6.1　迭代二维数组的元素</p>\n<p>如果想看这个矩阵的输出，可以创建一个通用函数，专门输出其中的值。</p>\n<p>function printMatrix(myMatrix) { for (let i = 0; i &lt; myMatrix.length; i++) { for (let j = 0; j &lt; myMatrix[i].length; j++) { console.log(myMatrix[i][j]); } } }</p>\n<p>我们需要迭代所有的行和列。因此，使用一个嵌套的 for 循环来处理，其中变量 i 为行，变量 j 为列。在这种情况下，每个 myMatrix [i] 同样代表一个数组，因此需要在嵌套的 for 循环中迭代 myMatrix [i] 的每个位置。</p>\n<p>可以使用以下代码来输出矩阵 averageTemp 的内容。</p>\n<p>printMatrix(averageTemp);</p>\n<p>要在浏览器控制台中打印二维数组，还可以使用 console.table (averageTemp) 语句。它会显示一个更加友好的输出结果。</p>\n<p>3.6.2　多维数组</p>\n<p>我们也可以用这种方式来处理多维数组。假设我们要创建一个 3 × 3 × 3 的矩阵，每一格里包含矩阵的 i（行）、j（列）及 z（深度）之和。</p>\n<p>const matrix3x3x3 = []; for (let i = 0; i &lt; 3; i++) { matrix3x3x3 [i] = []; // 我们需要初始化每个数组 for (let j = 0; j &lt; 3; j++) { matrix3x3x3 [i][j] = []; for (let z = 0; z &lt; 3; z++) { matrix3x3x3 [i][j][z] = i + j + z; } } }</p>\n<p>数据结构中有几个维度都没关系，我们可以用循环迭代每个维度来访问所有格子。3 × 3 × 3 的矩阵立体图如下所示。</p>\n<p>用以下代码输出这个矩阵的内容。</p>\n<p>for (let i = 0; i &lt; matrix3x3x3.length; i++) { for (let j = 0; j &lt; matrix3x3x3[i].length; j++) { for (let z = 0; z &lt; matrix3x3x3[i][j].length; z++) { console.log(matrix3x3x3[i][j][z]); } } }</p>\n<p>如果是一个 3 × 3 × 3 × 3 的矩阵，代码中就会用四层嵌套的 for 语句，以此类推。开发过程中很少会用到四维数组，二维数组是最常见的。</p>\n<p>3.7　JavaScript 的数组方法参考</p>\n<p>在 JavaScript 里，数组是经过改进的对象，这意味着创建的每个数组都有一些可用的方法。数组很有趣，因为它十分强大，并且相比其他语言中的数组，JavaScript 中的数组有许多很好用的方法。这样就不用再为它开发一些基本功能了，例如在数据结构的中间添加或删除元素。</p>\n<p>下表详述了数组的一些核心方法，其中的一些我们已经学习过了。</p>\n<p>方法</p>\n<p>描述</p>\n<p>concat</p>\n<p>连接 2 个或更多数组，并返回结果</p>\n<p>every</p>\n<p>对数组中的每个元素运行给定函数，如果该函数对每个元素都返回 true，则返回 true</p>\n<p>filter</p>\n<p>对数组中的每个元素运行给定函数，返回该函数会返回 true 的元素组成的数组</p>\n<p>forEach</p>\n<p>对数组中的每个元素运行给定函数。这个方法没有返回值</p>\n<p>join</p>\n<p>将所有的数组元素连接成一个字符串</p>\n<p>indexOf</p>\n<p>返回第一个与给定参数相等的数组元素的索引，没有找到则返回 - 1</p>\n<p>lastIndexOf</p>\n<p>返回在数组中搜索到的与给定参数相等的元素的索引里最大的值</p>\n<p>map</p>\n<p>对数组中的每个元素运行给定函数，返回每次函数调用的结果组成的数组</p>\n<p>reverse</p>\n<p>颠倒数组中元素的顺序，原先第一个元素现在变成最后一个，同样原先的最后一个元素变成了现在的第一个</p>\n<p>slice</p>\n<p>传入索引值，将数组里对应索引范围内的元素作为新数组返回</p>\n<p>some</p>\n<p>对数组中的每个元素运行给定函数，如果任一元素返回 true，则返回 true</p>\n<p>sort</p>\n<p>按照字母顺序对数组排序，支持传入指定排序方法的函数作为参数</p>\n<p>toString</p>\n<p>将数组作为字符串返回</p>\n<p>valueOf</p>\n<p>和 toString 类似，将数组作为字符串返回</p>\n<p>我们已经学过了 push、pop、shift、unshift 和 splice 方法。下面来看表格中提到的方法。在本书接下来的章节里，编写数据结构和算法时会大量用到这些方法。这其中的一些方法在函数式编程中是很有用的，我们将在第 14 章中学习到。</p>\n<p>3.7.1　数组合并</p>\n<p>考虑如下场景：有多个数组，需要合并起来成为一个数组。我们可以迭代各个数组，然后把每个元素加入最终的数组。幸运的是，JavaScript 已经给我们提供了解决方法，叫作 concat 方法。</p>\n<p>const zero = 0; const positiveNumbers = [1, 2, 3]; const negativeNumbers = [-3, -2, -1]; let numbers = negativeNumbers.concat(zero, positiveNumbers);</p>\n<p>concat 方法可以向一个数组传递数组、对象或是元素。数组会按照该方法传入的参数顺序连接指定数组。在这个例子里，zero 将被合并到 nagativeNumbers 中，然后 positiveNumbers 继续被合并。最后输出的结果是 - 3、-2、-1、0、1、2 和 3。</p>\n<p>3.7.2　迭代器函数</p>\n<p>有时，我们需要迭代数组中的元素。前面已经学过，可以用循环语句来处理，例如 for 语句。</p>\n<p>JavaScript 内置了许多数组可用的迭代方法。对于本节的例子，我们需要一个数组和一个函数：假设数组中的值是从 1 到 15；如果数组里的元素可以被 2 整除（偶数），函数就返回 true，否则返回 false。</p>\n<p>function isEven (x) { // 如果 x 是 2 的倍数，就返回 true console.log (x); return x % 2 === 0 ? true : false; } let numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];</p>\n<p>return (x % 2 === 0) ? true : false 也可以写成 return (x % 2 === 0)。</p>\n<p>为了简化代码，我们不使用 ES5 语法的函数声明，而是使用第 2 章中的 ES2015（ES6）语法。我们可以使用箭头函数来改写 isEven 函数。</p>\n<p>const isEven = x =&gt; x % 2 === 0;</p>\n<p>用 every 方法迭代</p>\n<p>我们要尝试的第一个方法是 every。every 方法会迭代数组中的每个元素，直到返回 false。</p>\n<p>numbers.every(isEven);</p>\n<p>在这个例子里，数组 numbers 的第一个元素是 1，它不是 2 的倍数（1 是奇数）， 因此 isEven 函数返回 false，然后 every 执行结束。</p>\n<p>用 some 方法迭代</p>\n<p>下一步，我们来看 some 方法。它和 every 的行为相反，会迭代数组的每个元素，直到函数返回 true。</p>\n<p>numbers.some(isEven);</p>\n<p>在我们的例子里，numbers 数组中第一个偶数是 2（第二个元素）。第一个被迭代的元素是 1，isEven 会返回 false。第二个被迭代的元素是 2，isEven 返回 true—— 迭代结束。</p>\n<p>用 forEach 方法迭代</p>\n<p>如果要迭代整个数组，可以用 forEach 方法。它和使用 for 循环的结果相同。</p>\n<p>numbers.forEach(x =&gt; console.log(x % 2 === 0));</p>\n<p>使用 map 和 filter 方法</p>\n<p>JavaScript 还有两个会返回新数组的迭代方法。第一个是 map。</p>\n<p>const myMap = numbers.map(isEven);</p>\n<p>数组 myMap 里的值是：[false, true, false, true, false, true, false, true, false, true, false, true, false, true, false]。它保存了传入 map 方法的 isEven 函数的运行结果。这样就很容易知道一个元素是否是偶数。比如，myMap [0] 是 false，因为 1 不是偶数；而 myMap [1] 是 true，因为 2 是偶数。</p>\n<p>还有一个 filter 方法，它返回的新数组由使函数返回 true 的元素组成。</p>\n<p>const evenNumbers = numbers.filter(isEven);</p>\n<p>在我们的例子里，evenNumbers 数组中的元素都是偶数：[2, 4, 6, 8, 10, 12, 14]。</p>\n<p>使用 reduce 方法</p>\n<p>最后是 reduce 方法。reduce 方法接收一个有如下四个参数的函数：previousValue、currentValue、index 和 array。因为 index 和 array 是可选的参数，所以如果用不到它们的话，可以不传。这个函数会返回一个将被叠加到累加器的值，reduce 方法停止执行后会返回这个累加器。如果要对一个数组中的所有元素求和，这就很有用。下面是一个例子。</p>\n<p>numbers.reduce((previous, current) =&gt; previous + current);</p>\n<p>输出将是 120。</p>\n<p>这三个方法（map、filter 和 reduce）是 JavaScript 函数式编程的基础，我们将在第 14 章了解到。</p>\n<p>3.7.3　ECMAScript 6 和数组的新功能</p>\n<p>第 1 章提到过，ECMAScript 2015（ES6 或 ES2015）和更新的规范（2015+）给 JavaScript 语言带来了新的功能。</p>\n<p>下表列出了 ES2015 和 ES2016 新增的数组方法。</p>\n<p>方法</p>\n<p>描述</p>\n<p>@@iterator</p>\n<p>返回一个包含数组键值对的迭代器对象，可以通过同步调用得到数组元素的键值对</p>\n<p>copyWithin</p>\n<p>复制数组中一系列元素到同一数组指定的起始位置</p>\n<p>entries</p>\n<p>返回包含数组所有键值对的 @@iterator</p>\n<p>includes</p>\n<p>如果数组中存在某个元素则返回 true，否则返回 false。E2016 新增</p>\n<p>find</p>\n<p>根据回调函数给定的条件从数组中查找元素，如果找到则返回该元素</p>\n<p>findIndex</p>\n<p>根据回调函数给定的条件从数组中查找元素，如果找到则返回该元素在数组中的索引</p>\n<p>fill</p>\n<p>用静态值填充数组</p>\n<p>from</p>\n<p>根据已有数组创建一个新数组</p>\n<p>keys</p>\n<p>返回包含数组所有索引的 @@iterator</p>\n<p>of</p>\n<p>根据传入的参数创建一个新数组</p>\n<p>values</p>\n<p>返回包含数组中所有值的 @@iterator</p>\n<p>除了这些新的方法，还有一种用 for...of 循环来迭代数组的新做法，以及可以从数组实例得到的迭代器对象。</p>\n<p>使用 for...of 循环迭代</p>\n<p>你已经学过用 for 循环和 forEach 方法迭代数组。ES2015 还引入了迭代数组值的 for...of 循环，下面来看看它的用法。</p>\n<p console.log(n=\"\" %=\"\" 2=\"\">for (const n of numbers)</p>\n<p>使用 @@iterator 对象</p>\n<p>ES2015 还为 Array 类增加了一个 @@iterator 属性，需要通过 Symbol.iterator 来访问。代码如下。</p>\n<p>let iterator = numbers<a href=\"\">Symbol.iterator</a>; console.log(iterator.next().value); // 1 console.log(iterator.next().value); // 2 console.log(iterator.next().value); // 3 console.log(iterator.next().value); // 4 console.log(iterator.next().value); // 5</p>\n<p>然后，不断调用迭代器的 next 方法，就能依次得到数组中的值。numbers 数组中有 15 个值，因此需要调用 15 次 iterator.next ().value。</p>\n<p>我们可以用下面的代码来输出 numbers 数组中的 15 个值。</p>\n<p console.log(n);=\"\">iterator = numbers<a href=\"\">Symbol.iterator</a>; for (const n of iterator)</p>\n<p>数组中的所有值都迭代完之后，iterator.next ().value 会返回 undefined。</p>\n<p>数组的 entries、keys 和 values 方法</p>\n<p>ES2015 还增加了三种从数组中得到迭代器的方法。我们首先要学习的是 entries 方法。</p>\n<p>entries 方法返回包含键值对的 @@iterator，下面是使用该方法的代码示例。</p>\n<p>let aEntries = numbers.entries (); // 得到键值对的迭代器 console.log (aEntries.next ().value); // [0, 1] - 位置 0 的值为 1 console.log (aEntries.next ().value); // [1, 2] - 位置 1 的值为 2 console.log (aEntries.next ().value); // [2, 3] - 位置 2 的值为 3</p>\n<p>numbers 数组中都是数，key 是数组中的位置，value 是保存在数组索引的值。</p>\n<p>我们也可以使用下面的代码。</p>\n<p console.log(n);=\"\">aEntries = numbers.entries(); for (const n of aEntries)</p>\n<p>使用集合、字典、散列表等数据结构时，能够取出键值对是很有用的。这个功能会在本书后面的章节中大显身手。</p>\n<p>keys 方法返回包含数组索引的 @@iterator，下面是使用该方法的代码示例。</p>\n<p value:=\"\" 2,=\"\" done:=\"\" false=\"\">const aKeys = numbers.keys (); // 得到数组索引的迭代器 console.log (aKeys.next ()); // {value: 0, done: false } console.log (aKeys.next ()); // {value: 1, done: false } console.log (aKeys.next ()); //</p>\n<p>keys 方法会返回 numbers 数组的索引。一旦没有可迭代的值，aKeys.next () 就会返回一个 value 属性为 undefined、done 属性为 true 的对象。如果 done 属性的值为 false，就意味着还有可迭代的值。</p>\n<p>values 方法返回的 @@iterator 则包含数组的值。使用这个方法的代码示例如下。</p>\n<p value:=\"\" 3,=\"\" done:=\"\" false=\"\">const aValues = numbers.values(); console.log(aValues.next()); // {value: 1, done: false } console.log(aValues.next()); // {value: 2, done: false } console.log(aValues.next()); //</p>\n<p>记住，当前的浏览器还没有完全支持 ES2015 的新功能。因此，测试这些代码最好的办法是使用 Babel。访问 http://t.cn/EGE4fTB 查看和运行示例。</p>\n<p>使用 from 方法</p>\n<p>Array.from 方法根据已有的数组创建一个新数组。比如，要复制 numbers 数组，可以如下这样做。</p>\n<p>let numbers2 = Array.from(numbers);</p>\n<p>还可以传入一个用来过滤值的函数，例子如下。</p>\n<p>let evens = Array.from(numbers, x =&gt; (x % 2 == 0));</p>\n<p>上面的代码会创建一个 evens 数组，以及值 true（如果在原数组中为偶数）或 false（如果在原数组中为奇数）。</p>\n<p>使用 Array.of 方法</p>\n<p>Array.of 方法根据传入的参数创建一个新数组。以下面的代码为例。</p>\n<p>let numbers3 = Array.of(1); let numbers4 = Array.of(1, 2, 3, 4, 5, 6);</p>\n<p>它和下面这段代码的效果一样。</p>\n<p>let numbers3 = [1]; let numbers4 = [1, 2, 3, 4, 5, 6];</p>\n<p>我们也可以用该方法复制已有的数组，如下所示。</p>\n<p>let numbersCopy = Array.of(...numbers4);</p>\n<p>上面的代码和 Array.from (numbers4) 的效果是一样的，区别只是用到了第 1 章讲过的展开运算符。展开运算符（...）会把 numbers4 数组里的值都展开成参数。</p>\n<p>使用 fill 方法</p>\n<p>fill 方法用静态值填充数组。以下面的代码为例。</p>\n<p>let numbersCopy = Array.of(1, 2, 3, 4, 5, 6);</p>\n<p>numbersCopy 数组的 length 是 6，也就是有 6 个位置。再看下面的代码。</p>\n<p>numbersCopy.fill(0);</p>\n<p>numbersCopy 数组所有位置上的值都会变成 0（[0, 0, 0, 0, 0, 0]）。我们还可以指定开始填充的索引，如下所示。</p>\n<p>numbersCopy.fill(2, 1);</p>\n<p>上面的例子里，数组中从 1 开始的所有位置上的值都是 2（[0, 2, 2, 2, 2, 2]）。</p>\n<p>同样，我们也可以指定结束填充的索引。</p>\n<p>numbersCopy.fill(1, 3, 5);</p>\n<p>在上面的例子里，我们会把 1 填充到数组索引 3 到 5 的位置（不包括 3 和 5），得到的数组为 [0, 2, 2, 1, 1, 2]。</p>\n<p>创建数组并初始化值的时候，fill 方法非常好用，就像下面这样。</p>\n<p>let ones = Array(6).fill(1);</p>\n<p>上面的代码创建了一个长度为 6、所有值都是 1 的数组（[1, 1, 1, 1, 1, 1]）。</p>\n<p>使用 copyWithin 方法</p>\n<p>copyWithin 方法复制数组中的一系列元素到同一数组指定的起始位置。看看下面这个例子。</p>\n<p>let copyArray = [1, 2, 3, 4, 5, 6];</p>\n<p>假如我们想把 4、5、6 三个值复制到数组前三个位置，得到 [4, 5, 6, 4, 5, 6] 这个数组，可以用下面的代码达到目的。</p>\n<p>copyArray.copyWithin(0, 3);</p>\n<p>假如我们想把 4、5 两个值（在位置 3 和 4 上）复制到位置 1 和 2，可以这样做：</p>\n<p>copyArray = [1, 2, 3, 4, 5, 6]; copyArray.copyWithin(1, 3, 5);</p>\n<p>这种情况下，会把从位置 3 开始到位置 5 结束（不包括 3 和 5）的元素复制到位置 1，结果是得到数组 [1, 4, 5, 4, 5, 6]。</p>\n<p>3.7.4　排序元素</p>\n<p>通过本书，我们能学到如何编写最常用的搜索和排序算法。其实，JavaScript 里也提供了一个排序方法和一组搜索方法。让我们来看看。</p>\n<p>首先，我们想反序输出数组 numbers（它本来的排序是 1, 2, 3, 4, ..., 15）。要实现这样的功能，可以用 reverse 方法，然后数组内元素就会反序。</p>\n<p>numbers.reverse();</p>\n<p>现在，输出 numbers 的话就会看到 [15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]。然后，我们使用 sort 方法。</p>\n<p>numbers.sort();</p>\n<p>然而，如果输出数组，结果会是 [1, 10, 11, 12, 13, 14, 15, 2, 3, 4, 5, 6, 7, 8, 9]。看起来不大对，是吧？这是因为 sort 方法在对数组做排序时，把元素默认成字符串进行相互比较。</p>\n<p>我们可以传入自己写的比较函数。因为数组里都是数，所以可以像下面这样写。</p>\n<p>numbers.sort((a, b) =&gt; a - b);</p>\n<p>在 b 大于 a 时，这段代码会返回负数，反之则返回正数。如果相等的话，就会返回 0。也就是说返回的是负数，就说明 a 比 b 小，这样 sort 就能根据返回值的情况对数组进行排序。</p>\n<p>之前的代码也可以表示成如下这样，会更清晰一些。</p>\n<p>function compare (a, b) { if (a &lt; b) { return -1; } if (a &gt; b) { return 1; } //a 必须等于 b return 0; } numbers.sort (compare);</p>\n<p>这是因为 JavaScript 的 sort 方法接收 compareFunction 作为参数，然后 sort 会用它排序数组。在这个例子里，我们声明了一个用来比较数组元素的函数，使数组按升序排序。</p>\n<p>自定义排序</p>\n<p>我们可以对任何对象类型的数组排序，也可以创建 compareFunction 来比较元素。例如，对象 Person 有名字和年龄属性，我们希望根据年龄排序，就可以这么写。</p>\n<p>const friends = [{ name: 'John', age: 30}, { name: 'Ana', age: 20 }, { name: 'Chris', age: 25 }, // ES2017 允许存在尾逗号 ]; function comparePerson (a, b) { if (a.age &lt; b.age) { return -1; } if (a.age &gt; b.age) { return 1; } return 0; } console.log (friends.sort (comparePerson));</p>\n<p>在这个例子里，最后会输出 Ana (20), Chris (25), John (30)。</p>\n<p>字符串排序</p>\n<p>假如有这样一个数组。</p>\n<p>let names = ['Ana', 'ana', 'john', 'John']; console.log(names.sort());</p>\n<p>你猜会输出什么？答案如下所示。</p>\n<p>[&quot;Ana&quot;, &quot;John&quot;, &quot;ana&quot;, &quot;john&quot;]</p>\n<p>既然 a 在字母表里排第一位，为何 ana 却排在了 John 之后呢？这是因为 JavaScript 在做字符比较的时候，是根据字符对应的 ASCII 值来比较的。例如，A、J、a、j 对应的 ASCII 值分别是 65、74、97、106。</p>\n<p>虽然 a 在字母表里是最靠前的，但 J 的 ASCII 值比 a 的小，所以排在了 a 前面。</p>\n<p>想了解更多关于 ASCII 表的信息，请访问 http://www.asciitable.com/。</p>\n<p>现在，如果给 sort 传入一个忽略大小写的比较函数，将输出 [&quot;Ana&quot;, &quot;ana&quot;, &quot;John&quot;, &quot;john&quot;]。</p>\n<p>names = ['Ana', 'ana', 'john', 'John']; // 重置数组的初始状态 console.log (names.sort ((a, b) =&gt; { if (a.toLowerCase () &lt; b.toLowerCase ()) { return -1; } if (a.toLowerCase () &gt; b.toLowerCase ()) { return 1; } return 0; }));</p>\n<p>在这种情况下，sort 函数不会有任何作用。它会按照现在的大小写字母顺序排序。</p>\n<p>如果希望小写字母排在前面，那么需要使用 localeCompare 方法。</p>\n<p>names.sort((a, b) =&gt; a.localeCompare(b));</p>\n<p>输出结果将是 [&quot;ana&quot;, &quot;Ana&quot;, &quot;john&quot;, &quot;John&quot;]。</p>\n<p>假如对带有重音符号的字符做排序的话，也可以用 localeCompare 来实现。</p>\n<p>const names2 = ['Maève', 'Maeve']; console.log(names2.sort((a, b) =&gt; a.localeCompare(b)));</p>\n<p>最后输出的结果将是 [&quot;Maeve&quot;, &quot;Maève&quot;]。</p>\n<p>3.7.5　搜索</p>\n<p>搜索有两个方法：indexOf 方法返回与参数匹配的第一个元素的索引；lastIndexOf 返回与参数匹配的最后一个元素的索引。我们来看看之前用过的 numbers 数组。</p>\n<p>console.log(numbers.indexOf(10)); console.log(numbers.indexOf(100));</p>\n<p>在这个示例中，第一行的输出是 9，第二行的输出是 - 1（因为 100 不在数组里）。下面的代码会返回同样的结果。</p>\n<p>numbers.push(10); console.log(numbers.lastIndexOf(10)); console.log(numbers.lastIndexOf(100));</p>\n<p>我们往数组里加入了一个新的元素 10，因此第二行会输出 15（数组中的元素是 1 到 15，还有 10），第三行会输出 - 1（因为 100 不在数组里）。</p>\n<p>ECMAScript 2015——find 和 findIndex 方法</p>\n<p>看看下面这个例子。</p>\n<p>let numbers = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]; function multipleOf13(element, index, array) { return (element % 13 == 0); } console.log(numbers.find(multipleOf13)); console.log(numbers.findIndex(multipleOf13));</p>\n<p>find 和 findIndex 方法接收一个回调函数，搜索一个满足回调函数条件的值。上面的例子里，我们要从数组里找一个 13 的倍数。</p>\n<p>find 和 findIndex 的不同之处在于，find 方法返回第一个满足条件的值，findIndex 方法则返回这个值在数组里的索引。如果没有满足条件的值，find 会返回 undefined，而 findIndex 返回 - 1。</p>\n<p>ECMAScript 7—— 使用 includes 方法</p>\n<p>如果数组里存在某个元素，includes 方法会返回 true，否则返回 false。使用 includes 方法的例子如下。</p>\n<p>console.log(numbers.includes(15)); console.log(numbers.includes(20));</p>\n<p>例子里的 includes (15) 返回 true，includes (20) 返回 false，因为 numbers 数组里没有 20。</p>\n<p>如果给 includes 方法传入一个起始索引，搜索会从索引指定的位置开始。</p>\n<p>let numbers2 = [7,6,5,4,3,2,1]; console.log(numbers2.includes(4,5));</p>\n<p>上面的例子输出为 false，因为数组索引 5 之后的元素不包含 4。</p>\n<p>3.7.6　输出数组为字符串</p>\n<p>现在，我们学习最后两个方法：toString 和 join。</p>\n<p>如果想把数组里所有元素输出为一个字符串，可以用 toString 方法。</p>\n<p>console.log(numbers.toString());</p>\n<p>1、2、3、4、5、6、7、8、9、10、11、12、13、14、15 和 10 这些值都会在控制台中输出。</p>\n<p>如果想用一个不同的分隔符（比如 -）把元素隔开，可以用 join 方法。</p>\n<p>const numbersString = numbers.join('-'); console.log(numbersString);</p>\n<p>输出将如下所示。</p>\n<p>1-2-3-4-5-6-7-8-9-10-11-12-13-14-15-10</p>\n<p>如果要把数组内容发送到服务器，或进行编码（知道了分隔符，解码也很容易），这会很有用。</p>\n<p>有一些很棒的资源可以帮助你更深入地了解数组及其方法。Mozilla 关于数组及其方法的页面非常棒，还有不错的例子：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvQXJyYXklRTMlODAlODJMby1EYXNoJUU0JUI5JTlGJUU2JTk4JUFGJUU0JUI4JTgwJUU0JUI4JUFBJUU1JTlDJUE4JUU1JUE0JTg0JUU3JTkwJTg2JUU2JTk1JUIwJUU3JUJCJTg0JUU2JTk2JUI5JUU5JTlEJUEyJUU5JTlEJTlFJUU1JUI4JUI4JUU2JTlDJTg5JUU3JTk0JUE4JUU3JTlBJTg0JUU1JUJBJTkzJUUzJTgwJTgy\">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array。Lo-Dash 也是一个在处理数组方面非常有用的库。</span></p>\n<p>3.8　类型数组</p>\n<p>与 C 和 Java 等其他语言不同，JavaScript 数组不是强类型的，因此它可以存储任意类型的数据。</p>\n<p>类型数组则用于存储单一类型的数据。它的语法是 let myArray = new TypedArray (length)，其中 TypedArray 需替换为下表所列之一。</p>\n<p>类型数组</p>\n<p>数据类型</p>\n<p>Int8Array</p>\n<p>8 位二进制补码整数</p>\n<p>Uint8Array</p>\n<p>8 位无符号整数</p>\n<p>Uint8ClampedArray</p>\n<p>8 位无符号整数</p>\n<p>Int16Array</p>\n<p>16 位二进制补码整数</p>\n<p>Uint16Array</p>\n<p>16 位无符号整数</p>\n<p>Int32Array</p>\n<p>32 位二进制补码整数</p>\n<p>Uint32Array</p>\n<p>32 位无符号整数</p>\n<p>Float32Array</p>\n<p>32 位 IEEE 浮点数</p>\n<p>Float64Array</p>\n<p>64 位 IEEE 浮点数</p>\n<p>代码示例如下。</p>\n<p>let length = 5; let int16 = new Int16Array(length); let array16 = []; array16.length = length; for (let i=0; i&lt;length; i++){ int16[i] = i+1; } console.log(int16);</p>\n<p>使用 WebGL API、进行位操作、处理文件和图像时，类型数组都可以大展拳脚。它用起来和普通数组毫无二致，本章所学的数组方法和功能都可以用于类型数组。</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHRtbDVyb2Nrcy5jb20vZW4vdHV0b3JpYWxzL3dlYmdsL3R5cGVkX2FycmF5cy8lRTYlOTglQUYlRTQlQjglODAlRTQlQjglQUElRTUlQkUlODglRTUlQTUlQkQlRTclOUElODQlRTYlOTUlOTklRTclQTglOEIlRUYlQkMlOEMlRTglQUUlQjIlRTglQTclQTMlRTQlQkElODYlRTUlQTYlODIlRTQlQkQlOTUlRTQlQkQlQkYlRTclOTQlQTglRTclQjElQkIlRTUlOUUlOEIlRTYlOTUlQjAlRTclQkIlODQlRTUlQTQlODQlRTclOTAlODYlRTQlQkElOEMlRTglQkYlOUIlRTUlODglQjYlRTYlOTUlQjAlRTYlOEQlQUUlRUYlQkMlOEMlRTQlQkIlQTUlRTUlOEYlOEElRTUlQUUlODMlRTUlOUMlQTglRTUlQUUlOUUlRTklOTklODUlRTklQTElQjklRTclOUIlQUUlRTQlQjglQUQlRTclOUElODQlRTUlQkElOTQlRTclOTQlQTglRTMlODAlODI=\">https://www.html5rocks.com/en/tutorials/webgl/typed_arrays/ 是一个很好的教程，讲解了如何使用类型数组处理二进制数据，以及它在实际项目中的应用。</span></p>\n<p>3.9　TypeScript 中的数组</p>\n<p>本章的所有源代码都是合法的 TypeScript 代码。区别在于 TypeScript 会在编译时进行类型检测，来确保只对所有值都属于相同数据类型的数组进行操作。</p>\n<p>如果检查下面这段代码，会发现它和本章前几节声明的 numbers 数组是一样的。</p>\n<p>const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];</p>\n<p>根据类型推断，TypeScript 能够理解 numbers 数组的声明和 const numbers: number [] 是一样的。出于这个原因，如果我们在声明时给变量赋了初始值，就不需要每次都显式声明变量的类型了。</p>\n<p>回到对 friends 数组的排序示例，我们可以用 TypeScript 将代码重构成如下这样。</p>\n<p comparePerson函数的内容=\"\">interface Person { name: string; age: number; } // const friends: {name: string, age: number}[]; const friends = [ { name: 'John', age: 30 }, { name: 'Ana', age: 20 }, { name: 'Chris', age: 25 } ]; function comparePerson(a: Person, b: Person)</p>\n<p>通过声明 Person 接口，我们确保了 comparePerson 函数只接收包含 name 和 age 属性的对象。friends 数组没有显式的类型，因此可以在本例中通过 const friends: Person [] 显式声明它的类型。</p>\n<p>总之，如果想用 TypeScript 给 JavaScript 变量设置类型，我们只需要使用 const 或 let variableName: &lt;type&gt;[]，抑或像我们在第 1 章中学习到的，在使用.js 扩展名的文件时，在第一行添加注释 // @ts-check。</p>\n<p>在运行时，输出结果和使用纯 JavaScript 时是一样的。</p>\n<p>3.10　小结</p>\n<p>本章，我们学习了最常用的数据结构：数组。不仅学习了如何声明和初始化数组、给数组赋值，以及添加和删除数组元素，还学习了二维、多维数组以及数组的主要方法。这对我们在后面章节中编写自己的算法很有用。</p>\n<p>我们还学习了 ES2015 和 ES2016 规范新增的 Array 方法和功能。</p>\n<p>最后，我们学习了怎样使用 TypeScript 或 TypeScript 的编译时检测功能来确保 JavaScript 文件中的数组只包含具有相同类型的值。</p>\n<p>下一章，我们将学习栈，可以把它当作一种具有特殊行为的数组。</p>\n<h1 id=\"第-4-章-栈\"><a class=\"anchor\" href=\"#第-4-章-栈\">#</a> 第 4 章　栈</h1>\n<p>上一章，我们学习了如何创建和使用计算机科学中最常用的数据结构 —— 数组。我们知道，可以在数组的任意位置上删除或添加元素。然而，有时候还需要一种能在添加或删除元素时进行更多控制的数据结构。有两种类似于数组的数据结构在添加和删除元素时更为可控，它们就是栈和队列。</p>\n<p>本章内容包括：</p>\n<p>创建我们自己的 JavaScript 数据结构库</p>\n<p>栈数据结构</p>\n<p>向栈添加元素</p>\n<p>从栈移除元素</p>\n<p>如何使用 Stack 类</p>\n<p>十进制转二进制</p>\n<p>4.1　创建一个 JavaScript 数据结构和算法库</p>\n<p>从本章开始，我们将要创建自己的 JavaScript 数据结构和算法库。本书的源代码包为本任务做好了准备。</p>\n<p>下载完源代码，并按照第 1 章的介绍安装好 Node.js 后，将当前目录切换至本项目的目录并运行命令 npm install，如下图所示。</p>\n<p>所有依赖都安装好后（node_modules），你就可以使用脚本来进行测试，生成测试覆盖率报告，以及生成一个叫作 PacktDataStructuresAlgorithms.min.js 的文件，它包含我们从本章开始创建的所有源代码。下图展示了我们的库中已有的文件和本章将要创建的一些文件。</p>\n<p>本章将要创建的文件可以在 src/js 目录中找到，它们已经被分类了。在另一个 test 目录中，你能找到和 src 目录中原始文件对应的 spec.js 文件。这些文件包含使用了名为 Mocha 的 JavaScript 测试框架的测试代码。另外，对于每个 JavaScript 文件，你都可以在 ts 目录中找到对应的 TypeScript 文件。要执行测试，只需要执行 npm run test 命令；要执行测试并查看测试覆盖率报告（源代码被测试代码覆盖的百分比），你可以执行 npm run dev 命令。如果你使用的编辑器是 Visual Studio Code 的话，也能找到用来调试测试代码的脚本。你只需在需要的位置添加好断点并执行 Mocha TS 或 Mocha JS 调试任务。在 package.json 文件中，你可以找到一条 npm run webpack 命令，它用来生成 PacktDataStructuresAlgorithms.min.js 文件，该文件可以用在我们的 HTML 示例中。这条脚本用到了 Webpack，它是一个可用于解析所有 ECMAScript 2015 + 模块依赖、使用 Babel 转译源代码、将所有 JavaScript 文件打包到一个单独的文件中，并能兼容于浏览器和 Node.js 环境的工具。我们在第 2 章中学习过它。关于其他可以使用的脚本命令，更多信息可以在 README.md 文件中找到。</p>\n<p>下载代码包的详细步骤在前言中提到过，你可以看一看。本书的代码包同样可以在 GitHub 地址 https://github.com/loiane/javascript-datastructures-algorithms 下载。</p>\n<p>4.2　栈数据结构</p>\n<p>栈是一种遵从后进先出（LIFO）原则的有序集合。新添加或待删除的元素都保存在栈的同一端，称作栈顶，另一端就叫栈底。在栈里，新元素都靠近栈顶，旧元素都接近栈底。</p>\n<p>在现实生活中也能发现很多栈的例子。例如，下图里的一摞书或者餐厅里叠放的盘子。</p>\n<p>栈也被用在编程语言的编译器和内存中保存变量、方法调用等，也被用于浏览器历史记录（浏览器的返回按钮）。</p>\n<p>4.2.1　创建一个基于数组的栈</p>\n<p>我们将创建一个类来表示栈。简单地从创建一个 stack-array.js 文件并声明 Stack 类开始。</p>\n<p>class Stack { constructor() { this.items = []; // {1} } }</p>\n<p>我们需要一种数据结构来保存栈里的元素。可以选择数组（行 {1}）。数组允许我们在任何位置添加或删除元素。由于栈遵循 LIFO 原则，需要对元素的插入和删除功能进行限制。接下来，要为栈声明一些方法。</p>\n<p>push (element (s))：添加一个（或几个）新元素到栈顶。</p>\n<p>pop ()：移除栈顶的元素，同时返回被移除的元素。</p>\n<p>peek ()：返回栈顶的元素，不对栈做任何修改（该方法不会移除栈顶的元素，仅仅返回它）。</p>\n<p>isEmpty ()：如果栈里没有任何元素就返回 true，否则返回 false。</p>\n<p>clear ()：移除栈里的所有元素。</p>\n<p>size ()：返回栈里的元素个数。该方法和数组的 length 属性很类似。</p>\n<p>4.2.2　向栈添加元素</p>\n<p>我们要实现的第一个方法是 push。该方法负责往栈里添加新元素，有一点很重要：该方法只添加元素到栈顶，也就是栈的末尾。push 方法可以如下这样写。</p>\n<p this.items.push(element);=\"\">push(element)</p>\n<p>因为我们使用了数组来保存栈里的元素，所以可以用上一章学到的数组的 push 方法来实现。</p>\n<p>4.2.3　从栈移除元素</p>\n<p>接着，我们来实现 pop 方法。该方法主要用来移除栈里的元素。栈遵从 LIFO 原则，因此移出的是最后添加进去的元素。因此，我们可以用上一章讲数组时介绍的 pop 方法。栈的 pop 方法可以这样写：</p>\n<p return=\"\" this.items.pop();=\"\">pop()</p>\n<p>只能用 push 和 pop 方法添加和删除栈中元素，这样一来，我们的栈自然就遵从了 LIFO 原则。</p>\n<p>4.2.4　查看栈顶元素</p>\n<p>现在，为我们的类实现一些额外的辅助方法。如果想知道栈里最后添加的元素是什么，可以用 peek 方法。该方法将返回栈顶的元素。</p>\n<p return=\"\" this.items[this.items.length=\"\" -=\"\" 1];=\"\">peek()</p>\n<p>因为类内部是用数组保存元素的，所以访问数组的最后一个元素可以用 length - 1。</p>\n<p>在上图中，有一个包含三个元素的栈，因此内部数组的长度就是 3。数组中最后一项的位置是 2，而 length - 1（3 - 1）正好是 2。</p>\n<p>4.2.5　检查栈是否为空</p>\n<p>下一个要实现的方法是 isEmpty，如果栈为空的话将返回 true，否则就返回 false。</p>\n<p return=\"\" this.items.length=\"\">isEmpty()</p>\n<p>使用 isEmpty 方法，我们能简单地判断内部数组的长度是否为 0。</p>\n<p>类似于数组的 length 属性，我们也能实现栈的 length。对于集合，最好用 size 代替 length。因为栈的内部使用数组保存元素，所以能简单地返回栈的长度。</p>\n<p return=\"\" this.items.length;=\"\">size()</p>\n<p>4.2.6　清空栈元素</p>\n<p>最后，我们来实现 clear 方法。clear 方法用来移除栈里所有的元素，把栈清空。实现该方法最简单的方式如下。</p>\n<p this.items=\"\">clear()</p>\n<p>也可以多次调用 pop 方法，把数组中的元素全部移除。</p>\n<p>完成了！栈已经实现。</p>\n<p>4.2.7　使用 Stack 类</p>\n<p>在深入了解栈的应用前，我们先来学习如何使用 Stack 类。首先需要初始化 Stack 类，然后验证一下栈是否为空（输出是 true，因为还没有往栈里添加元素）。</p>\n<p>const stack = new Stack (); console.log (stack.isEmpty ()); // 输出为 true</p>\n<p>接下来，往栈里添加一些元素（这里我们添加数字 5 和 8；你可以添加任意类型的元素）。</p>\n<p>stack.push(5); stack.push(8);</p>\n<p>如果调用 peek 方法，将输出 8，因为它是往栈里添加的最后一个元素。</p>\n<p>console.log (stack.peek ()); // 输出 8</p>\n<p>再添加一个元素。</p>\n<p>stack.push (11); console.log (stack.size ()); // 输出 3 console.log (stack.isEmpty ()); // 输出 false</p>\n<p>我们往栈里添加了 11。如果调用 size 方法，输出为 3，因为栈里有三个元素（5、8 和 11）。如果我们调用 isEmpty 方法，会看到输出了 false（因为栈里有三个元素，不是空栈）。最后，我们再添加一个元素。</p>\n<p>stack.push(15);</p>\n<p>下图描绘了目前为止我们对栈的操作，以及栈的当前状态。</p>\n<p>然后，调用两次 pop 方法从栈里移除两个元素。</p>\n<p>stack.pop (); stack.pop (); console.log (stack.size ()); // 输出 2</p>\n<p>在两次调用 pop 方法前，我们的栈里有四个元素。调用两次后，现在栈里仅剩下 5 和 8 了。下图描绘了这个执行过程。</p>\n<p>4.3　创建一个基于 JavaScript 对象的 Stack 类</p>\n<p>创建一个 Stack 类最简单的方式是使用一个数组来存储其元素。在处理大量数据的时候（这在现实生活中的项目里很常见），我们同样需要评估如何操作数据是最高效的。在使用数组时，大部分方法的时间复杂度是 O (n)。第 15 章我们将学习到更多有关算法复杂度的知识。O (n) 的意思是，我们需要迭代整个数组直到找到要找的那个元素，在最坏的情况下需要迭代数组的所有位置，其中的 n 代表数组的长度。如果数组有更多元素的话，所需的时间会更长。另外，数组是元素的一个有序集合，为了保证元素排列有序，它会占用更多的内存空间。</p>\n<p>如果我们能直接获取元素，占用较少的内存空间，并且仍然保证所有元素按照我们的需要排列，那不是更好吗？对于使用 JavaScript 语言实现栈数据结构的场景，我们也可以使用一个 JavaScript 对象来存储所有的栈元素，保证它们的顺序并且遵循 LIFO 原则。我们来看看如何实现这样的行为。</p>\n<p>首先像下面这样声明一个 Stack 类（stack.js 文件）。</p>\n<p>class Stack {constructor () { this.count = 0; this.items = {}; } // 方法 }</p>\n<p>在这个版本的 Stack 类中，我们将使用一个 count 属性来帮助我们记录栈的大小（也能帮助我们从数据结构中添加和删除元素）。</p>\n<p>4.3.1　向栈中插入元素</p>\n<p>在基于数组的版本中，我们可以同时向 Stack 类中添加多个元素。由于现在使用了一个对象，这个版本的 push 方法只允许我们一次插入一个元素。下面是 push 方法的代码。</p>\n<p this.items[this.count]=\"\" class=\"element;thiscount++;\">push(element)</p>\n<p>在 JavaScript 中，对象是一系列键值对的集合。要向栈中添加元素，我们将使用 count 变量作为 items 对象的键名，插入的元素则是它的值。在向栈插入元素后，我们递增 count 变量。</p>\n<p>可以延用之前的示例来使用 Stack 类，并向其中插入元素 5 和 8。</p>\n<p>const stack = new Stack(); stack.push(5); stack.push(8);</p>\n<p>在内部，items 包含的值和 count 属性如下所示。</p>\n<p>items = { 0: 5, 1: 8 }; count = 2;</p>\n<p>4.3.2　验证一个栈是否为空和它的大小</p>\n<p>count 属性也表示栈的大小。因此，我们可以简单地返回 count 属性的值来实现 size 方法。</p>\n<p return=\"\" this.count;=\"\">size()</p>\n<p>要验证栈是否为空，可以像下面这样判断 count 的值是否为 0。</p>\n<p return=\"\" this.count=\"\">isEmpty()</p>\n<p>4.3.3　从栈中弹出元素</p>\n<p>由于我们没有使用数组来存储元素，需要手动实现移除元素的逻辑。pop 方法同样返回了从栈中移除的元素，它的实现如下。</p>\n<p>pop() { if (this.isEmpty()) { // {1} return undefined; } this.count--; // {2} const result = this.items[this.count]; // {3} delete this.items[this.count]; // {4} return result; // {5} }</p>\n<p>首先，我们需要检验栈是否为空（行 {1}）。如果为空，就返回 undefined。如果栈不为空的话，我们会将 count 属性减 1（行 {2}），并保存栈顶的值（行 {3}），以便在删除它（行 {4}）之后将它返回（行 {5}）。</p>\n<p>由于我们使用的是 JavaScript 对象，可以用 JavaScript 的 delete 运算符从对象中删除一个特定的值。</p>\n<p>我们使用如下内部的值来模拟 pop 操作。</p>\n<p>items = { 0: 5, 1: 8 }; count = 2;</p>\n<p>要访问到栈顶的元素（即最后添加的元素 8），我们需要访问键值为 1 的位置。因此我们将 count 变量从 2 减为 1。这样就可以访问 items [1]，删除它，并将它的值返回了。</p>\n<p>4.3.4　查看栈顶的值并将栈清空</p>\n<p>上一节我们学习了，要访问栈顶元素，需要将 count 属性减 1。那么我们来看看 peek 方法的代码。</p>\n<p>peek() { if (this.isEmpty()) { return undefined; } return this.items[this.count - 1]; }</p>\n<p>要清空该栈，只需要将它的值复原为构造函数中使用的值即可。</p>\n<p>clear() { this.items =</p>\n<p>我们也可以遵循 LIFO 原则，使用下面的逻辑来移除栈中所有的元素。</p>\n<p this.pop();=\"\">while (!this.isEmpty())</p>\n<p>4.3.5　创建 toString 方法</p>\n<p>在数组版本中，我们不需要关心 toString 方法的实现，因为数据结构可以直接使用数组已经提供的 toString 方法。对于使用对象的版本，我们将创建一个 toString 方法来像数组一样打印出栈的内容。</p>\n<p>toString() { if (this.isEmpty()) { return ''; } let objString =  <code>$&#123;this.items[0]&#125;</code> ; // {1} for (let i = 1; i &lt; this.count; i++) { // {2} objString =  <code>$&#123;objString&#125;,$&#123;this.items[i]&#125;</code> ; // {3} } return objString; }</p>\n<p>如果栈是空的，我们只需返回一个空字符串即可。如果它不是空的，就需要用它底部的第一个元素作为字符串的初始值（行 {1}），然后迭代整个栈的键（行 {2}），一直到栈顶，添加一个逗号（,）以及下一个元素（行 {3}）。如果栈只包含一个元素，行 {2} 和行 {3} 的代码将不会执行。</p>\n<p>实现了 toString 方法后，我们就完成了这个版本的 Stack 类。这也是一个用不同方式写代码的例子。对于使用 Stack 类的开发者，选择使用基于数组或是基于对象的版本并不重要，两者都提供了相同的功能，只是内部实现很不一样。</p>\n<p>除了 toString 方法，我们创建的其他方法的复杂度均为 O (1)，代表我们可以直接找到目标元素并对其进行操作（push、pop 或 peek）。</p>\n<p>4.4　保护数据结构内部元素</p>\n<p>在创建别的开发者也可以使用的数据结构或对象时，我们希望保护内部的元素，只有我们暴露出的方法才能修改内部结构。对于 Stack 类来说，要确保元素只会被添加到栈顶，而不是栈底或其他任意位置（比如栈的中间）。不幸的是，我们在 Stack 类中声明的 items 和 count 属性并没有得到保护，因为 JavaScript 的类就是这样工作的。</p>\n<p>试着执行下面的代码。</p>\n<p 3=\"\">const stack = new Stack(); console.log(Object.getOwnPropertyNames(stack)); // {1} console.log(Object.keys(stack)); // {2} console.log(stack.items); //</p>\n<p>行 {1} 和行 {2} 的输出结果是 [&quot;count&quot;, &quot;items&quot;]。这表示 count 和 items 属性是公开的，我们可以像行 {3} 那样直接访问它们。根据这种行为，我们可以对这两个属性赋新的值。</p>\n<p>本章使用 ES2015（ES6）语法创建了 Stack 类。ES2015 类是基于原型的。尽管基于原型的类能节省内存空间并在扩展方面优于基于函数的类，但这种方式不能声明私有属性（变量）或方法。另外，在本例中，我们希望 Stack 类的用户只能访问我们在类中暴露的方法。下面来看看其他使用 JavaScript 来实现私有属性的方法。</p>\n<p>4.4.1　下划线命名约定</p>\n<p>一部分开发者喜欢在 JavaScript 中使用下划线命名约定来标记一个属性为私有属性。</p>\n<p>class Stack { constructor() { this._count = 0; this._items = {}; } }</p>\n<p>下划线命名约定就是在属性名称之前加上一个下划线（_）。不过这种方式只是一种约定，并不能保护数据，而且只能依赖于使用我们代码的开发者所具备的常识。</p>\n<p>4.4.2　用 ES2015 的限定作用域 Symbol 实现类</p>\n<p>ES2015 新增了一种叫作 Symbol 的基本类型，它是不可变的，可以用作对象的属性。看看怎么用它在 Stack 类中声明 items 属性（我们将使用数组来存储元素以简化代码）。</p>\n<p>const _items = Symbol ('stackItems'); // {1} class Stack { constructor () { this [_items] = []; // {2} } // 栈的方法 }</p>\n<p>在上面的代码中，我们声明了 Symbol 类型的变量_items（行 {1}），在类的 constructor 函数中初始化它的值（行 {2}）。要访问_items，只需要把所有的 this.items 都换成 this [_items]。</p>\n<p>这种方法创建了一个假的私有属性，因为 ES2015 新增的 Object.getOwnProperty- Symbols 方法能够取到类里面声明的所有 Symbols 属性。下面是一个破坏 Stack 类的例子。</p>\n<p>const stack = new Stack (); stack.push (5); stack.push (8); let objectSymbols = Object.getOwnPropertySymbols (stack); console.log (objectSymbols.length); // 输出 1 console.log (objectSymbols); // [Symbol ()] console.log (objectSymbols [0]); // Symbol () stack [objectSymbols [0]].push (1); stack.print (); // 输出 5, 8, 1</p>\n<p>从以上代码可以看到，访问 stack [objectSymbols [0]] 是可以得到_items 的。并且，_items 属性是一个数组，可以进行任意的数组操作，比如从中间删除或添加元素（使用对象进行存储也是一样的）。但我们操作的是栈，不应该出现这种行为。</p>\n<p>还有第三个方案。</p>\n<p>4.4.3　用 ES2015 的 WeakMap 实现类</p>\n<p>有一种数据类型可以确保属性是私有的，这就是 WeakMap。我们会在第 8 章深入探讨 Map 这种数据结构，现在只需要知道 WeakMap 可以存储键值对，其中键是对象，值可以是任意数据类型。</p>\n<p>如果用 WeakMap 来存储 items 属性（数组版本），Stack 类就是这样的：</p>\n<p>const items = new WeakMap (); // {1} class Stack { constructor () { items.set (this, []); // {2} } push (element){ const s = items.get (this); // {3} s.push (element); } pop (){ const s = items.get (this); const r = s.pop (); return r; } // 其他方法 }</p>\n<p>上面的代码片段解释如下。</p>\n<p>行 {1}，声明一个 WeakMap 类型的变量 items。</p>\n<p>行 {2}，在 constructor 中，以 this（Stack 类自己的引用）为键，把代表栈的数组存入 items。</p>\n<p>行 {3}，从 WeakMap 中取出值，即以 this 为键（行 {2} 设置的）从 items 中取值。</p>\n<p>现在我们知道了，items 在 Stack 类里是真正的私有属性。采用这种方法，代码的可读性不强，而且在扩展该类时无法继承私有属性。鱼和熊掌不可兼得！</p>\n<p>4.4.4　ECMAScript 类属性提案</p>\n<p>TypeScript 提供了一个给类属性和方法使用的 private 修饰符。然而，该修饰符只在编译时有用（包括我们在前几章讨论的 TypeScript 类型和错误检测）。在代码被转移完成后，属性同样是公开的。</p>\n<p>事实上，我们不能像在其他编程语言中一样声明私有属性和方法。虽然有很多种方法都可以达到相同的效果，但无论是在语法还是性能层面，这些方法都有各自的优点和缺点。</p>\n<p>哪种方法更好呢？这取决于你在实际项目中如何使用本书展示的算法，也取决于你需要处理的数据量、需要构造的实例数量，以及其他约束条件。最终，还是取决于你的选择。</p>\n<p>在写作本书的时候，有一个关于在 JavaScript 类中增加私有属性的提案。通过这个提案，我们能够直接在类中声明 JavaScript 类属性并进行初始化。下面是一个例子。</p>\n<p id=\"count\" id=\"0;items\">class Stack</p>\n<p>我们可以通过在属性前添加井号（#）作为前缀来声明私有属性。这种行为和 WeakMap 中的私有属性很相似。所以在不远的未来，我们有希望不使用特殊技巧或牺牲代码可读性，就能使用私有类属性。</p>\n<p>要了解更多有关类属性提案的信息，请访问：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RjMzkvcHJvcG9zYWwtY2xhc3MtZmllbGRzJUUzJTgwJTgy\">https://github.com/tc39/proposal-class-fields。</span></p>\n<p>4.5　用栈解决问题</p>\n<p>栈的实际应用非常广泛。在回溯问题中，它可以存储访问过的任务或路径、撤销的操作（后面的章节讨论图和回溯问题时，我们会学习如何应用这个例子）。Java 和 C# 用栈来存储变量和方法调用，特别是处理递归算法时，有可能抛出一个栈溢出异常（后面的章节也会介绍）。</p>\n<p>既然我们已经了解了 Stack 类的用法，不妨用它来解决一些计算机科学问题。本节，我们将介绍如何解决十进制转二进制问题，以及任意进制转换的算法。</p>\n<p>从十进制到二进制</p>\n<p>现实生活中，我们主要使用十进制。但在计算科学中，二进制非常重要，因为计算机里的所有内容都是用二进制数字表示的（0 和 1）。没有十进制和二进制相互转化的能力，与计算机交流就很困难。</p>\n<p>要把十进制转化成二进制，我们可以将该十进制数除以 2（二进制是满二进一）并对商取整，直到结果是 0 为止。举个例子，把十进制的数 10 转化成二进制的数字，过程大概是如下这样。</p>\n<p>大学的计算机课一般都会先教这个进制转换。下面是对应的算法描述。</p>\n<p>function decimalToBinary(decNumber) { const remStack = new Stack(); let number = decNumber; let rem; let binaryString = ''; while (number &gt; 0) { // {1} rem = Math.floor(number % 2); // {2} remStack.push(rem); // {3} number = Math.floor(number / 2); // {4} } while (!remStack.isEmpty()) { // {5} binaryString += remStack.pop().toString(); } return binaryString; }</p>\n<p>在这段代码里，当除法的结果不为 0 时（行 {1}），我们会获得一个余数，并放到栈里（行 {2}、行 {3}）。然后让结果继续除以 2（行 {4}）。另外请注意：JavaScript 有数值类型，但是它不会区分整数和浮点数。因此，要使用 Math.floor 函数仅返回除法运算结果的整数部分。最后，用 pop 方法把栈中的元素都移除，把出栈的元素连接成字符串（行 {5}）。</p>\n<p>用刚才写的算法做一些测试，使用以下代码把结果输出到控制台里。</p>\n<p>console.log(decimalToBinary(233)); // 11101001 console.log(decimalToBinary(10)); // 1010 console.log(decimalToBinary(1000)); // 1111101000</p>\n<p>进制转换算法</p>\n<p>我们可以修改之前的算法，使之能把十进制转换成基数为 2～36 的任意进制。除了把十进制数除以 2 转成二进制数，还可以传入其他任意进制的基数为参数，就像下面的算法这样。</p>\n<p>function baseConverter(decNumber, base) { const remStack = new Stack(); const digits = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'; // {6} let number = decNumber; let rem; let baseString = ''; if (!(base &gt;= 2 &amp;&amp; base &lt;= 36)) { return ''; } while (number &gt; 0) { rem = Math.floor(number % base); remStack.push(rem); number = Math.floor(number / base); } while (!remStack.isEmpty()) { baseString += digits[remStack.pop()]; // {7} } return baseString; }</p>\n<p>我们只需要改变一个地方。在将十进制转成二进制时，余数是 0 或 1；在将十进制转成八进制时，余数是 0～7；但是将十进制转成十六进制时，余数是 0～9 加上 A、B、C、D、E 和 F（对应 10、11、12、13、14 和 15）。因此，我们需要对栈中的数字做个转化才可以（行 {6} 和行 {7}）。因此，从十一进制开始，字母表中的每个字母将表示相应的基数。字母 A 代表基数 11，B 代表基数 12，以此类推。</p>\n<p>可以使用之前的算法，输出结果如下。</p>\n<p>console.log(baseConverter(100345, 2)); // 11000011111111001 console.log(baseConverter(100345, 8)); // 303771 console.log(baseConverter(100345, 16)); // 187F9 console.log(baseConverter(100345, 35)); // 2BW0</p>\n<p>请在网上下载本书的代码，里面还有一些栈的应用实例，如平衡圆括号和汉诺塔。</p>\n<p>4.6　小结</p>\n<p>本章，我们学习了栈这一数据结构的相关知识。我们使用数组和一个 JavaScript 对象自己实现了栈，还讲解了如何用 push 和 pop 往栈里添加和移除元素。</p>\n<p>我们比较了创建 Stack 类的不同方法，并分别列举了优点和缺点。我们还学习了用栈来解决计算机科学中最著名的问题之一。</p>\n<p>下一章将要学习队列。它和栈有很多相似之处，但有个重要区别：队列里的元素不遵循后进先出原则。</p>\n<h1 id=\"第-5-章-队列和双端队列\"><a class=\"anchor\" href=\"#第-5-章-队列和双端队列\">#</a> 第 5 章　队列和双端队列</h1>\n<p>我们已经学习了栈。队列和栈非常类似，但是使用了与后进先出不同的原则。你将在本章学习这些内容。我们同样要学习双端队列的工作原理。双端队列是一种将栈的原则和队列的原则混合在一起的数据结构。</p>\n<p>本章内容包括：</p>\n<p>队列数据结构</p>\n<p>双端队列数据结构</p>\n<p>向队列和双端队列增加元素</p>\n<p>从队列和双端队列中删除元素</p>\n<p>用击鼓传花游戏模拟循环队列</p>\n<p>用双端队列检查一个词组是否构成回文</p>\n<p>5.1　队列数据结构</p>\n<p>队列是遵循先进先出（FIFO，也称为先来先服务）原则的一组有序的项。队列在尾部添加新元素，并从顶部移除元素。最新添加的元素必须排在队列的末尾。</p>\n<p>在现实中，最常见的队列的例子就是排队。</p>\n<p>在电影院、自助餐厅、杂货店收银台，我们都会排队。排在第一位的人会先接受服务。</p>\n<p>在计算机科学中，一个常见的例子就是打印队列。比如说我们需要打印五份文档。我们会打开每个文档，然后点击打印按钮。每个文档都会被发送至打印队列。第一个发送到打印队列的文档会首先被打印，以此类推，直到打印完所有文档。</p>\n<p>5.1.1　创建队列</p>\n<p>我们需要创建自己的类来表示一个队列。先从最基本的声明类开始。</p>\n<p>class Queue { constructor() { this.count = 0; // {1} this.lowestCount = 0; // {2} this.items = {}; // {3} } }</p>\n<p>首先需要一个用于存储队列中元素的数据结构。我们可以使用数组，就像上一章的 Stack 类那样。但是，为了写出一个在获取元素时更高效的数据结构，我们将使用一个对象来存储我们的元素（行 {3}）。你会发现 Queue 类和 Stack 类非常类似，只是添加和移除元素的原则不同。</p>\n<p>也可以声明一个 count 属性来帮助我们控制队列的大小（行 {1}）。此外，由于我们将要从队列前端移除元素，同样需要一个变量来帮助我们追踪第一个元素。因此，声明一个 lowestCount 变量（行 {2}）。</p>\n<p>接下来需要声明一些队列可用的方法。</p>\n<p>enqueue (element (s))：向队列尾部添加一个（或多个）新的项。</p>\n<p>dequeue ()：移除队列的第一项（即排在队列最前面的项）并返回被移除的元素。</p>\n<p>peek ()：返回队列中第一个元素 —— 最先被添加，也将是最先被移除的元素。队列不做任何变动（不移除元素，只返回元素信息 —— 与 Stack 类的 peek 方法非常类似）。该方法在其他语言中也可以叫作 front 方法。</p>\n<p>isEmpty ()：如果队列中不包含任何元素，返回 true，否则返回 false。</p>\n<p>size ()：返回队列包含的元素个数，与数组的 length 属性类似。</p>\n<p>向队列添加元素</p>\n<p>首先要实现的是 enqueue 方法。该方法负责向队列添加新元素。此处一个非常重要的细节是新的项只能添加到队列末尾。</p>\n<p this.items[this.count]=\"\" class=\"element;thiscount++;\">enqueue(element)</p>\n<p>enqueue 方法和 Stack 类中 push 方法的实现方式相同。由于 items 属性是一个 JavaScript 对象，它是一个键值对的集合。要向队列中加入一个元素的话，我们要把 count 变量作为 items 对象中的键，对应的元素作为它的值。将元素加入队列后，我们将 count 变量加 1。</p>\n<p>从队列移除元素</p>\n<p>接下来要实现 dequeue 方法，该方法负责从队列移除项。由于队列遵循先进先出原则，最先添加的项也是最先被移除的。</p>\n<p>dequeue() { if (this.isEmpty()) { return undefined; } const result = this.items[this.lowestCount]; // {1} delete this.items[this.lowestCount]; // {2} this.lowestCount++; // {3} return result; // {4} }</p>\n<p>首先，我们需要检验队列是否为空。如果为空，我们返回 undefined 值。如果队列不为空，我们将暂存队列头部的值（行 {1}），以便该元素被移除后（行 {2}）将它返回（行 {4}）。我们也需要将 lowestCount 属性加 1（行 {2}）。</p>\n<p>用下面的内部值来模拟 dequeue 动作。</p>\n<p>items = { 0: 5, 1: 8 }; count = 2; lowestCount = 0;</p>\n<p>我们需要将键设为 0 来获取队列头部的元素（第一个被添加的元素是 5），删除它，再返回它的值。在这种场景下，删除第一个元素后，items 属性将只会包含一个元素（1∶8）。再次执行 dequeue 方法的话，它将被移除。因此我们将 lowestCount 变量从 0 修改为 1。</p>\n<p>只有 enqueue 方法和 dequeue 方法可以添加和移除元素，这样就确保了 Queue 类遵循先进先出原则。</p>\n<p>查看队列头元素</p>\n<p>现在来为我们的类实现一些额外的辅助方法。如果想知道队列最前面的项是什么，可以用 peek 方法。该方法会返回队列最前面的项（把 lowestCount 作为键名来获取元素值）。</p>\n<p>peek() { if (this.isEmpty()) { return undefined; } return this.items[this.lowestCount]; }</p>\n<p>检查队列是否为空并获取它的长度</p>\n<p>下一个是 isEmpty 方法。如果队列为空，它会返回 true，否则返回 false（注意该方法和 Stack 类里的一样）。</p>\n<p return=\"\" this.count=\"\" -=\"\" this.lowestCount=\"\">isEmpty()</p>\n<p>要计算队列中有多少元素，我们只需要计算 count 和 lowestCount 之间的差值即可。</p>\n<p>假设 count 属性的值为 2，lowestCount 的值为 0。这表示在队列中有两个元素。然后，我们从队列中移除一个元素，lowestCount 的值会变为 1，count 的值仍然是 2。现在队列中只有一个元素了，以此类推。</p>\n<p>所以要实现 size 方法的话，我们只需要返回这个差值即可。</p>\n<p return=\"\" this.count=\"\" -=\"\" this.lowestCount;=\"\">size()</p>\n<p>可以像下面这样写出 isEmpty 方法。</p>\n<p return=\"\" this.size()=\"\">isEmpty()</p>\n<p>清空队列</p>\n<p>要清空队列中的所有元素，我们可以调用 dequeue 方法直到它返回 undefined，也可以简单地将队列中的属性值重设为和构造函数中的一样。</p>\n<p>clear() { this.items =</p>\n<p>创建 toString 方法</p>\n<p>完成！Queue 类实现好了。我们也可以像 Stack 类一样增加一个 toString 方法。</p>\n<p>toString() { if (this.isEmpty()) { return ''; } let objString =  <code>$&#123;this.items[this.lowestCount]&#125;</code> ; for (let i = this.lowestCount + 1; i &lt; this.count; i++) { objString =  <code>$&#123;objString&#125;,$&#123;this.items[i]&#125;</code> ; } return objString; }</p>\n<p>在 Stack 类中，我们从索引值为 0 开始迭代 items 中的值。由于 Queue 类中的第一个索引值不一定是 0，我们需要从索引值为 lowestCount 的位置开始迭代队列。</p>\n<p>现在我们真的完成了！</p>\n<p>Queue 类和 Stack 类非常类似。主要的区别在于 dequeue 方法和 peek 方法，这是由于先进先出和后进先出原则的不同所造成的。</p>\n<p>5.1.2　使用 Queue 类</p>\n<p>首先要做的是实例化我们刚刚创建的 Queue 类，然后就可以验证它为空（输出为 true，因为我们还没有向队列添加任何元素）。</p>\n<p>const queue = new Queue (); console.log (queue.isEmpty ()); // 输出 true</p>\n<p>接下来，添加一些元素（添加 'John' 和 'Jack' 两个元素 —— 你可以向队列添加任何类型的元素）。</p>\n<p>queue.enqueue('John'); queue.enqueue('Jack'); console.log(queue.toString()); // John,Jack</p>\n<p>添加另一个元素。</p>\n<p>queue.enqueue('Camila');</p>\n<p>再执行一些其他命令。</p>\n<p>console.log (queue.toString ()); // John, Jack, Camila console.log (queue.size ()); // 输出 3 console.log (queue.isEmpty ()); // 输出 false queue.dequeue (); // 移除 John queue.dequeue (); // 移除 Jack console.log (queue.toString ()); // Camila</p>\n<p>如果打印队列的内容，就会得到 John、Jack 和 Camila 这三个元素。因为我们向队列添加了三个元素，所以队列的大小为 3（当然也就不为空了）。</p>\n<p>下图展示了目前为止执行的所有入列操作，以及队列当前的状态。</p>\n<p>然后，出列两个元素（执行两次 dequeue 方法）。下图展示了 dequeue 方法的执行过程。</p>\n<p>最后，再次打印队列内容时，就只剩 Camila 一个元素了。前两个入列的元素出列了，最后入列的元素也将是最后出列的。也就是说，我们遵循了先进先出原则。</p>\n<p>5.2　双端队列数据结构</p>\n<p>双端队列（deque，或称 double-ended queue）是一种允许我们同时从前端和后端添加和移除元素的特殊队列。</p>\n<p>双端队列在现实生活中的例子有电影院、餐厅中排队的队伍等。举个例子，一个刚买了票的人如果只是还需要再问一些简单的信息，就可以直接回到队伍的头部。另外，在队伍末尾的人如果赶时间，他可以直接离开队伍。</p>\n<p>在计算机科学中，双端队列的一个常见应用是存储一系列的撤销操作。每当用户在软件中进行了一个操作，该操作会被存在一个双端队列中（就像在一个栈里）。当用户点击撤销按钮时，该操作会被从双端队列中弹出，表示它被从后面移除了。在进行了预先定义的一定数量的操作后，最先进行的操作会被从双端队列的前端移除。由于双端队列同时遵守了先进先出和后进先出原则，可以说它是把队列和栈相结合的一种数据结构。</p>\n<p>5.2.1　创建 Deque 类</p>\n<p>和之前一样，我们先声明一个 Deque 类及其构造函数。</p>\n<p>class Deque { constructor() { this.count = 0; this.lowestCount = 0; this.items = {}; } }</p>\n<p>既然双端队列是一种特殊的队列，我们可以看到其构造函数中的部分代码和队列相同，包括相同的内部属性和以下方法：isEmpty、clear、size 和 toString。</p>\n<p>由于双端队列允许在两端添加和移除元素，还会有下面几个方法。</p>\n<p>addFront (element)：该方法在双端队列前端添加新的元素。</p>\n<p>addBack (element)：该方法在双端队列后端添加新的元素（实现方法和 Queue 类中的 enqueue 方法相同）。</p>\n<p>removeFront ()：该方法会从双端队列前端移除第一个元素（实现方法和 Queue 类中的 dequeue 方法相同）。</p>\n<p>removeBack ()：该方法会从双端队列后端移除第一个元素（实现方法和 Stack 类中的 pop 方法一样）。</p>\n<p>peekFront ()：该方法返回双端队列前端的第一个元素（实现方法和 Queue 类中的 peek 方法一样）。</p>\n<p>peekBack ()：该方法返回双端队列后端的第一个元素（实现方法和 Stack 类中的 peek 方法一样）。</p>\n<p>Deque 类同样实现了 isEmpty、clear、size 和 toString 方法（你可以下载本书的源代码包查看完整的源代码）。</p>\n<p>向双端队列的前端添加元素</p>\n<p>由于已经实现了部分方法，我们将只专注于 addFront 方法的逻辑。addFront 方法的代码如下所示。</p>\n<p>addFront(element) { if (this.isEmpty()) { // {1} this.addBack(element); } else if (this.lowestCount &gt; 0) { // {2} this.lowestCount--; this.items[this.lowestCount] = element; } else { for (let i = this.count; i &gt; 0; i--) { // {3} this.items[i] = this.items[i - 1]; } this.count++; this.lowestCount = 0; this.items[0] = element; // {4} } }</p>\n<p>要将一个元素添加到双端队列的前端，存在三种场景。</p>\n<p>第一种场景是这个双端队列是空的（行 {1}）。在这种情况下，我们可以执行 addBack 方法。元素会被添加到双端队列的后端，在本例中也是双端队列的前端。addBack 方法已经有了增加 count 属性值的逻辑，因此我们可以复用它来避免重复编写代码。</p>\n<p>第二种场景是一个元素已经被从双端队列的前端移除（行 {2}），也就是说 lowestCount 属性会大于等于 1。这种情况下，我们只需要将 lowestCount 属性减 1 并将新元素的值放在这个键的位置上即可。</p>\n<p>考虑如下所示的 Deque 类的内部值。</p>\n<p>items = { 1: 8, 2: 9 }; count = 3; lowestCount = 1;</p>\n<p>如果我们想将元素 7 添加在双端队列的前端，那么符合第二种场景。在本示例中，lowestCount 的值会减少（新的值是 0），并且 7 会成为键 0 的值。</p>\n<p>第三种也是最后一种场景是 lowestCount 为 0 的情况。我们可以设置一个负值的键，同时更新用于计算双端队列长度的逻辑，使其也能包含负键值。这种情况下，添加一个新元素的操作仍然能保持最低的计算成本。为了便于演示，我们把本场景看作使用数组。要在第一位添加一个新元素，我们需要将所有元素后移一位（行 {3}）来空出第一个位置。由于我们不想丢失任何已有的值，需要从最后一位开始迭代所有的值，并为元素赋上索引值减 1 位置的值。在所有的元素都完成移动后，第一位将是空闲状态，这样就可以用需要添加的新元素来覆盖它了（行 {4}）。</p>\n<p>5.2.2　使用 Deque 类</p>\n<p>在实例化 Deque 类后，我们可以执行下面的方法。</p>\n<p>const deque = new Deque (); console.log (deque.isEmpty ()); // 输出 true deque.addBack ('John'); deque.addBack ('Jack'); console.log (deque.toString ()); // John, Jack deque.addBack ('Camila'); console.log (deque.toString ()); // John, Jack, Camila console.log (deque.size ()); // 输出 3 console.log (deque.isEmpty ()); // 输出 false deque.removeFront (); // 移除 John console.log (deque.toString ()); // Jack, Camila deque.removeBack (); // Camila 决定离开 console.log (deque.toString ()); // Jack deque.addFront ('John'); // John 回来询问一些信息 console.log (deque.toString ()); // John, Jack</p>\n<p>借助 Deque 类，我们可以执行 Stack 和 Queue 类中的操作。我们同样可以使用 Deque 类来实现一个优先队列，第 11 章会讨论这个话题。</p>\n<p>5.3　使用队列和双端队列来解决问题</p>\n<p>现在我们知道了怎样使用 Queue 和 Deque 类，就用它们解决一些计算机科学中的问题吧。本节将使用队列来模拟击鼓传花游戏，并使用双端队列来检查一个短语是否为回文。</p>\n<p>5.3.1　循环队列 —— 击鼓传花游戏</p>\n<p>由于队列经常被应用在计算机领域和我们的现实生活中，就出现了一些队列的修改版本，我们会在本章实现它们。这其中的一种叫作循环队列。循环队列的一个例子就是击鼓传花游戏（hot potato）。在这个游戏中，孩子们围成一个圆圈，把花尽快地传递给旁边的人。某一时刻传花停止，这个时候花在谁手里，谁就退出圆圈、结束游戏。重复这个过程，直到只剩一个孩子（胜者）。</p>\n<p>在下面这个示例中，我们要实现一个模拟的击鼓传花游戏。</p>\n<p>function hotPotato(elementsList, num) { const queue = new Queue(); // {1} const elimitatedList = []; for (let i = 0; i &lt; elementsList.length; i++) { queue.enqueue(elementsList[i]); // {2} } while (queue.size() &gt; 1) { for (let i = 0; i &lt; num; i++) { queue.enqueue(queue.dequeue()); // {3} } elimitatedList.push(queue.dequeue()); // {4} } return { eliminated: elimitatedList, winner: queue.dequeue() // {5} }; }</p>\n<p>实现一个模拟的击鼓传花游戏，要用到本章开头实现的 Queue 类（行 {1}）。我们会得到一份名单，把里面的名字全都加入队列（行 {2}）。给定一个数字，然后迭代队列。从队列开头移除一项，再将其添加到队列末尾（行 {3}），模拟击鼓传花（如果你把花传给了旁边的人，你被淘汰的威胁就立刻解除了）。一旦达到给定的传递次数，拿着花的那个人就被淘汰了（从队列中移除 —— 行 {4}）。最后只剩下一个人的时候，这个人就是胜者（行 {5}）。</p>\n<p>我们可以使用下面的代码来尝试 hotPotato 算法。</p>\n<p>const names = ['John', 'Jack', 'Camila', 'Ingrid', 'Carl']; const result = hotPotato(names, 7); result.eliminated.forEach(name =&gt; { console.log( <code>$&#123;name&#125;在击鼓传花游戏中被淘汰。</code> ); }); console.log( <code>胜利者： $&#123;result.winner&#125;</code> );</p>\n<p>以上算法的输出如下。</p>\n<p>Camila 在击鼓传花游戏中被淘汰。 Jack 在击鼓传花游戏中被淘汰。 Carl 在击鼓传花游戏中被淘汰。 Ingrid 在击鼓传花游戏中被淘汰。 胜利者：John</p>\n<p>下图模拟了这个输出过程。</p>\n<p>你可以改变传入 hotPotato 函数的数，模拟不同的场景。</p>\n<p>5.3.2　回文检查器</p>\n<p>下面是维基百科对回文的解释。</p>\n<p>回文是正反都能读通的单词、词组、数或一系列字符的序列，例如 madam 或 racecar。</p>\n<p>有不同的算法可以检查一个词组或字符串是否为回文。最简单的方式是将字符串反向排列并检查它和原字符串是否相同。如果两者相同，那么它就是一个回文。我们也可以用栈来完成，但是利用数据结构来解决这个问题的最简单方法是使用双端队列。</p>\n<p>下面的算法使用了一个双端队列来解决问题。</p>\n<p>function palindromeChecker(aString) { if (aString === undefined || aString === null || (aString !== null &amp;&amp; aString.length === 0)) { // {1} return false; } const deque = new Deque(); // {2} const lowerString = aString.toLocaleLowerCase().split(' ').join(''); // {3} let isEqual = true; let firstChar, lastChar; for (let i = 0; i &lt; lowerString.length; i++) { // {4} deque.addBack(lowerString.charAt(i)); } while (deque.size() &gt; 1 &amp;&amp; isEqual) { // {5} firstChar = deque.removeFront(); // {6} lastChar = deque.removeBack(); // {7} if (firstChar !== lastChar) { isEqual = false; // {8} } } return isEqual; }</p>\n<p>在我们开始解释算法逻辑之前，需要检查传入的字符串参数是否合法（行 {1}）。如果不合法，我们返回 false。</p>\n<p>对于这个算法，我们将使用在本章实现的 Deque 类（行 {2}）。由于可能接收到同时包含大小写字母的字符串，我们会将所有字母转化为小写，同时移除所有的空格（行 {3}）。如果你愿意，也可以移除所有的特殊字符，例如！、?、-、(和) 等。为了保证算法简洁，我们会跳过这部分。</p>\n<p>然后，我们会对字符串中的所有字符执行 enqueue 操作（行 {4}）。如果所有元素都在双端队列中（如果只有一个字符的话，那它肯定是回文）并且首尾字符相同的话（行 {5}），我们将从前端移除一个元素（行 {6}），再从后端移除一个元素（行 {7}）。要使字符串为回文，移除的两个字符必须相同。如果字符不同的话，这个字符串就不是一个回文（行 {8}）。</p>\n<p>我们可以用下面的代码来测试 palindromeChecker 算法。</p>\n<p>console.log('a', palindromeChecker('a')); console.log('aa', palindromeChecker('aa')); console.log('kayak', palindromeChecker('kayak')); console.log('level', palindromeChecker('level')); console.log('Was it a car or a cat I saw', palindromeChecker('Was it a car or a cat I saw')); console.log('Step on no pets', palindromeChecker('Step on no pets'));</p>\n<p>前面所有示例的输出结果都是 true。</p>\n<p>5.3.3　JavaScript 任务队列</p>\n<p>既然我们在书中使用的是 JavaScript，何不探索一下这门语言本身呢？</p>\n<p>当我们在浏览器中打开新标签时，就会创建一个任务队列。这是因为每个标签都是单线程处理所有的任务，称为事件循环。浏览器要负责多个任务，如渲染 HTML、执行 JavaScript 代码、处理用户交互（用户输入、鼠标点击等）、执行和处理异步请求。如果想更多地了解事件循环，可以访问 https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/。</p>\n<p>像 JavaScript 这样流行而强大的语言竟然使用如此基础的数据结构来进行内部控制，真令人高兴。</p>\n<p>5.4　小结</p>\n<p>本章介绍了队列这种数据结构。我们实现了自己的队列算法，学习了如何通过 enqueue 方法和 dequeue 方法并遵循先进先出原则来添加和移除元素。我们同样学习了双端队列数据结构，如何将元素添加到双端队列的前端和后端，以及如何将元素从双端队列的前端和后端移除。</p>\n<p>我们也讨论了如何用队列和双端队列数据结构解决两个经典的问题：击鼓传花游戏（使用一个修改过的队列：循环队列）和回文检查（使用双端队列）。</p>\n<p>下一章，我们将学习链表。这是一种比数组更复杂的数据结构。</p>\n<h1 id=\"第-6-章-链表\"><a class=\"anchor\" href=\"#第-6-章-链表\">#</a> 第 6 章　链表</h1>\n<p>我们在第 3 章学习了数组这种数据结构。数组（也可以称为列表）是一种非常简单的存储数据序列的数据结构。在本章，你会学习如何实现和使用链表这种动态的数据结构，这意味着我们可以从中随意添加或移除项，它会按需进行扩容。</p>\n<p>本章内容包括：</p>\n<p>链表数据结构</p>\n<p>向链表添加元素</p>\n<p>从链表移除元素</p>\n<p>使用 LinkedList 类</p>\n<p>双向链表</p>\n<p>循环链表</p>\n<p>排序链表</p>\n<p>通过链表实现栈</p>\n<p>6.1　链表数据结构</p>\n<p>要存储多个元素，数组（或列表）可能是最常用的数据结构。正如本书之前提到的，每种语言都实现了数组。这种数据结构非常方便，提供了一个便利的 [] 语法来访问其元素。然而，这种数据结构有一个缺点：（在大多数语言中）数组的大小是固定的，从数组的起点或中间插入或移除项的成本很高，因为需要移动元素。（尽管我们已经学过，JavaScript 有来自 Array 类的方法可以帮我们做这些事，但背后的情况同样如此。）</p>\n<p>链表存储有序的元素集合，但不同于数组，链表中的元素在内存中并不是连续放置的。每个元素由一个存储元素本身的节点和一个指向下一个元素的引用（也称指针或链接）组成。下图展示了一个链表的结构。</p>\n<p>相对于传统的数组，链表的一个好处在于，添加或移除元素的时候不需要移动其他元素。然而，链表需要使用指针，因此实现链表时需要额外注意。在数组中，我们可以直接访问任何位置的任何元素，而要想访问链表中间的一个元素，则需要从起点（表头）开始迭代链表直到找到所需的元素。</p>\n<p>现实中也有一些链表的例子。第一个例子就是康加舞队。每个人是一个元素，手就是链向下一个人的指针。可以向队列中增加人 —— 只需要找到想加入的点，断开连接，插入一个人，再重新连接起来。</p>\n<p>另一个例子是寻宝游戏。你有一条线索，这条线索就是指向寻找下一条线索的地点的指针。你顺着这条链接去下一个地点，得到另一条指向再下一处的线索。得到链表中间的线索的唯一办法，就是从起点（第一条线索）顺着链表寻找。</p>\n<p>还有一个可能是用来说明链表的最流行的例子，那就是火车。一列火车是由一系列车厢（也称车皮）组成的。每节车厢或车皮都相互连接。你很容易分离一节车皮，改变它的位置、添加或移除它。下图演示了一列火车。每节车皮都是链表的元素，车皮间的连接就是指针。</p>\n<p>本章会介绍链表及其变体，但还是先从最简单的数据结构开始吧！</p>\n<p>创建链表</p>\n<p>理解了链表是什么之后，现在就要开始实现我们的数据结构了。以下是 LinkedList 类的 “骨架”。</p>\n<p>import { defaultEquals } from '../util'; import { Node } from './models/linked-list-models'; // {1} export default class LinkedList { constructor(equalsFn = defaultEquals) { this.count = 0; // {2} this.head = undefined; // {3} this.equalsFn = equalsFn; // {4} } }</p>\n<p>对于 LinkedList 数据结构，我们从声明 count 属性开始（行 {2}），它用来存储链表中的元素数量。</p>\n<p>我们要实现一个名为 indexOf 的方法，它使我们能够在链表中找到一个特定的元素。要比较链表中的元素是否相等，我们需要使用一个内部调用的函数，名为 equalsFn（行 {4}）。使用 linkedList 类的开发者可以自行传入用于比较两个 JavaScript 对象或值是否相等的自定义函数。如果没有传入这个自定义函数，该数据结构将使用定义在 util.js 中的 defaultEquals 函数（这样我们可以在随后章节的其他数据结构和算法中复用它）作为默认的相等性比较函数。 defaultEquals 函数的定义如下。</p>\n<p return=\"\" a=\"\">export function defaultEquals(a, b)</p>\n<p>defaultEquals 函数的默认参数值和模块导入功能由 ECMAScript 2015（ES6）提供，我们在第 2 章学习过。</p>\n<p>由于该数据结构是动态的，我们还需要将第一个元素的引用保存下来。我们可以用一个叫作 head 的元素保存引用（行 {3}）。</p>\n<p>要表示链表中的第一个以及其他元素，我们需要一个助手类，叫作 Node（行 {1}）。Node 类表示我们想要添加到链表中的项。它包含一个 element 属性，该属性表示要加入链表元素的值；以及一个 next 属性，该属性是指向链表中下一个元素的指针。Node 类的声明位于 models/linked-list-models.js 文件中（为了便于复用），它的代码如下所示。</p>\n<p>export class Node { constructor(element) { this.element = element; this.next = undefined; } }</p>\n<p>然后就是 LinkedList 类的方法。在实现这些方法之前，我们先来看看它们的职责。</p>\n<p>push (element)：向链表尾部添加一个新元素。</p>\n<p>insert (element, position)：向链表的特定位置插入一个新元素。</p>\n<p>getElementAt (index)：返回链表中特定位置的元素。如果链表中不存在这样的元素，则返回 undefined。</p>\n<p>remove (element)：从链表中移除一个元素。</p>\n<p>indexOf (element)：返回元素在链表中的索引。如果链表中没有该元素则返回 - 1。</p>\n<p>removeAt (position)：从链表的特定位置移除一个元素。</p>\n<p>isEmpty ()：如果链表中不包含任何元素，返回 true，如果链表长度大于 0 则返回 false。</p>\n<p>size ()：返回链表包含的元素个数，与数组的 length 属性类似。</p>\n<p>toString ()：返回表示整个链表的字符串。由于列表项使用了 Node 类，就需要重写继承自 JavaScript 对象默认的 toString 方法，让其只输出元素的值。</p>\n<p>向链表尾部添加元素</p>\n<p>向 LinkedList 对象尾部添加一个元素时，可能有两种场景：链表为空，添加的是第一个元素；链表不为空，向其追加元素。</p>\n<p>下面是我们实现的 push 方法。</p>\n<p>push (element) { const node = new Node (element); // {1} let current; // {2} if (this.head == null) { // {3} this.head = node; } else { current = this.head; // {4} while (current.next != null) { // {5} 获得最后一项 current = current.next; } // 将其 next 赋为新元素，建立链接 current.next = node; // {6} } this.count++; // {7} }</p>\n<p>首先需要做的是把 element 作为值传入，创建 Node 项（行 {1}）。</p>\n<p>先来实现第一个场景：向空列表添加一个元素。当我们创建一个 LinkedList 对象时，head 会指向 undefined（或者是 null）。</p>\n<p>如果 head 元素为 undefined 或 null（列表为空 —— 行 {3}），就意味着在向链表添加第一个元素。因此要做的就是让 head 元素指向 node 元素。下一个 node 元素会自动成为 undefined。</p>\n<p>链表最后一个节点的下一个元素始终是 undefined 或 null。</p>\n<p>好了，我们已经说完了第一种场景，再来看看第二种场景，也就是向一个不为空的链表尾部添加元素。</p>\n<p>要向链表的尾部添加一个元素，首先需要找到最后一个元素。记住，我们只有第一个元素的引用（行 {4}），因此需要循环访问列表，直到找到最后一项。为此，我们需要一个指向链表中 current 项的变量（行 {2}）。</p>\n<p>在循环访问链表的过程中，当 current.next 元素为 undefined 或 null 时，我们就知道已经到达链表尾部了（行 {5}）。然后要做的就是让当前（也就是最后一个）元素的 next 指针指向想要添加到链表的节点（行 {6}）。</p>\n<p>this.head == null（行 {3}）和 (this.head === undefined || head === null) 等价，current.next != null（行 {5}）和 (current.next !== undefined &amp;&amp; current.next !== null) 等价。要了解更多有关 JavaScript 中<mark>和</mark> = 运算符的信息，请参考第 1 章。</p>\n<p>下图展示了向非空链表的尾部添加一个元素的过程。</p>\n<p>当一个 Node 实例被创建时，它的 next 指针总是 undefined。这没问题，因为我们知道它会是链表的最后一项。</p>\n<p>当然，别忘了递增链表的长度，这样就能控制它并且轻松得到链表的长度（行 {7}）。</p>\n<p>我们可以通过以下代码来使用和测试目前创建的数据结构。</p>\n<p>const list = new LinkedList(); list.push(15); list.push(10);</p>\n<p>从链表中移除元素</p>\n<p>现在，让我们看看如何从 LinkedList 对象中移除元素。我们要实现两种 remove 方法：第一种是从特定位置移除一个元素（removeAt），第二种是根据元素的值移除元素（稍后我们会展示第二种 remove 方法）。和 push 方法一样，对于从链表中移除元素也存在两种场景：第一种是移除第一个元素，第二种是移除第一个元素之外的其他元素。</p>\n<p>removeAt 方法的代码如下所示。</p>\n<p>removeAt (index) { // 检查越界值 if (index &gt;= 0 &amp;&amp; index &lt; this.count) { // {1} let current = this.head; // {2} // 移除第一项 if (index === 0) { // {3} this.head = current.next; } else { let previous; // {4} for (let i = 0; i &lt; index; i++) { // {5} previous = current; // {6} current = current.next; // {7} } // 将 previous 与 current 的下一项链接起来：跳过 current，从而移除它 previous.next = current.next; // {8} } this.count--; // {9} return current.element; } return undefined; // {10} }</p>\n<p>一步一步来看这段代码。由于该方法要得到需要移除的元素的 index（位置），我们需要验证该 index 是有效的（行 {1}）。从 0（包括 0）到链表的长度（count – 1，因为 index 是从零开始的）都是有效的位置。如果不是有效的位置，就返回 undefined（行 {10}，即没有从列表中移除元素）。</p>\n<p>一起来为第一种场景编写代码：我们要从链表中移除第一个元素（position === 0—— 行 {3}）。下图展示了这个过程。</p>\n<p>因此，如果想移除第一个元素，要做的就是让 head 指向列表的第二个元素。我们将用 current 变量创建一个对链表中第一个元素的引用（行 {2}—— 我们还会用它来迭代链表，但 稍等一下再说）。这样 current 变量就是对链表中第一个元素的引用。如果把 head 赋为 current.next，就会移除第一个元素。我们也可以直接把 head 赋为 head.next（不使用 current 变量作为替代）。</p>\n<p>现在，假设我们要移除链表的最后一个或者中间某个元素。为此，需要迭代链表的节点，直到到达目标位置（行 {5}）。一个重要细节是：current 变量总是为对所循环列表的当前元素的引用（行 {7}）。我们还需要一个对当前元素的前一个元素的引用（行 {6}），它被命名为 previous（行 {4}）。</p>\n<p>在迭代到目标位置之后，current 变量会持有我们想从链表中移除的节点。因此，要从链表中移除当前元素，要做的就是将 previous.next 和 current.next 链接起来（行 {8}）。这样，当前节点就会被丢弃在计算机内存中，等着被垃圾回收器清除。</p>\n<p>要更好地理解 JavaScript 垃圾回收器如何工作，请阅读 https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Memory_Management。</p>\n<p>我们试着借助一些图表来更好地理解这段代码。首先考虑移除最后一个元素。</p>\n<p>对于最后一个元素，当我们在行 {8} 跳出循环时，current 变量将是对链表中最后一个节点的引用（要移除的节点）。current.next 的值将是 undefined（因为它是最后一个节点）。由于还保留了对 previous 节点的引用（当前节点的前一个节点），previous.next 就指向了 current。那么要移除 current，要做的就是把 previous.next 的值改变为 current.next。</p>\n<p>现在来看看，对于链表中间的元素是否可以应用相同的逻辑。</p>\n<p>current 变量是对要移除节点的引用。previous 变量是对要移除节点的前一个节点的引用。那么要移除 current 节点，需要做的就是将 previous.next 与 current.next 链接起来。因此，我们的逻辑对这两种情况都适用。</p>\n<p>循环迭代链表直到目标位置</p>\n<p>在 remove 方法中，我们需要迭代整个链表直到到达我们的目标索引 index（位置）。循环到目标 index 的代码片段在 LinkdedList 类的方法中很常见。因此，我们可以重构代码，将这部分逻辑独立为单独的方法，这样就可以在不同的地方复用它。那么，我们就来创建 getElementAt 方法吧。</p>\n<p>getElementAt(index) { if (index &gt;= 0 &amp;&amp; index &lt;= this.count) { // {1} let node = this.head; // {2} for (let i = 0; i &lt; index &amp;&amp; node != null; i++) { // {3} node = node.next; } return node; // {4} } return undefined; // {5} }</p>\n<p>为了确保我们能迭代链表直到找到一个合法的位置，需要对传入的 index 参数进行合法性验证（行 {1}）。如果传入的位置是不合法的参数，我们返回 undefined，因为这个位置在链表中并不存在（行 {5}）。然后，我们要初始化 node 变量，该变量会从链表的第一个元素 head（行 {2}）开始，迭代整个链表。如果你想和 LinkdedList 类中的其他方法保持相同的模式，也可以将 node 变量重命名为 current。</p>\n<p>然后，我们会迭代整个链表直到目标 index（行 {3}）。结束循环时，node 元素（行 {4}）将是 index 位置元素的引用。你也可以在 for 循环中使用 i = 1; i &lt;= index 来获得相同的结果。</p>\n<p>重构 remove 方法</p>\n<p>我们可以使用刚创建的 getElementAt 方法来重构 remove 方法。将行 {4}～行 {8} 替换为以下代码。</p>\n<p 9=\"\">if (index === 0) { // 第一个位置的逻辑 } else { const previous = this.getElementAt (index - 1); current = previous.next; previous.next = current.next; } this.count--; //</p>\n<p>在任意位置插入元素</p>\n<p>接下来，我们要实现 insert 方法。使用该方法可以在任意位置插入一个元素。我们来看一看它的实现。</p>\n<p>insert (element, index) { if (index &gt;= 0 &amp;&amp; index &lt;= this.count) { // {1} const node = new Node (element); if (index === 0) { // 在第一个位置添加 const current = this.head; node.next = current; // {2} this.head = node; } else { const previous = this.getElementAt (index - 1); // {3} const current = previous.next; // {4} node.next = current; // {5} previous.next = node; // {6} } this.count++; // 更新链表的长度 return true; } return false; // {7} }</p>\n<p>由于我们处理的是位置（索引），就需要检查越界值（行 {1}，跟 remove 方法类似）。如果越界了，就返回 false 值，表示没有添加元素到链表中（行 {7}）。</p>\n<p>如果位置合法，我们就要处理不同的场景。第一种场景是需要在链表的起点添加一个元素，也就是第一个位置，如下图所示。</p>\n<p>在上图中，current 变量是对链表中第一个元素的引用。我们需要做的是把 node.next 的值设为 current（链表中第一个元素，或简单地设为 head）。现在 head 和 node.next 都指向了 current。接下来要做的就是把 head 的引用改为 node（行 {2}），这样链表中就有了一个新元素。</p>\n<p>现在来处理第二种场景：在链表中间或尾部添加一个元素。首先，我们需要迭代链表，找到目标位置（行 {3}）。这个时候，我们会循环至 index - 1 的位置，表示需要添加新节点位置的前一个位置。</p>\n<p>当跳出循环时，previous 将是对想要插入新元素的位置之前一个元素的引用，current 变量（行 {4}）将是我们想要插入新元素的位置之后一个元素的引用。在这种情况下，我们要在 previous 和 current 之间添加新元素。因此，首先需要把新元素（node）和当前元素链接起来（行 {5}），然后需要改变 previous 和 current 之间的链接。我们还需要让 previous.next 指向 node（行 {6}），取代 current。</p>\n<p>我们通过一张图表来看看代码所做的事。</p>\n<p>如果试图向最后一个位置添加一个新元素，previous 将是对链表最后一个元素的引用，而 current 将是 undefined。在这种情况下，node.next 将指向 current，而 previous.next 将指向 node，这样链表中就有了一个新元素。</p>\n<p>现在来看看如何向链表中间添加一个新元素。</p>\n<p>在这种情况下，我们试图将新元素（node）插入 previous 和 current 元素之间。首先，我们需要把 node.next 的值指向 current，然后把 previous.next 的值设为 node。这样列表中就有了一个新元素。</p>\n<p>使用变量引用我们需要控制的节点非常重要，这样就不会丢失节点之间的链接。我们可以只使用一个变量（previous），但那样会很难控制节点之间的链接。因此，最好声明一个额外的变量来帮助我们处理这些引用。</p>\n<p>indexOf 方法：返回一个元素的位置</p>\n<p>indexOf 是我们下一个要实现的方法。indexOf 方法接收一个元素的值，如果在链表中找到了它，就返回元素的位置，否则返回 - 1。</p>\n<p>来看看它的实现。</p>\n<p>indexOf(element) { let current = this.head; // {1} for (let i = 0; i &lt; this.count &amp;&amp; current != null; i++) { // {2} if (this.equalsFn(element, current.element)) { // {3} return i; // {4} } current = current.next; // {5} } return -1; // {6} }</p>\n<p>一如既往，需要一个变量来帮助我们循环访问列表。该变量是 current，它的初始值是 head（行 {1}）。</p>\n<p>然后迭代元素（行 {2}），从 head（索引 0）开始，直到链表长度（count 变量）为止。为了确保不会发生运行时错误，我们可以验证一下 current 变量是否为 null 或 undefined。</p>\n<p>在每次迭代时，我们将验证 current 节点的元素和目标元素是否相等（行 {3}）。此时，我们会使用传入 LinkedList 类构造函数的用于判断相等的函数。equalFn 函数的默认值如下。</p>\n<p return=\"\" a=\"\">function defaultEquals(a, b)</p>\n<p>所以这和在行 {3} 使用 element === current.element 的作用是一样的。但是，如果元素是一个复杂对象的话，我们也允许开发者向 LinkedClass 中传入自定义的函数来判断元素是否相等。</p>\n<p>如果当前位置的元素就是我们要找的元素，就返回它的位置（行 {4}）。如果不是，就迭代下一个链表节点（行 {5}）。</p>\n<p>如果链表为空，或者我们迭代到链表尾部的话，循环就不会执行了。如果我们没有找到目标，则返回 - 1（行 {6}）。</p>\n<p>从链表中移除元素</p>\n<p>创建完 indexOf 方法之后，我们可以来实现其他方法，比如 remove 方法。</p>\n<p const=\"\" index=\"\" class=\"thisindexOf(element);\" return=\"\" this.removeAt(index);=\"\">remove(element)</p>\n<p>我们已经有了一个用来移除给定位置元素的方法（removeAt）。因为我们有了 indexOf 方法，如果传入元素的值，就可以找到它的位置，调用 removeAt 方法并传入该位置。这很简单，而且如果我们要修改 removeAt 方法的代码的话会更简单 —— 它会同时修改两个方法（这就是复用代码的好处）。这样，我们不用维护两个用来移除链表元素的方法 —— 只需要维护一个！另外，它们之间又通过 removeAt 方法相互联系。</p>\n<p>isEmpty、size 和 getHead 方法</p>\n<p>isEmpty 和 size 方法跟我们在上一章实现的一模一样，但我们还是来看一下。</p>\n<p return=\"\" this.count;=\"\">size()</p>\n<p>size 方法返回了链表的元素个数。和我们在前面章节实现的类不同，由于 LinkedList 是我们从头构建的类，链表的 length 变量是在内部控制的。</p>\n<p>如果列表中没有元素，isEmpty 方法就返回 true，否则返回 false。代码如下所示。</p>\n<p return=\"\" this.size()=\"\">isEmpty()</p>\n<p>最后还有 getHead 方法。</p>\n<p return=\"\" this.head;=\"\">getHead()</p>\n<p>head 变量是 LinkedList 类的私有变量（我们知道，JavaScript 还不支持真正的私有属性，但是为了教学需要，我们把实例的属性看作私有的，假设使用我们的类的开发者只会使用类和方法）。如果我们要在类的实现外部迭代链表，就需要提供一种获取类的第一个元素的方法。</p>\n<p>toString 方法</p>\n<p>toString 方法会把 LinkedList 对象转换成一个字符串。下面是 toString 方法的实现。</p>\n<p>toString() { if (this.head == null) { // {1} return ''; } let objString =  <code>$&#123;this.head.element&#125;</code> ; // {2} let current = this.head.next; // {3} for (let i = 1; i &lt; this.size() &amp;&amp; current != null; i++) { // {4} objString =  <code>$&#123;objString&#125;,$&#123;current.element&#125;</code> ; current = current.next; } return objString; // {5} }</p>\n<p>首先，如果链表为空（head 为 null 或 undefined），我们就返回一个空字符串（行 {1}）。我们也可以用 if (this.isEmpty ()) 来进行判断。</p>\n<p>如果链表不为空，我们就用链表第一个元素的值来初始化方法最后返回的字符串（objString）（行 {2}）。然后，我们迭代链表的所有其他元素（行 {4}），将元素值添加到字符串上。如果链表只有一个元素，current != null 验证将失败，因为 current 变量的值为 undefined（或 null），算法不会向 objString 添加其他值。</p>\n<p>最后，返回链表内容的字符串（行 {5}）。</p>\n<p>6.2　双向链表</p>\n<p>链表有多种不同的类型，本节介绍双向链表。双向链表和普通链表的区别在于，在链表中，一个节点只有链向下一个节点的链接；而在双向链表中，链接是双向的：一个链向下一个元素，另一个链向前一个元素，如下图所示。</p>\n<p>先从实现 DoublyLinkedList 类所需的变动开始。</p>\n<p>class DoublyNode extends Node {// {1} constructor (element, next, prev) { super (element, next); // {2} this.prev = prev; // {3} 新增的 } } class DoublyLinkedList extends LinkedList { // {4} constructor (equalsFn = defaultEquals) { super (equalsFn); // {5} this.tail = undefined; // {6} 新增的 } }</p>\n<p>DoublyLinkedList 类是一种特殊的 LinkedList 类，我们要扩展 LinkedList 类（行 {4}）。这表示 DoublyLinkedList 类将继承（可访问）LinkedList 类中所有的属性和方法。一开始，在 DoublyLinkedList 的构造函数中，我们要调用 LinkedList 的构造函数（行 {5}），它会初始化 equalsFn、count 和 head 属性。另外，我们也会保存对链表最后一个元素的引用（tail—— 行 {6}）。</p>\n<p>双向链表提供了两种迭代的方法：从头到尾，或者从尾到头。我们也可以访问一个特定节点的下一个或前一个元素。为了实现这种行为，还需要追踪每个节点的前一个节点。所以除了 Node 类中的 element 和 next 属性，DoubleLinkedList 会使用一个特殊的节点，这个名为 DoublyNode 的节点有一个叫作 prev 的属性（行 {3}）。DoublyNode 扩展了 Node 类，因此我们可以继承 element 和 next 属性（行 {1}）。由于使用了继承，我们需要在 DoublyNode 类的构造函数中调用 Node 的构造函数（行 {2}）。</p>\n<p>在单向链表中，如果迭代时错过了要找的元素，就需要回到起点，重新开始迭代。这是双向链表的一个优势。</p>\n<p>可以在前面的代码中看到，LinkedList 类和 DoublyLinkedList 类的区别用新增的标出了。</p>\n<p>6.2.1　在任意位置插入新元素</p>\n<p>向双向链表中插入一个新元素跟（单向）链表非常类似。区别在于，链表只要控制一个 next 指针，而双向链表则要同时控制 next 和 prev（previous，前一个）这两个指针。在 DoublyLinkedList 类中，我们将重写 insert 方法，表示我们会使用一个和 LinkedList 类中的方法行为不同的方法。</p>\n<p>下面是向任意位置插入一个新元素的算法。</p>\n<p>insert (element, index) { if (index &gt;= 0 &amp;&amp; index &lt;= this.count) { const node = new DoublyNode (element); let current = this.head; if (index === 0) { if (this.head == null) { // {1} 新增的 this.head = node; this.tail = node; } else { node.next = this.head; // {2} current.prev = node; // {3} 新增的 this.head = node; // {4} } } else if (index === this.count) { // 最后一项 // 新增的 current = this.tail; // {5} current.next = node; // {6} node.prev = current; // {7} this.tail = node; // {8} } else { const previous = this.getElementAt (index - 1); // {9} current = previous.next; // {10} node.next = current; // {11} previous.next = node; // {12} current.prev = node; // {13} 新增的 node.prev = previous; // {14} 新增的 } this.count++; return true; } return false; }</p>\n<p>我们来分析第一种场景：在双向链表的第一个位置（起点）插入一个新元素。如果双向链表为空（行 {1}），只需要把 head 和 tail 都指向这个新节点。如果不为空，current 变量将是对双向链表中第一个元素的引用。就像我们在链表中所做的，把 node.next 设为 current（行 {2}），而 head 将指向 node（行 {4}—— 它将成为双向链表中的第一个元素）。不同之处在于，我们还需要为指向上一个元素的指针设一个值。current.prev 指针将由指向 undefined 变为指向新元素（node—— 行 {3}）。node.prev 指针已经是 undefined，因此无须更新。</p>\n<p>下图演示了这个过程。</p>\n<p>现在来分析另一种场景：假设我们要在双向链表最后添加一个新元素。这是一种特殊情况，因为我们还控制着指向最后一个元素的指针。current 变量将引用最后一个元素（行 {5}），然后开始建立链接，current.next 指针（指向 undefined）将指向 node（行 {6}—— 基于构造函数的缘故，node.next 已经指向了 undefined）。node.prev 将引用 current（行 {7}）。最后只剩一件事了，就是更新 tail，它将由指向 current 变为指向 node（行 {8}）。</p>\n<p>下图展示了这些行为。</p>\n<p>然后还有第三种场景：在双向链表中间插入一个新元素。就像我们在之前的方法中所做的，迭代双向链表，直到要找的位置（行 {9}）。getElementAt 方法是从 LinkedList 类中继承的，不需要重写一遍。我们将在 current（行 {10}）和 previous 元素之间插入新元素。首先，node.next 将指向 current（行 {11}），而 previous.next 将指向 node（行 {12}），这样就不会丢失节点之间的链接。然后需要处理所有的链接：current.prev 将指向 node（行 {13}），而 node.prev 将指向 previous（行 {14}）。下图展示了这一过程。</p>\n<p>我们可以对 insert 和 remove 这两个方法的实现做一些改进。在结果为否的情况下，可以把元素插入双向链表的尾部。性能也可以有所改进，比如，如果 position 大于 length/2，就最好从尾部开始迭代，而不是从头开始（这样就能迭代双向链表中更少的元素）。</p>\n<p>6.2.2　从任意位置移除元素</p>\n<p>从双向链表中移除元素跟链表非常类似。唯一的区别就是，还需要设置前一个位置的指针。我们来看一下它的实现。</p>\n<p>removeAt (index) { if (index &gt;= 0 &amp;&amp; index &lt; this.count) { let current = this.head; if (index === 0) { this.head = current.next; // {1} // 如果只有一项，更新 tail // 新增的 if (this.count === 1) { // {2} this.tail = undefined; } else { this.head.prev = undefined; // {3} } } else if (index === this.count - 1) { // 最后一项 // 新增的 current = this.tail; // {4} this.tail = current.prev; // {5} this.tail.next = undefined; // {6} } else { current = this.getElementAt (index); // {7} const previous = current.prev; // {8} // 将 previous 与 current 的下一项链接起来 —— 跳过 current previous.next = current.next; // {9} current.next.prev = previous; // {10} 新增的 } this.count--; return current.element; } return undefined; }</p>\n<p>我们需要处理三种场景：从头部、从中间和从尾部移除一个元素。</p>\n<p>我们来看看如何移除第一个元素。current 变量是对双向链表中第一个元素的引用，也就是我们想移除的元素。我们需要做的就是改变 head 的引用，将其从 current 改为下一个元素（current.next—— 行 {1}），还需要更新 current.next 指向上一个元素的指针（因为第一个元素的 prev 指针是 undefined）。因此，把 head.prev 的引用改为 undefined（行 {3}—— 因为 head 也指向双向链表中新的第一个元素，也可以用 current.next.prev）。由于还需要控制 tail 的引用，我们可以检查要移除的元素是否是第一个元素，如果是，只需要把 tail 也设为 undefined（行 {2}）。</p>\n<p>下图展示了从双向链表移除第一个元素的过程。</p>\n<p>下一种场景是从最后一个位置移除元素。既然已经有了对最后一个元素的引用（tail），我们就不需要为找到它而迭代双向链表。这样也就可以把 tail 的引用赋给 current 变量（行 {4}）。接下来，需要把 tail 的引用更新为双向链表中倒数第二个元素（行 {5}——current.prev，或者 tail.prev）。既然 tail 指向了倒数第二个元素，我们就只需要把 next 指针更新为 undefined（行 {6}——tail.next= null）。下图演示了这一行为。</p>\n<p>第三种也是最后一种场景：从双向链表中间移除一个元素。首先需要迭代双向链表，直到要找的位置（行 {7}）。current 变量所引用的就是要移除的元素（行 {7}）。要移除它，我们可以通过更新 previous.next 和 current.next.prev 的引用，在双向链表中跳过它。因此，previous.next 将指向 current.next（行 {9}），而 current.next.prev 将指向 previous（行 {10}），如下图所示。</p>\n<p>要了解双向链表其他方法的实现，请参阅本书的配套源代码。源代码的下载链接见本书的前言，也可以通过 http://github.com/loiane/javascript-datastructures-algorithms 访问。</p>\n<p>6.3　循环链表</p>\n<p>循环链表可以像链表一样只有单向引用，也可以像双向链表一样有双向引用。循环链表和链表之间唯一的区别在于，最后一个元素指向下一个元素的指针（tail.next）不是引用 undefined，而是指向第一个元素（head），如下图所示。</p>\n<p>双向循环链表有指向 head 元素的 tail.next 和指向 tail 元素的 head.prev。</p>\n<p>我们来看创建 CircularLinkedList 类的代码。</p>\n<p>CircularLinkedList extends LinkedList { constructor(equalsFn = defaultEquals) { super(equalsFn); } }</p>\n<p>CircularLinkedList 类不需要任何额外的属性，所以直接扩展 LinkedList 类并覆盖需要改写的方法即可。</p>\n<p>我们将在后面重写 insert 和 removeAt 方法的实现。</p>\n<p>6.3.1　在任意位置插入新元素</p>\n<p>向循环链表中插入元素的逻辑和向普通链表中插入元素的逻辑是一样的。不同之处在于我们需要将循环链表尾部节点的 next 引用指向头部节点。下面是 CircularLinkedList 类的 insert 方法。</p>\n<p>insert (element, index) { if (index &gt;= 0 &amp;&amp; index &lt;= this.count) { const node = new Node (element); let current = this.head; if (index === 0) { if (this.head == null) { this.head = node; // {1} node.next = this.head; // {2} 新增的 } else { node.next = current; // {3} current = this.getElementAt (this.size ()); // {4} // 更新最后一个元素 this.head = node; // {5} current.next = this.head; // {6} 新增的 } } else { // 这种场景没有变化 const previous = this.getElementAt (index - 1); node.next = previous.next; previous.next = node; } this.count++; return true; } return false; }</p>\n<p>我们来分析一下不同的场景。第一种是我们想在循环链表第一个位置插入新元素。如果循环链表为空，我们就和在 LinkedList 类中一样将 head node 赋值为新创建的元素（行 {1}），并且将最后一个节点链接到 head（行 {2}）。这种情况下，循环链表最后的元素就是我们创建的指向自己的节点，因为它同时也是 head。</p>\n<p>下图展示了第一种情况。</p>\n<p>第二种情况是在一个非空循环链表的第一个位置插入元素，因此我们要做的第一件事是将 node.next 指向现在的 head 引用的节点（current 变量）。这是我们在 LinkedList 类中使用过的逻辑。但是，在 CircularLinkedList 中，我们还需要保证最后一个节点指向了这个新的头部元素，所以需要取得最后一个元素的引用。我们可以使用 getElementAt 方法，传入循环链表长度作为参数（行 {2}）。我们将头部元素更新为新元素，再将最后一个节点（current）指向新的头部节点（行 {3}）。</p>\n<p>下图展示了第二种情况。</p>\n<p>如果我们想在循环链表中间插入新元素，代码就和在 LinkedList 类中的一样了，因为我们对循环链表的第一个和最后一个节点没有做任何修改。</p>\n<p>6.3.2　从任意位置移除元素</p>\n<p>要从循环链表中移除元素，我们只需要考虑第二种情况，也就是修改循环链表的 head 元素。removeAt 方法的代码如下。</p>\n<p>removeAt (index) { if (index &gt;= 0 &amp;&amp; index &lt; this.count) { let current = this.head; if (index === 0) { if (this.size () === 1) { this.head = undefined; } else { const removed = this.head; // {1} current = this.getElementAt (this.size ()); // {2} 新增的 this.head = this.head.next; // {3} current.next = this.head; // {4} current = removed; // {5} } } else { // 不需要修改循环链表最后一个元素 const previous = this.getElementAt (index - 1); current = previous.next; previous.next = current.next; } this.count--; return current.element; // {6} } return undefined; }</p>\n<p>第一个场景是从只有一个元素的循环链表中移除一个元素。这种情况下，我们只需要将 head 赋值为 undefined，和 LinkedList 类中的实现一样。</p>\n<p>第二种情况是从一个非空循环链表中移除第一个元素。由于 head 的指向会改变，我们需要修改最后一个节点的 next 属性。那么，我们首先保存现在的 head 元素的引用，它将从循环链表中移除（行 {1}）。与我们在 insert 方法中所做的一样，同样需要获得循环链表最后一个元素的引用（行 {2}），它会被存储在 current 变量中。在取得所有所需节点的引用后，我们可以开始构建新的节点指向了。先更新 head element，将其指向第二个元素（head.next —— 行 {3}），然后我们将最后一个 element（current.next）指向新的 head（行 {4}）。我们可以更新 current 变量的引用（行 {5}），这样就能返回它（行 {6}）来表示移除元素的值。</p>\n<p>下图展示了这些操作。</p>\n<p>6.4　有序链表</p>\n<p>有序链表是指保持元素有序的链表结构。除了使用排序算法之外，我们还可以将元素插入到正确的位置来保证链表的有序性。</p>\n<p>先来声明 SortedLinkedList 类。</p>\n<p>const Compare = { LESS_THAN: -1, BIGGER_THAN: 1 }; function defaultCompare(a, b) { if (a === b) { // {1} return 0; } return a &lt; b ? Compare.LESS_THAN : Compare.BIGGER_THAN; // {2} } class SortedLinkedList extends LinkedList { constructor(equalsFn = defaultEquals, compareFn = defaultCompare) { super(equalsFn); this.compareFn = compareFn; // {3} } }</p>\n<p>SortedLinkedList 类会从 LinkedList 类中继承所有的属性和方法，但是由于这个类有特别的行为，我们需要一个用来比较元素的函数。因此，还需要声明 compareFn（行 {3}），用来比较元素。该函数会默认使用 defaultCompare。如果元素有相同的引用，它就返回 0（行 {1}）。如果第一个元素小于第二个元素，它就返回 - 1，反之则返回 1。为了保证代码优雅，我们可以声明一个 Compare 常量来表示每个值。如果用于比较的元素更复杂一些，我们可以创建自定义的比较函数并将它传入 SortedLinkedList 类的构造函数中。</p>\n<p>有序插入元素</p>\n<p>我们会用下面的代码来覆盖 insert 方法。</p>\n<p>insert(element, index = 0) { // {1} if (this.isEmpty()) { return super.insert(element, 0); // {2} } const pos = this.getIndexNextSortedElement(element); // {3} return super.insert(element, pos); // {4} } getIndexNextSortedElement(element) { let current = this.head; let i = 0; for (; i &lt; this.size() &amp;&amp; current; i++) { const comp = this.compareFn(element, current.element); // {5} if (comp === Compare.LESS_THAN) { // {6} return i; } current = current.next; } return i; // {7} }</p>\n<p>由于我们不想允许在任何位置插入元素，我们要给 index 参数设置一个默认值（行 {1}），以便直接调用 list.insert (myElement) 而无须传入 index 参数。如果 index 参数传给了方法，它的值会被忽略，因为插入元素的位置是内部控制的。我们这么做的原因是不想重写整个 LinkedList 类的方法，我们只需要覆盖 insert 方法的行为。如果你愿意，也可以从头创建 SortedLinkedList 类，把 LinkedList 类中的代码复制过来。但是这样会使代码维护变得困难，因为后面要修改代码的话，就需要修改两处而非一处。</p>\n<p>如果有序链表为空，我们可以直接调用 LinkedList 的 insert 方法并传入 0 作为 index（行 {2}）。如果有序链表不为空，我们会知道插入元素的正确位置（行 {3}）并调用 LinkedList 的 insert 方法，传入该位置来保证链表有序（行 {4}）。</p>\n<p>要获得插入元素的正确位置，我们需要创建一个叫作 getIndexNextSortedElement 的方法。在该方法里，我们需要迭代整个有序链表直至找到需要插入元素的位置，或是迭代完所有的元素。在后者的场景中，返回的 index（行 {7}）将是有序链表的长度（元素将被插入在链表的末尾）。我们将使用 compareFn（行 {5}）来比较传入构造函数的元素。当我们要插入有序链表的元素小于 current 的元素时，我们就找到了插入元素的位置（行 {6}）。</p>\n<p>就是这样了！我们可以在内部复用 LinkedList 的 insert 方法。其他方法例如 remove、indexOf 和 on 都和 LinkedList 是一样的。</p>\n<p>6.5　创建 StackLinkedList 类</p>\n<p>我们还可以使用 LinkedList 类及其变种作为内部的数据结构来创建其他数据结构，例如栈、队列和双向队列。在本节中，我们将学习怎样创建栈数据结构（参考第 4 章）。</p>\n<p>StackLinkedList 类结构和 push 与 pop 方法声明如下。</p>\n<p>class StackLinkedList { constructor() { this.items = new DoublyLinkedList(); // {1} } push(element) { this.items.push(element); // {2} } pop() { if (this.isEmpty()) { return undefined; } return this.items.removeAt(this.size() - 1); // {3} } }</p>\n<p>对于 StackLinkedList 类，我们将使用 DoublyLinkedList 来存储数据（行 {1}），而非使用数组或 JavaScript 对象。之所以使用双向链表而不是链表，是因为对栈来说，我们会向链表尾部添加元素（行 {2}），也会从链表尾部移除元素（行 {3}）。DoublyLinkedList 类有列表最后一个元素（tail）的引用，无须迭代整个链表的元素就能获取它。双向链表可以直接获取头尾的元素，减少过程消耗，它的时间复杂度和原始的 Stack 实现相同，为。</p>\n<p>我们也可以对 LinkedList 类进行优化，保存一个指向尾部元素的引用，并使用这个优化版本来代替 DoublyLinkedList。</p>\n<p>我们可以观察下面的 Stack 方法的代码。</p>\n<p return=\"\" this.items.toString();=\"\">peek() { if (this.isEmpty()) { return undefined; } return this.items.getElementAt(this.size() - 1).element; } isEmpty() { return this.items.isEmpty(); } size() { return this.items.size(); } clear() { this.items.clear(); } toString()</p>\n<p>我们实际在为每个其他方法调用 DoublyLinkedList 类的方法。在栈的实现内部使用链表数据结构会更加简单，因为不需要重新创建这些代码，也使代码的可读性更好。</p>\n<p>我们可以用相同的逻辑用 DoublyLinkedList 来创建 Queue 和 Deque 类，甚至使用 LinkedList 类也是可以的！</p>\n<p>6.6　小结</p>\n<p>本章介绍了链表这种数据结构，以及其变体：双向链表、循环链表和有序链表。你学习了如何在任意位置添加和移除元素，以及如何循环访问链表。你还学习了链表相比数组最重要的优点，那就是无须移动链表中的元素，就能轻松地添加和移除元素。因此，当你需要添加和移除很多元素时，最好的选择就是链表，而非数组。</p>\n<p>你还了解了如何使用内部链表存储元素来创建一个栈，而不是使用数组或对象；以及复用其他数据结构中可用的操作有什么好处，而不是重写所有的逻辑代码。</p>\n<p>在下一章中，你将学习集合。这是一种存储唯一元素的数据结构。</p>\n<h1 id=\"第-7-章-集合\"><a class=\"anchor\" href=\"#第-7-章-集合\">#</a> 第 7 章　集合</h1>\n<p>数组（列表）、栈、队列和链表这些顺序数据结构对你来说应该不陌生了。在本章，我们要学习集合，这是一种不允许值重复的顺序数据结构。我们将要学到如何创建集合这种数据结构，如何添加和移除值，如何搜索值是否存在。你也会学到如何进行并集、交集、差集等数学运算，还会学到如何使用 ECMAScript 2015（ES2015）原生的 Set 类。</p>\n<p>本章内容包括：</p>\n<p>从头创建一个 Set 类</p>\n<p>用 Set 来进行数学运算</p>\n<p>ECMAScript 2015 原生 Set 类</p>\n<p>7.1　构建数据集合</p>\n<p>集合是由一组无序且唯一（即不能重复）的项组成的。该数据结构使用了与有限集合相同的数学概念，但应用在计算机科学的数据结构中。</p>\n<p>在深入学习集合的计算机科学实现之前，我们先看看它的数学概念。在数学中，集合是一组不同对象的集。</p>\n<p>比如说，一个由大于或等于 0 的整数组成的自然数集合：N = {0, 1, 2, 3, 4, 5, 6, …}。集合中的对象列表用花括号（{}）包围。</p>\n<p>还有一个概念叫空集。空集就是不包含任何元素的集合。比如 24 和 29 之间的素数集合，由于 24 和 29 之间没有素数（除了 1 和自身，没有其他正因数的、大于 1 的自然数），这个集合就是空集。空集用 { } 表示。</p>\n<p>你也可以把集合想象成一个既没有重复元素，也没有顺序概念的数组。</p>\n<p>在数学中，集合也有并集、交集、差集等基本运算。本章也会介绍这些运算。</p>\n<p>7.2　创建集合类</p>\n<p>ECMAScript 2015 介绍了 Set 类是 JavaScript API 的一部分，你会在本章稍后学习到怎样使用它。我们将基于 ES2015 的 Set 类来实现我们自己的 Set 类。我们也会实现一些原生 ES2015 没有提供的集合运算，例如并集、交集和差集。</p>\n<p>用下面的 Set 类以及它的构造函数声明作为开始。</p>\n<p>class Set { constructor() { this.items = {}; } }</p>\n<p>有一个非常重要的细节是，我们使用对象而不是数组来表示集合（items）。不过，也可以用数组实现。此处用对象来实现，和我们在第 4 章与第 5 章中学习到的对象实现方式很相似。同样地，JavaScript 的对象不允许一个键指向两个不同的属性，也保证了集合里的元素都是唯一的。</p>\n<p>接下来，需要声明一些集合可用的方法（我们会尝试模拟与 ECMAScript 2015 实现相同的 Set 类）。</p>\n<p>add (element)：向集合添加一个新元素。</p>\n<p>delete (element)：从集合移除一个元素。</p>\n<p>has (element)：如果元素在集合中，返回 true，否则返回 false。</p>\n<p>clear ()：移除集合中的所有元素。</p>\n<p>size ()：返回集合所包含元素的数量。它与数组的 length 属性类似。</p>\n<p>values ()：返回一个包含集合中所有值（元素）的数组。</p>\n<p>7.2.1　has (element) 方法</p>\n<p>首先要实现的是 has (element) 方法，因为它会被 add、delete 等其他方法调用。它用来检验某个元素是否存在于集合中，下面看看它的实现。</p>\n<p>has(element){ return element in items; };</p>\n<p>既然我们使用对象来存储集合的元素，就可以用 JavaScript 的 in 运算符来验证给定元素是否是 items 对象的属性。</p>\n<p>然而这个方法还有更好的实现方式，如下所示。</p>\n<p return=\"\" Object.prototype.hasOwnProperty.call(this.items,=\"\" element);=\"\">has(element)</p>\n<p>Object 原型有 hasOwnProperty 方法。该方法返回一个表明对象是否具有特定属性的布尔值。in 运算符则返回表示对象在原型链上是否有特定属性的布尔值。</p>\n<p>我们也可以在代码中使用 this.items.hasOwnProperty (element)。但是，如果这样的话，代码检查工具如 ESLint 会抛出一个错误。错误的原因为不是所有的对象都继承了 Object.prototype，甚至继承了 Object.prototype 的对象上的 hasOwnProperty 方法也有可能被覆盖，导致代码不能正常工作。要避免出现任何问题，使用 Object.prototype.hasOwnProperty.call 是更安全的做法。</p>\n<p>7.2.2　add 方法</p>\n<p>接下来要实现 add 方法。</p>\n<p>add(element) { if (!this.has(element)) { this.items[element] = element; // {1} return true; } return false; }</p>\n<p>对于给定的 element，可以检查它是否存在于集合中。如果不存在，就把 element 添加到集合中（行 {1}），返回 true，表示添加了该元素。如果集合中已经有了这个元素，就返回 false，表示没有添加它。</p>\n<p>添加一个 element 的时候，把它同时作为键和值保存，因为这样有利于查找该元素。</p>\n<p>7.2.3　delete 和 clear 方法</p>\n<p>下面要实现 delete 方法。</p>\n<p>delete(element) { if (this.has(element)) { delete this.items[element]; // {1} return true; } return false; }</p>\n<p>在 delete 方法中，我们会验证给定的 element 是否存在于集合中。如果存在，就从集合中移除 element（行 {1}），返回 true，表示元素被移除；否则返回 false。</p>\n<p>既然我们用对象来存储集合的 items 对象，就可以简单地使用 delete 运算符从 items 对象中移除属性（行 {1}）。</p>\n<p>使用 Set 类的示例代码如下。</p>\n<p>const set = new Set(); set.add(1); set.add(2);</p>\n<p>出于好奇，如果在执行以上代码之后，在控制台（console.log）输出 this.items 变量，谷歌 Chrome 就会输出如下内容。</p>\n<p 1:=\"\" 1,=\"\" 2:=\"\" 2=\"\">Object</p>\n<p>可以看到，这是一个有两个属性的对象。属性名就是添加到集合的值，同时它也是属性值。</p>\n<p>如果想移除集合中的所有值，可以用 clear 方法。</p>\n<p>clear() { this.items = {}; // {2} }</p>\n<p>要重置 items 对象，需要做的只是把一个空对象重新赋值给它（行 {2}）。我们也可以迭代集合，用 delete 方法依次移除所有的值，不过既然有更简单的方法，这样做就太麻烦了。</p>\n<p>7.2.4　size 方法</p>\n<p>下一个要实现的是 size 方法（返回集合中有多少元素）。该方法有三种实现方式。</p>\n<p>第一种方式是使用一个 length 变量，每当使用 add 或 delete 方法时就控制它，就像在之前的章节中使用 LinkedList、Stack 和 Queue 类一样。</p>\n<p>第二种方式是使用 JavaScript 中 Object 类的一个内置方法（ECMAScript 2015 以上版本）。</p>\n<p>size() { return Object.keys(this.items).length; // {1} };</p>\n<p>JavaScript 的 Object 类有一个 keys 方法，它返回一个包含给定对象所有属性的数组。在这种情况下，可以使用这个数组的 length 属性（行 {1}）来返回 items 对象的属性个数。以上代码只能在现代浏览器（比如 IE9 以上版本、Firefox 4 以上版本、Chrome 5 以上版本、Opera 12 以上版本、Safari 5 以上版本等）中运行。</p>\n<p>第三种方式是手动提取 items 对象的每一个属性，记录属性的个数并返回这个数。该方法可以在任何浏览器上运行，和之前的代码是等价的。</p>\n<p>sizeLegacy() { let count = 0; for(let key in this.items) { // {2} if(this.items.hasOwnProperty(key)) { // {3} count++; // {4} } return count; };</p>\n<p>迭代 items 对象的所有属性（行 {2}），检查它们是否是对象自身的属性（避免重复计数 —— 行 {3}）。如果是，就递增 count 变量的值（行 {4}），最后在方法结束时返回这个数。</p>\n<p>我们不能简单地使用 for-in 语句迭代 items 对象的属性，并递增 count 变量的值，还需要使用 has 方法（以验证 items 对象具有该属性），因为对象的原型包含了额外的属性（属性既有继承自 JavaScript 的 Object 类的，也有属于对象自身、未用于数据结构的）。</p>\n<p>7.2.5　values 方法</p>\n<p>要实现 values 方法，我们同样可以使用 Object 类内置的 values 方法。</p>\n<p return=\"\" Object.values(this.items);=\"\">values()</p>\n<p>Object.values () 方法返回了一个包含给定对象所有属性值的数组。它是在 ECMAScript 2017 中被添加进来的，目前只在现代浏览器中可用。</p>\n<p>如果想让代码在任何浏览器中都能执行，可以用与之前代码等价的下面这段代码。</p>\n<p>valuesLegacy() { let values = []; for(let key in this.items) { // {1} if(this.items.hasOwnProperty(key)) { values.push(key); // {2} } } return values; };</p>\n<p>首先迭代 items 对象的所有属性（行 {1}），把它们添加到一个数组中（行 {2}），并返回这个数组。该方法类似于我们开发的 sizeLegacy 方法，但这里不是计算属性个数，而是在一个数组里做加法。</p>\n<p>7.2.6　使用 Set 类</p>\n<p>现在数据结构已经完成了，看看如何使用它吧。试着执行一些命令，测试我们的 Set 类。</p>\n<p>const set = new Set (); set.add (1); console.log (set.values ()); // 输出 [1] console.log (set.has (1)); // 输出 true console.log (set.size ()); // 输出 1 set.add (2); console.log (set.values ()); // 输出 [1, 2] console.log (set.has (2)); // 输出 true console.log (set.size ()); // 输出 2 set.delete (1); console.log (set.values ()); // 输出 [2] set.delete (2); console.log (set.values ()); // 输出 []</p>\n<p>现在我们有了一个和 ECMAScript 2015 中非常类似的 Set 类实现。</p>\n<p>7.3　集合运算</p>\n<p>集合是数学中基础的概念，在计算机领域也非常重要。它在计算机科学中的主要应用之一是数据库，而数据库是大多数应用程序的根基。集合被用于查询的设计和处理。当我们创建一条从关系型数据库（Oracle、Microsoft SQL Server、MySQL 等）中获取一个数据集合的查询语句时，使用的就是集合运算，并且数据库也会返回一个数据集合。当我们创建一条 SQL 查询命令时，可以指定是从表中获取全部数据还是获取其中的子集；也可以获取两张表共有的数据、只存在于一张表中的数据（不存在于另一张表中），或是存在于两张表内的数据（通过其他运算）。这些 SQL 领域的运算叫作联接，而 SQL 联接的基础就是集合运算。</p>\n<p>想学习更多有关 SQL 联接运算的知识，请阅读 http://www.sql-join.com/sql-join-types。</p>\n<p>我们可以对集合进行如下运算。</p>\n<p>并集：对于给定的两个集合，返回一个包含两个集合中所有元素的新集合。</p>\n<p>交集：对于给定的两个集合，返回一个包含两个集合中共有元素的新集合。</p>\n<p>差集：对于给定的两个集合，返回一个包含所有存在于第一个集合且不存在于第二个集合的元素的新集合。</p>\n<p>子集：验证一个给定集合是否是另一集合的子集。</p>\n<p>7.3.1　并集</p>\n<p>本节介绍并集的数学概念。集合和集合的并集表示如下。</p>\n<p>该集合定义如下。</p>\n<p>意思是（元素）存在于中，或存在于中。下图展示了并集运算。</p>\n<p>现在来实现 Set 类的 union 方法。</p>\n<p>union(otherSet) { const unionSet = new Set(); // {1} this.values().forEach(value =&gt; unionSet.add(value)); // {2} otherSet.values().forEach(value =&gt; unionSet.add(value)); // {3} return unionSet; }</p>\n<p>首先需要创建一个新的集合，代表两个集合的并集（行 {1}）。接下来，获取第一个集合（当前的 Set 类实例）所有的值（values），迭代并全部添加到代表并集的集合中（行 {2}）。然后对第二个集合做同样的事（行 {3}）。最后返回结果。</p>\n<p>既然我们创建的 values 方法返回一个数组，可以使用 Array 类的 forEach 方法来迭代数组的所有元素。需要提醒的是 forEach 方法是 ECMAScript 2015 中引入的。forEach 方法接收一个表示数组每个元素值的参数（value），同时有一个执行可编辑逻辑的回调函数。在之前的代码中，我们也使用了箭头函数（=&gt;）来代替显式声明 function (value) { unionSet.add (value) }。使用我们在第 2 章学到的 ES2015 的功能会使代码看起来更现代、更简明。</p>\n<p>也可以把 union 方法写成下面这样，不使用 forEach 方法和箭头函数，但是只要可以，我们就应该试着使用 ES2015 以上版本的功能。</p>\n<p>union(otherSet) { const unionSet = new Set(); // {1} let values = this.values(); // {2} for (let i = 0; i &lt; values.length; i++){ unionSet.add(values[i]); } values = otherSet.values(); // {3} for (let i = 0; i &lt; values.length; i++){ unionSet.add(values[i]); } return unionSet; };</p>\n<p>测试一下上面的代码。</p>\n<p>const setA = new Set(); setA.add(1); setA.add(2); setA.add(3); const setB = new Set(); setB.add(3); setB.add(4); setB.add(5); setB.add(6); const unionAB = setA.union(setB); console.log(unionAB.values());</p>\n<p>输出为 [1, 2, 3, 4, 5, 6]。注意元素 3 同时存在于 setA 和 setB 中，它在结果集合中只出现一次。</p>\n<p>重要的是要注意，本章实现的 union、intersection 和 difference 方法不会修改当前的 Set 类实例或是作为参数传入的 otherSet。没有副作用的方法和函数被称为纯函数。纯函数不会修改当前的实例或参数，只会生成一个新的结果。这在函数式编程中是非常重要的概念，本书后面的内容中会介绍。</p>\n<p>7.3.2　交集</p>\n<p>本节介绍交集的数学概念。集合和集合的交集表示如下。</p>\n<p>该集合定义如下。</p>\n<p>意思是（元素）存在于中，且存在于中。下图展示了交集运算。</p>\n<p>现在来实现 Set 类的 intersection 方法。</p>\n<p>intersection(otherSet) { const intersectionSet = new Set(); // {1} const values = this.values(); for (let i = 0; i &lt; values.length; i++) { // {2} if (otherSet.has(values[i])) { // {3} intersectionSet.add(values[i]); // {4} } } return intersectionSet; }</p>\n<p>intersection 方法需要找到当前 Set 实例中所有也存在于给定 Set 实例（otherSet）中的元素。首先创建一个新的 Set 实例（行 {1}），这样就能用它返回共有的元素。接下来，迭代当前 Set 实例所有的值（行 {2}），验证它们是否也存在于 otherSet 实例之中（行 {3}）。可以用本章前面实现的 has 方法来验证元素是否存在于 Set 实例中。然后，如果这个值也存在于另一个 Set 实例中，就将其添加到创建的 intersectionSet 变量中（行 {4}），最后返回它。</p>\n<p>我们做些测试。</p>\n<p>const setA = new Set(); setA.add(1); setA.add(2); setA.add(3); const setB = new Set(); setB.add(2); setB.add(3); setB.add(4); const intersectionAB = setA.intersection(setB); console.log(intersectionAB.values());</p>\n<p>输出为 [2, 3]，因为 2 和 3 同时存在于两个集合中。</p>\n<p>改进交集方法</p>\n<p>假设我们有下面两个集合：</p>\n<p>setA 的值为 [1, 2, 3, 4, 5, 6, 7]</p>\n<p>setB 的值为 [4, 6]</p>\n<p>使用我们创建的 intersection 方法，需要迭代七次 setA 的值，也就是 setA 中元素的个数，然后还要将这七个值和 setB 中的两个值进行比较。如果我们只需要迭代两次 setB 就好了，更少的迭代次数意味着更少的过程消耗。那么就来优化代码，使得迭代元素的次数更少吧，如下所示。</p>\n<p>intersection(otherSet) { const intersectionSet = new Set(); // {1} const values = this.values(); // {2} const otherValues = otherSet.values(); // {3} let biggerSet = values; // {4} let smallerSet = otherValues; // {5} if (otherValues.length - values.length &gt; 0) { // {6} biggerSet = otherValues; smallerSet = values; } smallerSet.forEach(value =&gt; { // {7} if (biggerSet.includes(value)) { intersectionSet.add(value); } }); return intersectionSet; }</p>\n<p>首先创建一个新的集合来存放 intersection 方法的返回结果（行 {1}）。同样要获取当前集合实例中的值（行 {2}）并将其作为参数传入 intersection 方法（行 {3}）。然后，假设当前的集合元素较多（行 {4}），另一个集合元素较少（行 {5}）。比较两个集合的元素个数（行 {6}），如果另一个集合元素个数多于当前集合的话，我们就交换 biggerSet 和 smallerSet 的值。最后，迭代较小集合（行 {7}）来计算出两个集合的共有元素并返回。</p>\n<p>7.3.3　差集</p>\n<p>本节介绍差集的数学概念。集合和集合的差集表示为，定义如下。</p>\n<p>意思是（元素）存在于中，且不存在于中。下图展示了集合和集合的差集运算。</p>\n<p>现在来实现 Set 类的 difference 方法。</p>\n<p>difference(otherSet) { const differenceSet = new Set(); // {1} this.values().forEach(value =&gt; { // {2} if (!otherSet.has(value)) { // {3} differenceSet.add(value); // {4} } }); return differenceSet; }</p>\n<p>intersection 方法会得到所有同时存在于两个集合中的元素。而 difference 方法会得到所有存在于集合但不存在于集合的元素。首先要创建结果集合（行 {1}），因为我们不想修改原来的集合。然后，要迭代集合中的所有值（行 {2}）。我们会检查当前值（元素）是否存在于给定集合中（行 {3}），如果不存在于 otherSet 中，则将此值加入结果集合中。</p>\n<p>（用跟 intersection 部分相同的集合）做些测试。</p>\n<p>const setA = new Set(); setA.add(1); setA.add(2); setA.add(3); const setB = new Set(); setB.add(2); setB.add(3); setB.add(4); const differenceAB = setA.difference(setB); console.log(differenceAB.values());</p>\n<p>输出为 [1]，因为 1 是唯一一个仅存在于 setA 的元素。如果我们执行 setB.difference (setA)，会得到 [4] 作为输出结果，因为 4 是只存在于 setB 中的元素。</p>\n<p>我们不能像优化 intersection 方法一样优化 difference 方法，因为 setA 与 setB 之间的差集可能和 setB 与 setA 之间的差集不同。</p>\n<p>7.3.4　子集</p>\n<p>要介绍的最后一个集合运算是子集。其数学概念的一个例子是集合是集合的子集（或集合包含集合），表示如下。</p>\n<p>该集合定义如下。</p>\n<p>意思是集合中的每一个（元素），也需要存在于集合中。下图展示了集合是集合的子集。</p>\n<p>现在来实现 Set 类的 isSubsetOf 方法。</p>\n<p>isSubsetOf(otherSet) { if (this.size() &gt; otherSet.size()) { // {1} return false; } let isSubset = true; // {2} this.values().every(value =&gt; { // {3} if (!otherSet.has(value)) { // {4} isSubset = false; // {5} return false; } return true; // {6} }); return isSubset; // {7} }</p>\n<p>首先需要验证的是当前 Set 实例的大小。如果当前实例中的元素比 otherSet 实例更多，它就不是一个子集（行 {1}）。子集的元素个数需要小于或等于要比较的集合。</p>\n<p>接下来，假定当前实例是给定集合的子集（行 {2}）。我们要迭代当前集合的所有元素（行 {3}），验证这些元素也存在于 otherSet 中（行 {4}）。如果有任何元素不存在于 otherSet 中，就意味着它不是一个子集，返回 false（行 {5}）。如果所有元素都存在于 otherSet 中，行 {5} 就不会被执行，那么就返回 true（行 {6}），isSubset 标识不会改变（行 {7}）。</p>\n<p>在 isSubsetOf 方法中，我们不会像在并集、交集和差集中一样使用 forEach 方法。我们会用 every 方法代替，它也是 ES2015 中的数组方法。第 3 章我们学习了 forEach 方法会在数组中的每个值上调用。在子集逻辑中，当我们发现一个值不存在于 otherSet 中时，可以停止迭代值，表示这不是一个子集。只要回调函数返回 true，every 方法就会被调用（行 {6}）。如果回调函数返回 false，循环会停止，这就是为什么我们要在行 {5} 改变 isSubset 标识的值。</p>\n<p>检验一下上面的代码效果如何。</p>\n<p>const setA = new Set(); setA.add(1); setA.add(2); const setB = new Set(); setB.add(1); setB.add(2); setB.add(3); const setC = new Set(); setC.add(2); setC.add(3); setC.add(4); console.log(setA.isSubsetOf(setB)); console.log(setA.isSubsetOf(setC));</p>\n<p>我们有三个集合：setA 是 setB 的子集（因此输出为 true），然而 setA 不是 setC 的子集（setC 只包含了 setA 中的 2，而不包含 1），因此输出为 false。</p>\n<p>7.4　ECMAScript 2015——Set 类</p>\n<p>ECMAScript 2015 新增了 Set 类作为 JavaScript API 的一部分。我们可以基于 ES2015 的 Set 开发我们的 Set 类。</p>\n<p>关于 ECMAScript 2015 中 Set 类的实现细节，请查阅 https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Set。</p>\n<p>我们先看看原生的 Set 类怎么用。</p>\n<p>还是用我们原来测试 Set 类的例子：</p>\n<p>const set = new Set (); set.add (1); console.log (set.values ()); // 输出 @Iterator console.log (set.has (1)); // 输出 true console.log (set.size); // 输出 1</p>\n<p>和原来的 Set 不同，ES2015 的 Set 的 values 方法返回 Iterator（第 3 章提到过），而不是值构成的数组。另一个区别是，我们实现的 size 方法返回 set 中存储的值的个数，而 ES2015 的 Set 则有一个 size 属性。</p>\n<p>我们可以用 delete 方法删除 set 中的元素。</p>\n<p>set.delete(1);</p>\n<p>clear 方法会重置 set 数据结构，这跟我们实现的功能一样。</p>\n<p>ES2015 Set 类的运算</p>\n<p>我们的 Set 类实现了并集、交集、差集、子集等数学运算，然而 ES2015 原生的 Set 并没有这些功能。不过，有需要的话，我们也可以模拟。</p>\n<p>我们的例子会用到下面两个集合。</p>\n<p>const setA = new Set(); setA.add(1); setA.add(2); setA.add(3); const setB = new Set(); setB.add(2); setB.add(3); setB.add(4);</p>\n<p>模拟并集运算</p>\n<p>我们可以创建一个函数，来返回包含 setA 和 setB 中所有的元素的新集合。迭代这两个集合，把所有元素都添加到并集的集合中。代码如下。</p>\n<p>const union = (setA, setB) =&gt; { const unionAb = new Set (); setA.forEach (value =&gt; unionAb.add (value)); setB.forEach (value =&gt; unionAb.add (value)); return unionAb; }; console.log (union (setA, setB)); // 输出 [1, 2, 3, 4]</p>\n<p>模拟交集运算</p>\n<p>模拟交集运算需要创建一个辅助函数，来生成包含 setA 和 setB 共有元素的新集合。代码如下。</p>\n<p>const intersection = (setA, setB) =&gt; { const intersectionSet = new Set (); setA.forEach (value =&gt; { if (setB.has (value)) { intersectionSet.add (value); } }); return intersectionSet; }; console.log (intersection (setA, setB)); // 输出 [2, 3]</p>\n<p>这和 intersection 函数的效果完全一样，但是上面的代码没有被优化（我们开发的是经过优化的版本）。</p>\n<p>模拟差集运算</p>\n<p>交集运算创建的集合包含 setA 和 setB 都有的元素，差集运算创建的集合则包含 setA 有而 setB 没有的元素。看下面的代码。</p>\n<p>const difference = (setA, setB) =&gt; { const differenceSet = new Set(); setA.forEach(value =&gt; { if (!setB.has(value)) { // {1} differenceSet.add(value); } }); return differenceSet; }; console.log(difference(setA, setB));</p>\n<p>intersection 函数和 difference 函数除函数名外只有行 {1} 不同，因为差集中只添加 setA 有而 setB 没有的元素。</p>\n<p>使用扩展运算符</p>\n<p>有一种计算并集、交集和差集的简便方法，就是使用扩展运算符，它包含在 ES2015 中，我们在第 2 章中学到过。</p>\n<p>整个过程包含三个步骤：</p>\n<p>(1) 将集合转化为数组；</p>\n<p>(2) 执行需要的运算；</p>\n<p>(3) 将结果转化回集合。</p>\n<p>我们来看看怎样用扩展运算符进行并集的计算。</p>\n<p>console.log(new Set([...setA, ...setB]));</p>\n<p>ES2015 的 Set 类支持向构造函数传入一个数组来初始化集合的运算，那么我们对 setA 使用扩展运算符（...setA）会将它的值转化为一个数组（展开它的值），然后对 setB 也这样做。</p>\n<p>由于 setA 的值为 [1, 2, 3]，setB 的值为 [2, 3, 4]，上述代码和 new Set ([1, 2, 3, 2, 3, 4]) 是一样的，但集合中每种值只会有一个。</p>\n<p>现在，我们来看看怎样用扩展运算符进行交集的运算。</p>\n<p>console.log(new Set([...setA].filter(x =&gt; setB.has(x))));</p>\n<p>上面的代码同样将 setA 转化为了一个数组，并使用了 filter 方法，它会返回一个新数组，包含能通过回调函数检测的值 —— 在本示例中验证了元素是否也存在于 setB 中。返回的数组会用来初始化结果集合。</p>\n<p>最后，我们来看看怎样用扩展运算符完成差集的运算。</p>\n<p>console.log(new Set([...setA].filter(x =&gt; !setB.has(x))));</p>\n<p>代码和求交集的运算很相似，不同之处在于我们需要的是不存在于 setB 中的元素。</p>\n<p>你可以使用你喜欢的方法来执行原生 ES2015 的 Set 类的集合运算！</p>\n<p>7.5　多重集或袋</p>\n<p>我们已经学习过，集合数据结构不允许存在重复的元素。但是，在数学中，有一个叫作多重集的概念，它允许我们向集合中插入之前已经添加过的元素。多重集（或袋）在计算集合中元素的出现次数时很有用。它也在数据库系统中得到了广泛运用。</p>\n<p>我们不会在本书中解释袋数据结构。不过，你可以下载本书的代码包来查看源代码，或访问 https://github.com/loiane/javascript-datastructures-algorithms。</p>\n<p>7.6　小结</p>\n<p>本章介绍了如何从头实现一个与 ECMAScript 2015 中所定义的 Set 类类似的 Set 类，还介绍了在其他编程语言的集合数据结构实现中不常见的一些方法，比如并集、交集、差集和子集。因此，相比于其他编程语言目前的 Set 实现，我们实现了一个非常完备的 Set 类。</p>\n<p>下一章，我们将介绍散列表和字典这两种非顺序数据结构。</p>\n<h1 id=\"第-8-章-字典和散列表\"><a class=\"anchor\" href=\"#第-8-章-字典和散列表\">#</a> 第 8 章　字典和散列表</h1>\n<p>上一章，我们学习了集合。本章会继续学习使用字典和散列表来存储唯一值（不重复的值）的数据结构。</p>\n<p>在集合中，我们感兴趣的是每个值本身，并把它当作主要元素。在字典（或映射）中，我们用 [键，值] 对的形式来存储数据。在散列表中也是一样（也是以 [键，值] 对的形式来存储数据）。但是两种数据结构的实现方式略有不同，例如字典中的每个键只能有一个值，本章中将会介绍。</p>\n<p>本章内容包括：</p>\n<p>字典数据结构</p>\n<p>散列表数据结构</p>\n<p>处理散列表中的冲突</p>\n<p>ECMAScript 2015 中的 Map、WeakMap 和 WeakSet 类</p>\n<p>8.1　字典</p>\n<p>你已经知道，集合表示一组互不相同的元素（不重复的元素）。在字典中，存储的是 [键，值] 对，其中键名是用来查询特定元素的。字典和集合很相似，集合以 [值，值] 的形式存储元素，字典则是以 [键，值] 的形式来存储元素。字典也称作映射、符号表或关联数组。</p>\n<p>在计算机科学中，字典经常用来保存对象的引用地址。例如，打开 Chrome | 开发者工具中的 Memory 标签页，执行快照功能，我们就能看到内存中的一些对象和它们对应的地址引用（用 @&lt;数&gt; 表示）。下面是该场景的截图。</p>\n<p>本章，我们会介绍在现实问题中使用字典数据结构的例子：一个实际的字典（单词和它们的释义）以及一个地址簿。</p>\n<p>8.1.1　创建字典类</p>\n<p>与 Set 类相似，ECMAScript 2015 同样包含了一个 Map 类的实现，即我们所说的字典。</p>\n<p>本章将要实现的类就是以 ECMAScript 2015 中 Map 类的实现为基础的。你会发现它和 Set 类很相似，但不同于存储 [值，值] 对的形式，我们将要存储的是 [键，值] 对。</p>\n<p>以下是我们的 Dictionary 类的骨架。</p>\n<p>import { defaultToString } from '../util'; export default class Dictionary { constructor(toStrFn = defaultToString) { this.toStrFn = toStrFn; // {1} this.table = {}; // {2} } }</p>\n<p>与 Set 类类似，我们将在一个 Object 的实例而不是数组中存储字典中的元素（table 属性 —— 行 {2}）。我们会将 [键，值] 对保存为 table [key] = {key, value}。</p>\n<p>JavaScript 允许我们使用方括号（[]）获取对象的属性，将属性名作为 “位置” 传入即可。这也是称它为关联数组的原因！我们在第 4 章、第 5 章以及第 7 章就已经使用过字典了。</p>\n<p>在字典中，理想的情况是用字符串作为键名，值可以是任何类型（从数、字符串等原始类型，到复杂的对象）。但是，由于 JavaScript 不是强类型的语言，我们不能保证键一定是字符串。我们需要把所有作为键名传入的对象转化为字符串，使得从 Dictionary 类中搜索和获取值更简单（同样的逻辑也可以应用在上一章的 Set 类上）。要实现此功能，我们需要一个将 key 转化为字符串的函数（行 {1}）。默认情况下，我们会使用在 utils.js 文件中定义的 defaultToString 函数（可以在所创建的任何数据结构中复用该文件中的函数）。</p>\n<p>由于我们使用了 ES2015 的默认参数功能，toStrFn 是一个可选的参数。如果需要的话，我们也可以传入自定义的函数来指定如何将 key 转化为字符串。</p>\n<p>defaultToString 函数声明如下。</p>\n<p>export function defaultToString(item) { if (item === null) { return 'NULL'; } else if (item === undefined) { return 'UNDEFINED'; } else if (typeof item === 'string' || item instanceof String) { return  <code>$&#123;item&#125;</code> ; } return item.toString(); // {1} }</p>\n<p>请注意，如果 item 变量是一个对象的话，它需要实现 toString 方法，否则会导致出现异常的输出结果，如 [object Object]。这对用户是不友好的。</p>\n<p>如果键（item）是一个字符串，那么我们直接返回它，否则要调用 item 的 toString 方法。</p>\n<p>然后，我们需要声明一些映射 / 字典所能使用的方法。</p>\n<p>set (key,value)：向字典中添加新元素。如果 key 已经存在，那么已存在的 value 会被新的值覆盖。</p>\n<p>remove (key)：通过使用键值作为参数来从字典中移除键值对应的数据值。</p>\n<p>hasKey (key)：如果某个键值存在于该字典中，返回 true，否则返回 false。</p>\n<p>get (key)：通过以键值作为参数查找特定的数值并返回。</p>\n<p>clear ()：删除该字典中的所有值。</p>\n<p>size ()：返回字典所包含值的数量。与数组的 length 属性类似。</p>\n<p>isEmpty ()：在 size 等于零的时候返回 true，否则返回 false。</p>\n<p>keys ()：将字典所包含的所有键名以数组形式返回。</p>\n<p>values ()：将字典所包含的所有数值以数组形式返回。</p>\n<p>keyValues ()：将字典中所有 [键，值] 对返回。</p>\n<p>forEach (callbackFn)：迭代字典中所有的键值对。callbackFn 有两个参数：key 和 value。该方法可以在回调函数返回 false 时被中止（和 Array 类中的 every 方法相似）。</p>\n<p>检测一个键是否存在于字典中</p>\n<p>我们首先来实现 hasKey (key) 方法。之所以要先实现这个方法，是因为它会被 set 和 remove 等其他方法调用。我们可以通过如下代码来实现。</p>\n<p return=\"\" this.table[this.toStrFn(key)]=\"\" !=\"\" null;=\"\">hasKey(key)</p>\n<p>JavaScript 只允许我们使用字符串作为对象的键名或属性名。如果传入一个复杂对象作为键，需要将它转化为一个字符串。因此我们需要调用 toStrFn 函数。如果已经存在一个给定键名的键值对（表中的位置不是 null 或 undefined），那么返回 true，否则返回 false。</p>\n<p>在字典和 ValuePair 类中设置键和值</p>\n<p>下面，我们来实现 set 方法，代码如下。</p>\n<p>set(key, value) { if (key != null &amp;&amp; value != null) { const tableKey = this.toStrFn(key); // {1} this.table[tableKey] = new ValuePair(key, value); // {2} return true; } return false; }</p>\n<p>该方法接收 key 和 value 作为参数。如果 key 和 value 不是 undefined 或 null，那么我们获取表示 key 的字符串（行 {1}），创建一个新的键值对并将其赋值给 table 对象上的 key 属性（tableKey）（行 {2}）。如果 key 和 value 是合法的，我们返回 true，表示字典可以将 key 和 value 保存下来，否则返回 false。</p>\n<p>该方法可以用于添加新的值，或是更新已有的值。</p>\n<p>在行 {2}，我们实例化了 ValuePair 类。ValuePair 类的定义如下。</p>\n<p>class ValuePair { constructor(key, value) { this.key = key; this.value = value; } toString() { return  <code>[#$&#123;this.key&#125;: $&#123;this.value&#125;]</code> ; } }</p>\n<p>为了在字典中保存 value，我们将 key 转化为了字符串，而为了保存信息的需要，我们同样要保存原始的 key。因此，我们不是只将 value 保存在字典中，而是要保存两个值：原始的 key 和 value。为了字典能更简单地通过 toString 方法输出结果，我们同样要为 ValuePair 类创建 toString 方法。</p>\n<p>从字典中移除一个值</p>\n<p>接下来，我们实现 remove 方法。它和 Set 类中的 delete 方法很相似，唯一的不同在于我们将先搜索 key（而不是 value）。</p>\n<p>remove(key) { if (this.hasKey(key)) { delete this.table[this.toStrFn(key)]; return true; } return false; }</p>\n<p>然后，可以使用 JavaScript 的 delete 运算符来从 items 对象中移除 key 属性。如果能够将 value 从字典中移除的话，就返回 true，否则将会返回 false。</p>\n<p>从字典中检索一个值</p>\n<p>如果我们想在字典中查找一个特定的 key，并检索它的 value，可以使用下面的方法。</p>\n<p>get(key) { const valuePair = this.table[this.toStrFn(key)]; // {1} return valuePair == null ? undefined : valuePair.value; // {2} }</p>\n<p>get 方法首先会检索存储在给定 key 属性中的对象（行 {1}）。如果 valuePair 对象存在，将返回该值，否则将返回一个 undefined 值（行 {2}）。</p>\n<p>该方法的另一个实现是先验证我们要获取的 value 是否存在（通过搜索它的 key），如果存在，我们就在 table 对象中找到它并返回。第二种实现的方式如下所示。</p>\n<p>get(key) { if (this.hasKey(key)) { return this.table[this.toStrFn(key)]; } return undefined; }</p>\n<p>但是，在第二种方式中，我们会获取两次 key 的字符串以及访问两次 table 对象：第一次是在 hasKey 方法中，第二次是在 if 语句内。这是个小细节，不过第一种方式的消耗更少。</p>\n<p>keys、values 和 valuePairs 方法</p>\n<p>我们已经给 Dictionary 类创建了最重要的方法，现在来创建一些很有用的辅助方法。</p>\n<p>下面将创建 valuePairs 方法，它会以数组形式返回字典中的所有 valuePair 对象。代码如下。</p>\n<p return=\"\" Object.values(this.table);=\"\">keyValues()</p>\n<p>代码很简单。我们执行了 JavaScript 的 Object 类内置的 values 方法，它是在第 2 章中介绍的 ECMAScript 2017 中引入的。</p>\n<p>可能不是所有浏览器都支持 Object.values 方法，我们也可以用下面的代码来代替。</p>\n<p>keyValues() { const valuePairs = []; for (const k in this.table) { // {1} if (this.hasKey(k)) { valuePairs.push(this.table[k]); // {2} } } return valuePairs; };</p>\n<p>在上面的代码中，我们迭代了 table 对象的所有属性（行 {1}）。为了保证 key 是存在的，我们会使用 hasKey 函数来进行检验，然后将 table 对象中的 valuePair 加入结果数组（行 {2}）。在该方法里，由于我们已经直接从 table 对象中获取了属性（key），不需要用 toStrFn 函数将它转化为字符串。</p>\n<p>我们不能仅使用 for-in 语句来迭代 table 对象的所有属性，还需要使用 hasKey 方法（验证 table 对象是否包含某个属性），因为对象的原型也会包含对象的其他属性（JavaScript 基本的 Object 类中的属性将会被继承，包括那些在当前数据结构中并不需要的属性）。</p>\n<p>接下来要创建的是 keys 方法。该方法返回 Dictionary 类中用于识别值的所有（原始）键名，如下所示。</p>\n<p return=\"\" this.keyValues().map(valuePair=\"\" class=\"&gt;valuePairkey);\">keys()</p>\n<p>我们将会调用所创建的 keyValues 方法来返回一个包含 valuePair 实例的数组，然后迭代每个 valuePair。由于我们只对 valuePair 的 key 属性感兴趣，就只返回它的 key。</p>\n<p>在上面的代码中，我们使用了 Array 类中的 map 方法来迭代每个 valuePair。map 方法可以将一个 value 转化为其他值。在本例中，我们将每个 valuePair 转化为了它的 key。在 keys 方法中使用的逻辑还可以写成下面这样。</p>\n<p>const keys = []; const valuePairs = this.keyValues(); for (let i = 0; i &lt; valuePairs.length; i++) { keys.push(valuePairs[i].key); } return keys;</p>\n<p>map 方法允许我们执行相同的逻辑并获得和上面代码相同的结果。一旦我们熟悉了它的语法，阅读代码和理解它的行为会变得更简单。</p>\n<p>第 3 章提到了 ES2015（ES6）引入的 map 方法。本书后面的章节会学习到函数式编程范式，我们创建的 keys 方法也使用了它。</p>\n<p>和 keys 方法相似，我们还有一个 values 方法。values 方法返回一个字典包含的所有值构成的数组。它的代码和 keys 方法很相似，只不过不同于返回 ValuePair 类的 key 属性，我们返回的是 value 属性，如下所示。</p>\n<p return=\"\" this.keyValues().map(valuePair=\"\" class=\"&gt;valuePairvalue);\">values()</p>\n<p>用 forEach 迭代字典中的每个键值对</p>\n<p>到目前为止，我们还没有创建一个能迭代数据结构中每个值的方法。下面，我们给 Dictionary 类创建一个 forEach 方法，也可以在之前学过的数据结构中使用与它相同的逻辑。</p>\n<p>forEach 方法如下所示。</p>\n<p>forEach(callbackFn) { const valuePairs = this.keyValues(); // {1} for (let i = 0; i &lt; valuePairs.length; i++) { // {2} const result = callbackFn(valuePairs[i].key, valuePairs[i].value); // {3} if (result === false) { break; // {4} } } }</p>\n<p>首先，我们获取字典中所有 valuePair 构成的数组（行 {1}）。然后，我们迭代每个 valuePair（行 {2}）并执行以参数形式传入 forEach 方法的 callbackFn 函数（行 {3}），保存它的结果。如果回调函数返回了 false，我们会中断 forEach 方法的执行（行 {4}），打断正在迭代 valuePairs 的 for 循环。</p>\n<p>clear、size、isEmpty 和 toString 方法</p>\n<p>size 方法返回字典中的值的个数。我们可以用 Object.keys 方法来获取 table 对象中的所有键名（和我们在 keyValues 方法中所做的一样）。size 方法的代码如下。</p>\n<p return=\"\" Object.keys(this.table).length;=\"\">size()</p>\n<p>我们也可以调用 keyValues 方法并返回它所返回的数组长度（return this.keyValues ().length）。</p>\n<p>要检验字典是否为空，我们可以获取它的 size 看看是否为零。如果 size 为零，表示字典为空。isEmpty 方法的实现就使用了这种逻辑，如下所示。</p>\n<p return=\"\" this.size()=\"\">isEmpty()</p>\n<p>要清空字典内容，我们只需要将一个新对象赋值给 table 即可。</p>\n<p>clear() { this.table =</p>\n<p>最后，可以像下面这样创建 toString 方法。</p>\n<p>toString() { if (this.isEmpty()) { return ''; } const valuePairs = this.keyValues(); let objString =  <code>$&#123;valuePairs[0].toString()&#125;</code> ; // {1} for (let i = 1; i &lt; valuePairs.length; i++) { objString =  <code>$&#123;objString&#125;,$&#123;valuePairs[i].toString()&#125;</code> ; // {2} } return objString; // {3} }</p>\n<p>在 toString 方法中，如果字典为空，我们就返回一个空字符串，否则调用 valuePair 的 toString 方法来将它的第一个 valuePair 加入结果字符串（行 {1}）。然后，如果数组中还有值，我们同样将其加入结果字符串（行 {2}），在方法末尾将字符串返回（行 {3}）。</p>\n<p>8.1.2　使用 Dictionary 类</p>\n<p>要使用 Dictionary 类，首先需要创建一个实例，然后给它添加三条电子邮件地址。我们将会使用这个 dictionary 实例来实现一个电子邮件地址簿。</p>\n<p>使用我们创建的类来执行如下代码。</p>\n<p>const dictionary = new Dictionary(); dictionary.set('Gandalf', 'gandalf@email.com'); dictionary.set('John', 'johnsnow@email.com'); dictionary.set('Tyrion', 'tyrion@email.com');</p>\n<p>如果执行了如下代码，输出结果将会是 true。</p>\n<p>console.log(dictionary.hasKey('Gandalf'));</p>\n<p>下面的代码将会输出 3，因为我们向字典实例中添加了三个元素。</p>\n<p>console.log(dictionary.size());</p>\n<p>现在，执行下面的几行代码。</p>\n<p>console.log(dictionary.keys()); console.log(dictionary.values()); console.log(dictionary.get('Tyrion'));</p>\n<p>输出结果分别如下所示。</p>\n<p>[&quot;Gandalf&quot;, &quot;John&quot;, &quot;Tyrion&quot;] [&quot;<span class=\"exturl\" data-url=\"bWFpbHRvOmdhbmRhbGZAZW1haWwuY29t\">gandalf@email.com</span>&quot;, &quot;<span class=\"exturl\" data-url=\"bWFpbHRvOmpvaG5zbm93QGVtYWlsLmNvbQ==\">johnsnow@email.com</span>&quot;, &quot;<span class=\"exturl\" data-url=\"bWFpbHRvOnR5cmlvbkBlbWFpbC5jb20=\">tyrion@email.com</span>&quot;] <span class=\"exturl\" data-url=\"bWFpbHRvOnR5cmlvbkBlbWFpbC5jb20=\">tyrion@email.com</span></p>\n<p>最后，再执行几行代码。</p>\n<p>dictionary.remove('John');</p>\n<p>再执行下面的代码。</p>\n<p>console.log(dictionary.keys()); console.log(dictionary.values()); console.log(dictionary.keyValues());</p>\n<p>输出结果如下所示。</p>\n<p>[&quot;Gandalf&quot;, &quot;Tyrion&quot;] [&quot;<span class=\"exturl\" data-url=\"bWFpbHRvOmdhbmRhbGZAZW1haWwuY29t\">gandalf@email.com</span>&quot;, &quot;<span class=\"exturl\" data-url=\"bWFpbHRvOnR5cmlvbkBlbWFpbC5jb20=\">tyrion@email.com</span>&quot;] [{key: &quot;Gandalf&quot;, value: &quot;<span class=\"exturl\" data-url=\"bWFpbHRvOmdhbmRhbGZAZW1haWwuY29t\">gandalf@email.com</span>&quot;}, {key: &quot;Tyrion&quot;, value: &quot;<span class=\"exturl\" data-url=\"bWFpbHRvOnR5cmlvbkBlbWFpbC5jb20=\">tyrion@email.com</span>&quot;}]</p>\n<p>移除一个元素后，现在的 dictionary 实例只包含两个元素了。加粗的一行表现了 table 对象的内部结构。</p>\n<p>要调用 forEach 方法，可以使用下面的代码。</p>\n<p>dictionary.forEach((k, v) =&gt; { console.log('forEach: ',  <code>key: $&#123;k&#125;, value: $&#123;v&#125;</code> ); });</p>\n<p>我们会得到下面的输出结果。</p>\n<p>forEach: key: Gandalf, value: <span class=\"exturl\" data-url=\"bWFpbHRvOmdhbmRhbGZAZW1haWwuY29t\">gandalf@email.com</span> forEach: key: Tyrion, value: <span class=\"exturl\" data-url=\"bWFpbHRvOnR5cmlvbkBlbWFpbC5jb20=\">tyrion@email.com</span></p>\n<p>8.2　散列表</p>\n<p>本节，你将会学到 HashTable 类，也叫 HashMap 类，它是 Dictionary 类的一种散列表实现方式。</p>\n<p>散列算法的作用是尽可能快地在数据结构中找到一个值。在之前的章节中，你已经知道如果要在数据结构中获得一个值（使用 get 方法），需要迭代整个数据结构来找到它。如果使用散列函数，就知道值的具体位置，因此能够快速检索到该值。散列函数的作用是给定一个键值，然后返回值在表中的地址。</p>\n<p>散列表有一些在计算机科学中应用的例子。因为它是字典的一种实现，所以可以用作关联数组。它也可以用来对数据库进行索引。当我们在关系型数据库（如 MySQL、Microsoft SQL Server、Oracle，等等）中创建一个新的表时，一个不错的做法是同时创建一个索引来更快地查询到记录的 key。在这种情况下，散列表可以用来保存键和对表中记录的引用。另一个很常见的应用是使用散列表来表示对象。JavaScript 语言内部就是使用散列表来表示每个对象。此时，对象的每个属性和方法（成员）被存储为 key 对象类型，每个 key 指向对应的对象成员。</p>\n<p>继续以前一节中使用的电子邮件地址簿为例。我们将使用最常见的散列函数 ——lose lose 散列函数，方法是简单地将每个键值中的每个字母的 ASCII 值相加，如下图所示。</p>\n<p>8.2.1　创建散列表</p>\n<p>我们将使用一个关联数组（对象）来表示我们的数据结构，和我们在 Dictionary 类中所做的一样。</p>\n<p>和之前一样，我们从搭建类的骨架开始。</p>\n<p>class HashTable { constructor(toStrFn = defaultToString) { this.toStrFn = toStrFn; this.table = {}; } }</p>\n<p>然后，给类添加一些方法。我们给每个类实现三个基本方法。</p>\n<p>put (key,value)：向散列表增加一个新的项（也能更新散列表）。</p>\n<p>remove (key)：根据键值从散列表中移除值。</p>\n<p>get (key)：返回根据键值检索到的特定的值。</p>\n<p>创建散列函数</p>\n<p>在实现这三个方法之前，我们要实现的第一个方法是散列函数，它的代码如下。</p>\n<p return=\"\" this.loseloseHashCode(key);=\"\">loseloseHashCode(key) { if (typeof key === 'number') { // {1} return key; } const tableKey = this.toStrFn(key); // {2} let hash = 0; // {3} for (let i = 0; i &lt; tableKey.length; i++) { hash += tableKey.charCodeAt(i); // {4} } return hash % 37; // {5} } hashCode(key)</p>\n<p>hashCode 方法简单地调用了 loseloseHashCode 方法，将 key 作为参数传入。</p>\n<p>在 loseloseHashCode 方法中，我们首先检验 key 是否是一个数（行 {1}）。如果是，我们直接将其返回。然后，给定一个 key 参数，我们就能根据组成 key 的每个字符的 ASCII 码值的和得到一个数。所以，首先需要将 key 转换为一个字符串（行 {2}），防止 key 是一个对象而不是字符串。我们需要一个 hash 变量来存储这个总和（行 {3}）。然后，遍历 key 并将从 ASCII 表中查到的每个字符对应的 ASCII 值加到 hash 变量中（行 {4}），可以使用 JavaScript 的 String 类中的 charCodeAt 方法。最后，返回 hash 值。为了得到比较小的数值，我们会使用 hash 值和一个任意数做除法的余数（%）（行 {5}）—— 这可以规避操作数超过数值变量最大表示范围的风险。</p>\n<p>要了解更多关于 ASCII 的信息，请访问 http://www.asciitable.com/。</p>\n<p>将键和值加入散列表</p>\n<p>现在我们有了自己的 hashCode 函数，下面来实现 put 方法。</p>\n<p>put(key, value) { if (key != null &amp;&amp; value != null) { // {1} const position = this.hashCode(key); // {2} this.table[position] = new ValuePair(key, value); // {3} return true; } return false; }</p>\n<p>put 方法和 Dictionary 类中的 set 方法逻辑相似。我们也可以将其命名为 set，但是大多数的编程语言会在 HashTable 数据结构中使用 put 方法，因此我们遵循相同的命名方式。</p>\n<p>首先，我们检验 key 和 value 是否合法（行 {1}），如果不合法就返回 false，表示这个值没有被添加（或更新）。对于给出的 key 参数，我们需要用所创建的 hashCode 函数在表中找到一个位置（行 {2}）。然后，用 key 和 value 创建一个 ValuePair 实例（行 {3}）。和 Dictionary 类相似，我们会为了信息备份将原始的 key 保存下来。</p>\n<p>从散列表中获取一个值</p>\n<p>从 HashTable 实例中获取一个值也很简单。我们像下面这样实现一个 get 方法。</p>\n<p const=\"\" valuePair=\"\" class=\"thistable[this.hashCode(key)]; =null?undefined:valuePairvalue;\" return=\"\" valuePair=\"\">get(key)</p>\n<p>首先，我们会用所创建的 hashCode 方法获取 key 参数的位置。该函数会返回对应值的位置，我们要做的就是到 table 数组中对应的位置取到值并返回。</p>\n<p>HashTable 和 Dictionary 类很相似。不同之处在于在 Dictionary 类中，我们将 valuePair 保存在 table 的 key 属性中（在它被转化为字符串之后），而在 HashTable 类中，我们由 key（hash）生成一个数，并将 valuePair 保存在 hash 位置（或属性）。</p>\n<p>从散列表中移除一个值</p>\n<p>我们要为 HashTable 实现的最后一个方法是 remove 方法，代码如下。</p>\n<p>remove(key) { const hash = this.hashCode(key); // {1} const valuePair = this.table[hash]; // {2} if (valuePair != null) { delete this.table[hash]; // {3} return true; } return false; }</p>\n<p>要从 HashTable 中移除一个值，首先需要知道值所在的位置，因此我们使用 hashCode 函数来获取 hash（行 {1}）。我们在 hash 的位置获取到 valuePair（行 {2}），如果 valuePair 不是 null 或 undefined，就使用 JavaScript 的 delete 运算符将其删除（行 {3}）。如果删除成功，就返回 true，否则返回 false。</p>\n<p>除了使用 JavaScript 的 delete 运算符，我们还可以将删除的 hash 位置赋值为 null 或 undefined。</p>\n<p>8.2.2　使用 HashTable 类</p>\n<p>让我们执行一些代码来测试 HashTable 类。</p>\n<p>const hash = new HashTable(); hash.put('Gandalf', 'gandalf@email.com'); hash.put('John', 'johnsnow@email.com'); hash.put('Tyrion', 'tyrion@email.com'); console.log(hash.hashCode('Gandalf') + ' - Gandalf'); console.log(hash.hashCode('John') + ' - John'); console.log(hash.hashCode('Tyrion') + ' - Tyrion');</p>\n<p>执行上述代码，会在控制台中获得如下输出。</p>\n<p>19 - Gandalf 29 - John 16 - Tyrion</p>\n<p>下图展现了包含这三个元素的 HashTable 数据结构。</p>\n<p>执行如下代码来测试 get 方法。</p>\n<p>console.log(hash.get('Gandalf')); // <span class=\"exturl\" data-url=\"bWFpbHRvOmdhbmRhbGZAZW1haWwuY29t\">gandalf@email.com</span> console.log(hash.get('Loiane')); // undefined</p>\n<p>由于 Gandalf 是一个在散列表中存在的键，get 方法将会返回它的值。而由于 Loiane 是一个不存在的键，当我们试图在数组中根据位置获取值的时候（一个由散列函数生成的位置），返回值将会是 undefined（即不存在）。</p>\n<p>然后，我们试试从散列表中移除 Gandalf。</p>\n<p>hash.remove('Gandalf'); console.log(hash.get('Gandalf'));</p>\n<p>由于 Gandalf 不再存在于表中，hash.get ('Gandalf') 方法将会在控制台上给出 undefined 的输出结果。</p>\n<p>8.2.3　散列表和散列集合</p>\n<p>散列表和散列映射是一样的，我们已经在本章中介绍了这种数据结构。</p>\n<p>在一些编程语言中，还有一种叫作散列集合的实现。散列集合由一个集合构成，但是插入、移除或获取元素时，使用的是 hashCode 函数。我们可以复用本章中实现的所有代码来实现散列集合，不同之处在于，不再添加键值对，而是只插入值而没有键。例如，可以使用散列集合来存储所有的英语单词（不包括它们的定义）。和集合相似，散列集合只存储不重复的唯一值。</p>\n<p>8.2.4　处理散列表中的冲突</p>\n<p>有时候，一些键会有相同的散列值。不同的值在散列表中对应相同位置的时候，我们称其为冲突。例如，我们看看下面的代码会得到怎样的输出结果。</p>\n<p>const hash = new HashTable(); hash.put('Ygritte', 'ygritte@email.com'); hash.put('Jonathan', 'jonathan@email.com'); hash.put('Jamie', 'jamie@email.com'); hash.put('Jack', 'jack@email.com'); hash.put('Jasmine', 'jasmine@email.com'); hash.put('Jake', 'jake@email.com'); hash.put('Nathan', 'nathan@email.com'); hash.put('Athelstan', 'athelstan@email.com'); hash.put('Sue', 'sue@email.com'); hash.put('Aethelwulf', 'aethelwulf@email.com'); hash.put('Sargeras', 'sargeras@email.com');</p>\n<p>通过对每个提到的名字调用 hash.hashCode 方法，输出结果如下。</p>\n<p>4 - Ygritte 5 - Jonathan 5 - Jamie 7 - Jack 8 - Jasmine 9 - Jake 10 - Nathan 7 - Athelstan 5 - Sue 5 - Aethelwulf 10 - Sargeras</p>\n<p>注意，Nathan 和 Sargeras 有相同的散列值（10）。Jack 和 Athelstan 有相同的散列值（7），Jonathan、Jamie、Sue 和 Aethelwulf 也有相同的散列值（5）。</p>\n<p>那 HashTable 实例会怎样呢？执行之前的代码后散列表中会有哪些值呢？</p>\n<p>为了获得结果，我们来实现 toString 方法。</p>\n<p>toString() { if (this.isEmpty()) { return ''; } const keys = Object.keys(this.table); let objString =  <code>&#123;$&#123;keys[0]&#125; =&gt; $&#123;this.table[keys[0]].toString()&#125;&#125;</code> ; for (let i = 1; i &lt; keys.length; i++) { objString =  <code>$&#123;objString&#125;,&#123;$&#123;keys[i]&#125; =&gt; $&#123;this.table[keys[i]].toString()&#125;&#125;</code> ; } return objString; }</p>\n<p>由于我们不知道表数组中的哪些位置有值，可以使用和 Dictionary 的 toString 方法相似的逻辑。</p>\n<p>在调用 console.log (hashTable.toString ()) 后，我们会在控制台中得到下面的输出结果。</p>\n<p 10=\"\" id=\"&gt;[Sargeras:\" sargeras@email.com]=\"\">{4 =&gt; [#Ygritte: <span class=\"exturl\" data-url=\"bWFpbHRvOnlncml0dGVAZW1haWwuY29t\">ygritte@email.com</span>]} {5 =&gt; [#Aethelwulf: <span class=\"exturl\" data-url=\"bWFpbHRvOmFldGhlbHd1bGZAZW1haWwuY29t\">aethelwulf@email.com</span>]} {7 =&gt; [#Athelstan: <span class=\"exturl\" data-url=\"bWFpbHRvOmF0aGVsc3RhbkBlbWFpbC5jb20=\">athelstan@email.com</span>]} {8 =&gt; [#Jasmine: <span class=\"exturl\" data-url=\"bWFpbHRvOmphc21pbmVAZW1haWwuY29t\">jasmine@email.com</span>]} {9 =&gt; [#Jake: <span class=\"exturl\" data-url=\"bWFpbHRvOmpha2VAZW1haWwuY29t\">jake@email.com</span>]}</p>\n<p>Jonathan、Jamie、Sue 和 Aethelwulf 有相同的散列值，也就是 5。由于 Aethelwulf 是最后一个被添加的，它将是在 HashTable 实例中占据位置 5 的元素。首先 Jonathan 会占据这个位置，然后 Jamie 会覆盖它，Sue 会再次覆盖，最后 Aethelwulf 会再覆盖一次。这对于其他发生冲突的元素来说也是一样的。</p>\n<p>使用一个数据结构来保存数据的目的显然不是丢失这些数据，而是通过某种方法将它们全部保存起来。因此，当这种情况发生的时候就要去解决。处理冲突有几种方法：分离链接、线性探查和双散列法。在本书中，我们会介绍前两种方法。</p>\n<p>分离链接</p>\n<p>分离链接法包括为散列表的每一个位置创建一个链表并将元素存储在里面。它是解决冲突的最简单的方法，但是在 HashTable 实例之外还需要额外的存储空间。</p>\n<p>例如，我们在之前的测试代码中使用分离链接并用图表示的话，输出结果将会是如下这样（为了简化，图表中的值被省略了）。</p>\n<p>在位置 5 上，将会有包含四个元素的 LinkedList 实例；在位置 7 和 10 上，将会有包含两个元素的 LinkedList 实例；在位置 4、8 和 9 上，将会有包含单个元素的 LinkedList 实例。</p>\n<p>对于分离链接和线性探查来说，只需要重写三个方法：put、get 和 remove。这三个方法在每种技术实现中都是不同的。</p>\n<p>和之前一样，我们来声明 HashTableSeparateChaining 的基本结构。</p>\n<p>class HashTableSeparateChaining { constructor(toStrFn = defaultToString) { this.toStrFn = toStrFn; this.table = {}; } }</p>\n<p>put 方法</p>\n<p>我们来实现第一个方法，即 put 方法，代码如下。</p>\n<p>put(key, value) { if (key != null &amp;&amp; value != null) { const position = this.hashCode(key); if (this.table[position] == null) { // {1} this.table[position] = new LinkedList(); // {2} } this.table[position].push(new ValuePair(key, value)); // {3} return true; } return false; }</p>\n<p>在这个方法中，我们将验证要加入新元素的位置是否已经被占据（行 {1}）。如果是第一次向该位置加入元素，我们会在该位置上初始化一个 LinkedList 类的实例（行 {2}—— 你已经在第 6 章中学习过）。然后，使用第 6 章中实现的 push 方法向 LinkedList 实例中添加一个 ValuePair 实例（键和值）（行 {3}）。</p>\n<p>get 方法</p>\n<p>然后，我们实现 get 方法，用来获取给定键的值。</p>\n<p>get(key) { const position = this.hashCode(key); const linkedList = this.table[position]; // {1} if (linkedList != null &amp;&amp; !linkedList.isEmpty()) { // {2} let current = linkedList.getHead(); // {3} while (current != null) { // {4} if (current.element.key === key) { // {5} return current.element.value; // {6} } current = current.next; // {7} } } return undefined; // {8} }</p>\n<p>首先要验证的是在特定的位置上是否有元素存在。我们在 position 位置检索 linkedList（行 {1}），并检验是否存在 linkedList 实例（行 {2}）。如果没有，则返回一个 undefined 表示在 HashTable 实例中没有找到这个值（行 {8}）。如果该位置上有值存在，我们知道这是一个 LinkedList 实例。现在要做的是迭代这个链表来寻找我们需要的元素。在迭代之前先要获取链表表头的引用（行 {3}），然后就可以从链表的头部迭代到尾部（行 {4}，最后 current.next 将会是 null）。</p>\n<p>Node 链表包含 next 指针和 element 属性。而 element 属性又是 ValuePair 的实例，所以它又有 value 和 key 属性。可以通过 current.element.key 来获得 Node 链表的 key 属性，并通过比较它来确定它是否就是我们要找的键（行 {5}）。如果 key 值相同，就返回 Node 的值（行 {6}）；如果不相同，就继续迭代链表，访问下一个节点（行 {7}）。这段逻辑允许我们搜索链表任意位置的任意 key 属性。</p>\n<p>另一个实现算法的思路如下：除了在 get 方法内部搜索 key，还可以在 put 方法中实例化 LinkedList，向 LinkedList 的构造函数传入自定义的 equalsFn，只用它来比较元素的 key 属性（即 ValuePair 实例）。我们要记住，默认情况下，LinkedList 会使用 === 运算符来比较它的元素实例，也就是说会比较 ValuePair 实例的引用。这种情况下，在 get 方法中，我们要使用 indexOf 方法来搜索目标 key，如果返回大于或等于零的位置，则说明元素存在于链表中。有了该位置，我们就可以使用 getElementAt 方法来从链表中获取 ValuePair 实例。</p>\n<p>remove 方法</p>\n<p>从 HashTableSeparateChaining 实例中移除一个元素和之前在本章实现的 remove 方法有一些不同。现在使用的是链表，我们需要从链表中移除一个元素。来看看 remove 方法的实现。</p>\n<p>remove(key) { const position = this.hashCode(key); const linkedList = this.table[position]; if (linkedList != null &amp;&amp; !linkedList.isEmpty()) { let current = linkedList.getHead(); while (current != null) { if (current.element.key === key) { // {1} linkedList.remove(current.element); // {2} if (linkedList.isEmpty()) { // {3} delete this.table[position]; // {4} } return true; // {5} } current = current.next; // {6} } } return false; // {7} }</p>\n<p>在 remove 方法中，我们使用和 get 方法一样的步骤找到要找的元素。迭代 LinkedList 实例时，如果链表中的 current 元素就是要找的元素（行 {1}），使用 remove 方法将其从链表中移除（行 {2}）。然后进行一步额外的验证：如果链表为空了（行 {3}—— 链表中不再有任何元素了），就使用 delete 运算符将散列表的该位置删除（行 {4}），这样搜索一个元素的时候，就可以跳过这个位置了。最后，返回 true 表示该元素已经被移除（行 {5}），或者在最后返回 false 表示该元素在散列表中不存在（行 {7}）。如果不是我们要找的元素，那么和 get 方法中一样继续迭代下一个元素（行 {6}）。</p>\n<p>重写了这三个方法后，我们就拥有了一个使用分离链接法来处理冲突的 HashTableSeparateChaining 实例。</p>\n<p>线性探查</p>\n<p>另一种解决冲突的方法是线性探查。之所以称作线性，是因为它处理冲突的方法是将元素直接存储到表中，而不是在单独的数据结构中。</p>\n<p>当想向表中某个位置添加一个新元素的时候，如果索引为 position 的位置已经被占据了，就尝试 position+1 的位置。如果 position+1 的位置也被占据了，就尝试 position+2 的位置，以此类推，直到在散列表中找到一个空闲的位置。想象一下，有一个已经包含一些元素的散列表，我们想要添加一个新的键和值。我们计算这个新键的 hash，并检查散列表中对应的位置是否被占据。如果没有，我们就将该值添加到正确的位置。如果被占据了，我们就迭代散列表，直到找到一个空闲的位置。</p>\n<p>下图展现了这个过程。</p>\n<p>当我们从散列表中移除一个键值对的时候，仅将本章之前的数据结构所实现位置的元素移除是不够的。如果我们只是移除了元素，就可能在查找有相同 hash（位置）的其他元素时找到一个空的位置，这会导致算法出现问题。</p>\n<p>线性探查技术分为两种。第一种是软删除方法。我们使用一个特殊的值（标记）来表示键值对被删除了（惰性删除或软删除），而不是真的删除它。经过一段时间，散列表被操作过后，我们会得到一个标记了若干删除位置的散列表。这会逐渐降低散列表的效率，因为搜索键值会随时间变得更慢。能快速访问并找到一个键是我们使用散列表的一个重要原因。下图展示了这个过程。</p>\n<p>第二种方法需要检验是否有必要将一个或多个元素移动到之前的位置。当搜索一个键的时候，这种方法可以避免找到一个空位置。如果移动元素是必要的，我们就需要在散列表中挪动键值对。下图展现了这个过程。</p>\n<p>两种方法都有各自的优缺点。本章会实现第二种方法（移动一个或多个元素到之前的位置）。要查看惰性删除的实现（HashTableLinearProbingLazy 类），请参考本书源代码。源代码的下载链接可以在本书前言中找到，你也可以访问 http://github.com/loiane/javascript-datastructures-algorithms 来查看。</p>\n<p>put 方法</p>\n<p>让我们继续实现需要重写的三个方法。第一个是 put 方法。</p>\n<p>put(key, value) { if (key != null &amp;&amp; value != null) { const position = this.hashCode(key); if (this.table[position] == null) { // {1} this.table[position] = new ValuePair(key, value); // {2} } else { let index = position + 1; // {3} while (this.table[index] != null) { // {4} index++; // {5} } this.table[index] = new ValuePair(key, value); // {6} } return true; } return false; }</p>\n<p>和之前一样，先获得由散列函数生成的位置，然后验证这个位置是否有元素存在（行 {1}）。如果没有元素存在（这是最简单的场景），就在这个位置添加新元素（行 {2}—— 一个 ValuePair 的实例）。</p>\n<p>如果该位置已经被占据了，需要找到下一个没有被占据的位置（position 的值是 undefined 或 null），因此我们声明一个 index 变量并赋值为 position+1（行 {3}）。然后验证该位置是否被占据（行 {4}），如果被占据了，继续将 index 递增（行 {5}），直到找到一个没有被占据的位置。然后我们要做的，就是将值分配到该位置（行 {6}）。</p>\n<p>在一些编程语言中，我们需要定义数组的大小。如果使用线性探查的话，需要注意的一个问题是数组的可用位置可能会被用完。当算法到达数组的尾部时，它需要循环回到开头并继续迭代元素。如果必要的话，我们还需要创建一个更大的数组并将元素复制到新数组中。在 JavaScript 中，不需要担心这个问题。我们不需要定义数组的大小，因为它可以根据需要自动改变 —— 这是 JavaScript 内置的一个功能。</p>\n<p>让我们来模拟一下散列表中的插入操作。</p>\n<p>(1) 试着插入 Ygritte。它的散列值是 4，由于散列表刚刚被创建，位置 4 还是空的，可以在这里插入数据。</p>\n<p>(2) 试着在位置 5 插入 Jonathan。它也是空的，所以可以插入这个姓名。</p>\n<p>(3) 试着在位置 5 插入 Jamie，因为它的散列值也是 5。位置 5 已经被 Jonathan 占据了，所以需要检查索引值为 position+1 的位置（5+1），位置 6 是空的，所以可以在位置 6 插入 Jamie。</p>\n<p>(4) 试着在位置 7 插入 Jack。它是空的，所以可以插入这个姓名，不会有冲突。</p>\n<p>(5) 试着在位置 8 插入 Jasmine。它是空的，所以可以插入这个姓名，不会有冲突。</p>\n<p>(6) 试着在位置 9 插入 Jake。它是空的，所以可以插入这个姓名，不会有冲突。</p>\n<p>(7) 试着在位置 10 插入 Nathan。它是空的，所以可以插入这个姓名，不会有冲突。</p>\n<p>(8) 试着在位置 7 插入 Athelstan。位置 7 已经被 Jack 占据了，所以需要检查索引值为 position+1 的位置（7+1）。位置 8 也被占据了，所以迭代到下一个空位置，也就是位置 11，并插入 Athelstan。</p>\n<p>(9) 试着在位置 5 插入 Sue，位置 5 到 11 都被占据了，所以我们在位置 12 插入 Sue。</p>\n<p>(10) 试着在位置 5 插入 Aethelwulf，位置 5 到 12 都被占据了，所以我们在位置 13 插入 Aethelwulf。</p>\n<p>(11) 试着在位置 10 插入 Sargeras，位置 10 到 13 都被占据了，所以我们在位置 14 插入 Sargeras。</p>\n<p>get 方法</p>\n<p>现在插入了所有的元素，让我们实现 get 方法来获取它们的值吧。</p>\n<p>get(key) { const position = this.hashCode(key); if (this.table[position] != null) { // {1} if (this.table[position].key === key) { // {2} return this.table[position].value; // {3} } let index = position + 1; // {4} while (this.table[index] != null &amp;&amp; this.table[index].key !== key) { // {5} index++; } if (this.table[index] != null &amp;&amp; this.table[index].key === key) { // {6} return this.table[position].value; // {7} } } return undefined; // {8} }</p>\n<p>要获得一个键对应的值，先要确定这个键存在（行 {1}）。如果这个键不存在，说明要查找的值不在散列表中，因此可以返回 undefined（行 {8}）。如果这个键存在，需要检查我们要找的值是否就是原始位置上的值（行 {2}）。如果是，就返回这个值（行 {3}）。</p>\n<p>如果不是，就在 HashTableLinearProbing 的下一个位置继续查找（行 {4}），我们会按位置递增的顺序查找散列表上的元素直到找到我们要找的元素，或者找到一个空位置（行 {5}）。当从 while 循环跳出的时候，我们要验证元素的键是否是我们要找的键（行 {6}），如果是，就返回它的值（行 {7}）。如果迭代完整个散列表并且 index 的位置上是 undefined 或 null 的话，说明要找的键不存在，返回 undefined（行 {8}）。</p>\n<p>remove 方法</p>\n<p>remove 方法和 get 方法基本相同，代码如下。</p>\n<p>remove(key) { const position = this.hashCode(key); if (this.table[position] != null) { if (this.table[position].key === key) { delete this.table[position]; // {1} this.verifyRemoveSideEffect(key, position); // {2} return true; } let index = position + 1; while (this.table[index] != null &amp;&amp; this.table[index].key !== key ) { index++; } if (this.table[index] != null &amp;&amp; this.table[index].key === key) { delete this.table[index]; // {3} this.verifyRemoveSideEffect(key, index); // {4} return true; } } return false; }</p>\n<p>在 get 方法中，当我们找到了要找的 key 后，返回它的值。在 remove 方法中，我们会从散列表中删除元素。可以直接从原始 hash 位置找到元素（行 {1}），如果有冲突并被处理了，我们可以在另一个位置找到元素（行 {3}）。由于我们不知道在散列表的不同位置上是否存在具有相同 hash 的元素，需要验证删除操作是否有副作用。如果有，就需要将冲突的元素移动至一个之前的位置，这样就不会产生空位置（行 {2} 和行 {4}）。要完成这项工作，我们将会创建一个工具方法，声明如下。</p>\n<p>verifyRemoveSideEffect(key, removedPosition) { const hash = this.hashCode(key); // {1} let index = removedPosition + 1; // {2} while (this.table[index] != null) { // {3} const posHash = this.hashCode(this.table[index].key); // {4} if (posHash &lt;= hash || posHash &lt;= removedPosition) { // {5} this.table[removedPosition] = this.table[index]; // {6} delete this.table[index]; removedPosition = index; } index++; } }</p>\n<p>verifyRemoveSideEffect 方法接收两个参数：被删除的 key 和该 key 被删除的位置。首先，我们要获取被删除的 key 的 hash 值（行 {1}—— 也可以将该值作为一个参数传入这个方法）。然后，我们会从下一个位置开始迭代散列表（行 {2}）直到找到一个空位置（行 {3}）。当空位置被找到后，表示元素都在合适的位置上，不需要进行移动（或更多的移动）。当迭代随后的元素时，我们需要计算当前位置上元素的 hash 值（行 {4}）。如果当前元素的 hash 值小于或等于原始的 hash 值（行 {5}）或者当前元素的 hash 值小于或等于 removedPosition（也就是上一个被移除 key 的 hash 值），表示我们需要将当前元素移动至 removedPosition 的位置（行 {6}）。移动完成后，我们可以删除当前的元素（因为它已经被复制到 removedPosition 的位置了）。我们还需要将 removedPosition 更新为当前的 index，然后重复这个过程。</p>\n<p>我们来考虑演示 put 方法所创建的散列表。假设我们想要从散列表中移除 Jonathan 元素。下面来模拟一下删除的过程。</p>\n<p>(1) 我们可以在位置 5 找到并删除 Jonathan。位置 5 现在空闲了。我们将验证一下是否有副作用。</p>\n<p>(2) 我们来到存储 Jamie 的位置 6，现在的散列值为 5，它的散列值 5 小于等于散列值 5，所以要将 Jamie 复制到位置 5 并删除 Jamie。位置 6 现在空闲了，我们来验证下一个位置。</p>\n<p>(3) 我们来到位置 7，这里保存了 Jack，散列值为 7。它的散列值 7 大于散列值 5，并且散列值 7 大于 removedPosition 的值 6，所以我们不需要移动它。下一个位置也被占据了，那么我们来验证下一个位置。</p>\n<p>(4) 我们来到位置 8，此处保存了 Jasmine，散列值为 8。散列值 8 大于 Jasmine 的散列值 5，并且散列值 8 大于 removedPosition 的值 6，因此不需要移动它。下一个位置也被占了，那么我们来验证下一个位置。</p>\n<p>(5) 我们来到位置 9，这里保存了 Jake，它的散列值是 9。散列值 9 大于散列值 5，并且散列值 9 大于 removedPosition 的值 6，所以不需要移动它。下一个位置也被占了，那么我们来验证下一个位置。</p>\n<p>(6) 我们重复相同的过程，直到位置 12。</p>\n<p>(7) 我们来到位置 12，此处保存了 Sue，它的散列值为 5。散列值 5 小于等于散列值 5，并且散列值 5 小于等于 removedPosition 的值 6，因此我们将 Sue 复制到位置 6，并删除位置 12 的 Sue。位置 12 现在空闲了。下一个位置也被占据了，那么我们来验证下一个位置。</p>\n<p>(8) 我们来到位置 13，此处保存了 Aethelwulf，它的散列值为 5。散列值 5 小于等于散列值 5，并且散列值 5 小于等于 removedPosition 的值 12，因此我们需要将 Aethelwulf 复制到位置 12 并删除位置 13 的值。位置 13 现在空闲了。下一个位置也被占据了，那么我们来验证下一个位置。</p>\n<p>(9) 我们来到位置 14，此处保存了 Sargeras，散列值为 10。散列值 10 大于 Aethelwulf 的散列值 5，但是散列值 10 小于等于 removedPosition 的值 13，因此我们要将 Sargeras 复制到位置 13 并删除位置 14 的值。位置 14 现在空闲了。下一个位置也是空闲的，那么本次执行完成了。</p>\n<p>8.2.5　创建更好的散列函数</p>\n<p>我们实现的 lose lose 散列函数并不是一个表现良好的散列函数，因为它会产生太多的冲突。一个表现良好的散列函数是由几个方面构成的：插入和检索元素的时间（即性能），以及较低的冲突可能性。我们可以在网上找到一些不同的实现方法，也可以实现自己的散列函数。</p>\n<p>另一个可以实现的、比 lose lose 更好的散列函数是 djb2。</p>\n<p>djb2HashCode(key) { const tableKey = this.toStrFn(key); // {1} let hash = 5381; // {2} for (let i = 0; i &lt; tableKey.length; i++) { // {3} hash = (hash * 33) + tableKey.charCodeAt(i); // {4} } return hash % 1013; // {5} }</p>\n<p>在将键转化为字符串之后（行 {1}），djb2HashCode 方法包括初始化一个 hash 变量并赋值为一个质数（行 {2}—— 大多数实现都使用 5381），然后迭代参数 key（行 {3}），将 hash 与 33 相乘（用作一个幻数 1），并和当前迭代到的字符的 ASCII 码值相加（行 {4}）。</p>\n<p>1 幻数在编程中指直接使用的常数。—— 编者注</p>\n<p>最后，我们将使用相加的和与另一个随机质数相除的余数（行 {5}），比我们认为的散列表大小要大。在本例中，我们认为散列表的大小为 1000。</p>\n<p>如果再次执行 8.2.4 节中插入数据的代码，这将是使用 djb2HashCode 代替 loseloseHashCode 的最终结果。</p>\n<p>807 - Ygritte 288 - Jonathan 962 - Jamie 619 - Jack 275 - Jasmine 877 - Jake 223 - Nathan 925 - Athelstan 502 - Sue 149 - Aethelwulf 711 - Sargeras</p>\n<p>没有冲突！</p>\n<p>这并不是最好的散列函数，但这是最受社区推崇的散列函数之一。</p>\n<p>也有一些为数字键值准备的散列函数，你可以在 http://t.cn/Eqg1yb0 找到一系列的实现。</p>\n<p>8.3　ES2015 Map 类</p>\n<p>ECMAScript 2015 新增了 Map 类。可以基于 ES2015 的 Map 类开发我们的 Dictionary 类。</p>\n<p>关于 ECMAScript 6 的 Map 类的实现细节，请查阅 https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map。</p>\n<p>我们看看原生的 Map 类怎么用。还是用我们原来测试 Dictionary 类的例子。</p>\n<p>const map = new Map (); map.set ('Gandalf', 'gandalf@email.com'); map.set ('John', 'johnsnow@email.com'); map.set ('Tyrion', 'tyrion@email.com'); console.log (map.has ('Gandalf')); //true console.log (map.size); // 3 console.log (map.keys ()); // 输出 {&quot;Gandalf&quot;, &quot;John&quot;, &quot;Tyrion&quot;} console.log (map.values ()); // 输出 {&quot;<span class=\"exturl\" data-url=\"bWFpbHRvOmdhbmRhbGZAZW1haWwuY29t\">gandalf@email.com</span>&quot;, &quot;<span class=\"exturl\" data-url=\"bWFpbHRvOmpvaG5zbm93QGVtYWlsLmNvbQ==\">johnsnow@email.com</span>&quot;, &quot;<span class=\"exturl\" data-url=\"bWFpbHRvOnR5cmlvbkBlbWFpbC5jb20=\">tyrion@email.com</span>&quot;} console.log(map.get('Tyrion')); // <span class=\"exturl\" data-url=\"bWFpbHRvOnR5cmlvbkBlbWFpbC5jb20=\">tyrion@email.com</span></p>\n<p>和我们的 Dictionary 类不同，ES2015 的 Map 类的 values 方法和 keys 方法都返回 Iterator（第 3 章提到过），而不是值或键构成的数组。另一个区别是，我们实现的 size 方法返回字典中存储的值的个数，而 ES2015 的 Map 类则有一个 size 属性。</p>\n<p>删除 map 中的元素可以用 delete 方法。</p>\n<p>map.delete('John');</p>\n<p>clear 方法会重置 map 数据结构，这跟我们在 Dictionary 类里实现的一样。</p>\n<p>8.4　ES2105 WeakMap 类和 WeakSet 类</p>\n<p>除了 Set 和 Map 这两种新的数据结构，ES2015 还增加了它们的弱化版本，WeakSet 和 WeakMap。</p>\n<p>基本上，Map 和 Set 与其弱化版本之间仅有的区别是：</p>\n<p>WeakSet 或 WeakMap 类没有 entries、keys 和 values 等方法；</p>\n<p>只能用对象作为键。</p>\n<p>创建和使用这两个类主要是为了性能。WeakSet 和 WeakMap 是弱化的（用对象作为键），没有强引用的键。这使得 JavaScript 的垃圾回收器可以从中清除整个入口。</p>\n<p>另一个优点是，必须用键才可以取出值。这些类没有 entries、keys 和 values 等迭代器方法，因此，除非你知道键，否则没有办法取出值。这印证了我们在第 4 章的做法，即使用 WeakMap 类封装 ES2015 类的私有属性。</p>\n<p>使用 WeakMap 类的例子如下。</p>\n<p 5=\"\">const map = new WeakMap(); const ob1 = { name: 'Gandalf' }; // {1} const ob2 = { name: 'John' }; const ob3 = { name: 'Tyrion' }; map.set(ob1, 'gandalf@email.com'); // {2} map.set(ob2, 'johnsnow@email.com'); map.set(ob3, 'tyrion@email.com'); console.log(map.has(ob1)); // true {3} console.log(map.get(ob3)); // <span class=\"exturl\" data-url=\"bWFpbHRvOnR5cmlvbkBlbWFpbC5jb20=\">tyrion@email.com</span> {4} map.delete(ob2); //</p>\n<p>WeakMap 类也可以用 set 方法（行 {2}），但不能使用数、字符串、布尔值等基本数据类型，需要将名字转换为对象（行 {1}）。</p>\n<p>搜索（行 {3}）、读取（行 {4}）和删除值（行 {5}），也要传入作为键的对象。</p>\n<p>同样的逻辑也适用于 WeakSet 类。</p>\n<p>8.5　小结</p>\n<p>在本章中，我们学习了字典的相关知识，了解了如何添加、移除和获取元素以及其他一些方法。我们还了解了字典和集合的不同之处。</p>\n<p>我们也学习了散列运算，怎样创建一个散列表（或者说散列映射）数据结构，如何添加、移除和获取元素，以及如何创建散列函数。我们学习了怎样使用两种不同的方法解决散列表中的冲突问题。</p>\n<p>我们还介绍了如何使用 ES2015 的 Map、WeakMap 和 WeakSet 类。</p>\n<p>在下一章中，我们将学习递归。</p>\n<h1 id=\"第-9-章-递归\"><a class=\"anchor\" href=\"#第-9-章-递归\">#</a> 第 9 章　递归</h1>\n<p>在之前的章节中，我们学习了不同的可迭代数据结构。从下一章开始，我们要使用一种特殊的方法使操作树和图数据结构变得更简单，那就是递归。但是学习树和图之前，我们需要先理解递归是如何工作的。</p>\n<p>本章内容包括：</p>\n<p>理解递归</p>\n<p>计算一个数的阶乘</p>\n<p>斐波那契数列</p>\n<p>JavaScript 调用栈</p>\n<p>9.1　理解递归</p>\n<p>有一句编程的至理名言是这样的：</p>\n<p>“要理解递归，首先要理解递归。”</p>\n<p>—— 佚名</p>\n<p>递归是一种解决问题的方法，它从解决问题的各个小部分开始，直到解决最初的大问题。递归通常涉及函数调用自身。</p>\n<p>递归函数是像下面这样能够直接调用自身的方法或函数。</p>\n<p recursiveFunction(someParam);=\"\">function recursiveFunction(someParam)</p>\n<p>能够像下面这样间接调用自身的函数，也是递归函数。</p>\n<p recursiveFunction1(someParam);=\"\">function recursiveFunction1(someParam){ recursiveFunction2(someParam); } function recursiveFunction2(someParam)</p>\n<p>假设现在必须要执行 recursiveFunction，结果是什么？单就上述情况而言，它会一直执行下去。因此，每个递归函数都必须有基线条件，即一个不再递归调用的条件（停止点），以防止无限递归。</p>\n<p>回到之前的编程至理名言，在理解了什么是递归之后，我们也就解决了最初的问题。如果我们把这句话翻译成 JavaScript 代码的话，可以写成下面这样。</p>\n<p>function understandRecursion (doIunderstandRecursion) { const recursionAnswer = confirm ('Do you understand recursion?'); if (recursionAnswer === true) { // 基线条件或停止点 return true; } understandRecursion (recursionAnswer); // 递归调用 }</p>\n<p>understandRecursion 函数会不断地调用自身，直到 recursionAnswer 为真（true）。recursionAnswer 为真就是上述代码的基线条件。</p>\n<p>下面来看看一些著名的递归算法。</p>\n<p>9.2　计算一个数的阶乘</p>\n<p>作为递归的第一个例子，我们来看看如何计算一个数的阶乘。数的阶乘，定义为，表示从 1 到的整数的乘积。</p>\n<p>5 的阶乘表示为 5!，和 5 × 4 × 3 × 2 × 1 相等，结果是 120。</p>\n<p>9.2.1　迭代阶乘</p>\n<p>如果尝试表示计算任意数的阶乘的步骤，可以将步骤定义如下：(n) * (n - 1) * (n - 2) * (n - 3) * ... * 1。</p>\n<p>可以使用循环来写一个计算一个数阶乘的函数，如下所示。</p>\n<p>function factorialIterative(number) { if (number &lt; 0) return undefined; let total = 1; for (let n = number; n &gt; 1; n--) { total = total * n; } return total; } console.log(factorialIterative(5)); // 120</p>\n<p>我们可以从给定的 number 开始计算阶乘，并减少，直到它的值为 2，因为 1 的阶乘还是 1，而且它已经被包含在 total 变量中了。零的阶乘也是 1。负数的阶乘不会被计算。</p>\n<p>9.2.2　递归阶乘</p>\n<p>现在我们试着用递归来重写 factorialIterative 函数，但是首先使用递归的定义来定义所有的步骤。</p>\n<p>5 的阶乘用 5 × 4 × 3 × 2 × 1 来计算。的阶乘用 4 × 3 × 2 × 1 来计算。计算的阶乘是我们计算原始问题的一个子问题，因此可以像下面这样定义 5 的阶乘。</p>\n<p>(1) factorial (5) = 5 * factorial (4)：我们可以用 5 × 4! 来计算 5!。</p>\n<p>(2) factorial (5) = 5 * (4 * factorial (3))：我们需要计算子问题 4!，它可以用 4 × 3! 来计算。</p>\n<p>(3) factorial (5) = 5 * 4 * (3 * factorial (2))：我们需要计算子问题 3!，它可以用 3 × 2! 来计算。</p>\n<p>(4) factorial (5) = 5 * 4 * 3 * (2 * factorial (1))：我们需要计算子问题 2!，它可以用 2 × 1! 来计算。</p>\n<p>(5) factorial (5) = 5 * 4 * 3 * 2 * (1)：我们需要计算子问题 1!。</p>\n<p>(6) factorial (1) 或 factorial (0) 返回 1。1! 等于 1。我们也可以说 1! = 1 × 0!，0! 也等于 1。</p>\n<p>使用递归的 factorial 函数定义如下。</p>\n<p>function factorial (n) { if (n === 1 || n === 0) { // 基线条件 return 1; } return n * factorial (n - 1); // 递归调用 } console.log (factorial (5)); // 120</p>\n<p>调用栈</p>\n<p>我们在第 4 章学习了栈数据结构。我们来看看在实际应用中用递归形式使用它的例子。每当一个函数被一个算法调用时，该函数会进入调用栈的顶部。当使用递归的时候，每个函数调用都会堆叠在调用栈的顶部，这是因为每个调用都可能依赖前一个调用的结果。</p>\n<p>我们可以用浏览器看到调用栈的行为，如下图所示。</p>\n<p>如果执行 factorial (3)，打开浏览器的开发者工具，打开 Sources 标签页，在 Factorial.js 文件中增加一个断点，当 n 的值为 1 时，我们可以看到 Call Stack 里有三个 factorial 函数的调用。如果继续执行，会看到当 factorial (1) 被返回后，Call Stack 开始弹出 factorial 的调用。</p>\n<p>我们也可以在函数开头添加 console.trace () 来在浏览器的控制台中查看结果。</p>\n<p console.trace();=\"\" 函数逻辑=\"\">function factorial(n)</p>\n<p>当 factorial (3) 被调用时，我们能在控制台中得到下面的结果。</p>\n<p>factorial @ 02-Factorial.js:18 (anonymous) @ 02-Factorial.js:25 //console.log (factorial (3)) 调用</p>\n<p>当 factorial (2) 被调用时，我们能在控制台中得到下面的结果。</p>\n<p>factorial @ 02-Factorial.js:18 factorial @ 02-Factorial.js:22 //factorial (3) 在等待 factorial (2) (anonymous) @ 02-Factorial.js:25 //console.log (factorial (3)) 调用</p>\n<p>最后，当 factorial (1) 被调用时，我们能在控制台中得到下面的结果。</p>\n<p>factorial @ 02-Factorial.js:18 factorial @ 02-Factorial.js:22 //factorial (2) 在等待 factorial (1) factorial @ 02-Factorial.js:22 //factorial (3) 在等待 factorial (2) (anonymous) @ 02-Factorial.js:25 //console.log (factorial (3)) 调用</p>\n<p>下图展示了执行的各个步骤和调用栈中的行为。</p>\n<p>当 factorial (1) 返回 1 时，调用栈会开始弹出调用，返回结果，直到 3 * factorial (2) 被计算。</p>\n<p>JavaScript 调用栈大小的限制</p>\n<p>如果忘记加上用以停止函数递归调用的基线条件，会发生什么呢？递归并不会无限地执行下去，浏览器会抛出错误，也就是所谓的栈溢出错误（stack overflow error）。</p>\n<p>每个浏览器都有自己的上限，可用以下代码测试。</p>\n<p console.log(i=\"\">let i = 0; function recursiveFn() { i++; recursiveFn(); } try { recursiveFn(); } catch (ex)</p>\n<p>在 Chrome v65 中，该函数执行了 15 662 次，而后浏览器抛出错误 RangeError: Maximum call stack size exceeded（超限错误：超过最大调用栈大小）。在 Firefox v59 中，该函数执行了 188 641 次，然后浏览器抛出错误 InternalError: too much recursion（内部错误：递归次数过多）。在 Edge v41 中，该函数执行了 17 654 次。</p>\n<p>根据操作系统和浏览器的不同，具体数值会所有不同，但区别不大。</p>\n<p>ECMAScript 2015 有尾调用优化（tail call optimization）。如果函数内的最后一个操作是调用函数（就像示例中加粗的那行），会通过 “跳转指令”（jump） 而不是 “子程序调用”（subroutine call）来控制。也就是说，在 ECMAScript 2015 中，这里的代码可以一直执行下去。因此，具有停止递归的基线条件非常重要。</p>\n<p>有关尾调用优化的更多相关信息，请访问 https://www.chromestatus.com/feature/5516876633341952。</p>\n<p>9.3　斐波那契数列</p>\n<p>斐波那契数列是另一个可以用递归解决的问题。它是一个由 0、1、1、2、3、5、8、13、21、34 等数组成的序列。数 2 由 1 + 1 得到，数 3 由 1 + 2 得到，数 5 由 2 + 3 得到，以此类推。斐波那契数列的定义如下。</p>\n<p>位置 0 的斐波那契数是零。</p>\n<p>1 和 2 的斐波那契数是 1。</p>\n<p>（此处）的斐波那契数是（）的斐波那契数加上（）的斐波那契数。</p>\n<p>9.3.1　迭代求斐波那契数</p>\n<p>我们用迭代的方法实现了 fibonacci 函数，如下所示。</p>\n<p>function fibonacciIterative(n) { if (n &lt; 1) return 0; if (n &lt;= 2) return 1; let fibNMinus2 = 0; let fibNMinus1 = 1; let fibN = n; for (let i = 2; i &lt;= n; i++) { // n &gt;= 2 fibN = fibNMinus1 + fibNMinus2; // f(n-1) + f(n-2) fibNMinus2 = fibNMinus1; fibNMinus1 = fibN; } return fibN; }</p>\n<p>9.3.2　递归求斐波那契数</p>\n<p>fibonacci 函数可以写成下面这样。</p>\n<p>function fibonacci(n){ if (n &lt; 1) return 0; // {1} if (n &lt;= 2) return 1; // {2} return fibonacci(n - 1) + fibonacci(n - 2); // {3} }</p>\n<p>在上面的代码中，有基线条件（行 {1} 和行 {2}）以及计算的斐波那契数的逻辑（行 {3}）。</p>\n<p>如果我们试着寻找 fibonacci (5)，下面是调用情况的结果。</p>\n<p>9.3.3　记忆化斐波那契数</p>\n<p>还有第三种写 fibonacci 函数的方法，叫作记忆化。记忆化是一种保存前一个结果的值的优化技术，类似于缓存。如果我们分析在计算 fibonacci (5) 时的调用，会发现 fibonacci (3) 被计算了两次，因此可以将它的结果存储下来，这样当需要再次计算它的时候，我们就已经有它的结果了。</p>\n<p>下面的代码展示了使用记忆化的 fibonacci 函数。</p>\n<p>function fibonacciMemoization(n) { const memo = [0, 1]; // {1} const fibonacci = (n) =&gt; { if (memo[n] != null) return memo[n]; // {2} return memo[n] = fibonacci(n - 1, memo) + fibonacci(n - 2, memo); // {3} }; return fibonacci; }</p>\n<p>在上面的代码中，我们声明了一个 memo 数组来缓存所有的计算结果（行 {1}）。如果结果已经被计算了，我们就返回它（行 {2}），否则计算该结果并将它加入缓存（行 {3}）。</p>\n<p>9.4　为什么要用递归？它更快吗</p>\n<p>我们运行一个检测程序来测试本章三种不同的 fibonacci 函数。</p>\n<p>迭代的版本比递归的版本快很多，所以这表示递归更慢。但是，再看看三个不同版本的代码。递归版本更容易理解，需要的代码通常也更少。另外，对一些算法来说，迭代的解法可能不可用，而且有了尾调用优化，递归的多余消耗甚至可能被消除。</p>\n<p>所以，我们经常使用递归，因为用它来解决问题会更简单。</p>\n<p>9.5　小结</p>\n<p>本章，我们学习了怎样写两种著名算法的迭代版本和递归版本：数的阶乘和斐波那契数列。我们学习了一种叫作记忆化的优化技术，它可以防止递归算法重复计算一个相同的值。</p>\n<p>我们还比较了斐波那契算法的迭代版本和递归版本的性能，了解了尽管迭代版本可能更快，但是递归算法会使人更容易阅读和理解它正在做什么。</p>\n<p>在下一章，我们将会学习树数据结构。我们会创建 Tree 类，而它的大部分方法会使用递归。</p>\n<h1 id=\"第-10-章-树\"><a class=\"anchor\" href=\"#第-10-章-树\">#</a> 第 10 章　树</h1>\n<p>到目前为止，本书已经介绍了一些顺序数据结构，而第一个非顺序数据结构是散列表。在本章，我们将要学习另一种非顺序数据结构 —— 树，它对于存储需要快速查找的数据非常有用。</p>\n<p>本章内容包括：</p>\n<p>树的相关术语</p>\n<p>创建二叉搜索树</p>\n<p>树的遍历</p>\n<p>添加和移除节点</p>\n<p>AVL 树</p>\n<p>10.1　树数据结构</p>\n<p>树是一种分层数据的抽象模型。现实生活中最常见的树的例子是家谱，或是公司的组织架构图，如下图所示。</p>\n<p>10.2　树的相关术语</p>\n<p>一个树结构包含一系列存在父子关系的节点。每个节点都有一个父节点（除了顶部的第一个节点）以及零个或多个子节点：</p>\n<p>位于树顶部的节点叫作根节点（11）。它没有父节点。树中的每个元素都叫作节点，节点分为内部节点和外部节点。至少有一个子节点的节点称为内部节点（7、5、9、15、13 和 20 是内部节点）。没有子元素的节点称为外部节点或叶节点（3、6、8、10、12、14、18 和 25 是叶节点）。</p>\n<p>一个节点可以有祖先和后代。一个节点（除了根节点）的祖先包括父节点、祖父节点、曾祖父节点等。一个节点的后代包括子节点、孙子节点、曾孙节点等。例如，节点 5 的祖先有节点 7 和节点 11，后代有节点 3 和节点 6。</p>\n<p>有关树的另一个术语是子树。子树由节点和它的后代构成。例如，节点 13、12 和 14 构成了上图中树的一棵子树。</p>\n<p>节点的一个属性是深度，节点的深度取决于它的祖先节点的数量。比如，节点 3 有 3 个祖先节点（5、7 和 11），它的深度为 3。</p>\n<p>树的高度取决于所有节点深度的最大值。一棵树也可以被分解成层级。根节点在第 0 层，它的子节点在第 1 层，以此类推。上图中的树的高度为 3（最大高度已在图中表示 —— 第 3 层）。</p>\n<p>现在我们知道了与树相关的一些最重要的概念，下面来学习更多有关树的知识。</p>\n<p>10.3　二叉树和二叉搜索树</p>\n<p>二叉树中的节点最多只能有两个子节点：一个是左侧子节点，另一个是右侧子节点。这个定义有助于我们写出更高效地在树中插入、查找和删除节点的算法。二叉树在计算机科学中的应用非常广泛。</p>\n<p>二叉搜索树（BST）是二叉树的一种，但是只允许你在左侧节点存储（比父节点）小的值，在右侧节点存储（比父节点）大的值。上一节的图中就展现了一棵二叉搜索树。</p>\n<p>二叉搜索树将是我们要在本章研究的数据结构。</p>\n<p>10.3.1　创建 BinarySearchTree 类</p>\n<p>我们先来创建 Node 类来表示二叉搜索树中的每个节点，代码如下。</p>\n<p>export class Node {constructor (key) { this.key = key; // {1} 节点值 this.left = null; // 左侧子节点引用 this.right = null; // 右侧子节点引用 } }</p>\n<p>下图展现了二叉搜索树数据结构的组织方式。</p>\n<p>和链表一样，我们将通过指针（引用）来表示节点之间的关系（树相关的术语称其为边）。在双向链表中，每个节点包含两个指针，一个指向下一个节点，另一个指向上一个节点。对于树，使用同样的方式（也使用两个指针），但是一个指向左侧子节点，另一个指向右侧子节点。因此，将声明一个 Node 类来表示树中的每个节点。值得注意的一个小细节是，不同于在之前的章节中将节点本身称作节点或项，我们将会称其为键（行 {1}）。键是树相关的术语中对节点的称呼。</p>\n<p>下面，我们会声明 BinarySearchTree 类的基本结构。</p>\n<p>import {Compare, defaultCompare} from '../util'; import { Node } from './models/node'; export default class BinarySearchTree { constructor (compareFn = defaultCompare) { this.compareFn = compareFn; // 用来比较节点值 this.root = null; // {1} Node 类型的根节点 } }</p>\n<p>我们将会遵循和 LinkedList 类中相同的模式（第 6 章），这表示也将声明一个变量以控制此数据结构的第一个节点。在树中，它不再是 head，而是 root（行 {1}）。</p>\n<p>然后，我们需要实现一些方法。下面是将要在 BinarySearchTree 类中实现的方法。</p>\n<p>insert (key)：向树中插入一个新的键。</p>\n<p>search (key)：在树中查找一个键。如果节点存在，则返回 true；如果不存在，则返回 false。</p>\n<p>inOrderTraverse ()：通过中序遍历方式遍历所有节点。</p>\n<p>preOrderTraverse ()：通过先序遍历方式遍历所有节点。</p>\n<p>postOrderTraverse ()：通过后序遍历方式遍历所有节点。</p>\n<p>min ()：返回树中最小的值 / 键。</p>\n<p>max ()：返回树中最大的值 / 键。</p>\n<p>remove (key)：从树中移除某个键。</p>\n<p>我们将在后面的小节中实现每个方法。</p>\n<p>10.3.2　向二叉搜索树中插入一个键</p>\n<p>本章要实现的方法会比前几章实现的方法稍微复杂一些。我们将会在方法中使用很多递归。如果你对递归还不熟悉的话，请先参考第 9 章。</p>\n<p>下面的代码是用来向树插入一个新键的算法的第一部分。</p>\n<p>insert(key) { if (this.root == null) { // {1} this.root = new Node(key); // {2} } else { this.insertNode(this.root, key); // {3} } }</p>\n<p>要向树中插入一个新的节点（或键），要经历三个步骤。</p>\n<p>第一步是验证插入操作是否是特殊情况。对于二叉搜索树的特殊情况是，我们尝试插入的树节点是否为第一个节点（行 {1}）。如果是，我们要做的就是创建一个 Node 类的实例并将它赋值给 root 属性来将 root 指向这个新节点（行 {2}）。因为在 Node 构建函数的属性里，只需要向构造函数传递我们想用来插入树的节点值（key），它的左指针和右指针的值会由构造函数自动设置为 null。</p>\n<p>第二步是将节点添加到根节点以外的其他位置。在这种情况下，我们需要一个辅助方法（行 {3}）来帮助我们做这件事，它的声明如下。</p>\n<p>insertNode(node, key) { if (this.compareFn(key, node.key) === Compare.LESS_THAN) { // {4} if (node.left == null) { // {5} node.left = new Node(key); // {6} } else { this.insertNode(node.left, key); // {7} } } else { if (node.right == null) { // {8} node.right = new Node(key); // {9} } else { this.insertNode(node.right, key); // {10} } } }</p>\n<p>insertNode 方法会帮助我们找到新节点应该插入的正确位置。下面是这个函数实现的步骤。</p>\n<p>如果树非空，需要找到插入新节点的位置。因此，在调用 insertNode 方法时要通过参数传入树的根节点和要插入的节点。</p>\n<p>如果新节点的键小于当前节点的键（现在，当前节点就是根节点）（行 {4}），那么需要检查当前节点的左侧子节点。注意在这里，由于键可能是复杂的对象而不是数，我们使用传入二叉搜索树构造函数的 compareFn 函数来比较值。如果它没有左侧子节点（行 {5}），就在那里插入新的节点（行 {6}）。如果有左侧子节点，需要通过递归调用 insertNode 方法（行 {7}）继续找到树的下一层。在这里，下次要比较的节点将会是当前节点的左侧子节点（左侧节点子树）。</p>\n<p>如果节点的键比当前节点的键大，同时当前节点没有右侧子节点（行 {8}），就在那里插入新的节点（行 {9}）。如果有右侧子节点，同样需要递归调用 insertNode 方法，但是要用来和新节点比较的节点将会是右侧子节点（右侧节点子树）（行 {10}）。</p>\n<p>我们来将这个逻辑应用在一个例子中，以便更好地理解这个过程。考虑下面的情景：我们有一棵新的树，并且想要向它插入第一个值。在这个例子中，我们执行下面的代码。</p>\n<p>const tree = new BinarySearchTree(); tree.insert(11);</p>\n<p>这种情况下，树中有一个单独的节点，根指针将会指向它。源代码的行 {1} 和行 {2} 将会执行。</p>\n<p>现在，来考虑下图所示树结构的情况。</p>\n<p>创建上图所示的树的代码如下，它们接着上面一段代码（插入了键为 11 的节点）之后输入执行。</p>\n<p>tree.insert(7); tree.insert(15); tree.insert(5); tree.insert(3); tree.insert(9); tree.insert(8); tree.insert(10); tree.insert(13); tree.insert(12); tree.insert(14); tree.insert(20); tree.insert(18); tree.insert(25);</p>\n<p>同时，我们想要插入一个值为 6 的键，执行下面的代码。</p>\n<p>tree.insert(6);</p>\n<p>下面的步骤将会被执行。</p>\n<p>(1) 树不是空的，行 {3} 的代码将会执行。insertNode 方法将会被调用（root, key [6]）。</p>\n<p>(2) 算法将会检测行 {4}（key [6] &lt; root [11] 为真），并继续检测行 {5}（node.left [7] 不是 null），然后将到达行 {7} 并调用 insertNode（node.left [7], key [6]）。</p>\n<p>(3) 再次进入 insertNode 方法内部，但是使用了不同的参数。它会再次检测行 {4}（key [6]&lt; node [7] 为真），然后再检测行 {5}（node.left [5] 不是 null），接着到达行 {7}，调用 insertNode（node.left [5], key [6]）。</p>\n<p>(4) 将再一次进入 insertNode 方法内部。它会再次检测行 {4}（key [6] &lt; node [5] 为假），然后到达行 {8}（node.right 是 null—— 节点 5 没有任何右侧的子节点），然后将会执行行 {9}，在节点 5 的右侧子节点位置插入键 6。</p>\n<p>(5) 然后，方法调用会依次出栈，代码执行过程结束。</p>\n<p>下图是插入键 6 后的结果。</p>\n<p>10.4　树的遍历</p>\n<p>遍历一棵树是指访问树的每个节点并对它们进行某种操作的过程。但是我们应该怎么去做呢？应该从树的顶端还是底端开始呢？从左开始还是从右开始呢？访问树的所有节点有三种方式：中序、先序和后序。</p>\n<p>在后面的小节中，我们将会深入了解这三种遍历方式的用法和实现。</p>\n<p>10.4.1　中序遍历</p>\n<p>中序遍历是一种以上行顺序访问 BST 所有节点的遍历方式，也就是以从最小到最大的顺序访问所有节点。中序遍历的一种应用就是对树进行排序操作。我们来看看它的实现。</p>\n<p>inOrderTraverse(callback) { this.inOrderTraverseNode(this.root, callback); // {1} }</p>\n<p>inOrderTraverse 方法接收一个回调函数作为参数。回调函数用来定义我们对遍历到的每个节点进行的操作（这也叫作访问者模式，要了解更多关于访问者模式的信息，请参考 http://en.wikipedia.org/wiki/Visitor_pattern）。由于我们在 BST 中最常实现的算法是递归，这里使用了一个辅助方法，来接收一个节点和对应的回调函数作为参数（行 {1}）。辅助方法如下所示。</p>\n<p>inOrderTraverseNode(node, callback) { if (node != null) { // {2} this.inOrderTraverseNode(node.left, callback); // {3} callback(node.key); // {4} this.inOrderTraverseNode(node.right, callback); // {5} } }</p>\n<p>要通过中序遍历的方法遍历一棵树，首先要检查以参数形式传入的节点是否为 null（行 {2}—— 这就是停止递归继续执行的判断条件，即递归算法的基线条件）。</p>\n<p>然后，递归调用相同的函数来访问左侧子节点（行 {3}）。接着对根节点（行 {4}）进行一些操作（callback），然后再访问右侧子节点（行 {5}）。</p>\n<p>我们试着在之前展示的树上执行下面的方法。</p>\n<p 7=\"\">const printNode = (value) =&gt; console.log(value); // {6} tree.inOrderTraverse(printNode); //</p>\n<p>首先，需要创建一个回调函数（行 {6}）。我们要做的，是在浏览器的控制台上输出节点的值。然后，调用 inOrderTraverse 方法并将回调函数作为参数传入（行 {7}）。当执行上面的代码后，下面的结果将会在控制台上输出（每个数将会输出在不同的行上）。</p>\n<p>3 5 6 7 8 9 10 11 12 13 14 15 18 20 25</p>\n<p>下图描绘了 inOrderTraverse 方法的访问路径。</p>\n<p>10.4.2　先序遍历</p>\n<p>先序遍历是以优先于后代节点的顺序访问每个节点的。先序遍历的一种应用是打印一个结构化的文档。</p>\n<p>我们来看其实现。</p>\n<p this.preOrderTraverseNode(this.root,=\"\" callback);=\"\">preOrderTraverse(callback)</p>\n<p>preOrderTraverseNode 方法的实现如下。</p>\n<p>preOrderTraverseNode(node, callback) { if (node != null) { callback(node.key); // {1} this.preOrderTraverseNode(node.left, callback); // {2} this.preOrderTraverseNode(node.right, callback); // {3} } }</p>\n<p>先序遍历和中序遍历的不同点是，先序遍历会先访问节点本身（行 {1}），然后再访问它的左侧子节点（行 {2}），最后是右侧子节点（行 {3}），而中序遍历的执行顺序是：{2}、{1} 和 {3}。</p>\n<p>下面是控制台上的输出结果（每个数将会输出在不同的行上）。</p>\n<p>11 7 5 3 6 9 8 10 15 13 12 14 20 18 25</p>\n<p>下图描绘了 preOrderTraverse 方法的访问路径：</p>\n<p>10.4.3　后序遍历</p>\n<p>后序遍历则是先访问节点的后代节点，再访问节点本身。后序遍历的一种应用是计算一个目录及其子目录中所有文件所占空间的大小。</p>\n<p>我们来看它的实现。</p>\n<p this.postOrderTraverseNode(this.root,=\"\" callback);=\"\">postOrderTraverse(callback)</p>\n<p>postOrderTraverseNode 方法的实现如下。</p>\n<p>postOrderTraverseNode(node, callback) { if (node != null) { this.postOrderTraverseNode(node.left, callback); // {1} this.postOrderTraverseNode(node.right, callback); // {2} callback(node.key); // {3} } }</p>\n<p>这个例子中，后序遍历会先访问左侧子节点（行 {1}），然后是右侧子节点（行 {2}），最后是父节点本身（行 {3}）。</p>\n<p>你会发现，中序、先序和后序遍历的实现方式是很相似的，唯一不同的是行 {1}、{2} 和 {3} 的执行顺序。</p>\n<p>下面是控制台的输出结果（每个数将会输出在不同行上）。</p>\n<p>3 6 5 8 10 9 7 12 14 13 18 25 20 15 11</p>\n<p>下图描绘了 postOrderTraverse 方法的访问路径。</p>\n<p>10.5　搜索树中的值</p>\n<p>在树中，有三种经常执行的搜索类型：</p>\n<p>搜索最小值</p>\n<p>搜索最大值</p>\n<p>搜索特定的值</p>\n<p>我们依次来看。</p>\n<p>10.5.1　搜索最小值和最大值</p>\n<p>我们使用下面的树作为示例。</p>\n<p>只用眼睛看这张图，你能立刻找到树中的最小值和最大值吗？</p>\n<p>如果你看一眼树最后一层最左侧的节点，会发现它的值为 3，这是这棵树中最小的键。如果你再看一眼树最右端的节点（同样是树的最后一层），会发现它的值为 25，这是这棵树中最大的键。这条信息在我们实现搜索树节点的最小值和最大值的方法时能给予我们很大的帮助。</p>\n<p>首先，我们来看寻找树的最小键的方法。</p>\n<p>min() { return this.minNode(this.root); // {1} }</p>\n<p>min 方法将会暴露给用户。这个方法调用了 minNode 方法（行 {1}）。</p>\n<p>minNode(node) { let current = node; while (current != null &amp;&amp; current.left != null) { // {2} current = current.left; // {3} } return current; // {4} }</p>\n<p>minNode 方法允许我们从树中任意一个节点开始寻找最小的键。我们可以使用它来找到一棵树或其子树中最小的键。因此，我们在调用 minNode 方法的时候传入树的根节点（行 {1}），因为我们想要找到整棵树的最小键。</p>\n<p>在 minNode 方法内部，我们会遍历树的左边（行 {2} 和行 {3}）直到找到树的最下层（最左端）。</p>\n<p>minNode 方法中使用的逻辑和我们在第 6 章中用来遍历到最后一个节点使用的代码很相似。这里的不同之处在于我们遍历到树最左端的节点。</p>\n<p>以相似的方式，可以实现 max 方法。</p>\n<p>max() { return this.maxNode(this.root); } maxNode(node) { let current = node; while (current != null &amp;&amp; current.right != null) { // {5} current = current.right; } return current; }</p>\n<p>要找到最大的键，我们要沿着树的右边进行遍历（行 {5}）直到找到最右端的节点。</p>\n<p>因此，对于寻找最小值，总是沿着树的左边；而对于寻找最大值，总是沿着树的右边。</p>\n<p>10.5.2　搜索一个特定的值</p>\n<p>在之前的章节中，我们同样实现了 find、search 或 get 方法来查找数据结构中的一个特定的值。我们将同样在 BST 中实现搜索的方法，来看它的实现。</p>\n<p>search(key) { return this.searchNode(this.root, key); // {1} } searchNode(node, key) { if (node == null) { // {2} return false; } if (this.compareFn(key, node.key) === Compare.LESS_THAN) { // {3} return this.searchNode(node.left, key); // {4} } else if ( this.compareFn(key, node.key) === Compare.BIGGER_THAN ) { // {5} return this.searchNode(node.right, key); // {6} } else { return true; // {7} } }</p>\n<p>我们要做的第一件事，是声明 search 方法。和 BST 中声明的其他方法的模式相同，我们将会使用一个辅助方法（行 {1}）。</p>\n<p>searchNode 方法可以用来寻找一棵树或其任意子树中的一个特定的值。这也是为什么在行 {1} 中调用它的时候传入树的根节点作为参数。</p>\n<p>在开始算法之前，要验证作为参数传入的 node 是否合法（不是 null 或 undefined）。如果是的话，说明要找的键没有找到，返回 false。</p>\n<p>如果传入的节点不是 null，需要继续验证。如果要找的键比当前的节点小（行 {3}），那么继续在左侧的子树上搜索（行 {4}）。如果要找的键比当前的节点大（行 {5}），那么就从右侧子节点开始继续搜索（行 {6}），否则就说明要找的键和当前节点的键相等，返回 true 来表示找到了这个键（行 {7}）。</p>\n<p>可以通过下面的代码来测试这个方法。</p>\n<p>console.log(tree.search(1) ? 'Key 1 found.' : 'Key 1 not found.'); console.log(tree.search(8) ? 'Key 8 found.' : 'Key 8 not found.');</p>\n<p>输出结果如下所示。</p>\n<p>Value 1 not found. Value 8 found.</p>\n<p>让我们详细展示是如何执行该方法来查找 1 这个键的。</p>\n<p>(1) 调用 searchNode 方法，传入根节点作为参数（行 {1}）。node [root [11]] 不为 null（行 {2}），因此我们执行到行 {3}。</p>\n<p>(2) key [1] &lt; node [11] 为真（行 {3}），因此来到行 {4} 并再次调用 searchNode 方法，传入 node [7], key [1] 作为参数。</p>\n<p>(3) node [7] 不为 null（行 {2}），因此继续执行行 {3}。</p>\n<p>(4) key [1] &lt; node [7] 为真（行 {3}），因此来到行 {4} 并再次调用 searchNode 方法，传入 node [5], key [1] 作为参数。</p>\n<p>(5) node [5] 不为 null（行 {2}），因此继续执行行 {3}。</p>\n<p>(6) key [1] &lt; node [5] 为真（行 {3}），因此来到行 {4} 并再次调用 searchNode 方法，传入 node [3], key [1] 作为参数。</p>\n<p>(7) node [3] 不为 null（行 {2}），因此来到行 {3}。</p>\n<p>(8) key [1] &lt; node [3] 为真（行 {3}），因此来到行 {4} 并再次调用 searchNode 方法，传入 null, key [1] 作为参数。null 被作为参数传入是因为 node [3] 是一个叶节点（它没有子节点，所以它的左侧子节点的值为 null）。</p>\n<p>(9) 节点的值为 null（行 {2}，这时要搜索的节点为 null），因此返回 false。</p>\n<p>(10) 然后，方法调用会依次出栈，代码执行过程结束。</p>\n<p>让我们再来查找值为 8 的节点。</p>\n<p>(1) 调用 searchNode 方法，传入 root 作为参数（行 {1}）。node [root [11]] 不为 null（行 {2}），因此我们来到行 {3}。</p>\n<p>(2) key [8] &lt; node [11] 为真（行 {3}），因此执行到行 {4} 并再次调用 searchNode 方法，传入 node [7], key [8] 作为参数。</p>\n<p>(3) node [7] 不为 null，因此来到行 {3}。</p>\n<p>(4) key [8] &lt; node [7] 为假（行 {3}），因此来到行 {5}。</p>\n<p>(5) key [8] &gt; node [7] 为真（行 {5}），因此来到行 {6} 并再次调用 searchNode 方法，传入 node [9], key [8] 作为参数。</p>\n<p>(6) node [9] 不为 null（行 {2}），因此来到行 {3}。</p>\n<p>(7) key [8] &lt; node [9] 为真（行 {3}），因此来到行 {4} 并再次调用 searchNode 方法，传入 node [8], key [8] 作为参数。</p>\n<p>(8) node [8] 不为 null（行 {2}），因此来到行 {3}。</p>\n<p>(9) key [8] &lt; node [8] 为假（行 {3}），因此来到行 {5}。</p>\n<p>(10) key [8] &gt; node [8] 为假（行 {5}），因此来到行 {7} 并返回 true，因为 node [8] 就是要找的键。</p>\n<p>(11) 然后，方法调用会依次出栈，代码执行过程结束。</p>\n<p>10.5.3　移除一个节点</p>\n<p>我们要为 BST 实现的下一个、也是最后一个方法是 remove 方法。这是我们在本书中要实现的最复杂的方法。我们先创建这个方法，使它能够在树的实例上被调用。</p>\n<p>remove(key) { this.root = this.removeNode(this.root, key); // {1} }</p>\n<p>这个方法接收要移除的键并且调用了 removeNode 方法，传入 root 和要移除的键作为参数（行 {1}）。我要提醒大家的一件非常重要的事情：root 被赋值为 removeNode 方法的返回值。我们稍后会明白其中的原因。</p>\n<p>removeNode 方法的复杂之处在于我们要处理不同的运行场景，当然也因为它同样是通过递归来实现的。</p>\n<p>我们来看 removeNode 方法的实现。</p>\n<p>removeNode (node, key) { if (node == null) { // {2} return null; } if (this.compareFn (key, node.key) === Compare.LESS_THAN) { // {3} node.left = this.removeNode (node.left, key); // {4} return node; // {5} } else if ( this.compareFn (key, node.key) === Compare.BIGGER_THAN ) { // {6} node.right = this.removeNode (node.right, key); // {7} return node; // {8} } else { // 键等于 node.key// 第一种情况 if (node.left == null &amp;&amp; node.right == null) { // {9} node = null; // {10} return node; // {11} } // 第二种情况 if (node.left == null) { // {12} node = node.right; // {13} return node; // {14} } else if (node.right == null) { // {15} node = node.left; // {16} return node; // {17} } // 第三种情况 const aux = this.minNode (node.right); // {18} node.key = aux.key; // {19} node.right = this.removeNode (node.right, aux.key); // {20} return node; // {21} } }</p>\n<p>我们来看行 {2}，如果正在检测的节点为 null，那么说明键不存在于树中，所以返回 null。</p>\n<p>如果不为 null，我们需要在树中找到要移除的键。因此，如果要找的键比当前节点的值小（行 {3}），就沿着树的左边找到下一个节点（行 {4}）。如果要找的键比当前节点的值大（行 {6}），那么就沿着树的右边找到下一个节点（行 {7}），也就是说我们要分析它的子树。</p>\n<p>如果我们找到了要找的键（键和 node.key 相等），就需要处理三种不同的情况。</p>\n<p>移除一个叶节点</p>\n<p>第一种情况是该节点是一个没有左侧或右侧子节点的叶节点 —— 行 {9}。在这种情况下，我们要做的就是给这个节点赋予 null 值来移除它（行 {9}）。但是当学习了链表的实现之后，我们知道仅仅赋一个 null 值是不够的，还需要处理引用（指针）。在这里，这个节点没有任何子节点，但是它有一个父节点，需要通过返回 null 来将对应的父节点指针赋予 null 值（行 {11}）。</p>\n<p>现在节点的值已经是 null 了，父节点指向它的指针也会接收到这个值，这也是我们为什么要在函数中返回节点的值。父节点总是会接收到函数的返回值。另一种可行的办法是将父节点和节点本身都作为参数传入方法内部。</p>\n<p>如果回头来看方法的第一行代码，会发现我们在行 {4} 和行 {7} 更新了节点左右指针的值，同样也在行 {5} 和行 {8} 返回了更新后的节点。</p>\n<p>下图展现了移除一个叶节点的过程。</p>\n<p>移除有一个左侧或右侧子节点的节点</p>\n<p>现在我们来看第二种情况，移除有一个左侧子节点或右侧子节点的节点。这种情况下，需要跳过这个节点，直接将父节点指向它的指针指向子节点。</p>\n<p>如果这个节点没有左侧子节点（行 {12}），也就是说它有一个右侧子节点。因此我们把对它的引用改为对它右侧子节点的引用（行 {13}）并返回更新后的节点（行 {14}）。如果这个节点没有右侧子节点，也是一样 —— 把对它的引用改为对它左侧子节点的引用（行 {16}）并返回更新后的值（行 {17}）。</p>\n<p>下图展现了移除只有一个左侧子节点或右侧子节点的节点的过程。</p>\n<p>移除有两个子节点的节点</p>\n<p>现在是第三种情况，也是最复杂的情况，那就是要移除的节点有两个子节点 —— 左侧子节点和右侧子节点。要移除有两个子节点的节点，需要执行四个步骤。</p>\n<p>(1) 当找到了要移除的节点后，需要找到它右边子树中最小的节点（它的继承者 —— 行 {18}）。</p>\n<p>(2) 然后，用它右侧子树中最小节点的键去更新这个节点的值（行 {19}）。通过这一步，我们改变了这个节点的键，也就是说它被移除了。</p>\n<p>(3) 但是，这样在树中就有两个拥有相同键的节点了，这是不行的。要继续把右侧子树中的最小节点移除，毕竟它已经被移至要移除的节点的位置了（行 {20}）。</p>\n<p>(4) 最后，向它的父节点返回更新后节点的引用（行 {21}）。</p>\n<p>findMinNode 方法的实现和 min 方法的实现方式是一样的。唯一的不同之处在于，在 min 方法中只返回键，而在 findMinNode 中返回了节点。</p>\n<p>下图展现了移除有两个子节点的节点的过程。</p>\n<p>10.6　自平衡树</p>\n<p>现在你知道如何使用二叉搜索树了，如果愿意的话，可以继续学习更多关于树的知识。</p>\n<p>BST 存在一个问题：取决于你添加的节点数，树的一条边可能会非常深；也就是说，树的一条分支会有很多层，而其他的分支却只有几层，如下图所示。</p>\n<p>这会在需要在某条边上添加、移除和搜索某个节点时引起一些性能问题。为了解决这个问题，有一种树叫作 Adelson-Velskii-Landi 树（AVL 树）。AVL 树是一种自平衡二叉搜索树，意思是任何一个节点左右两侧子树的高度之差最多为 1。在下一节中，你会学到更多关于 AVL 数的知识。</p>\n<p>10.6.1　Adelson-Velskii-Landi 树（AVL 树）</p>\n<p>AVL 树是一种自平衡树。添加或移除节点时，AVL 树会尝试保持自平衡。任意一个节点（不论深度）的左子树和右子树高度最多相差 1。添加或移除节点时，AVL 树会尽可能尝试转换为完全树。</p>\n<p>从创建我们的 AVLTree 类开始，声明如下。</p>\n<p>class AVLTree extends BinarySearchTree { constructor(compareFn = defaultCompare) { super(compareFn); this.compareFn = compareFn; this.root = null; } }</p>\n<p>既然 AVL 树是一个 BST，我们可以扩展我们写的 BST 类，只需要覆盖用来维持 AVL 树平衡的方法，也就是 insert、insertNode 和 removeNode 方法。所有其他的 BST 方法将会被 AVLTree 类继承。</p>\n<p>在 AVL 树中插入或移除节点和 BST 完全相同。然而，AVL 树的不同之处在于我们需要检验它的平衡因子，如果有需要，会将其逻辑应用于树的自平衡。</p>\n<p>我们将会学习怎样创建 remove 和 insert 方法，但是首先需要学习 AVL 树的术语和它的旋转操作。</p>\n<p>节点的高度和平衡因子</p>\n<p>正如本章开头所述，节点的高度是从节点到其任意子节点的边的最大值。下图展示了一个包含每个节点高度的树。</p>\n<p>计算一个节点高度的代码如下。</p>\n<p>getNodeHeight(node) { if (node == null) { return -1; } return Math.max( this.getNodeHeight(node.left), this.getNodeHeight(node.right) ) + 1; }</p>\n<p>在 AVL 树中，需要对每个节点计算右子树高度（hr）和左子树高度（hl）之间的差值，该值（hr－hl）应为 0、1 或 - 1。如果结果不是这三个值之一，则需要平衡该 AVL 树。这就是平衡因子的概念。</p>\n<p>下图举例说明了一些树的平衡因子（所有的树都是平衡的）。</p>\n<p>遵循计算一个节点的平衡因子并返回其值的代码如下。</p>\n<p>getBalanceFactor(node) { const heightDifference = this.getNodeHeight(node.left) - this.getNodeHeight(node.right); switch (heightDifference) { case -2: return BalanceFactor.UNBALANCED_RIGHT; case -1: return BalanceFactor.SLIGHTLY_UNBALANCED_RIGHT; case 1: return BalanceFactor.SLIGHTLY_UNBALANCED_LEFT; case 2: return BalanceFactor.UNBALANCED_LEFT; default: return BalanceFactor.BALANCED; } }</p>\n<p>为了避免直接在代码中处理平衡因子的数值，我们还要创建一个用来作为计数器的 JavaScript 常量。</p>\n<p>const BalanceFactor = { UNBALANCED_RIGHT: 1, SLIGHTLY_UNBALANCED_RIGHT: 2, BALANCED: 3, SLIGHTLY_UNBALANCED_LEFT: 4, UNBALANCED_LEFT: 5 };</p>\n<p>我们会在下面学习到每个 heightDifference 表示什么。</p>\n<p>平衡操作 ——AVL 旋转</p>\n<p>在对 AVL 树添加或移除节点后，我们要计算节点的高度并验证树是否需要进行平衡。向 AVL 树插入节点时，可以执行单旋转或双旋转两种平衡操作，分别对应四种场景。</p>\n<p>左 - 左（LL）：向右的单旋转</p>\n<p>右 - 右（RR）：向左的单旋转</p>\n<p>左 - 右（LR）：向右的双旋转（先 LL 旋转，再 RR 旋转）</p>\n<p>右 - 左（RL）：向左的双旋转（先 RR 旋转，再 LL 旋转）</p>\n<p>左 - 左（LL）：向右的单旋转</p>\n<p>这种情况出现于节点的左侧子节点的高度大于右侧子节点的高度时，并且左侧子节点也是平衡或左侧较重的，如下图所示。</p>\n<p>我们来看一个实际的例子，如下图所示。</p>\n<p>假设向 AVL 树插入节点 5，这会造成树失衡（节点 50-Y 高度为 + 2），需要恢复树的平衡。下面是我们执行的操作：</p>\n<p>与平衡操作相关的节点有三个（X、Y、Z），将节点 X 置于节点 Y（平衡因子为 + 2）所在的位置（行 {1}）；</p>\n<p>节点 X 的左子树保持不变；</p>\n<p>将节点 Y 的左子节点置为节点 X 的右子节点 Z（行 {2}）；</p>\n<p>将节点 X 的右子节点置为节点 Y（行 {3}）。</p>\n<p>下面的代码举例说明了整个过程。</p>\n<p>rotationLL(node) { const tmp = node.left; // {1} node.left = tmp.right; // {2} tmp.right = node; // {3} return tmp; }</p>\n<p>右 - 右（RR）：向左的单旋转</p>\n<p>右 - 右的情况和左 - 左的情况相反。它出现于右侧子节点的高度大于左侧子节点的高度，并且右侧子节点也是平衡或右侧较重的，如下图所示。</p>\n<p>我们来看一个实际的例子，如下图所示。</p>\n<p>假设向 AVL 树插入节点 90，这会造成树失衡（节点 50-Y 高度为 - 2），因此需要恢复树的平衡。下面是我们执行的操作：</p>\n<p>与平衡操作相关的节点有三个（X、Y、Z），将节点 X 置于节点 Y（平衡因子为 - 2）所在的位置（行 {1}）；</p>\n<p>节点 X 的右子树保持不变；</p>\n<p>将节点 Y 的右子节点置为节点 X 的左子节点 Z（行 {2}）；</p>\n<p>将节点 X 的左子节点置为节点 Y（行 {3}）。</p>\n<p>下面的代码举例说明了整个过程。</p>\n<p>rotationRR(node) { const tmp = node.right; // {1} node.right = tmp.left; // {2} tmp.left = node; // {3} return tmp; }</p>\n<p>左 - 右（LR）：向右的双旋转</p>\n<p>这种情况出现于左侧子节点的高度大于右侧子节点的高度，并且左侧子节点右侧较重。在这种情况下，我们可以对左侧子节点进行左旋转来修复，这样会形成左 - 左的情况，然后再对不平衡的节点进行一个右旋转来修复，如下图所示。</p>\n<p>我们来看一个实际的例子，如下图所示。</p>\n<p>假设向 AVL 树插入节点 75，这会造成树失衡（节点 70-Y 高度为 - 2），需要恢复树的平衡。下面是我们执行的操作：</p>\n<p>将节点 X 置于节点 Y（平衡因子为 - 2）所在的位置；</p>\n<p>将节点 Z 的左子节点置为节点 X 的右子节点；</p>\n<p>将节点 Y 的右子节点置为节点 X 的左子节点；</p>\n<p>将节点 X 的右子节点置为节点 Y；</p>\n<p>将节点 X 的左子节点置为节点 Z。</p>\n<p>基本上，就是先做一次 LL 旋转，再做一次 RR 旋转。</p>\n<p>下面的代码举例说明了整个过程。</p>\n<p node.left=\"\" class=\"thisrotationRR(node.left);\" return=\"\" this.rotationLL(node);=\"\">rotationLR(node)</p>\n<p>右 - 左（RL）：向左的双旋转</p>\n<p>右 - 左的情况和左 - 右的情况相反。这种情况出现于右侧子节点的高度大于左侧子节点的高度，并且右侧子节点左侧较重。在这种情况下我们可以对右侧子节点进行右旋转来修复，这样会形成右 - 右的情况，然后我们再对不平衡的节点进行一个左旋转来修复，如下图所示。</p>\n<p>我们来看一个实际的例子，如下图所示。</p>\n<p>假设向 AVL 树插入节点 35，这会造成树失衡（节点 50-Y 高度为 + 2），需要恢复树的平衡。下面是我们执行的操作：</p>\n<p>将节点 X 置于节点 Y（平衡因子为 + 2）所在的位置；</p>\n<p>将节点 Y 的左子节点置为节点 X 的右子节点；</p>\n<p>将节点 Z 的右子节点置为节点 X 的左子节点；</p>\n<p>将节点 X 的左子节点置为节点 Y；</p>\n<p>将节点 X 的右子节点置为节点 Z。</p>\n<p>基本上，就是先做一次 RR 旋转，再做一次 LL 旋转。</p>\n<p>下面的代码举例说明了整个过程。</p>\n<p node.right=\"\" class=\"thisrotationLL(node.right);\" return=\"\" this.rotationRR(node);=\"\">rotationRL(node)</p>\n<p>理解了这些概念，我们就可以专注于向树添加阶段和从树移除节点的代码了。</p>\n<p>向 AVL 树插入节点</p>\n<p>向 AVL 树插入节点和在 BST 中是一样的。除了插入节点外，我们还要验证插入后树是否还是平衡的，如果不是，就要进行必要的旋转操作。</p>\n<p>下面的代码向 AVL 树插入了一个新节点。</p>\n<p>insert (key) { this.root = this.insertNode (this.root, key); } insertNode (node, key) { // 像在 BST 树中一样插入节点 if (node == null) { return new Node (key); } else if (this.compareFn (key, node.key) === Compare.LESS_THAN) { node.left = this.insertNode (node.left, key); } else if (this.compareFn (key, node.key) === Compare.BIGGER_THAN) { node.right = this.insertNode (node.right, key); } else { return node; // 重复的键 } // 如果需要，将树进行平衡操作 const balanceFactor = this.getBalanceFactor (node); // {1} if (balanceFactor === BalanceFactor.UNBALANCED_LEFT) { // {2} if (this.compareFn (key, node.left.key) === Compare.LESS_THAN) { // {3} node = this.rotationLL (node); // {4} } else { return this.rotationLR (node); // {5} } } if (balanceFactor === BalanceFactor.UNBALANCED_RIGHT) { // {6} if ( this.compareFn (key, node.right.key) === Compare.BIGGER_THAN ) { // {7} node = this.rotationRR (node); // {8} } else { return this.rotationRL (node); // {9} } } return node; }</p>\n<p>在向 AVL 树插入节点后，我们需要检查树是否需要进行平衡，因此要使用递归计算以每个插入树的节点为根的节点的平衡因子（行 {1}），然后对每种情况应用正确的旋转。</p>\n<p>如果在向左侧子树插入节点后树不平衡了（行 {2}），我们需要比较是否插入的键小于左侧子节点的键（行 {3}）。如果是，我们要进行 LL 旋转（行 {4}）。否则，要进行 LR 旋转（行 {5}）。</p>\n<p>如果在向右侧子树插入节点后树不平衡了（行 {6}），我们需要比较是否插入的键小于右侧子节点的键（行 {7}）。如果是，我们要进行 RR 旋转（行 {8}）。否则，要进行 RL 旋转（行 {9}）。</p>\n<p>从 AVL 树中移除节点</p>\n<p>从 AVL 树移除节点和在 BST 中是一样的。除了移除节点外，我们还要验证移除后树是否还是平衡的，如果不是，就要进行必要的旋转操作。</p>\n<p>下面的代码从 AVL 树移除了一个节点。</p>\n<p>removeNode (node, key) { node = super.removeNode (node, key); // {1} if (node == null) { return node; //null，不需要进行平衡 } // 检测树是否平衡 const balanceFactor = this.getBalanceFactor (node); // {2} if (balanceFactor === BalanceFactor.UNBALANCED_LEFT) { // {3} const balanceFactorLeft = this.getBalanceFactor (node.left); // {4} if ( balanceFactorLeft === BalanceFactor.BALANCED || balanceFactorLeft === BalanceFactor.SLIGHTLY_UNBALANCED_LEFT ) { // {5} return this.rotationLL (node); // {6} } if ( balanceFactorLeft === BalanceFactor.SLIGHTLY_UNBALANCED_RIGHT ) { // {7} return this.rotationLR (node.left); // {8} } } if (balanceFactor === BalanceFactor.UNBALANCED_RIGHT) { // {9} const balanceFactorRight = this.getBalanceFactor (node.right); // {10} if ( balanceFactorRight === BalanceFactor.BALANCED || balanceFactorRight === BalanceFactor.SLIGHTLY_UNBALANCED_RIGHT ) { // {11} return this.rotationRR (node); // {12} } if ( balanceFactorRight === BalanceFactor.SLIGHTLY_UNBALANCED_LEFT ) { // {13} return this.rotationRL (node.right); // {14} } } return node; }</p>\n<p>既然 AVLTree 类是 BinarySearchTree 类的子类，我们也可以使用 BST 的 removeNode 方法来从 AVL 树中移除节点（行 {1}）。在从 AVL 树中移除节点后，我们需要检查树是否需要进行平衡，所以使用递归计算以每个移除的节点为根的节点的平衡因子（行 {2}），然后需要对每种情况应用正确的旋转。</p>\n<p>如果在从左侧子树移除节点后树不平衡了（行 {3}），我们要计算左侧子树的平衡因子（行 {4}）。如果左侧子树向左不平衡（行 {5}），要进行 LL 旋转（行 {6}）；如果左侧子树向右不平衡（行 {7}），要进行 LR 旋转（行 {8}）。</p>\n<p>最后一种情况是，如果在从右侧子树移除节点后树不平衡了（行 {9}），我们要计算右侧子树的平衡因子（行 {10}）。如果右侧子树向右不平衡（行 {11}），要进行 RR 旋转（行 {12}）；如果右侧子树向左不平衡（行 {13}），要进行 LR 旋转（行 {14}）。</p>\n<p>10.6.2　红黑树</p>\n<p>和 AVL 树一样，红黑树也是一个自平衡二叉搜索树。我们学习了对 AVL 书插入和移除节点可能会造成旋转，所以我们需要一个包含多次插入和删除的自平衡树，红黑树是比较好的。如果插入和删除频率较低（我们更需要多次进行搜索操作），那么 AVL 树比红黑树更好。</p>\n<p>在红黑树中，每个节点都遵循以下规则：</p>\n<p>(1) 顾名思义，每个节点不是红的就是黑的；</p>\n<p>(2) 树的根节点是黑的；</p>\n<p>(3) 所有叶节点都是黑的（用 NULL 引用表示的节点）；</p>\n<p>(4) 如果一个节点是红的，那么它的两个子节点都是黑的；</p>\n<p>(5) 不能有两个相邻的红节点，一个红节点不能有红的父节点或子节点；</p>\n<p>(6) 从给定的节点到它的后代节点（NULL 叶节点）的所有路径包含相同数量的黑色节点。</p>\n<p>我们从创建 RedBlackTree 类开始，如下所示。</p>\n<p>class RedBlackTree extends BinarySearchTree { constructor(compareFn = defaultCompare) { super(compareFn); this.compareFn = compareFn; this.root = null; } }</p>\n<p>由于红黑树也是二叉搜索树，可以扩展我们创建的二叉搜索树类并重写红黑树属性所需要的那些方法。我们从 insert 和 insertNode 方法开始。</p>\n<p>向红黑树中插入节点</p>\n<p>向红黑树插入节点和在二叉搜索树中是一样的。除了插入的代码，我们还要在插入后给节点应用一种颜色，并且验证树是否满足红黑树的条件以及是否还是自平衡的。</p>\n<p>下面的代码向红黑树插入了新的节点。</p>\n<p>insert(key: T) { if (this.root == null) { // {1} this.root = new RedBlackNode(key); // {2} this.root.color = Colors.BLACK; // {3} } else { const newNode = this.insertNode(this.root, key); // {4} this.fixTreeProperties(newNode); // {5} } }</p>\n<p>如果树是空的（行 {1}），那么我们需要创建一个红黑树节点（行 {2}）。为了满足规则 2，我们要将这个根节点的颜色设为黑色（行 {3}）。默认情况下，创建的节点颜色是红色（行 {6}）。如果树不是空的，我们会像二叉搜索树一样在正确的位置插入节点（行 {4}）。在这种情况下，insertNode 方法需要返回新插入的节点，这样我们可以验证在插入后，红黑树的规则是否得到了满足（行 {5}）。</p>\n<p>对红黑树来说，节点和之前比起来需要一些额外的属性：节点的颜色（行 {6}）和指向父节点的引用（行 {7}）。代码如下所示。</p>\n<p>class RedBlackNode extends Node { constructor(key) { super(key); this.key = key; this.color = Colors.RED; // {6} this.parent = null; // {7} } isRed() { return this.color === Colors.RED; } }</p>\n<p>重写的 insertNode 方法如下。</p>\n<p>insertNode(node, key) { if (this.compareFn(key, node.key) === Compare.LESS_THAN) { if (node.left == null) { node.left = new RedBlackNode(key); node.left.parent = node; // {8} return node.left; // {9} } else { return this.insertNode(node.left, key); } } else if (node.right == null) { node.right = new RedBlackNode(key); node.right.parent = node; // {10} return node.right; // {11} } else { return this.insertNode(node.right, key); } }</p>\n<p>我们可以看到，逻辑和二叉搜索树中的一样。不同之处在于我们保存了指向被插入节点父节点的引用（行 {8} 和行 {10}），并且返回了节点的引用（行 {9} 和行 {11}），这样我们可以在后面验证树的属性。</p>\n<p>在插入节点后验证红黑树属性</p>\n<p>要验证红黑树是否还是平衡的以及满足它的所有要求，我们需要使用两个概念：重新填色和旋转。</p>\n<p>在向树中插入节点后，新节点将会是红色。这不会影响黑色节点数量的规则（规则 6），但会影响规则 5：两个后代红节点不能共存。如果插入节点的父节点是黑色，那没有问题。但是如果插入节点的父节点是红色，那么会违反规则 5。要解决这个冲突，我们只需要改变父节点、祖父节点和叔节点（因为我们同样改变了父节点的颜色）。</p>\n<p>下图描述了这个过程。</p>\n<p>下面是 fixTreeProperties 方法的代码。</p>\n<p>fixTreeProperties (node) { while (node &amp;&amp; node.parent &amp;&amp; node.parent.color.isRed () // {1} &amp;&amp; node.color !== Colors.BLACK) { // {2} let parent = node.parent; // {3} const grandParent = parent.parent; // {4} // 情形 A：父节点是左侧子节点 if (grandParent &amp;&amp; grandParent.left === parent) { // {5} const uncle = grandParent.right; // {6} // 情形 1A：叔节点也是红色 —— 只需要重新填色 if (uncle &amp;&amp; uncle.color === Colors.RED) { // {7} grandParent.color = Colors.RED; parent.color = Colors.BLACK; uncle.color = Colors.BLACK; node = grandParent; // {8} } else { // 情形 2A：节点是右侧子节点 —— 左旋转 // 情形 3A：节点是左侧子节点 —— 右旋转 } } else { // 情形 B：父节点是右侧子节点 const uncle = grandParent.left; // {9} // 情形 1B：叔节点是红色 —— 只需要重新填色 if (uncle &amp;&amp; uncle.color === Colors.RED) { // {10} grandParent.color = Colors.RED; parent.color = Colors.BLACK; uncle.color = Colors.BLACK; node = grandParent; } else { // 情形 2B：节点是左侧子节点 —— 右旋转 // 情形 3B：节点是右侧子节点 —— 左旋转 } } } this.root.color = Colors.BLACK; // {11} }</p>\n<p>从插入的节点开始，我们要验证它的父节点是否是红色（行 {1}），以及这个节点是否不是黑色（行 {2}）。为了保证代码的可读性，我们要保存父节点（行 {3}）和祖父节点（行 {4}）的引用。</p>\n<p>接下来，我们要验证父节点是左侧子节点（行 {5}—— 情形 A）还是右侧子节点（情形 B）。对于情形 1A，我们只需要对节点重新填色，父节点是左侧还是右侧子节点没有什么影响，不过在下面的情形中就有影响了。</p>\n<p>由于也需要改变叔节点的颜色，我们需要一个指向它的引用（行 {6} 和行 {9}）。如果叔节点的颜色是红色（行 {7} 和行 {10}），就改变祖父节点、父节点和叔节点的颜色，并且将当前节点的引用指向祖父节点（行 {8}），继续检查树是否有其他冲突。</p>\n<p>为了保证根节点的颜色始终是黑色（规则 2），我们在代码最后设置根节点的颜色（行 {11}）。</p>\n<p>在节点的叔节点颜色为黑时，也就是说仅仅重新填色是不够的，树是不平衡的，那么我们需要进行旋转操作。</p>\n<p>左 - 左（LL）：父节点是祖父节点的左侧子节点，节点是父节点的左侧子节点（情形 3A）。</p>\n<p>左 - 右（LR）：父节点是祖父节点的左侧子节点，节点是父节点的右侧子节点（情形 2A）。</p>\n<p>右 - 右（RR）：父节点是祖父节点的右侧子节点，节点是父节点的右侧子节点（情形 2A）。</p>\n<p>右 - 左（RL）：父节点是祖父节点的右侧子节点，节点是父节点的左侧子节点（情形 2A）。</p>\n<p>我们来看看情形 2A 和 3A。</p>\n<p 18=\"\">// 情形 2A：节点是右侧子节点 —— 左旋转 if (node === parent.right) { this.rotationRR (parent); // {12} node = parent; // {13} parent = node.parent; // {14} } // 情形 3A：节点是左侧子节点 —— 右旋转 this.rotationLL (grandParent); // {15} parent.color = Colors.BLACK; // {16} grandParent.color = Colors.RED; // {17} node = parent; //</p>\n<p>如果父节点是左侧子节点并且节点是右侧子节点，我们要进行两次旋转，首先是右 - 右旋转（行 {12}），并更新节点（行 {13}）和父节点（行 {10}）的引用。在第一次旋转后，我们要再次旋转，以祖父节点为基准（行 {15}），并在旋转过程中更新父节点（行 {16}）和祖父节点（行 {17}）的颜色。最后，我们更新当前节点的引用（行 {18}），以便继续检查树的其他冲突。</p>\n<p>情形 2A 如下图所示。</p>\n<p>节点是左侧子节点时，我们直接来到行 {15} 进行左 - 左旋转。情形 3A 如下图所示。</p>\n<p>现在，我们来看看情形 2B 和 3B。</p>\n<p>// 情形 2B：节点是左侧子节点 —— 左旋转 if (node === parent.left) { this.rotationLL (parent); // {19} node = parent; parent = node.parent; } // 情形 3B：节点是右侧子节点 —— 左旋转 this.rotationRR (grandParent); // {20} parent.color = Colors.BLACK; grandParent.color = Colors.RED; node = parent;</p>\n<p>逻辑是一样的，不同之处在于选择会这样进行：先进行左 - 左旋转（行 {18}），再进行右 - 右旋转（行 {20}）。情形 2B 如下图所示。</p>\n<p>最后，情形 3B 如下图所示。</p>\n<p>红黑树旋转</p>\n<p>在插入算法中，我们只使用了右 - 右旋转和左 - 左旋转。逻辑和 AVL 树是一样，但是，由于我们保存了父节点的引用，需要将引用更新为旋转后的新父节点。</p>\n<p>左 - 左旋转（右旋转）的代码如下（更新父节点加粗显示）。</p>\n<p>rotationLL(node) { const tmp = node.left; node.left = tmp.right; if (tmp.right &amp;&amp; tmp.right.key) { tmp.right.parent = node; } tmp.parent = node.parent; if (!node.parent) { this.root = tmp; } else { if (node === node.parent.left) { node.parent.left = tmp; } else { node.parent.right = tmp; } } tmp.right = node; node.parent = tmp; }</p>\n<p>右 - 右旋转（左旋转）的代码如下（更新父节点加粗显示）。</p>\n<p>rotationRR(node) { const tmp = node.right; node.right = tmp.left; if (tmp.left &amp;&amp; tmp.left.key) { tmp.left.parent = node; } tmp.parent = node.parent; if (!node.parent) { this.root = tmp; } else { if (node === node.parent.left) { node.parent.left = tmp; } else { node.parent.right = tmp; } } tmp.left = node; node.parent = tmp; }</p>\n<p>10.7　小结</p>\n<p>在本章中，我们介绍了在计算机科学中被广泛使用的基本树数据结构 —— 二叉搜索树，以及在其中添加、搜索和移除键的算法。我们同样介绍了访问树中每个节点的三种遍历方式，还学习了如何开发名叫 AVL 的自平衡树和为其添加、移除键的方法，以及红黑树。</p>\n<p>下一章中，我们会学习一种名为堆（或优先队列）的特殊数据结构。</p>\n<h1 id=\"第-11-章-二叉堆和堆排序\"><a class=\"anchor\" href=\"#第-11-章-二叉堆和堆排序\">#</a> 第 11 章　二叉堆和堆排序</h1>\n<p>在上一章，我们学习了树数据结构。在本章中，我们将要学习一种特殊的二叉树，也就是堆数据结构，也叫作二叉堆。二叉堆是计算机科学中一种非常著名的数据结构，由于它能高效、快速地找出最大值和最小值，常被应用于优先队列。它也被用于著名的堆排序算法中。</p>\n<p>本章的内容包括：</p>\n<p>二叉堆数据结构</p>\n<p>最大和最小堆</p>\n<p>堆排序算法</p>\n<p>11.1　二叉堆数据结构</p>\n<p>二叉堆是一种特殊的二叉树，有以下两个特性。</p>\n<p>它是一棵完全二叉树，表示树的每一层都有左侧和右侧子节点（除了最后一层的叶节点），并且最后一层的叶节点尽可能都是左侧子节点，这叫作结构特性。</p>\n<p>二叉堆不是最小堆就是最大堆。最小堆允许你快速导出树的最小值，最大堆允许你快速导出树的最大值。所有的节点都大于等于（最大堆）或小于等于（最小堆）每个它的子节点。这叫作堆特性。</p>\n<p>下图展示了一些合法的和不合法的堆。</p>\n<p>尽管二叉堆是二叉树，但并不一定是二叉搜索树（BST）。在二叉堆中，每个子节点都要大于等于父节点（最小堆）或小于等于父节点（最大堆）。然而在二叉搜索树中，左侧子节点总是比父节点小，右侧子节点也总是更大。</p>\n<p>11.1.1　创建最小堆类</p>\n<p>我们先来创建 MinHeap 类，如下所示。</p>\n<p>import { defaultCompare } from '../util'; export class MinHeap { constructor(compareFn = defaultCompare) { this.compareFn = compareFn; // {1} this.heap = []; // {2} } }</p>\n<p>要比较储存在数据结构中的值，我们要使用 compareFn（行 {1}），在没有传入自定义函数的时候进行基本的比较，和之前的章节一样。</p>\n<p>我们将会使用数组来存储数据（行 {2}）。</p>\n<p>二叉树的数组表示</p>\n<p>二叉树有两种表示方式。第一种是使用一个动态的表示方式，也就是指针（用节点表示），在上一章使用过。第二种是使用一个数组，通过索引值检索父节点、左侧和右侧子节点的值。下图展示了两种不同的表示方式。</p>\n<p>要访问使用普通数组的二叉树节点，我们可以用下面的方式操作 index。</p>\n<p>对于给定位置 index 的节点：</p>\n<p>它的左侧子节点的位置是 2 * index + 1（如果位置可用）；</p>\n<p>它的右侧子节点的位置是 2 * index + 2（如果位置可用）；</p>\n<p>它的父节点位置是 index / 2（如果位置可用）。</p>\n<p>用上面的方法来访问特定节点，我们可以把下面的方法加入 MinHeap 类。</p>\n<p>getLeftIndex(index) { return 2 * index + 1; } getRightIndex(index) { return 2 * index + 2; } getParentIndex(index) { if (index === 0) { return undefined; } return Math.floor((index - 1) / 2); }</p>\n<p>我们可以在堆数据结构中进行三个主要操作。</p>\n<p>insert (value)：这个方法向堆中插入一个新的值。如果插入成功，它返回 true，否则返回 false。</p>\n<p>extract ()：这个方法移除最小值（最小堆）或最大值（最大堆），并返回这个值。</p>\n<p>findMinimum ()：这个方法返回最小值（最小堆）或最大值（最大堆）且不会移除这个值。</p>\n<p>我们来依次学习每个方法。</p>\n<p>向堆中插入值</p>\n<p>向堆中插入值是指将值插入堆的底部叶节点（数组的最后一个位置 —— 行 {1}）再执行 siftUp 方法（行 {2}），表示我们将要将这个值和它的父节点进行交换，直到父节点小于这个插入的值。这个上移操作也被称为 up head、percolate up、bubble up、heapify up 或 cascade up。</p>\n<p>向堆中插入新值的代码如下。</p>\n<p>insert(value) { if (value != null) { this.heap.push(value); // {1} this.siftUp(this.heap.length - 1); // {2} return true; } return false; }</p>\n<p>上移操作</p>\n<p>上移操作的代码如下。</p>\n<p>siftUp(index) { let parent = this.getParentIndex(index); // {1} while ( index &gt; 0 &amp;&amp; this.compareFn(this.heap[parent], this.heap[index]) &gt; Compare.BIGGER_THAN ) { // {2} swap(this.heap, parent, index); // {3} index = parent; parent = this.getParentIndex(index); // {4} } }</p>\n<p>siftUp 方法接收插入值的位置作为参数。我们同样需要获取其父节点的位置（行 {1}）。</p>\n<p>如果插入的值小于它的父节点（行 {2}—— 在最小堆中，或在最大堆中比父节点大），那么我们将这个元素和父节点交换（行 {3}）。我们重复这个过程直到堆的根节点也经过了交换节点和父节点位置的操作（行 {4}）。</p>\n<p>交换函数如下所示。</p>\n<p>function swap(array, a, b) { const temp = array[a]; // {5} array[a] = array[b]; // {6} array[b] = temp; // {7} }</p>\n<p>要交换数组中的两个值，我们需要一个辅助变量来复制要交换的第一个元素（行 {5}）。然后，将第二个元素赋值到第一个元素的位置（行 {6}）。最后，将复制的第一个元素的值（行 {5}）覆盖到第二个元素的位置（行 {7}）。</p>\n<p>swap 函数在第 13 章中会经常用到。</p>\n<p>我们也可以使用 ECMAScript 2015（ES6）的语法来重写 swap 函数。</p>\n<p>const swap = (array, a, b) =&gt; [array[a], array[b]] = [array[b], array[a]];</p>\n<p>我们在第 2 章学习过，ES2015 中包含对象和数组解构的功能 [a, b] = [b, a]。但是，在写这本书的时候，有一个公开的问题表示解构操作比正常的赋值操作性能更差。要了解更多有关这个问题的信息，请访问 https://bugzilla.mozilla.org/show_bug.cgi?id=1177319。</p>\n<p>我们来看看 insert 方法的实际操作。考虑下面的堆数据结构。</p>\n<p>假设我们想要向堆中插入一个值 1。算法会进行一些少量的上移操作，如下图所示。</p>\n<p>下面的代码展示了堆的创建和上图的操作。</p>\n<p>const heap = new MinHeap(); heap.insert(2); heap.insert(3); heap.insert(4); heap.insert(5); heap.insert(1);</p>\n<p>从堆中找到最小值或最大值</p>\n<p>在最小堆中，最小值总是位于数组的第一个位置（堆的根节点）。代码如下所示。</p>\n<p>size() { return this.heap.length; } isEmpty() { return this.size() === 0; } findMinimum() { return this.isEmpty() ? undefined : this.heap[0]; // {1} }</p>\n<p>因此如果堆不为空，我们返回数组的第一个值（行 {1}）。我们同样可以创建 MinHeap 类的 size 和 empty 方法。</p>\n<p>下面的代码可用来测试这三个方法。</p>\n<p>console.log('Heap size: ', heap.size()); // 5 console.log('Heap is empty: ', heap.isEmpty()); // false console.log('Heap min value: ', heap.findMinimum()); // 1</p>\n<p>在最大堆中，数组的第一个元素保存了最大值，所以我们可以使用相同的代码。</p>\n<p>导出堆中的最小值或最大值</p>\n<p>移除最小值（最小堆）或最大值（最大堆）表示移除数组中的第一个元素（堆的根节点）。在移除后，我们将堆的最后一个元素移动至根部并执行 siftDown 函数，表示我们将交换元素直到堆的结构正常。这个下移操作也被称为 sink down、percolate down、bubble down、heapify down 或 cascade down。</p>\n<p>代码如下。</p>\n<p>extract() { if (this.isEmpty()) { return undefined; // {1} } if (this.size() === 1) { return this.heap.shift(); // {2} } const removedValue = this.heap.shift(); // {3} this.siftDown(0); // {4} return removedValue; // {5} }</p>\n<p>如果堆为空，也就是没有值可以导出，那么我们可以返回 undefined（行 {1}）。如果堆中只有一个值，我们可以直接移除并返回它（行 {2}）。但是，如果堆中有不止一个值，我们需要将第一个值移除（行 {3}），存储到一个临时变量中以便在执行完下移操作后（行 {4}）返回它（行 {5}）。</p>\n<p>下移操作（堆化）</p>\n<p>下移操作的代码如下所示。</p>\n<p>siftDown(index) { let element = index; const left = this.getLeftIndex(index); // {1} const right = this.getRightIndex(index); // {2} const size = this.size(); if ( left &lt; size &amp;&amp; this.compareFn(this.heap[element], this.heap[left]) &gt; Compare.BIGGER_THAN ) { // {3} element = left; // {4} } if ( right &lt; size &amp;&amp; this.compareFn(this.heap[element], this.heap[right]) &gt; Compare.BIGGER_THAN ) { // {5} element = right; // {6} } if (index !== element) { // {7} swap(this.heap, index, element); // {8} this.siftDown(element); // {9} } }</p>\n<p>siftDown 方法接收移除元素的位置作为参数。我们会将 index 复制到 element 变量中。我们同样要获取左侧子节点（行 {1}）和右侧子节点（行 {2}）的值。</p>\n<p>下移操作表示将元素和最小子节点（最小堆）和最大子节点（最大堆）进行交换。如果元素比左侧子节点要小（行 {3}—— 且 index 合法），我们就交换元素和它的左侧子节点（行 {4}）。如果元素小于它的右侧子节点（行 {5}—— 且 index 合法），我们就交换元素和它的右侧子节点（行 {6}）。</p>\n<p>在找到最小子节点的位置后，我们要检验它的值是否和 element 相同（传入 siftDown 方法 —— 行 {7}）—— 和自己交换是没有意义的！如果不是，就将它和最小的 element 交换（行 {8}），并且重复这个过程（行 {9}）直到 element 被放在正确的位置上。</p>\n<p>假设我们从堆中进行导出操作。算法会进行一些下移操作，如下图所示。</p>\n<p>代码如下。</p>\n<p>heap = new MinHeap(); for (let i = 1; i &lt; 10; i++) { heap.insert(i); } console.log('Extract minimum: ', heap.extract()); // 1</p>\n<p>11.1.2　创建最大堆类</p>\n<p>MaxHeap 类的算法和 MinHeap 类的算法一模一样。不同之处在于我们要把所有 &gt;（大于）的比较换成 &lt;（小于）的比较。</p>\n<p>MaxHeap 类的代码如下。</p>\n<p>export class MaxHeap extends MinHeap { constructor(compareFn = defaultCompare) { super(compareFn); this.compareFn = reverseCompare(compareFn); // {1} } }</p>\n<p>但是不同于复制代码，可以扩展 MinHeap 类来继承我们在本章创建的所有代码，并在需要时进行反向的比较。要将比较反转，不将 a 和 b 进行比较，而是将 b 和 a 进行比较（行 {1}），如下面代码所示。</p>\n<p return=\"\" (a,=\"\" b)=\"\">function reverseCompare(compareFn)</p>\n<p>我们可以使用测试最小堆的代码来测试最大堆。不同点是最大的值会是堆的根节点，而不是最小的值。</p>\n<p>const maxHeap = new MaxHeap(); maxHeap.insert(2); maxHeap.insert(3); maxHeap.insert(4); maxHeap.insert(5); maxHeap.insert(1); console.log('Heap size: ', maxHeap.size()); // 5 console.log('Heap min value: ', maxHeap.findMinimum()); // 5</p>\n<p>11.2　堆排序算法</p>\n<p>我们可以使用二叉堆数据结构来帮助我们创建一个非常著名的排序算法：堆排序算法。它包含下面三个步骤。</p>\n<p>(1) 用数组创建一个最大堆用作源数据。</p>\n<p>(2) 在创建最大堆后，最大的值会被存储在堆的第一个位置。我们要将它替换为堆的最后一个值，将堆的大小减 1。</p>\n<p>(3) 最后，我们将堆的根节点下移并重复步骤 2 直到堆的大小为 1。</p>\n<p>我们用最大堆得到一个升序排列的数组（从最小到最大）。如果我们想要这个数组按降序排列，可以用最小堆代替。</p>\n<p>下面是堆排序算法的代码。</p>\n<p>function heapSort (array, compareFn = defaultCompare) { let heapSize = array.length; buildMaxHeap (array, compareFn); // 步骤 1 while (heapSize &gt; 1) { swap (array, 0, --heapSize); // 步骤 2 heapify (array, 0, heapSize, compareFn); // 步骤 3 } return array; }</p>\n<p>要构建最大堆，可以使用下面的函数。</p>\n<p>function buildMaxHeap(array, compareFn) { for (let i = Math.floor(array.length / 2); i &gt;= 0; i -= 1) { heapify(array, i, array.length, compareFn); } return array; }</p>\n<p>最大堆函数会重新组织数组的顺序。归功于要进行的所有比较，我们只需要对后半部分数组执行 heapify（下移）函数（前半部分会被自动排好序，所以不需要对已经知道排好序的部分执行函数）。</p>\n<p>heapify 函数和我们创建的 siftDown 方法有相同的代码。不同之处是我们会将堆本身、堆的大小和要使用的比较函数传入作为参数。这是因为我们不会直接使用堆数据结构，而是使用它的逻辑来开发 heapSort 算法。</p>\n<p>下图展示了堆排序算法。</p>\n<p>下面的代码可以用来测试 heapSort 算法：</p>\n<p>const array = [7, 6, 3, 5, 4, 1, 2]; console.log('Before sorting: ', array); console.log('After sorting: ', heapSort(array));</p>\n<p>堆排序算法不是一个稳定的排序算法，也就是说如果数组没有排好序，可能会得到不一样的结果。我们会在第 13 章探索更好的排序算法。</p>\n<p>11.3　小结</p>\n<p>在本章，我们学习了二叉堆数据结构和它的两个变体：最小堆和最大堆。我们学习了怎样插入值，怎样查看或找到最小值或最大值，以及怎样从堆中导出一个值。我们同样学习了上移和下移操作来帮助我们维护堆的结构。</p>\n<p>我们也学习了怎样用堆数据结构来创建堆排序算法。</p>\n<p>在下一章，我们会学习图的基本概念，它是一种非线性数据结构。</p>\n<h1 id=\"第-12-章-图\"><a class=\"anchor\" href=\"#第-12-章-图\">#</a> 第 12 章　图</h1>\n<p>在本章，你将学习另一种非线性数据结构 —— 图。这是我们要讲的最后一种数据结构，下一章将深入学习排序和搜索算法。</p>\n<p>本章将会包含不少图的巧妙运用。图是一个庞大的主题，深入探索图的奇妙世界就足够写一本书了。</p>\n<p>在本章中，我们将会讨论下面的话题：</p>\n<p>图的相关术语</p>\n<p>图的三种不同表示</p>\n<p>图数据结构</p>\n<p>图的搜索算法</p>\n<p>最短路径算法</p>\n<p>最小生成树算法</p>\n<p>12.1　图的相关术语</p>\n<p>图是网络结构的抽象模型。图是一组由边连接的节点（或顶点）。学习图是重要的，因为任何二元关系都可以用图来表示。</p>\n<p>任何社交网络，例如 Facebook、Twitter 和 Google+，都可以用图来表示。</p>\n<p>我们还可以使用图来表示道路、航班以及通信，如下图所示。</p>\n<p>让我们来学习一下图在数学及技术上的概念。</p>\n<p>一个图由以下元素组成。</p>\n<p>：一组顶点</p>\n<p>：一组边，连接中的顶点</p>\n<p>下图表示一个图。</p>\n<p>在着手实现算法之前，让我们先了解一下图的一些术语。</p>\n<p>由一条边连接在一起的顶点称为相邻顶点。比如，A 和 B 是相邻的，A 和 D 是相邻的，A 和 C 是相邻的，A 和 E 不是相邻的。</p>\n<p>一个顶点的度是其相邻顶点的数量。比如，A 和其他三个顶点相连接，因此 A 的度为 3；E 和其他两个顶点相连，因此 E 的度为 2。</p>\n<p>路径是顶点的一个连续序列，其中和是相邻的。以上一示意图中的图为例，其中包含路径 A B E I 和 A C D G。</p>\n<p>简单路径要求不包含重复的顶点。举个例子，A D G 是一条简单路径。除去最后一个顶点（因为它和第一个顶点是同一个顶点），环也是一个简单路径，比如 A D C A（最后一个顶点重新回到 A）。</p>\n<p>如果图中不存在环，则称该图是无环的。如果图中每两个顶点间都存在路径，则该图是连通的。</p>\n<p>有向图和无向图</p>\n<p>图可以是无向的（边没有方向）或是有向的（有向图）。如下图所示，有向图的边有一个方向。</p>\n<p>如果图中每两个顶点间在双向上都存在路径，则该图是强连通的。例如，C 和 D 是强连通的，而 A 和 B 不是强连通的。</p>\n<p>图还可以是未加权的（目前为止我们看到的图都是未加权的）或是加权的。如下图所示，加权图的边被赋予了权值。</p>\n<p>我们可以使用图来解决计算机科学世界中的很多问题，比如搜索图中的一个特定顶点或搜索一条特定边，寻找图中的一条路径（从一个顶点到另一个顶点），寻找两个顶点之间的最短路径，以及环检测。</p>\n<p>12.2　图的表示</p>\n<p>从数据结构的角度来说，我们有多种方式来表示图。在所有的表示法中，不存在绝对正确的方式。图的正确表示法取决于待解决的问题和图的类型。</p>\n<p>12.2.1　邻接矩阵</p>\n<p>图最常见的实现是邻接矩阵。每个节点都和一个整数相关联，该整数将作为数组的索引。我们用一个二维数组来表示顶点之间的连接。如果索引为 i 的节点和索引为 j 的节点相邻，则 array [i][j] === 1，否则 array [i][j] === 0，如下图所示。</p>\n<p>不是强连通的图（稀疏图）如果用邻接矩阵来表示，则矩阵中将会有很多 0，这意味着我们浪费了计算机存储空间来表示根本不存在的边。例如，找给定顶点的相邻顶点，即使该顶点只有一个相邻顶点，我们也不得不迭代一整行。邻接矩阵表示法不够好的另一个理由是，图中顶点的数量可能会改变，而二维数组不太灵活。</p>\n<p>12.2.2　邻接表</p>\n<p>我们也可以使用一种叫作邻接表的动态数据结构来表示图。邻接表由图中每个顶点的相邻顶点列表所组成。存在好几种方式来表示这种数据结构。我们可以用列表（数组）、链表，甚至是散列表或是字典来表示相邻顶点列表。下面的示意图展示了邻接表数据结构。</p>\n<p>尽管邻接表可能对大多数问题来说都是更好的选择，但以上两种表示法都很有用，且它们有着不同的性质（例如，要找出顶点和是否相邻，使用邻接矩阵会比较快）。在本书的示例中，我们将会使用邻接表表示法。</p>\n<p>12.2.3　关联矩阵</p>\n<p>还可以用关联矩阵来表示图。在关联矩阵中，矩阵的行表示顶点，列表示边。如下图所示，使用二维数组来表示两者之间的连通性，如果顶点是边的入射点，则 array [v][e] === 1；否则，array [v][e] === 0。</p>\n<p>关联矩阵通常用于边的数量比顶点多的情况，以节省空间和内存。</p>\n<p>12.3　创建 Graph 类</p>\n<p>照例，我们声明类的骨架。</p>\n<p>class Graph { constructor(isDirected = false) { this.isDirected = isDirected; // {1} this.vertices = []; // {2} this.adjList = new Dictionary(); // {3} } }</p>\n<p>Graph 构造函数可以接收一个参数来表示图是否有向（行 {1}），默认情况下，图是无向的。我们使用一个数组来存储图中所有顶点的名字（行 {2}），以及一个字典（在第 8 章中已经实现）来存储邻接表（行 {3}）。字典将会使用顶点的名字作为键，邻接顶点列表作为值。</p>\n<p>接着，我们将实现两个方法：一个用来向图中添加一个新的顶点（因为图实例化后是空的），另外一个方法用来添加顶点之间的边。我们先实现 addVertex 方法。</p>\n<p>addVertex(v) { if (!this.vertices.includes(v)) { // {5} this.vertices.push(v); // {6} this.adjList.set(v, []); // {7} } }</p>\n<p>这个方法接收顶点 v 作为参数。只有在这个顶点不存在于图中时（行 {5}）我们将该顶点添加到顶点列表中（行 {6}），并且在邻接表中，设置顶点 v 作为键对应的字典值为一个空数组（行 {7}）。</p>\n<p>现在，我们来实现 addEdge 方法。</p>\n<p>addEdge(v, w) { if (!this.adjList.get(v)) { this.addVertex(v); // {8} } if (!this.adjList.get(w)) { this.addVertex(w); // {9} } this.adjList.get(v).push(w); // {10} if (!this.isDirected) { this.adjList.get(w).push(v); // {11} } }</p>\n<p>这个方法接收两个顶点作为参数，也就是我们要建立连接的两个顶点。在连接顶点之前，需要验证顶点是否存在于图中。如果顶点 v 或 w 不存在于图中，要将它们加入顶点列表（行 {8} 和行 {9}）。</p>\n<p>然后，通过将 w 加入到 v 的邻接表中，我们添加了一条自顶点 v 到顶点 w 的边（行 {10}）。如果你想实现一个有向图，则行 {10} 就足够了。由于本章中大多数的例子都是基于无向图的，我们需要添加一条自 w 到 v 的边（行 {11}）。</p>\n<p>请注意我们只是往数组里新增元素，因为数组已经在行 {7} 被初始化了。</p>\n<p>要完成创建 Graph 类，我们还要声明两个取值的方法：一个返回顶点列表，另一个返回邻接表。</p>\n<p return=\"\" this.adjList;=\"\">getVertices() { return this.vertices; } getAdjList()</p>\n<p>让我们测试这段代码。</p>\n<p>const graph = new Graph(); const myVertices = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I']; // {12} for (let i = 0; i &lt; myVertices.length; i++) { // {13} graph.addVertex(myVertices[i]); } graph.addEdge('A', 'B'); // {14} graph.addEdge('A', 'C'); graph.addEdge('A', 'D'); graph.addEdge('C', 'D'); graph.addEdge('C', 'G'); graph.addEdge('D', 'G'); graph.addEdge('D', 'H'); graph.addEdge('B', 'E'); graph.addEdge('B', 'F'); graph.addEdge('E', 'I');</p>\n<p>为方便起见，我们创建了一个数组，包含所有想添加到图中的顶点（行 {12}）。接下来，只要遍历 myVertices 数组并将其中的值逐一添加到我们的图中（行 {13}）。最后，我们添加想要的边（行 {14}）。这段代码将会创建一个图，也就是到目前为止本章的示意图所使用的。</p>\n<p>为了更方便一些，让我们来实现 Graph 类的 toString 方法，以便在控制台输出图。</p>\n<p>toString() { let s = ''; for (let i = 0; i &lt; this.vertices.length; i++) { // {15} s +=  <code>$&#123;this.vertices[i]&#125; -&gt; </code> ; const neighbors = this.adjList.get(this.vertices[i]); // {16} for (let j = 0; j &lt; neighbors.length; j++) { // {17} s +=  <code>$&#123;neighbors[j]&#125; </code> ; } s += '\\n'; // {18} } return s; }</p>\n<p>我们为邻接表表示法构建了一个字符串。首先，迭代 vertices 数组列表（行 {15}），将顶点的名字加入字符串中。接着，取得该顶点的邻接表（行 {16}），同样迭代该邻接表（行 {17}），将相邻顶点加入我们的字符串。邻接表迭代完成后，给我们的字符串添加一个换行符（行 {18}），这样就可以在控制台看到一个漂亮的输出了。运行如下代码：</p>\n<p>console.log(graph.toString());</p>\n<p>输出如下。</p>\n<p>A -&gt; B C D B -&gt; A E F C -&gt; A D G D -&gt; A C G H E -&gt; B I F -&gt; B G -&gt; C D H -&gt; D I -&gt; E</p>\n<p>一个漂亮的邻接表！从该输出中，我们知道顶点 A 有这几个相邻顶点：B、C 和 D。</p>\n<p>12.4　图的遍历</p>\n<p>和树数据结构类似，我们可以访问图的所有节点。有两种算法可以对图进行遍历：广度优先搜索（breadth-first search，BFS）和深度优先搜索（depth-first search，DFS）。图遍历可以用来寻找特定的顶点或寻找两个顶点之间的路径，检查图是否连通，检查图是否含有环，等等。</p>\n<p>在实现算法之前，让我们来更好地理解一下图遍历的思想。</p>\n<p>图遍历算法的思想是必须追踪每个第一次访问的节点，并且追踪有哪些节点还没有被完全探索。对于两种图遍历算法，都需要明确指出第一个被访问的顶点。</p>\n<p>完全探索一个顶点要求我们查看该顶点的每一条边。对于每一条边所连接的没有被访问过的顶点，将其标注为被发现的，并将其加进待访问顶点列表中。</p>\n<p>为了保证算法的效率，务必访问每个顶点至多两次。连通图中每条边和顶点都会被访问到。</p>\n<p>广度优先搜索算法和深度优先搜索算法基本上是相同的，只有一点不同，那就是待访问顶点列表的数据结构，如下表所示。</p>\n<p>算法</p>\n<p>数据结构</p>\n<p>描述</p>\n<p>深度优先搜索</p>\n<p>栈</p>\n<p>将顶点存入栈（在第 4 章中学习过），顶点是沿着路径被探索的，存在新的相邻顶点就去访问</p>\n<p>广度优先搜索</p>\n<p>队列</p>\n<p>将顶点存入队列（在第 5 章中学习过），最先入队列的顶点先被探索</p>\n<p>当要标注已经访问过的顶点时，我们用三种颜色来反映它们的状态。</p>\n<p>白色：表示该顶点还没有被访问。</p>\n<p>灰色：表示该顶点被访问过，但并未被探索过。</p>\n<p>黑色：表示该顶点被访问过且被完全探索过。</p>\n<p>这就是之前提到的务必访问每个顶点最多两次的原因。</p>\n<p>为了有助于在广度优先和深度优先算法中标记顶点，我们要使用 Colors 变量（作为一个枚举器），声明如下。</p>\n<p>const Colors = { WHITE: 0, GREY: 1, BLACK: 2 };</p>\n<p>两个算法还需要一个辅助对象来帮助存储顶点是否被访问过。在每个算法的开头，所有的顶点会被标记为未访问（白色）。我们要用下面的函数来初始化每个顶点的颜色。</p>\n<p>const initializeColor = vertices =&gt; { const color = {}; for (let i = 0; i &lt; vertices.length; i++) { color[vertices[i]] = Colors.WHITE; } return color; };</p>\n<p>我们使用第 2 章学习到的 ES2015 中的 const 和箭头函数来声明函数。我们也可以使用如 function initializeColor (vertices) {} 的函数语法来声明 initializeColor 函数。</p>\n<p>12.4.1　广度优先搜索</p>\n<p>广度优先搜索算法会从指定的第一个顶点开始遍历图，先访问其所有的邻点（相邻顶点），就像一次访问图的一层。换句话说，就是先宽后深地访问顶点，如下图所示。</p>\n<p>以下是从顶点开始的广度优先搜索算法所遵循的步骤。</p>\n<p>(1) 创建一个队列。</p>\n<p>(2) 标注为被发现的（灰色），并将入队列。</p>\n<p>(3) 如果非空，则运行以下步骤：</p>\n<p>(a) 将从中出队列；</p>\n<p>(b) 标注为被发现的（灰色）；</p>\n<p>(c) 将所有未被访问过的邻点（白色）入队列；</p>\n<p>(d) 标注为已被探索的（黑色）。</p>\n<p>让我们来实现广度优先搜索算法。</p>\n<p>export const breadthFirstSearch = (graph, startVertex, callback) =&gt; { const vertices = graph.getVertices(); const adjList = graph.getAdjList(); const color = initializeColor(vertices); // {1} const queue = new Queue(); // {2} queue.enqueue(startVertex); // {3} while (!queue.isEmpty()) { // {4} const u = queue.dequeue(); // {5} const neighbors = adjList.get(u); // {6} color[u] = Colors.GREY; // {7} for (let i = 0; i &lt; neighbors.length; i++) { // {8} const w = neighbors[i]; // {9} if (color[w] === Colors.WHITE) { // {10} color[w] = Colors.GREY; // {11} queue.enqueue(w); // {12} } } color[u] = Colors.BLACK; // {13} if (callback) { // {14} callback(u); } } };</p>\n<p>让我们深入学习广度优先搜索方法的实现。我们要做的第一件事情是用 initializeColor 函数来将 color 数组初始化为白色（行 {1}）。我们还需要声明和创建一个 Queue 实例（行 {2}），它将会存储待访问和待探索的顶点。</p>\n<p>照着本章开头解释过的步骤，breadthFirstSearch 方法接收一个图实例和顶点作为算法的起始点。起始顶点是必要的，我们将此顶点入队列（行 {3}）。</p>\n<p>如果队列非空（行 {4}），我们将通过出队列（行 {5}）操作从队列中移除一个顶点，并取得一个包含其所有邻点的邻接表（行 {6}）。该顶点将被标注为灰色（行 {7}），表示我们发现了它（但还未完成对其的探索）。</p>\n<p>对于 u（行 {8}）的每个邻点，我们取得其值（该顶点的名字 —— 行 {9}），如果它还未被访问过（颜色为白色 —— 行 {10}），则将其标注为我们已经发现了它（颜色设置为灰色 —— 行 {11}），并将这个顶点加入队列（行 {12}）。这样当其从队列中出列的时候，我们可以完成对其的探索。</p>\n<p>当完成探索该顶点和其相邻顶点后，我们将该顶点标注为已探索过的（颜色设置为黑色 —— 行 {13}）。</p>\n<p>我们实现的这个 breadthFirstSearch 方法也接收一个回调（我们在第 10 章中遍历树时使用了一个相似的方法）。这个参数是可选的，如果我们传递了回调函数（行 {14}），就会用到它。</p>\n<p>让我们执行下面这段代码来测试一下该算法。</p>\n<p>const printVertex = (value) =&gt; console.log('Visited vertex: ' + value); // {15} breadthFirstSearch(graph, myVertices[0], printVertex);</p>\n<p>首先，我们声明了一个回调函数（行 {15}），它仅仅在浏览器控制台上输出已经被完全探索过的顶点的名字。接着，我们会调用 breadthFirstSearch 方法，给它传递图（和我们在本章之前用来测试 Graph 类的示例一样），第一个顶点（A—— 来自本章开头声明的 myVertices 数组）和回调函数（printVertex）。当我们执行这段代码时，该算法会在浏览器控制台输出如下所示的结果。</p>\n<p>Visited vertex: A Visited vertex: B Visited vertex: C Visited vertex: D Visited vertex: E Visited vertex: F Visited vertex: G Visited vertex: H Visited vertex: I</p>\n<p>如你所见，顶点被访问的顺序和本节开头的示意图中所展示的一致。</p>\n<p>使用 BFS 寻找最短路径</p>\n<p>到目前为止，我们只展示了 BFS 算法的工作原理。我们可以用该算法做更多事情，而不只是输出被访问顶点的顺序。例如，考虑如何来解决下面这个问题。</p>\n<p>给定一个图和源顶点，找出每个顶点和之间最短路径的距离（以边的数量计）。</p>\n<p>对于给定顶点，广度优先算法会访问所有与其距离为 1 的顶点，接着是距离为 2 的顶点，以此类推。所以，可以用广度优先算法来解这个问题。我们可以修改 breadthFirstSearch 方法以返回给我们一些信息：</p>\n<p>从到的距离 distances [u]；</p>\n<p>前溯点 predecessors [u]，用来推导出从到其他每个顶点的最短路径。</p>\n<p>让我们来看看改进过的广度优先方法的实现。</p>\n<p>const BFS = (graph, startVertex) =&gt; { const vertices = graph.getVertices(); const adjList = graph.getAdjList(); const color = initializeColor(vertices); const queue = new Queue(); const distances = {}; // {1} const predecessors = {}; // {2} queue.enqueue(startVertex); for (let i = 0; i &lt; vertices.length; i++) { // {3} distances[vertices[i]] = 0; // {4} predecessors[vertices[i]] = null; // {5} } while (!queue.isEmpty()) { const u = queue.dequeue(); const neighbors = adjList.get(u); color[u] = Colors.GREY; for (let i = 0; i &lt; neighbors.length; i++) { const w = neighbors[i]; if (color[w] === Colors.WHITE) { color[w] = Colors.GREY; distances[w] = distances[u] + 1; // {6} predecessors[w] = u; // {7} queue.enqueue(w); } } color[u] = Colors.BLACK; } return { // {8} distances, predecessors }; };</p>\n<p>这个版本的 BFS 方法有些什么改变？</p>\n<p>我们还需要声明数组 distances（行 {1}）来表示距离，以及 predecessors 数组（行 {2}）来表示前溯点。下一步则是对于图中的每一个顶点（行 {3}），用 0 来初始化数组 distances（行 {4}），用 null 来初始化数组 predecessors（行 {5}）。</p>\n<p>当我们发现顶点 u 的邻点 w 时，则设置 w 的前溯点值为 u（行 {7}）。我们还通过给 distances [u] 加 1 来增加 v 和 w 之间的距离（u 是 w 的前溯点，distances [u] 的值已经有了）。</p>\n<p>方法最后返回了一个包含 distances 和 predecessors 的对象（行 {8}）。</p>\n<p>现在，我们可以再次执行 BFS 方法，并将其返回值存在一个变量中。</p>\n<p>const shortestPathA = BFS(graph, myVertices[0]); console.log(shortestPathA);</p>\n<p>对顶点 A 执行 BFS 方法，以下将会是输出。</p>\n<p>distances: [A: 0, B: 1, C: 1, D: 1, E: 2, F: 2, G: 2, H: 2 , I: 3], predecessors: [A: null, B: &quot;A&quot;, C: &quot;A&quot;, D: &quot;A&quot;, E: &quot;B&quot;, F: &quot;B&quot;, G: &quot;C&quot;, H: &quot;D&quot;, I: &quot;E&quot;]</p>\n<p>这意味着顶点 A 与顶点 B、C 和 D 的距离为 1；与顶点 E、F、G 和 H 的距离为 2；与顶点 I 的距离为 3。</p>\n<p>通过前溯点数组，我们可以用下面这段代码来构建从顶点 A 到其他顶点的路径。</p>\n<p>const fromVertex = myVertices[0]; // {9} for (i = 1; i &lt; myVertices.length; i++) { // {10} const toVertex = myVertices[i]; // {11} const path = new Stack(); // {12} for (let v = toVertex; v !== fromVertex; v = shortestPathA.predecessors[v]) { // {13} path.push(v); // {14} } path.push(fromVertex); // {15} let s = path.pop(); // {16} while (!path.isEmpty()) { // {17} s += ' - ' + path.pop(); // {18} } console.log(s); // {19} }</p>\n<p>我们用顶点 A 作为源顶点（行 {9}）。对于每个其他顶点（除了顶点 A—— 行 {10}），我们会计算顶点 A 到它的路径。我们从 myVertices 数组得到值（行 {11}），然后会创建一个栈来存储路径值（行 {12}）。</p>\n<p>接着，我们追溯 toVertex 到 fromVertex 的路径（行 {13}）。变量 v 被赋值为其前溯点的值，这样我们能够反向追溯这条路径。将变量 v 添加到栈中（行 {14}）。最后，源顶点也会被添加到栈中（行 {15}），以得到完整路径。</p>\n<p>之后，我们创建了一个 s 字符串，并将源顶点赋值给它（它是最后一个加入栈中的，所以是第一个被弹出的项 —— 行 {16}）。当栈是非空的（行 {17}），我们就从栈中移出一个项并将其拼接到字符串 s 的后面（行 {18}）。最后，在控制台上输出路径（行 {19}）。</p>\n<p>执行该代码段，我们会得到如下输出。</p>\n<p>A - B A - C A - D A - B - E A - B - F A - C - G A - D - H A - B - E - I</p>\n<p>这里，我们得到了从顶点 A 到图中其他顶点的最短路径（衡量标准是边的数量）。</p>\n<p>深入学习最短路径算法</p>\n<p>本章中的图不是加权图。如果要计算加权图中的最短路径（例如，城市 A 和城市 B 之间的最短路径 ——GPS 和 Google Maps 中用到的算法），广度优先搜索未必合适。</p>\n<p>举几个例子，Dijkstra 算法解决了单源最短路径问题。Bellman-Ford 算法解决了边权值为负的单源最短路径问题。A * 搜索算法解决了求仅一对顶点间的最短路径问题，用经验法则来加速搜索过程。Floyd-Warshall 算法解决了求所有顶点对之间的最短路径这一问题。</p>\n<p>我们会在本章后面学习 Dijkstra 算法和 Floyd-Warshall 算法。</p>\n<p>12.4.2　深度优先搜索</p>\n<p>深度优先搜索算法将会从第一个指定的顶点开始遍历图，沿着路径直到这条路径最后一个顶点被访问了，接着原路回退并探索下一条路径。换句话说，它是先深度后广度地访问顶点，如下图所示。</p>\n<p>深度优先搜索算法不需要一个源顶点。在深度优先搜索算法中，若图中顶点未访问，则访问该顶点。</p>\n<p>要访问顶点，照如下步骤做：</p>\n<p>(1) 标注为被发现的（灰色）；</p>\n<p>(2) 对于的所有未访问（白色）的邻点，访问顶点；</p>\n<p>(3) 标注为已被探索的（黑色）。</p>\n<p>如你所见，深度优先搜索的步骤是递归的，这意味着深度优先搜索算法使用栈来存储函数调用（由递归调用所创建的栈）。</p>\n<p>让我们来实现一下深度优先算法。</p>\n<p>const depthFirstSearch = (graph, callback) =&gt; { // {1} const vertices = graph.getVertices(); const adjList = graph.getAdjList(); const color = initializeColor(vertices); for (let i = 0; i &lt; vertices.length; i++) { // {2} if (color[vertices[i]] === Colors.WHITE) { // {3} depthFirstSearchVisit(vertices[i], color, adjList, callback); // {4} } } }; const depthFirstSearchVisit = (u, color, adjList, callback) =&gt; { color[u] = Colors.GREY; // {5} if (callback) { // {6} callback(u); } const neighbors = adjList.get(u); // {7} for (let i = 0; i &lt; neighbors.length; i++) { // {8} const w = neighbors[i]; // {9} if (color[w] === Colors.WHITE) { // {10} depthFirstSearchVisit(w, color, adjList, callback); // {11} } } color[u] = Colors.BLACK; // {12} };</p>\n<p>depthFirstSearch 函数接收一个 Graph 类实例和回调函数作为参数（行 {1}）。在初始化每个顶点的颜色后，对于图实例中每一个未被访问过的顶点（行 {2} 和行 {3}），我们调用私有的递归函数 depthFirstSearchVisit，传递的参数为要访问的顶点 u、颜色数组以及回调函数 （行 {4}）。</p>\n<p>当访问顶点 u 时，我们标注其为被发现的（灰色 —— 行 {5}）。如果有 callback 函数的话（行 {6}），则执行该函数输出已访问过的顶点。接下来的一步是取得包含顶点 u 所有邻点的列表（行 {7}）。对于顶点 u 的每一个未被访问过（颜色为白色 —— 行 {10} 和行 {8}）的邻点 w（行 {9}），我们将调用 depthFirstSearchVisit 函数，传递 w 和其他参数（行 {11}—— 添加顶点 w 入栈，这样接下来就能访问它）。最后，在该顶点和邻点按深度访问之后，我们回退，意思是该顶点已被完全探索，并将其标注为黑色（行 {12}）。</p>\n<p>让我们执行下面的代码段来测试一下 depthFirstSearch 方法。</p>\n<p>depthFirstSearch(graph, printVertex);</p>\n<p>输出如下。</p>\n<p>Visited vertex: A Visited vertex: B Visited vertex: E Visited vertex: I Visited vertex: F Visited vertex: C Visited vertex: D Visited vertex: G Visited vertex: H</p>\n<p>这个顺序和本节开头处示意图所展示的一致。下面这个示意图展示了该算法每一步的执行过程。</p>\n<p>在我们示例所用的图中，行 {4} 只会被执行一次，因为所有其他的顶点都有路径到第一个调用 depthFirstSearchVisit 函数的顶点（顶点 A）。如果顶点 B 第一个调用函数，则行 {4} 将会为其他顶点再执行一次（比如顶点 A）。</p>\n<p>Angular（版本 2+）在探测变更（验证 HTML 模板是否需要更新）方面使用的算法和深度优先搜索算法非常相似。要了解更多，请访问 http://t.cn/E532diz。数据结构和算法对于理解前端框架是怎样工作的以及将你的知识提升到更高的层次也是很重要的。</p>\n<p>探索深度优先算法</p>\n<p>到目前为止，我们只是展示了深度优先搜索算法的工作原理。我们可以用该算法做更多的事情，而不只是输出被访问顶点的顺序。</p>\n<p>对于给定的图，我们希望深度优先搜索算法遍历图的所有节点，构建 “森林”（有根树的一个集合）以及一组源顶点（根），并输出两个数组：发现时间和完成探索时间。我们可以修改 depthFirstSearch 函数来返回一些信息：</p>\n<p>顶点 u 的发现时间 d [u]；</p>\n<p>当顶点 u 被标注为黑色时，u 的完成探索时间 f [u]；</p>\n<p>顶点 u 的前溯点 p [u]。</p>\n<p>让我们来看看改进了的 DFS 方法的实现。</p>\n<p>export const DFS = graph =&gt; { const vertices = graph.getVertices(); const adjList = graph.getAdjList(); const color = initializeColor(vertices); const d = {}; const f = {}; const p = {}; const time = { count : 0}; // {1} for (let i = 0; i &lt; vertices.length; i++) { // {2} f[vertices[i]] = 0; d[vertices[i]] = 0; p[vertices[i]] = null; } for (let i = 0; i &lt; vertices.length; i++) { if (color[vertices[i]] === Colors.WHITE) { DFSVisit(vertices[i], color, d, f, p, time, adjList); } } return { // {3} discovery: d, finished: f, predecessors: p }; }; const DFSVisit = (u, color, d, f, p, time, adjList) =&gt; { color[u] = Colors.GREY; d[u] = <ins>time.count; // {4} const neighbors = adjList.get(u); for (let i = 0; i &lt; neighbors.length; i</ins>) { const w = neighbors[i]; if (color[w] === Colors.WHITE) { p[w] = u; // {5} DFSVisit(w, color, d, f, p, time, adjList); } } color[u] = Colors.BLACK; f[u] = ++time.count; // {6} };</p>\n<p>我们需要声明一个变量来追踪发现时间和完成探索时间（行 {1}）。</p>\n<p>我们声明一个 time 对象，包含 count 属性，这跟 JavaScript 中的方法按值或按引用传递参数有关。在一些语言中，按值或按引用传递参数是有区别的。原始数据类型是按值传递的，也就是说值的作用域只存在于函数的执行过程中。如果修改了值，只会在函数的作用域内生效。如果参数以引用形式（对象）传递，并修改了对象中的任意属性，将会影响对象的原始值。对象以引用形式传递是因为只有内存的引用被传给了函数或方法。在这个例子中，我们希望次数统计在这个算法执行过程中是全局使用的，所以需要将参数以对象传递，而不是原始值。</p>\n<p>接下来，我们声明数组 d、f 和 p（行 {2}），还需要为图的每一个顶点来初始化这些数组。在这个方法结尾处返回这些值（行 {3}），之后我们要用到它们。</p>\n<p>当一个顶点第一次被发现时，我们追踪其发现时间（行 {4}）。当它是由引自顶点 u 的边而被发现的，我们追踪它的前溯点（行 {5}）。最后，当这个顶点被完全探索后，我们追踪其完成时间（行 {6}）。</p>\n<p>深度优先算法背后的思想是什么？边是从最近发现的顶点 u 处被向外探索的。只有连接到未发现的顶点的边被探索了。当 u 所有的边都被探索了，该算法回退到 u 被发现的地方去探索其他的边。这个过程持续到我们发现了所有从原始顶点能够触及的顶点。如果还留有任何其他未被发现的顶点，我们对新源顶点重复这个过程。重复该算法，直到图中所有的顶点都被探索了。</p>\n<p>对于改进过的深度优先搜索，有两点需要我们注意：</p>\n<p>时间（time）变量值的范围只可能在图顶点数量的一倍到两倍（2|V|）之间；</p>\n<p>对于所有的顶点 u，d [u]&lt;f [u]（意味着，发现时间的值比完成时间的值小，完成时间意思是所有顶点都已经被探索过了）。</p>\n<p>在这两个假设下，我们有如下的规则。</p>\n<p>1 &lt;= d [u] &lt; f [u] &lt;= 2|V|</p>\n<p>如果对同一个图再跑一遍新的深度优先搜索方法，对图中每个顶点，我们会得到如下的发现 / 完成时间。</p>\n<p>但我们能用这些新信息来做什么呢？来看下一节。</p>\n<p>拓扑排序 —— 使用深度优先搜索</p>\n<p>给定下图，假定每个顶点都是一个我们需要去执行的任务。</p>\n<p>这是一个有向图，意味着任务的执行是有顺序的。例如，任务 F 不能在任务 A 之前执行。注意这个图没有环，意味着这是一个无环图。所以，我们可以说该图是一个有向无环图（DAG）。</p>\n<p>当我们需要编排一些任务或步骤的执行顺序时，这称为拓扑排序（topological sorting，英文亦写作 topsort 或是 toposort）。在日常生活中，这个问题在不同情形下都会出现。例如，当我们开始学习一门计算机科学课程，在学习某些知识之前得按顺序完成一些知识储备（你不可以在上算法 I 课程前先上算法 II 课程）。当我们在开发一个项目时，需要按顺序执行一些步骤。例如，首先从客户那里得到需求，接着开发客户要求的东西，最后交付项目。你不能先交付项目再去收集需求。</p>\n<p>拓扑排序只能应用于 DAG。那么，如何使用深度优先搜索来实现拓扑排序呢？让我们在本节开头的示意图上执行一下深度优先搜索。</p>\n<p>graph = new Graph (true); // 有向图 myVertices = ['A', 'B', 'C', 'D', 'E', 'F']; for (i = 0; i &lt; myVertices.length; i++) { graph.addVertex (myVertices [i]); } graph.addEdge ('A', 'C'); graph.addEdge ('A', 'D'); graph.addEdge ('B', 'D'); graph.addEdge ('B', 'E'); graph.addEdge ('C', 'F'); graph.addEdge ('F', 'E'); const result = DFS (graph);</p>\n<p>这段代码将创建图，添加边，执行改进版本的深度优先搜索算法，并将结果保存到 result 变量。下图展示了深度优先搜索算法执行后，该图的发现和完成时间。</p>\n<p>现在要做的仅仅是以倒序来排序完成时间数组，这便得出了该图的拓扑排序，如下所示。</p>\n<p>const fTimes = result.finished; s = ''; for (let count = 0; count &lt; myVertices.length; count++) { let max = 0; let maxName = null; for (i = 0; i &lt; myVertices.length; i++) { if (fTimes[myVertices[i]] &gt; max) { max = fTimes[myVertices[i]]; maxName = myVertices[i]; } } s += ' - ' + maxName; delete fTimes[maxName]; } console.log(s);</p>\n<p>执行了上述代码后，我们会得到下面的输出。</p>\n<p>B - A - D - C - F - E</p>\n<p>注意之前的拓扑排序结果仅是多种可能性之一。如果我们稍微修改一下算法，就会有不同的结果。比如下面这个结果也是众多其他可能性中的一个。</p>\n<p>A - B - C - D - F - E</p>\n<p>这也是一个可以接受的结果。</p>\n<p>12.5　最短路径算法</p>\n<p>设想你要从街道地图上的 A 点出发，通过可能的最短路径到达 B 点。举例来说，从洛杉矶的圣莫尼卡大道到好莱坞大道，如下图所示。</p>\n<p>这种问题在生活中非常常见，我们（特别是生活在大城市的人们）会求助于苹果地图、谷歌地图、Waze 等应用程序。当然，我们也有其他的考虑，如时间或路况，但根本的问题仍然是：从 A 到 B 的最短路径是什么？</p>\n<p>我们可以用图来解决这个问题，相应的算法被称为最短路径。下节我们将介绍两种非常著名的算法，即 Dijkstra 算法和 Floyd-Warshall 算法。</p>\n<p>12.5.1　Dijkstra 算法</p>\n<p>Dijkstra 算法是一种计算从单个源到所有其他源的最短路径的贪心算法（你可以在第 14 章了解到更多关于贪心算法的内容），这意味着我们可以用它来计算从图的一个顶点到其余各顶点的最短路径。</p>\n<p>考虑下面这个图。</p>\n<p>我们来看看如何找到顶点 A 和其余顶点之间的最短路径。但首先，我们需要声明表示上图的邻接矩阵，如下所示。</p>\n<p>var graph = [[0, 2, 4, 0, 0, 0], [0, 0, 1, 4, 2, 0], [0, 0, 0, 0, 3, 0], [0, 0, 0, 0, 0, 2], [0, 0, 0, 3, 0, 2], [0, 0, 0, 0, 0, 0]];</p>\n<p>现在，通过下面的代码来看看 Dijkstra 算法是如何工作的。</p>\n<p>const INF = Number.MAX_SAFE_INTEGER; const dijkstra = (graph, src) =&gt; { const dist = []; const visited = []; const { length } = graph; for (let i = 0; i &lt; length; i++) { // {1} dist[i] = INF; visited[i] = false; } dist[src] = 0; // {2} for (let i = 0; i &lt; length - 1; i++) { // {3} const u = minDistance(dist, visited); // {4} visited[u] = true; // {5} for (let v = 0; v &lt; length; v++) { if (!visited[v] &amp;&amp; graph[u][v] !== 0 &amp;&amp; dist[u] !== INF &amp;&amp; dist[u] + graph[u][v] &lt; dist[v]) { // {6} dist[v] = dist[u] + graph[u][v]; // {7} } } } return dist; // {8} };</p>\n<p>下面是对算法过程的描述。</p>\n<p>行 {1}：首先，把所有的距离（dist）初始化为无限大（JavaScript 最大的数 INF = Number.MAX_SAFE_INTEGER），将 visited [] 初始化为 false。</p>\n<p>行 {2}：然后，把源顶点到自己的距离设为 0。</p>\n<p>行 {3}：接下来，要找出到其余顶点的最短路径。</p>\n<p>行 {4}：为此，我们需要从尚未处理的顶点中选出距离最近的顶点。</p>\n<p>行 {5}：把选出的顶点标为 visited，以免重复计算。</p>\n<p>行 {6}：如果找到更短的路径，则更新最短路径的值（行 {7}）。</p>\n<p>行 {8}：处理完所有顶点后，返回从源顶点（src）到图中其他顶点最短路径的结果。</p>\n<p>要计算顶点间的 minDistance，就要搜索 dist 数组中的最小值，返回它在数组中的索引。</p>\n<p>const minDistance = (dist, visited) =&gt; { let min = INF; let minIndex = -1; for (let v = 0; v &lt; dist.length; v++) { if (visited[v] === false &amp;&amp; dist[v] &lt;= min) { min = dist[v]; minIndex = v; } } return minIndex; };</p>\n<p>对本节开始的图执行以上算法，会得到如下输出。</p>\n<p>0 0 1 2 2 4 3 6 4 4 5 6</p>\n<p>也可以修改算法，将最短路径的值和路径一同返回。</p>\n<p>12.5.2　Floyd-Warshall 算法</p>\n<p>Floyd-Warshall 算法是一种计算图中所有最短路径的动态规划算法（你可以在第 14 章了解到更多关于动态规划算法的内容）。通过该算法，我们可以找出从所有源到所有顶点的最短路径。</p>\n<p>Floyd-Warshall 算法实现如下所示。</p>\n<p>const floydWarshall = graph =&gt; { const dist = []; const { length } = graph; for (let i = 0; i &lt; length; i++) { // {1} dist[i] = []; for (let j = 0; j &lt; length; j++) { if (i === j) { dist[i][j] = 0; // {2} } else if (!isFinite(graph[i][j])) { dist[i][j] = Infinity; // {3} } else { dist[i][j] = graph[i][j]; // {4} } } } for (let k = 0; k &lt; length; k++) { // {5} for (let i = 0; i &lt; length; i++) { for (let j = 0; j &lt; length; j++) { if (dist[i][k] + dist[k][j] &lt; dist[i][j]) { // {6} dist[i][j] = dist[i][k] + dist[k][j]; // {7} } } } } return dist; };</p>\n<p>下面是对算法过程的描述。</p>\n<p>首先，把 distance 数组初始化为每个顶点之间的权值（行 {1}），因为 i 到 j 可能的最短距离就是这些顶点间的权值（行 {4}）。顶点到自身的距离为 0（行 {2}）。如果两个顶点之间没有边，就将其表示为 Infinity（行 {3}）。将顶点 0 到 k 作为中间点（行 {5}），从 i 到 j 的最短路径经过 k。行 {6} 给出的公式用来计算通过顶点 k 的 i 和 j 之间的最短路径。如果一个最短路径的新的值被找到，我们要使用并存储它（行 {7}）。</p>\n<p>行 {6} 是 Floyd-Warshall 算法的核心。对本节开始的图执行以上算法，会得到如下输出。</p>\n<p>0 2 4 6 4 6 INF 0 2 4 2 4 INF INF 0 6 3 5 INF INF INF 0 INF 2 INF INF INF 3 0 2 INF INF INF INF INF 0</p>\n<p>这里的 INF 代表顶点 i 到 j 的最短路径不存在。</p>\n<p>对图中每一个顶点执行 Dijkstra 算法，也可以得到相同的结果。</p>\n<p>12.6　最小生成树</p>\n<p>最小生成树（MST）问题是网络设计中常见的问题。想象一下，你的公司有几间办公室，要以最低的成本实现办公室电话线路相互连通，以节省资金，最好的办法是什么？</p>\n<p>这也可以应用于岛桥问题。设想你要在个岛屿之间建造桥梁，想用最低的成本实现所有岛屿相互连通。</p>\n<p>这两个问题都可以用 MST 算法来解决，其中的办公室或者岛屿可以表示为图中的一个顶点，边代表成本。下面有一个图的例子，其中较粗的边是一个 MST 的解决方案。</p>\n<p>本节我们将学习两种主要的求最小生成树的算法：Prim 算法和 Kruskal 算法。</p>\n<p>12.6.1　Prim 算法</p>\n<p>Prim 算法是一种求解加权无向连通图的 MST 问题的贪心算法。它能找出一个边的子集，使得其构成的树包含图中所有顶点，且边的权值之和最小。</p>\n<p>Prim 算法如下所示。</p>\n<p>const INF = Number.MAX_SAFE_INTEGER; const prim = graph =&gt; { const parent = []; const key = []; const visited = []; const { length } = graph; for (let i = 0; i &lt; length; i++) { // {1} key[i] = INF; visited[i] = false; } key[0] = 0; // {2} parent[0] = -1; for (let i = 0; i &lt; length - 1; i++) { // {3} const u = minKey(graph, key, visited); // {4} visited[u] = true; // {5} for (let v = 0; v &lt; length; v++) { if (graph[u][v] &amp;&amp; !visited[v] &amp;&amp; graph[u][v] &lt; key[v]) { // {6} parent[v] = u; // {7} key[v] = graph[u][v]; // {8} } } } return parent; // {9} };</p>\n<p>下面是对算法过程的描述。</p>\n<p>行 {1}：首先，把所有顶点（key）初始化为无限大（JavaScript 最大的数 INF = Number.MAX_SAFE_INTEGER），visited [] 初始化为 false。</p>\n<p>行 {2}：其次，选择第一个 key 作为第一个顶点，同时，因为第一个顶点总是 MST 的根节点，所以 parent [0] = -1。</p>\n<p>行 {3}：然后，对所有顶点求 MST。</p>\n<p>行 {4}：从未处理的顶点集合中选出 key 值最小的顶点（与 Dijkstra 算法中使用的 minDistance 函数一样，只是名字不同）。</p>\n<p>行 {5}：把选出的顶点标为 visited，以免重复计算。</p>\n<p>行 {6}：如果得到更小的权值，则保存 MST 路径（parent，行 {7}）并更新其权值（行 {8}）。</p>\n<p>行 {9}：处理完所有顶点后，返回包含 MST 的结果。</p>\n<p>比较 Prim 算法和 Dijkstra 算法，我们会发现除了行 {7} 和行 {8} 之外，两者非常相似。行 {7} 用 parent 数组保存 MST 的结果。行 {8} 用 key 数组保存权值最小的边，而在 Dijkstra 算法中，用 dist 数组保存距离。我们可以修改 Dijkstra 算法，加入 parent 数组。这样，就可以在求出距离的同时得到路径。</p>\n<p>对如下的图执行以上算法。</p>\n<p>var graph = [[0, 2, 4, 0, 0, 0], [2, 0, 2, 4, 2, 0], [4, 2, 0, 0, 3, 0], [0, 4, 0, 0, 3, 2], [0, 2, 3, 3, 0, 2], [0, 0, 0, 2, 2, 0]];</p>\n<p>我们会得到如下输出。</p>\n<p>Edge Weight 0 - 1 2 1 - 2 2 5 - 3 2 1 - 4 2 4 - 5 2</p>\n<p>12.6.2　Kruskal 算法</p>\n<p>和 Prim 算法类似，Kruskal 算法也是一种求加权无向连通图的 MST 的贪心算法。</p>\n<p>现在，通过下面的代码来看看 Kruskal 算法。</p>\n<p>const kruskal = graph =&gt; { const { length } = graph; const parent = []; let ne = 0; let a; let b; let u; let v; const cost = initializeCost(graph); // {1} while (ne &lt; length - 1) { // {2} for (let i = 0, min = INF; i &lt; length; i++) { // {3} for (let j = 0; j &lt; length; j++) { if (cost[i][j] &lt; min) { min = cost[i][j]; a = u = i; b = v = j; } } } u = find(u, parent); // {4} v = find(v, parent); // {5} if (union(u, v, parent)) { // {6} ne++; } cost[a][b] = cost[b][a] = INF; // {7} } return parent; };</p>\n<p>下面是对算法过程的描述。</p>\n<p>行 {1}：首先，把邻接矩阵的值复制到 cost 数组，以方便修改且可以保留原始值行 {7}。</p>\n<p>行 {2}：当 MST 的边数小于顶点总数减 1 时。</p>\n<p>行 {3}：找出权值最小的边。</p>\n<p>行 {4} 和行 {5}：检查 MST 中是否已存在这条边，以避免环路。</p>\n<p>行 {6}：如果 u 和 v 是不同的边，则将其加入 MST。</p>\n<p>行 {7}：从列表中移除这些边，以免重复计算。</p>\n<p>行 {8}：返回 MST。</p>\n<p>下面是 find 函数的定义。它能防止 MST 出现环路。</p>\n<p>const find = (i, parent) =&gt; { while (parent[i]) { i = parent[i]; } return i; };</p>\n<p>union 函数的定义如下所示。</p>\n<p>const union = (i, j, parent) =&gt; { if (i !== j) { parent[j] = i; return true; } return false; };</p>\n<p>这个算法有几种变体。这取决于对边的权值排序时所使用的数据结构（如优先队列），以及图是如何表示的。</p>\n<p>12.7　小结</p>\n<p>本章涵盖了图的基本概念。我们学习了几种不同的方式来表示这一数据结构，并实现了用邻接表表示图的算法。你还学到了如何用广度优先搜索和深度优先搜索来遍历图。本章还包括了广度优先搜索和深度优先搜索的两个实际应用，它们分别是使用广度优先搜索来找到最短路径，以及使用深度优先搜索来做拓扑排序。</p>\n<p>本章还介绍了一些著名的算法，如计算最短路径的 Dijkstra 算法和 Floyd-Warshall 算法，以及计算图的最小生成树的 Prim 算法和 Kruskal 算法。</p>\n<p>下一章，我们将会学习计算机科学中最常用的排序算法。</p>\n<h1 id=\"第-13-章-排序和搜索算法\"><a class=\"anchor\" href=\"#第-13-章-排序和搜索算法\">#</a> 第 13 章　排序和搜索算法</h1>\n<p>假设我们有一个没有任何排列顺序的电话号码簿（或笔记本）。当需要添加联络人和电话时，你只能将其写在下一个空位上。假定你的联系人列表上有很多人。某天，你要找某个联系人及其电话号码。但是由于联系人列表没有按照任何顺序来组织，你只能逐个检查，直到找到那个你想要的联系人为止。这个方法太吓人了，难道你不这么认为吗？想象一下你要在黄页上搜寻一个联系人，但是那本黄页没有进行任何组织，那得花多长时间啊？！</p>\n<p>因此（还有其他原因），我们需要组织信息集，比如那些存储在数据结构里的信息。排序和搜索算法广泛地运用在待解决的日常问题中。</p>\n<p>本章，你会学到最常用的排序和搜索算法，如冒泡排序、选择排序、插入排序、希尔排序、归并排序、快速排序、计数排序、桶排序、基数排序，以及顺序搜索、内插搜索和二分搜索算法。</p>\n<p>13.1　排序算法</p>\n<p>本节会介绍一些在计算机科学中最著名的排序算法。我们会从最慢的一个开始，接着是一些性能较好的算法。我们要理解：首先要学会如何排序，然后再搜索我们需要的信息。</p>\n<p>你可以在 https://visualgo.net/zh/sorting 和 https://www.toptal.com/developers/sorting-algorithms 查看本章介绍的著名算法的动画演示版本。</p>\n<p>我们开始吧！</p>\n<p>13.1.1　冒泡排序</p>\n<p>人们开始学习排序算法时，通常都先学冒泡算法，因为它在所有排序算法中最简单。然而，从运行时间的角度来看，冒泡排序是最差的一个，接下来你会知晓原因。</p>\n<p>冒泡排序比较所有相邻的两个项，如果第一个比第二个大，则交换它们。元素项向上移动至正确的顺序，就好像气泡升至表面一样，冒泡排序因此得名。</p>\n<p>让我们来实现一下冒泡排序。</p>\n<p>function bubbleSort(array, compareFn = defaultCompare) { const { length } = array; // {1} for (let i = 0; i &lt; length; i++) { // {2} for (let j = 0; j &lt; length - 1; j++) { // {3} if (compareFn(array[j], array[j + 1]) === Compare.BIGGER_THAN) { // {4} swap(array, j, j + 1); // {5} } } } return array; }</p>\n<p>本章创建的非分布式排序算法都会接收一个待排序的数组作为参数以及一个比较函数。为了使测试更容易理解，我们会在例子中使用包含数字的数组。不过如果需要对包含复杂对象的数组进行排序（对包含 people 对象的数组按 age 属性排序），我们的算法也可以奏效。默认的比较函数是我们之前使用过的 defaultCompare 函数（return a &lt; b ? Compare.LESS_THAN : Compare.BIGGER_THAN）。</p>\n<p>首先，声明一个名为 length 的变量，用来存储数组的长度（行 {1}）。这一步可选，它能帮助我们在行 {2} 和行 {3} 时直接使用数组的长度。接着，外循环（行 {2}）会从数组的第一位迭代至最后一位，它控制了在数组中经过多少轮排序（应该是数组中每项都经过一轮，轮数和数组长度一致）。然后，内循环将从第一位迭代至倒数第二位，内循环实际上进行当前项和下一项的比较（行 {4}）。如果这两项顺序不对（当前项比下一项大），则交换它们（行 {5}），意思是位置为 j+1 的值将会被换置到位置 j 处，反之亦然。</p>\n<p>我们在第 11 章创建了 swap 函数。为了提醒我们自己，swap 函数的代码如下。</p>\n<p *=\"\" const=\"\" temp=\"\">function swap(array, a, b)</p>\n<p>下面的示意图展示了冒泡排序的工作过程。</p>\n<p>该示意图中每一小段表示外循环的一轮（行 {2}），而相邻两项的比较则是在内循环中进行的（行 {3}）。</p>\n<p>我们将使用下面这段代码来测试冒泡排序算法，看结果是否和示意图所示一致。</p>\n<p 10=\"\">function createNonSortedArray(size) { // 6 const array = []; for (let i = size; i &gt; 0; i--) { array.push(i); } return array; } let array = createNonSortedArray(5); // {7} console.log(array.join()); // {8} array = bubbleSort(array); // {9} console.log(array.join()); //</p>\n<p>为了辅助测试本章将要学习的排序算法，我们将创建一个函数来自动创建一个未排序的数组，数组的长度由函数参数指定（行 {6}）。如果传递 5 作为参数，该函数会创建如下数组：[5, 4, 3, 2, 1]。调用这个函数并将返回值存储在一个变量中，该变量将包含这个以某些数字来初始化的数组实例（行 {7}）。我们在控制台上输出这个数组内容，确保这是一个未排序数组（行 {8}），接着我们调用冒泡排序方法（行 {9}）并再次在控制台上输出数组内容以验证数组已被排序了（行 {10}）。</p>\n<p>你可以从书本的支持页面（或 GitHub 仓库 https://github.com/loiane/javascript-datastructures-algorithms）所下载的源代码文件中找到更多示例和测试代码。</p>\n<p>注意当算法执行外循环的第二轮的时候，数字 4 和 5 已经是正确排序的了。尽管如此，在后续比较中，它们还在一直进行着比较，即使这是不必要的。因此，我们可以稍稍改进一下冒泡排序算法。</p>\n<p>改进后的冒泡排序</p>\n<p>如果从内循环减去外循环中已跑过的轮数，就可以避免内循环中所有不必要的比较（行 {1}）。</p>\n<p>function modifiedBubbleSort(array, compareFn = defaultCompare) { const { length } = array; for (let i = 0; i &lt; length; i++) { for (let j = 0; j &lt; length - 1 - i; j++) { // {1} if (compareFn(array[j], array[j + 1]) === Compare.BIGGER_THAN) { swap(array, j, j + 1); } } } return array; }</p>\n<p>下面这个示意图展示了改进后的冒泡排序算法是如何执行的。</p>\n<p>注意，已经在正确位置上的数字没有被比较。即便我们做了这个小改变来改进冒泡排序算法，但还是不推荐该算法，它的复杂度是。</p>\n<p>我们将在第 15 章详细介绍大表示法，对算法做更多的讨论。</p>\n<p>13.1.2　选择排序</p>\n<p>选择排序算法是一种原址比较排序算法。选择排序大致的思路是找到数据结构中的最小值并将其放置在第一位，接着找到第二小的值并将其放在第二位，以此类推。</p>\n<p>下面是选择排序算法的源代码。</p>\n<p>function selectionSort(array, compareFn = defaultCompare) { const { length } = array; // {1} let indexMin; for (let i = 0; i &lt; length - 1; i++) { // {2} indexMin = i; // {3} for (let j = i; j &lt; length; j++) { // {4} if (compareFn(array[indexMin], array[j]) === Compare.BIGGER_THAN) { // {5} indexMin = j; // {6} } } if (i !== indexMin) { // {7} swap(array, i, indexMin); } } return array; };</p>\n<p>首先声明一些将在算法内使用的变量（行 {1}）。接着，外循环（行 {2}）迭代数组，并控制迭代轮次（数组的第个值 —— 下一个最小值）。我们假设本迭代轮次的第一个值为数组最小值（行 {3}）。然后，从当前 i 的值开始至数组结束（行 {4}），我们比较是否位置 j 的值比当前最小值小（行 {5}）；如果是，则改变最小值至新最小值（行 {6}）。当内循环结束（行 {4}），将得出数组第小的值。最后，如果该最小值和原最小值不同（行 {7}），则交换其值。</p>\n<p>用以下代码段来测试选择排序算法。</p>\n<p>let array = createNonSortedArray(5); console.log(array.join()); array = selectionSort(array); console.log(array.join());</p>\n<p>下面的示意图展示了选择排序算法，此例基于之前代码中所用的数组，也就是 [5, 4, 3, 2, 1]。</p>\n<p>数组底部的箭头指示出当前迭代轮寻找最小值的数组范围（内循环 —— 行 {4}），示意图中的每一步则表示外循环（行 {2}）。</p>\n<p>选择排序同样也是一个复杂度为的算法。和冒泡排序一样，它包含有嵌套的两个循环，这导致了二次方的复杂度。然而，接下来要学的插入排序比选择排序性能要好。</p>\n<p>13.1.3　插入排序</p>\n<p>插入排序每次排一个数组项，以此方式构建最后的排序数组。假定第一项已经排序了。接着，它和第二项进行比较 —— 第二项是应该待在原位还是插到第一项之前呢？这样，头两项就已正确排序，接着和第三项比较（它是该插入到第一、第二还是第三的位置呢），以此类推。</p>\n<p>下面这段代码表示插入排序算法。</p>\n<p>function insertionSort(array, compareFn = defaultCompare) { const { length } = array; // {1} let temp; for (let i = 1; i &lt; length; i++) { // {2} let j = i; // {3} temp = array[i]; // {4} while (j &gt; 0 &amp;&amp; compareFn(array[j - 1], temp) === Compare.BIGGER_THAN) { // {5} array[j] = array[j - 1]; // {6} j--; } array[j] = temp; // {7} } return array; };</p>\n<p>照例，算法的第一行用来声明代码中使用的变量（行 {1}）。接着，迭代数组来给第 i 项找到正确的位置（行 {2}）。注意，算法是从第二个位置（索引 1）而不是 0 位置开始的（我们认为第一项已排序了）。然后，用 i 的值来初始化一个辅助变量（行 {3}）并也将其值存储在一个临时变量中（行 {4}），便于之后将其插入到正确的位置上。下一步是要找到正确的位置来插入项目。只要变量 j 比 0 大（因为数组的第一个索引是 0—— 没有负值的索引）并且数组中前面的值比待比较的值大（行 {5}），我们就把这个值移到当前位置上（行 {6}）并减小 j。最终，能将该值插入到正确的位置上。</p>\n<p>下面的示意图展示了一个插入排序的实例。</p>\n<p>举个例子，假定待排序数组是 [3, 5, 1, 4, 2]。这些值将被插入排序算法按照下面的步骤进行排序。</p>\n<p>(1) 3 已被排序，所以我们从数组第二个值 5 开始。3 比 5 小，所以 5 待在原位（数组的第二位）。3 和 5 排序完毕。</p>\n<p>(2) 下一个待排序和插到正确位置上的值是 1（目前在数组的第三位）。5 比 1 大，所以 5 被移至第三位去了。我们得分析 1 是否应该被插入到第二位 ——1 比 3 大吗？不，所以 3 被移到第二位去了。接着，我们得证明 1 应该插入到数组的第一位上。因为 0 是第一个位置且没有负数位，所以 1 必须被插入第一位。1、3、5 三个数字已经排序。</p>\n<p>(3) 然后看下一个值：4。4 应该在当前位置（索引 3）还是要移动到索引较低的位置上呢？4 比 5 小，所以 5 移动到索引 3 位置上去。那么应该把 4 插到索引 2 的位置上去吗？4 比 3 大，所以把 4 插入数组的位置 3 上。</p>\n<p>(4) 下一个待插入的数字是 2（数组的位置 4）。5 比 2 大，所以 5 移动至索引 4。4 比 2 大，所以 4 也得移动（位置 3）。3 也比 2 大，所以 3 还得移动。1 比 2 小，所以 2 插入到数组的第二位置上。至此，数组已排序完成。</p>\n<p>排序小型数组时，此算法比选择排序和冒泡排序性能要好。</p>\n<p>13.1.4　归并排序</p>\n<p>归并排序是第一个可以实际使用的排序算法。你在本书中学到的前三个排序算法性能不好，但归并排序性能不错，其复杂度为。</p>\n<p>JavaScript 的 Array 类定义了一个 sort 函数（Array.prototype.sort）用以排序 JavaScript 数组（我们不必自己实现这个算法）。ECMAScript 没有定义用哪个排序算法，所以浏览器厂商可以自行去实现算法。例如，Mozilla Firefox 使用归并排序作为 Array.prototype.sort 的实现，而 Chrome（V8 引擎）使用了一个快速排序的变体（下面我们会学习）。</p>\n<p>归并排序是一种分而治之算法。其思想是将原始数组切分成较小的数组，直到每个小数组只有一个位置，接着将小数组归并成较大的数组，直到最后只有一个排序完毕的大数组。</p>\n<p>由于是分治法，归并排序也是递归的。我们要将算法分为两个函数：第一个负责将一个大数组分为多个小数组并调用用来排序的辅助函数。我们来看看在这里声明的主要函数。</p>\n<p>function mergeSort(array, compareFn = defaultCompare) { if (array.length &gt; 1) { // {1} const { length } = array; const middle = Math.floor(length / 2); // {2} const left = mergeSort(array.slice(0, middle), compareFn); // {3} const right = mergeSort(array.slice(middle, length), compareFn); // {4} array = merge(left, right, compareFn); // {5} } return array; }</p>\n<p>归并排序将一个大数组转化为多个小数组直到其中只有一个项。由于算法是递归的，我们需要一个停止条件，在这里此条件是判断数组的长度是否为 1（行 {1}）。如果是，则直接返回这个长度为 1 的数组，因为它已排序了。</p>\n<p>如果数组长度比 1 大，那么得将其分成小数组。为此，首先得找到数组的中间位（行 {2}），找到后我们将数组分成两个小数组，分别叫作 left（行 {3}）和 right（行 {4}）。left 数组由索引 0 至中间索引的元素组成，而 right 数组由中间索引至原始数组最后一个位置的元素组成。行 {3} 和行 {4} 将会对自身调用 mainSort 函数直到 left 数组和 right 数组的大小小于等于 1。</p>\n<p>下面的步骤是调用 merge 函数（行 {6}），它负责合并和排序小数组来产生大数组，直到回到原始数组并已排序完成。merge 函数如下所示。</p>\n<p>function merge(left, right, compareFn) { let i = 0; // {6} let j = 0; const result = []; while (i &lt; left.length &amp;&amp; j &lt; right.length) { // {7} result.push( compareFn(left[i], right[j]) === Compare.LESS_THAN ? left[i++] : right[j++] ); // {8} } return result.concat(i &lt; left.length ? left.slice(i) : right.slice(j)); // {9} }</p>\n<p>merge 函数接收两个数组作为参数，并将它们归并至一个大数组。排序发生在归并过程中。首先，需要声明归并过程要创建的新数组以及用来迭代两个数组（left 和 right 数组）所需的两个变量（行 {6}）。迭代两个数组的过程中（行 {7}），我们比较来自 left 数组的项是否比来自 right 数组的项小。如果是，将该项从 left 数组添加至归并结果数组，并递增用于迭代数组的控制变量（行 {8}）；否则，从 right 数组添加项并递增用于迭代数组的控制变量。</p>\n<p>接下来，将 left 数组所有剩余的项添加到归并数组中，right 数组也是一样（行 {9}）。最后，将归并数组作为结果返回。</p>\n<p>如果执行 mergeSort 函数，下图是具体的执行过程。</p>\n<p>可以看到，算法首先将原始数组分割直至只有一个元素的子数组，然后开始归并。归并过程也会完成排序，直至原始数组完全合并并完成排序。</p>\n<p>13.1.5　快速排序</p>\n<p>快速排序也许是最常用的排序算法了。它的复杂度为，且性能通常比其他复杂度为的排序算法要好。和归并排序一样，快速排序也使用分而治之的方法，将原始数组分为较小的数组（但它没有像归并排序那样将它们分割开）。</p>\n<p>快速排序比目前学过的其他排序算法要复杂一些。让我们一步步地来学习。</p>\n<p>(1) 首先，从数组中选择一个值作为主元（pivot），也就是数组中间的那个值。</p>\n<p>(2) 创建两个指针（引用），左边一个指向数组第一个值，右边一个指向数组最后一个值。移动左指针直到我们找到一个比主元大的值，接着，移动右指针直到找到一个比主元小的值，然后交换它们，重复这个过程，直到左指针超过了右指针。这个过程将使得比主元小的值都排在主元之前，而比主元大的值都排在主元之后。这一步叫作划分（partition）操作。</p>\n<p>(3) 接着，算法对划分后的小数组（较主元小的值组成的子数组，以及较主元大的值组成的子数组）重复之前的两个步骤，直至数组已完全排序。</p>\n<p>让我们开始快速排序的实现吧。</p>\n<p>function quickSort(array, compareFn = defaultCompare) { return quick(array, 0, array.length - 1, compareFn); };</p>\n<p>就像归并算法那样，开始声明一个主方法来调用递归函数，传递待排序数组，以及索引 0 及其最末的位置（因为我们要排整个数组，而不是一个子数组）作为参数。</p>\n<p>下面我们来创建 quick 函数。</p>\n<p>function quick(array, left, right, compareFn) { let index; // {1} if (array.length &gt; 1) { // {2} index = partition(array, left, right, compareFn); // {3} if (left &lt; index - 1) { // {4} quick(array, left, index - 1, compareFn); // {5} } if (index &lt; right) { // {6} quick(array, index, right, compareFn); // {7} } } return array; };</p>\n<p>首先声明 index（行 {1}），该变量能帮助我们将子数组分离为较小值数组和较大值数组。这样就能再次递归地调用 quick 函数了。partition 函数返回值将赋值给 index（行 {3}）。</p>\n<p>如果数组的长度比 1 大（因为只有一个元素的数组必然是已排序了的 —— 行 {2}），我们将对给定子数组执行 partition 操作（第一次调用是针对整个数组）以得到 index（行 {3}）。如果子数组存在较小值的元素（行 {4}），则对该数组重复这个过程（行 {5}）。同理，对存在较大值的子数组也是如此，如果有子数组存在较大值（行 {6}），我们也将重复快速排序过程（行 {7}）。</p>\n<p>划分过程</p>\n<p>第一件要做的事情是选择主元，有好几种方式。最简单的一种是选择数组的第一个值（最左边的值）。然而，研究表明对于几乎已排序的数组，这不是一个好的选择，它将导致该算法的最差表现。另外一种方式是随机选择数组的一个值或是选择中间的值。</p>\n<p>现在，让我们看看划分过程。</p>\n<p>function partition(array, left, right, compareFn) { const pivot = array[Math.floor((right + left) / 2)]; // {8} let i = left; // {9} let j = right; // {10} while (i &lt;= j) { // {11} while (compareFn(array[i], pivot) === Compare.LESS_THAN) { // {12} i++; } while (compareFn(array[j], pivot) === Compare.BIGGER_THAN) { // {13} j--; } if (i &lt;= j) { // {14} swap(array, i, j); // {15} i++; j--; } } return i; // {16} }</p>\n<p>在本实现中，我们选择中间值作为主元（行 {8}）。我们初始化两个指针：left（低 —— 行 {9}），初始化为数组第一个元素；right（高 —— 行 {10}），初始化为数组最后一个元素。</p>\n<p>只要 left 和 right 指针没有相互交错（行 {11}），就执行划分操作。首先，移动 left 指针直到找到一个比主元大的元素（行 {12}）。对 right 指针，我们做同样的事情，移动 right 指针直到我们找到一个比主元小的元素（行 {13}）。</p>\n<p>当左指针指向的元素比主元大且右指针指向的元素比主元小，并且此时左指针索引没有右指针索引大时（行 {14}），意思是左项比右项大（值比较），我们交换它们（行 {15}），然后移动两个指针，并重复此过程（从行 {11} 再次开始）。</p>\n<p>在划分操作结束后，返回左指针的索引，用来在行 {3} 处创建子数组。</p>\n<p>快速排序实战</p>\n<p>让我们来一步步地看一个快速排序的实际例子。</p>\n<p>给定数组 [3, 5, 1, 6, 4, 7, 2]，前面的示意图展示了划分操作的第一次执行。</p>\n<p>下面的示意图展示了对有较小值的子数组执行的划分操作（注意 7 和 6 不包含在子数组之内）。</p>\n<p>接着，我们继续创建子数组，如下图所示，但是这次操作是针对上图中有较大值的子数组（有 1 的那个较小子数组不用再划分了，因为它仅含有一个值）。</p>\n<p>对子数组 [2, 3, 5, 4] 中的较小子数组 [2, 3] 继续进行划分（算法代码中的行 {5}）。</p>\n<p>然后子数组 [2, 3, 5, 4] 中的较大子数组 [5, 4] 也继续进行划分（算法中的行 {7}），示意图如下。</p>\n<p>最终，较大子数组 [6, 7] 也会进行划分操作，快速排序算法的操作执行完成。</p>\n<p>13.1.6　计数排序</p>\n<p>计数排序是我们在本书中学习的第一个分布式排序。分布式排序使用已组织好的辅助数据结构（称为桶），然后进行合并，得到排好序的数组。计数排序使用一个用来存储每个元素在原始数组中出现次数的临时数组。在所有元素都计数完成后，临时数组已排好序并可迭代以构建排序后的结果数组。</p>\n<p>它是用来排序整数的优秀算法（它是一个整数排序算法），时间复杂度为，其中是临时计数数组的大小；但是，它确实需要更多的内存来存放临时数组。</p>\n<p>下面的代码表示计数排序算法。</p>\n<p>function countingSort(array) { if (array.length &lt; 2) { // {1} return array; } const maxValue = findMaxValue(array); // {2} const counts = new Array(maxValue + 1); // {3} array.forEach(element =&gt; { if (!counts[element]) { // {4} counts[element] = 0; } counts[element]<ins>; // {5} }); let sortedIndex = 0; counts.forEach((count, i) =&gt; { while (count &gt; 0) { // {6} array[sortedIndex</ins>] = i; // {7} count--; // {8} } }); return array; }</p>\n<p>如果待排序的数组为空或只有一个元素（行 {1}），则不需要运行排序算法。</p>\n<p>对于计数排序算法，我们需要创建计数数组，从索引 0 开始直到最大值索引（行 {3}）。因此，我们还需要找到数组中的最大值（行 {2}）。要找到数组中的最大值，我们只需要迭代并找到值最大的一项即可。</p>\n<p>function findMaxValue(array) { let max = array[0]; for (let i = 1; i &lt; array.length; i++) { if (array[i] &gt; max) { max = array[i]; } } return max; }</p>\n<p>然后，我们迭代数组中的每个位置并在 counts 数组中增加元素计数值（行 {5}）。为了确保递增操作成功，如果 counts 数组中用来计数某个元素的位置一开始没有用 0 初始化的话，我们将其赋值为 0（行 {4}）。</p>\n<p>在这个算法中，我们不使用 for 循环来迭代数组。这是用来展示除了用经典的 for 循环来迭代数组之外，我们还有其他的选择，例如使用第 3 章学习的 forEach 方法。</p>\n<p>所有元素都计数后，我们要迭代 counts 数组并构建排序后的结果数组。由于可能有多个元素有相同的值，我们要将元素按照在原始数组中的出现次数进行相加。我们要减少计数值（行 {8}）直到它的值为零（行 {6}），将值（i）加入结果数组。因此，还需要一个辅助索引（sortedIndex）帮助我们将值赋值到结果数组中的正确位置。</p>\n<p>我们来看看计数排序的实际操作来更好地理解上面的代码。</p>\n<p>13.1.7　桶排序</p>\n<p>桶排序（也被称为箱排序）也是分布式排序算法，它将元素分为不同的桶（较小的数组），再使用一个简单的排序算法，例如插入排序（用来排序小数组的不错的算法），来对每个桶进行排序。然后，它将所有的桶合并为结果数组。</p>\n<p>下面的代码展示了桶排序算法。</p>\n<p>function bucketSort(array, bucketSize = 5) { // {1} if (array.length &lt; 2) { return array; } const buckets = createBuckets(array, bucketSize); // {2} return sortBuckets(buckets); // {3} }</p>\n<p>对于桶排序算法，我们需要指定需要多少桶来排序各个元素（行 {1}）。默认情况下，我们会使用 5 个桶。桶排序在所有元素平分到各个桶中时的表现最好。如果元素非常稀疏，则使用更多的桶会更好。如果元素非常密集，则使用较少的桶会更好。因此，我们允许 bucketSize 以参数形式传递。</p>\n<p>我们将算法分为两个部分：第一个用于创建桶并将元素分布到不同的桶中（行 {2}），第二个包含对每个桶执行插入排序算法和将所有桶合并为排序后的结果数组（行 {3}）。</p>\n<p>我们来看看用于创建桶的代码。</p>\n<p>function createBuckets(array, bucketSize) { let minValue = array[0]; let maxValue = array[0]; for (let i = 1; i &lt; array.length; i++) { // {4} if (array[i] &lt; minValue) { minValue = array[i]; } else if (array[i] &gt; maxValue) { maxValue = array[i]; } } const bucketCount = Math.floor((maxValue - minValue) / bucketSize) + 1; // {5} const buckets = []; for (let i = 0; i &lt; bucketCount; i++) { // {6} buckets[i] = []; } for (let i = 0; i &lt; array.length; i++) { // {7} const bucketIndex = Math.floor((array[i] - minValue) / bucketSize); // {8} buckets[bucketIndex].push(array[i]); } return buckets; }</p>\n<p>桶排序的第一个重要步骤时计算每个桶中需要分布的元素个数（行 {5}）。要计算这个数，我们要使用一个公式，包含计算数组最大值和最小值的差值并与桶的大小进行除法计算。这时，我们还需要迭代原数组并找到最大值和最小值（行 {4}）。我们可以使用计数排序中创建的 findMaxValue 函数并另外创建一个 findMinValue 函数，但这意味着迭代两次相同的数组。因此，要优化搜索过程，我们可以只迭代数组一次就找到两个值。</p>\n<p>在计算了 bucketCount 后，我们需要初始化每个桶（行 {6}）。buckets 数据结构是一个矩阵（多维数组）。buckets 中的每个位置包含了另一个数组。</p>\n<p>最后一步是将元素分布到桶中。我们需要迭代数组中的每个元素（行 {7}），计算要将元素放到哪个桶中（行 {8}），并将元素插入正确的桶中。这个步骤完成了算法的第一个部分。</p>\n<p>我们来看看桶排序算法的下一个部分，也就是将每个桶进行排序。</p>\n<p>function sortBuckets(buckets) { const sortedArray = []; // {9} for (let i = 0; i &lt; buckets.length; i++) { // {10} if (buckets[i] != null) { insertionSort(buckets[i]); // {11} sortedArray.push(...buckets[i]); // {12} } } return sortedArray; }</p>\n<p>我们要创建一个用作结果数组的新数组（行 {9}），这表示原数组不会被修改，我们会返回一个新的数组。接下来，迭代每个可迭代的桶并应用插入排序（行 {11}）—— 根据场景，我们还可以应用其他的排序算法，例如快速排序。最后，我们将排好序的桶中的所有元素加入结果数组中（行 {12}）。</p>\n<p>注意到在行 {12} 中，我们使用了在第 2 章学到的 ES2015 中的解构运算符。经典的做法是迭代 buckets [i] 中的每个元素（buckets [i][j]）并将每个元素加入排序后的数组。</p>\n<p>下图展现了桶排序算法的过程。</p>\n<p>13.1.8　基数排序</p>\n<p>基数排序也是一个分布式排序算法，它根据数字的有效位或基数（这也是它为什么叫基数排序）将整数分布到桶中。基数是基于数组中值的记数制的。</p>\n<p>比如，对于十进制数，使用的基数是 10。因此，算法将会使用 10 个桶用来分布元素并且首先基于个位数字进行排序，然后基于十位数字，然后基于百位数字，以此类推。</p>\n<p>下面的代码展示了基数排序算法。</p>\n<p>function radixSort(array, radixBase = 10) { if (array.length &lt; 2) { return array; } const minValue = findMinValue(array); const maxValue = findMaxValue(array); let significantDigit = 1; // {1} while ((maxValue - minValue) / significantDigit &gt;= 1) { // {2} array = countingSortForRadix(array, radixBase, significantDigit, minValue); // {3} significantDigit *= radixBase; // {4} } return array; }</p>\n<p>既然基数排序也用来排序整数，我们就从最后一位开始排序所有的数（行 {1}）。这个算法也可以被修改成支持排序字母字符。我们首先只会基于最后一位有效位对数字进行排序，在下次迭代时，我们会基于第二个有效位进行排序（十位数字），然后是第三个有效位（百位数字），以此类推（行 {4}）。我们继续这个过程直到没有待排序的有效位（行 {2}），这也是为什么我们需要知道数组中的最小值和最大值。</p>\n<p>如果数组中包含的值都在 1～9，行 {2} 的循环只会执行一次。如果值都小于 99，则循环会执行第二次，以此类推。</p>\n<p>我们来看看用来基于有效位（基数）排序的代码。</p>\n<p>function countingSortForRadix(array, radixBase, significantDigit, minValue) { let bucketsIndex; const buckets = []; const aux = []; for (let i = 0; i &lt; radixBase; i++) { // {5} buckets[i] = 0; } for (let i = 0; i &lt; array.length; i++) { // {6} bucketsIndex = Math.floor(((array[i] - minValue) / significantDigit) % radixBase); // {7} buckets[bucketsIndex]<ins>; // {8} } for (let i = 1; i &lt; radixBase; i</ins>) { // {9} buckets[i] += buckets[i - 1]; } for (let i = array.length - 1; i &gt;= 0; i--) { // {10} bucketsIndex = Math.floor(((array[i] - minValue) / significantDigit) % radixBase); // {11} aux[--buckets[bucketsIndex]] = array[i]; // {12} } for (let i = 0; i &lt; array.length; i++) { // {13} array[i] = aux[i]; } return array; }</p>\n<p>首先，我们基于基数初始化桶（行 {5}）。由于我们排序的是十进制数，那么需要 10 个桶。然后，我们会基于数组中（行 {6}）数的有效位（行 {7}）进行计数排序（行 {8}）。由于我们进行的是计数排序，我们还需要计算累积结果来得到正确的计数值（行 {9}）。</p>\n<p>在计数完成后，要开始将值移回原始数组中。我们会使用一个临时数组（aux）来帮助我们。对原始数组中的每个值（行 {10}），我们会再次获取它的有效位（行 {11}）并将它的值移动到 aux 数组中（从 buckets 数组中减去它的计数值 —— 行 {12}）。最后一步是可选的（行 {13}），我们将 aux 数组中的每个值转移到原始数组中。除了返回 array 之外，我们还可以直接返回 aux 数组而不需要复制它的值。</p>\n<p>我们来看看基数排序算法是如何工作的，如下图所示。</p>\n<p>13.2　搜索算法</p>\n<p>现在，让我们来谈谈搜索算法。回顾一下之前章节所实现的算法，我们会发现 BinarySearchTree 类的 search 方法（第 8 章）以及 LinkedList 类的 indexOf 方法（第 5 章）等，都是搜索算法。当然，它们每一个都是根据其各自的数据结构来实现的。所以，我们已经熟悉两个搜索算法了，只是还不知道它们 “正式” 的名称而已。</p>\n<p>13.2.1　顺序搜索</p>\n<p>顺序或线性搜索是最基本的搜索算法。它的机制是，将每一个数据结构中的元素和我们要找的元素做比较。顺序搜索是最低效的一种搜索算法。</p>\n<p>以下是其实现。</p>\n<p>const DOES_NOT_EXIST = -1; function sequentialSearch(array, value, equalsFn = defaultEquals) { for (let i = 0; i &lt; array.length; i++) { // {1} if (equalsFn(value, array[i])) { // {2} return i; // {3} } } return DOES_NOT_EXIST; // {4} }</p>\n<p>顺序搜索迭代整个数组（行 {1}），并将每个数组元素和搜索项做比较（行 {2}）。如果搜索到了，算法将用返回值来标示搜索成功。返回值可以是该搜索项本身，或是 true，又或是搜索项的索引（行 {3}）。如果没有找到该项，则返回 - 1（行 {4}），表示该索引不存在；也可以考虑返回 false 或者 null。</p>\n<p>假定有数组 [5, 4, 3, 2, 1] 和待搜索值 3，下图展示了顺序搜索的示意图。</p>\n<p>13.2.2　二分搜索</p>\n<p>二分搜索算法的原理和猜数字游戏类似，就是那个有人说 “我正想着一个 1～100 的数” 的游戏。我们每回应一个数，那个人就会说这个数是高了、低了还是对了。</p>\n<p>这个算法要求被搜索的数据结构已排序。以下是该算法遵循的步骤。</p>\n<p>(1) 选择数组的中间值。</p>\n<p>(2) 如果选中值是待搜索值，那么算法执行完毕（值找到了）。</p>\n<p>(3) 如果待搜索值比选中值要小，则返回步骤 1 并在选中值左边的子数组中寻找（较小）。</p>\n<p>(4) 如果待搜索值比选中值要大，则返回步骤 1 并在选种值右边的子数组中寻找（较大）。</p>\n<p>以下是其实现。</p>\n<p>function binarySearch(array, value, compareFn = defaultCompare) { const sortedArray = quickSort(array); // {1} let low = 0; // {2} let high = sortedArray.length - 1; // {3} while (lesserOrEquals(low, high, compareFn) { // {4} const mid = Math.floor((low + high) / 2); // {5} const element = sortedArray[mid]; // {6} if (compareFn(element, value) === Compare.LESS_THAN) { // {7} low = mid + 1; // {8} } else if (compareFn(element, value) === Compare.BIGGER_THAN) { // {9} high = mid - 1; // {10} } else { return mid; // {11} } } return DOES_NOT_EXIST; // {12} }</p>\n<p>开始前需要先将数组排序，我们可以选择任何一个在 13.1 节中实现的排序算法。这里我们选择了快速排序。在数组排序之后，我们设置 low（行 {2}）和 high（行 {3}）指针（它们是边界）。</p>\n<p>当 low 比 high 小时（行 {4}），我们计算得到中间项索引并取得中间项的值，此处如果 low 比 high 大，则意味着该待搜索值不存在并返回 - 1（行 {12}）。接着，我们比较选中项的值和搜索值（行 {7}）。如果小了，则选择数组低半边并重新开始。如果选中项的值比搜索值大了，则选择数组高半边并重新开始。若两者都是不是，则意味着选中项的值和搜索值相等，因此直接返回该索引（行 {11}）。</p>\n<p>上面代码中用到的 lesserOrEquals 函数声明如下。</p>\n<p const=\"\" comp=\"\" class=\"compareFn(a,b);returncomp===CompareLESS_THAN ==CompareEQUALS;\" ||=\"\" comp=\"\">function lesserOrEquals(a, b, compareFn)</p>\n<p>给定下图所示数组，让我们试试搜索 2。这些是算法将会执行的步骤。</p>\n<p>第 10 章中，我们实现的 BinarySearchTree 类有一个 search 方法，和这个二分搜索完全一样，只不过前者是针对树数据结构的。</p>\n<p>13.2.3　内插搜索</p>\n<p>内插搜索是改良版的二分搜索。二分搜索总是检查 mid 位置上的值，而内插搜索可能会根据要搜索的值检查数组中的不同地方。</p>\n<p>这个算法要求被搜索的数据结构已排序。以下是该算法遵循的步骤：</p>\n<p>(1) 使用 position 公式选中一个值；</p>\n<p>(2) 如果这个值是待搜索值，那么算法执行完毕（值找到了）；</p>\n<p>(3) 如果待搜索值比选中值要小，则返回步骤 1 并在选中值左边的子数组中寻找（较小）；</p>\n<p>(4) 如果待搜索值比选中值要大，则返回步骤 1 并在选种值右边的子数组中寻找（较大）。</p>\n<p>以下是其实现。</p>\n<p>function interpolationSearch(array, value, compareFn = defaultCompare, equalsFn = defaultEquals, diffFn = defaultDiff ) { const { length } = array; let low = 0; let high = length - 1; let position = -1; let delta = -1; while ( low &lt;= high &amp;&amp; biggerOrEquals(value, array[low], compareFn) &amp;&amp; lesserOrEquals(value, array[high], compareFn) ) { delta = diffFn(value, array[low]) / diffFn(array[high], array[low]); // {1} position = low + Math.floor((high - low) * delta); // {2} if (equalsFn(array[position], value)) { // {3} return position; } if (compareFn(array[position], value) === Compare.LESS_THAN) { // {4} low = position + 1; } else { high = position - 1; } } return DOES_NOT_EXIST; }</p>\n<p>首先要做的是计算要比较值的位置 position（行 {2}）。公式的做法是，如果查找的值更接近 array [high] 则查找 position 位置旁更大的值，如果查找的值更接近 array [low] 则查找 position 位置旁更小的值。这个算法在数组中的值都是均匀分布时性能最好（delta 会非常小）（行 {1}）。</p>\n<p>如果待搜索值找到了，则返回它的索引值（行 {3}）。如果待搜索值小于当前位置的值，我们使用左边或右边的子数组重复这段逻辑（行 {4}）。</p>\n<p>lesserOrEquals 和 biggerOrEquals 函数如下所示。</p>\n<p const=\"\" comp=\"\" class=\"compareFn(a,b);returncomp===CompareBIGGER_THAN ==CompareEQUALS;\" ||=\"\" comp=\"\">function lesserOrEquals(a, b, compareFn) { const comp = compareFn(a, b); return comp === Compare.LESS_THAN || comp === Compare.EQUALS; } function biggerOrEquals(a, b, compareFn)</p>\n<p>下图展示了算法的过程 —— 数组是均匀分布的（数字差值之间的差别非常小）。</p>\n<p>13.3　随机算法</p>\n<p>本章，我们学习了如何将一个数组进行排序以及怎样在排序后的数组中搜索元素。不过还有一种场景是需要将一个数组中的值进行随机排列。现实中的一个常见场景是洗扑克牌。</p>\n<p>在下一节，我们会学习随机数组的一种最有名的算法。</p>\n<p>Fisher-Yates 随机</p>\n<p>这个算法由 Fisher 和 Yates 创造，并由高德纳（Donald E. Knuth）在《计算机程序设计艺术》系列图书 1 中推广。</p>\n<p>1 中英文版正在由人民邮电出版社陆续出版，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS1pdHVyaW5nLWU3M2tpYTM0YnQwMmY5cjNwLmNuL2Jvb2svOTkzJUUzJTgwJTgxaXR1cmluZy5jbi9ib29rLzk4NyVFMyU4MCU4MWl0dXJpbmcuY24vYm9vay85MjYlRTMlODAlODFpdHVyaW5nLmNuL2Jvb2svOTI1JUU3JUFEJTg5JUUzJTgwJTgy\">图书主页为 ituring.cn/book/993、ituring.cn/book/987、ituring.cn/book/926、ituring.cn/book/925 等。</span></p>\n<p>它的含义是迭代数组，从最后一位开始并将当前位置和一个随机位置进行交换。这个随机位置比当前位置小。这样，这个算法可以保证随机过的位置不会再被随机一次（洗扑克牌的次数越多，随机效果越差）。</p>\n<p>下面的代码展示了 Fisher-Yates 随机算法。</p>\n<p>function shuffle(array) { for (let i = array.length - 1; i &gt; 0; i--) { const randomIndex = Math.floor(Math.random() * (i + 1)); swap(array, i, randomIndex); } return array; }</p>\n<p>下图展现了该算法的操作。</p>\n<p>13.4　小结</p>\n<p>本章介绍了排序、搜索和随机算法。</p>\n<p>我们学习了冒泡、选择、插入、归并、快速、计数、桶以及基数排序算法，它们是用来排序数据结构的。我们还学到了顺序搜索、内插搜索和二分搜索（需要数据结构已排序）。我们还学习了怎样随机排列一个数组的值。</p>\n<p>下一章，我们会学习一些高级的算法技巧。</p>\n<h1 id=\"第-14-章-算法设计与技巧\"><a class=\"anchor\" href=\"#第-14-章-算法设计与技巧\">#</a> 第 14 章　算法设计与技巧</h1>\n<p>到现在为止，我们愉快地学习了各种数据结构的实现，其中包括常用的排序和搜索算法。在编程的世界中，算法很有意思。算法（以及编程逻辑）最美的地方在于有不同的方法可以解决问题。我们在前几章学习了，可以用迭代的方式解决问题，也可以使用递归使代码可读性更高。还有另外一些技巧可以用来借算法解决问题。本章，我们会学习不同的技巧，你会进一步了解这个世界，并且我们将探讨进一步深入其中的途径（如果你感兴趣的话）。</p>\n<p>本章我们会学习：</p>\n<p>分而治之算法</p>\n<p>动态规划</p>\n<p>贪心算法</p>\n<p>回溯算法</p>\n<p>著名算法问题</p>\n<p>14.1　分而治之</p>\n<p>在第 13 章，我们学习了归并和排序算法。两者的共同点在于它们都是分而治之算法。分而治之是算法设计中的一种方法。它将一个问题分成多个和原问题相似的小问题，递归解决小问题，再将解决方式合并以解决原来的问题。</p>\n<p>分而治之算法可以分成三个部分。</p>\n<p>(1) 分解原问题为多个子问题（原问题的多个小实例）。</p>\n<p>(2) 解决子问题，用返回解决子问题的方式的递归算法。递归算法的基本情形可以用来解决子问题。</p>\n<p>(3) 组合这些子问题的解决方式，得到原问题的解。</p>\n<p>我们在第 13 章已经学习了两种最著名的分而治之算法，接下来将要学习怎样将二分搜索用分而治之的方式实现。</p>\n<p>二分搜索</p>\n<p>在第 13 章中，我们学习了怎样用迭代的方式实现二分搜索。如果我们回头看看，同样可以用分而治之的方式实现这个算法，逻辑如下。</p>\n<p>分解：计算 mid 并搜索数组较小或较大的一半。</p>\n<p>解决：在较小或较大的一半中搜索值。</p>\n<p>合并：这步不需要，因为我们直接返回了索引值。</p>\n<p>分而治之版本的二分搜索算法如下。</p>\n<p const=\"\" sortedArray=\"\" class=\"quickSort(array);constlow=0;consthigh=sortedArraylength\" -=\"\" 1;=\"\" return=\"\" binarySearchRecursive(array,=\"\" value,=\"\" low,=\"\" high,=\"\" compareFn);=\"\">function binarySearchRecursive( array, value, low, high, compareFn = defaultCompare ) { if (low &lt;= high) { const mid = Math.floor((low + high) / 2); const element = array[mid]; if (compareFn(element, value) === Compare.LESS_THAN) { // {1} return binarySearchRecursive(array, value, mid + 1, high, compareFn); } else if (compareFn(element, value) === Compare.BIGGER_THAN) { // {2} return binarySearchRecursive(array, value, low, mid - 1, compareFn); } else { return mid; // {3} } } return DOES_NOT_EXIST; // {4} } export function binarySearch(array, value, compareFn = defaultCompare)</p>\n<p>在上面的算法中，我们有两个函数：binarySearch 和 binarySearchRecursive。binarySearch 函数用来暴露给开发者进行二分搜索。binarySearchRecursive 是分而治之算法。我们将 low 参数以 0 传递，将 high 参数以 sortedArray.length - 1 传递，来在已排序的数组中进行搜索。在计算 mid 元素的索引值后，我们确定待搜索的值比 mid 大还是小。如果小（行 {1}）或大（行 {2}），就再次调用 binarySearchRecursive 函数，但是这次，我们在子数组中进行搜索，改变 low 或 high 参数（不同于我们在第 13 章中那样移动指针）。如果不大也不小，表示我们找到了这个值（行 {3}）并且这就是一种基本情形。还有一种情况是 low 比 high 要大，这表示算法没有找到这个值（行 {4}）。</p>\n<p>下图展示了算法的过程。</p>\n<p>14.2　动态规划</p>\n<p>动态规划（dynamic programming，DP）是一种将复杂问题分解成更小的子问题来解决的优化技术。</p>\n<p>注意，动态规划和分而治之是不同的方法。分而治之方法是把问题分解成相互独立的子问题，然后组合它们的答案，而动态规划则是将问题分解成相互依赖的子问题。</p>\n<p>动态规划的一个例子是第 9 章解决的斐波那契问题。我们将斐波那契问题分解成了一些小问题。</p>\n<p>用动态规划解决问题时，要遵循三个重要步骤：</p>\n<p>(1) 定义子问题；</p>\n<p>(2) 实现要反复执行来解决子问题的部分（这一步要参考前一节讨论的递归的步骤）；</p>\n<p>(3) 识别并求解出基线条件。</p>\n<p>能用动态规划解决的一些著名问题如下。</p>\n<p>背包问题：给出一组项，各自有值和容量，目标是找出总值最大的项的集合。这个问题的限制是，总容量必须小于等于 “背包” 的容量。</p>\n<p>最长公共子序列：找出一组序列的最长公共子序列（可由另一序列删除元素但不改变余下元素的顺序而得到）。</p>\n<p>矩阵链相乘：给出一系列矩阵，目标是找到这些矩阵相乘的最高效办法（计算次数尽可能少）。相乘运算不会进行，解决方案是找到这些矩阵各自相乘的顺序。</p>\n<p>硬币找零：给出面额为的一定数量的硬币和要找零的钱数，找出有多少种找零的方法。</p>\n<p>图的全源最短路径：对所有顶点对，找出从顶点到顶点的最短路径。我们在第 9 章已经学习过这个问题的 Floyd-Warshall 算法。</p>\n<p>在接下来的几节里，我们会一一讲解这些问题。</p>\n<p>在 Google、Amazon、Microsoft、Oracle 等大公司的编程面试中，这些问题及其解决方案非常常见。</p>\n<p>14.2.1　最少硬币找零问题</p>\n<p>最少硬币找零问题是硬币找零问题的一个变种。硬币找零问题是给出要找零的钱数，以及可用的硬币面额及其数量，找出有多少种找零方法。最少硬币找零问题是给出要找零的钱数，以及可用的硬币面额及其数量，找到所需的最少的硬币个数。</p>\n<p>例如，美国有以下面额（硬币）：，，，。</p>\n<p>如果要找 36 美分的零钱，我们可以用 1 个 25 美分、1 个 10 美分和 1 个便士（1 美分）。</p>\n<p>如何将这个解答转化成算法？</p>\n<p>最少硬币找零的解决方案是找到所需的最小硬币数。但要做到这一点，首先得找到对每个的解。然后，我们可以基于更小的值的解来求解。</p>\n<p>下面来看看算法。</p>\n<p>function minCoinChange(coins, amount) { const cache = []; // {1} const makeChange = (value) =&gt; { // {2} if (!value) { // {3} return []; } if (cache[value]) { // {4} return cache[value]; } let min = []; let newMin; let newAmount; for (let i = 0; i &lt; coins.length; i++) { // {5} const coin = coins[i]; newAmount = value - coin; // {6} if (newAmount &gt;= 0) { newMin = makeChange(newAmount); // {7} } if ( newAmount &gt;= 0 &amp;&amp; // {8} (newMin.length &lt; min.length - 1 || !min.length) &amp;&amp; // {9} (newMin.length || !newAmount) // {10} ) { min = [coin].concat(newMin); // {11} console.log('new Min ' + min + ' for ' + amount); } } return (cache[value] = min); // {12} }; return makeChange(amount); // {13} }</p>\n<p>minCoinChange 参数接收 coins 参数（行 {1}），该参数代表问题中的面额。对美国的硬币系统而言，它是 [1, 5, 10, 25]。我们可以随心所欲地传递任何面额。此外，为了更加高效且不重复计算值，我们使用了 cache（行 {1}—— 这个技巧称为记忆化）。</p>\n<p>接下来是 minCoinChange 函数中的 makeChange 方法（行 {2}），它也是一个递归函数，用来解决问题。makeChange 函数在行 {13} 被调用，amount 作为参数传入。由于 makeChange 是一个内部函数，它也能访问到 cache 变量。</p>\n<p>现在我们来看算法的主要逻辑。首先，若 amount 不为正（&lt;0），就返回空数组（行 {3}）；方法执行结束后，会返回一个数组，包含用来找零的各个面额的硬币数量（最少硬币数）。接着，检查 cache 缓存。若结果已缓存（行 {4}），则直接返回结果；否则，执行算法。</p>\n<p>为了进一步帮助我们，我们基于 coins 参数（面额）解决问题。因此，对每个面额（行 {5}），我们都计算 newAmount（行 {6}）的值，它的值会一直减小，直到能找零的最小钱数（别忘了本算法对所有的 x &lt; amount 都会计算 makeChange 结果）。若 newAmount 是合理的值（正值），我们也会计算它的找零结果（行 {7}）。</p>\n<p>最后，我们判断 newAmount 是否有效，minValue （最少硬币数）是否是最优解，与此同时 minValue 和 newAmount 是否是合理的值（行 {10}）。若以上判断都成立，意味着有一个比之前更优的答案（行 {11}—— 以 5 美分为例，可以给 5 便士或者 1 个 5 美分镍币，1 个 5 美分镍币是最优解）。最后，返回最终结果（行 {12}）。</p>\n<p>测试一下这个算法。</p>\n<p>console.log(minCoinChange([1, 5, 10, 25], 36));</p>\n<p>要知道，如果我们检查 cache 变量，会发现它存储了从 1 到 36 美分的所有结果。以上代码的结果是 [1, 10, 25]。</p>\n<p>本书的源代码中会有几行多余的代码，输出算法的步骤。例如，使用面额 [1, 3, 4]，并对钱数 6 执行算法，会产生以下输出：</p>\n<p>new Min 1 for 1 new Min 1,1 for 2 new Min 1,1,1 for 3 new Min 3 for 3 new Min 1,3 for 4 new Min 4 for 4 new Min 1,4 for 5 new Min 1,1,4 for 6 new Min 3,3 for 6 [3, 3]</p>\n<p>所以，找零钱数为 6 时，最佳答案是两枚价值为 3 的硬币。</p>\n<p>14.2.2　背包问题</p>\n<p>背包问题是一个组合优化问题。它可以描述如下：给定一个固定大小、能够携重量的背包，以及一组有价值和重量的物品，找出一个最佳解决方案，使得装入背包的物品总重量不超过，且总价值最大。</p>\n<p>下面是一个例子。</p>\n<p>物品</p>\n<p>重量</p>\n<p>价值</p>\n<p>1</p>\n<p>2</p>\n<p>3</p>\n<p>2</p>\n<p>3</p>\n<p>4</p>\n<p>3</p>\n<p>4</p>\n<p>5</p>\n<p>考虑背包能够携带的重量只有 5。对于这个例子，我们可以说最佳解决方案是往背包里装入物品 1 和物品 2。这样，总重量为 5，总价值为 7。</p>\n<p>这个问题有两个版本。0-1 版本只能往背包里装完整的物品，而分数背包问题则允许装入分数物品。在这个例子里，我们将处理该问题的 0-1 版本。动态规划对分数版本无能为力，但本章稍后要学习的贪心算法可以解决它。</p>\n<p>我们来看看下面这个背包算法。</p>\n<p>function knapSack (capacity, weights, values, n) { const kS = []; for (let i = 0; i &lt;= n; i++) { // {1} kS [i] = []; } for (let i = 0; i &lt;= n; i++) { for (let w = 0; w &lt;= capacity; w++) { if (i === 0 || w === 0) { // {2} kS [i][w] = 0; } else if (weights [i - 1] &lt;= w) { // {3} const a = values [i - 1] + kS [i - 1][w - weights [i - 1]]; const b = kS [i - 1][w]; kS [i][w] = a &gt; b ? a : b; // {4} max (a,b) } else { kS [i][w] = kS [i - 1][w]; // {5} } } } findValues (n, capacity, kS, weights, values); // {6} 增加的代码 return kS [n][capacity]; // {7} }</p>\n<p>我们来看看这个算法是如何工作的。</p>\n<p>首先，初始化将用于寻找解决方案的矩阵（行 {1}）。矩阵为 ks [n+1][capacity+1]。然后，忽略矩阵的第一列和第一行，只处理索引不为 0 的列和行（行 {2}）并且要迭代数组中每个可用的项。物品 i 的重量必须小于约束（capacity—— 行 {3}）才有可能成为解决方案的一部分；否则，总重量就会超出背包能够携带的重量，这是不可能发生的。发生这种情况时，只要忽略它，用之前的值就可以了（行 {5}）。当找到可以构成解决方案的物品时，选择价值最大的那个（行 {4}）。最后，问题的解决方案就在这个二维表格右下角的最后一个格子里（行 {7}）。</p>\n<p>我们可以用开头的例子来测试这个算法。</p>\n<p>const values = [3,4,5], weights = [2,3,4], capacity = 5, n = values.length; console.log (knapSack (capacity, weights, values, n)); // 输出 7</p>\n<p>下图举例说明了例子中 kS 矩阵的构造。</p>\n<p>请注意，这个算法只输出背包携带物品价值的最大值，而不列出实际的物品。我们可以增加下面的附加函数来找出构成解决方案的物品。</p>\n<p>function findValues (n, capacity, kS, weights, values) { let i = n; let k = capacity; console.log (' 构成解的物品：'); while (i &gt; 0 &amp;&amp; k &gt; 0) { if (kS [i][k] !== kS [i - 1][k]) { console.log ( <code>物品 $&#123;i&#125; 可以是解的一部分 w,v: $&#123;weights[i - 1]&#125;, $&#123;values[i - 1]&#125;</code> ); i--; k -= kS[i][k]; } else { i--; } } }</p>\n<p>我们可以在 knapSack 函数的行 {7} 之前调用这个函数（在行 {6} 声明）。执行完整的算法，会得到如下输出。</p>\n<p>构成解的物品： 物品 2 可以是解的一部分 w,v: 3,4 物品 1 可以是解的一部分 w,v: 2,3 总价值: 7</p>\n<p>背包问题也可以写成递归形式。你可以在本书的源代码包中找到它的递归版本。</p>\n<p>14.2.3　最长公共子序列</p>\n<p>另一个经常被当作编程挑战问题的动态规划问题是最长公共子序列（LCS）：找出两个字符串序列的最长子序列的长度。最长子序列是指，在两个字符串序列中以相同顺序出现，但不要求连续（非字符串子串）的字符串序列。</p>\n<p>考虑如下例子。</p>\n<p>再看看下面这个算法。</p>\n<p>function lcs(wordX, wordY) { const m = wordX.length; const n = wordY.length; const l = []; for (let i = 0; i &lt;= m; i++) { l[i] = []; // {1} for (let j = 0; j &lt;= n; j++) { l[i][j] = 0; // {2} } } for (let i = 0; i &lt;= m; i++) { for (let j = 0; j &lt;= n; j++) { if (i === 0 || j === 0) { l[i][j] = 0; } else if (wordX[i - 1] === wordY[j - 1]) { l[i][j] = l[i - 1][j - 1] + 1; // {3} } else { const a = l[i - 1][j]; const b = l[i][j - 1]; l[i][j] = a &gt; b ? a : b; // {4} max(a,b) } } } return l[m][n]; // {5} }</p>\n<p>如果比较背包问题和 LCS 算法，我们会发现两者非常相似。这项从顶部开始构建解决方案的技术被称为记忆化，而解决方案就在表格或矩阵的右下角。</p>\n<p>像背包问题算法一样，这种方法只输出 LCS 的长度，而不包含 LCS 的实际结果。要提取这个信息，需要对算法稍作修改，声明一个新的 solution 矩阵。注意，代码中有一些注释，我们需要用以下代码替换这些注释。</p>\n<p>行 {1}：solution [i] = [];</p>\n<p>行 {2}：solution [i][j] = '0';</p>\n<p>行 {3}：solution [i][j] = 'diagonal';</p>\n<p>行 {4}：solution [i][j]=(l [i][j] == l [i-1][j]) ? 'top' : 'left';</p>\n<p>行 {5}：printSolution (solution, wordX, m, n);</p>\n<p>printSolution 函数如下所示。</p>\n<p>function printSolution(solution, wordX, m, n) { let a = m; let b = n; let x = solution[a][b]; let answer = ''; while (x !== '0') { if (solution[a][b] === 'diagonal') { answer = wordX[a - 1] + answer; a--; b--; } else if (solution[a][b] === 'left') { b--; } else if (solution[a][b] === 'top') { a--; } x = solution[a][b]; } console.log('lcs: ' + answer); }</p>\n<p>当解矩阵的方向为对角线时，我们可以将字符添加到答案中。</p>\n<p>如果用 'acbaed' 和 'abcadf' 两个字符串执行上面的算法，我们将得到输出 4。用于构建结果的矩阵 l 看起来像下面这样。我们也可以用附加的算法来跟踪 LCS 的值（如下图高亮所示）。</p>\n<p>通过上面的矩阵，我们知道 LCS 算法的结果是长度为 4 的 acad。</p>\n<p>LCS 问题也可以写成递归形式。你可以在本书的源代码包中找到它的递归版本。</p>\n<p>14.2.4　矩阵链相乘</p>\n<p>矩阵链相乘是另一个可以用动态规划解决的著名问题。这个问题是要找出一组矩阵相乘的最佳方式（顺序）。</p>\n<p>让我们试着更好地理解这个问题。行列的矩阵和行列的矩阵相乘，结果是行列的矩阵。</p>\n<p>考虑我们想做的乘法。因为乘法满足结合律，所以我们可以让这些矩阵以任意顺序相乘。因此，考虑如下情况：</p>\n<p>是一个 10 行 100 列的矩阵；</p>\n<p>是一个 100 行 5 列的矩阵；</p>\n<p>是一个 5 行 50 列的矩阵；</p>\n<p>是一个 50 行 1 列的矩阵；</p>\n<p>的结果是一个 10 行 1 列的矩阵。</p>\n<p>在这个例子里，相乘的方式有五种。</p>\n<p>(1) ：乘法运算的次数是 1750 次。</p>\n<p>(2) ：乘法运算的次数是 5300 次。</p>\n<p>(3) ：乘法运算的次数是 8000 次。</p>\n<p>(4) ：乘法运算的次数是 75 500 次。</p>\n<p>(5) ：乘法运算的次数是 31 000 次。</p>\n<p>相乘的顺序不一样，要进行的乘法运算总数也有很大差异。那么，要如何构建一个算法，求出最少的乘法运算次数？矩阵链相乘的算法如下。</p>\n<p>function matrixChainOrder(p) { const n = p.length; const m = []; const s = []; for (let i = 1; i &lt;= n; i++) { m[i] = []; m[i][i] = 0; } for (let l = 2; l &lt; n; l++) { for (let i = 1; i &lt;= (n - l) + 1; i++) { const j = (i + l) - 1; m[i][j] = Number.MAX_SAFE_INTEGER; for (let k = i; k &lt;= j - 1; k++) { const q = m[i][k] + m[k + 1][j] + ((p[i - 1] * p[k]) * p[j]); // {1} if (q &lt; m[i][j]) { m[i][j] = q; // {2} } } } } return m[1][n - 1]; // {3} }</p>\n<p>整个算法中最重要的是行 {1}，神奇之处全都在这一行。它计算了给定括号顺序的乘法运算次数，并将值保存在辅助矩阵 m 中。</p>\n<p>对开头的例子执行上面的算法，会得到结果 1750。正如我们前面提到的，这是最少的运算次数。看看下面的代码。</p>\n<p>const p = [10, 100, 5, 50, 1]; console.log(matrixChainOrder(p));</p>\n<p>然而，这个算法也不会给出最优解的括号顺序。为了得到这些信息，我们可以对代码做一些改动。</p>\n<p>首先，需要通过以下代码声明并初始化一个辅助矩阵 s。</p>\n<p>const s = []; for (let i = 0; i &lt;= n; i++){ s[i] = []; for (let j=0; j &lt;= n; j++){ s[i][j] = 0; } }</p>\n<p>然后，在 matrixChainOrder 函数的行 {2} 添加下面的代码。</p>\n<p>s[i][j] = k;</p>\n<p>在行 {3}，我们调用打印括号的函数，如下所示。</p>\n<p>printOptimalParenthesis(s, 1, n-1);</p>\n<p>最后，我们的 printOptimalParenthesis 函数如下。</p>\n<p>function printOptimalParenthesis(s, i, j){ if(i === j) { console.log(&quot;A[&quot; + i + &quot;]&quot;); } else { console.log(&quot;(&quot;); printOptimalParenthesis(s, i, s[i][j]); printOptimalParenthesis(s, s[i][j] + 1, j); console.log(&quot;)&quot;); } }</p>\n<p>执行修改后的算法，也能得到括号的最佳顺序 (A<a href=\"A%5B2%5D(A%5B3%5DA%5B4%5D)\">1</a>)，并可以转化为 (A (B (CD)))。</p>\n<p>14.3　贪心算法</p>\n<p>贪心算法遵循一种近似解决问题的技术，期盼通过每个阶段的局部最优选择（当前最好的解），从而达到全局的最优（全局最优解）。它不像动态规划算法那样计算更大的格局。</p>\n<p>我们来看看如何用贪心算法解决动态规划话题中最少硬币找零问题和背包问题。</p>\n<p>我们在第 12 章介绍了一些其他的贪心算法，比如 Dijkstra 算法、Prim 算法和 Kruskal 算法。</p>\n<p>14.3.1　最少硬币找零问题</p>\n<p>最少硬币找零问题也能用贪心算法解决。大部分情况下的结果是最优的，不过对有些面额而言，结果不会是最优的。</p>\n<p>下面来看看算法。</p>\n<p>function minCoinChange(coins, amount) { const change = []; let total = 0; for (let i = coins.length; i &gt;= 0; i--) { // {1} const coin = coins[i]; while (total + coin &lt;= amount) { // {2} change.push(coin); // {3} total += coin; // {4} } } return change; }</p>\n<p>不得不说贪心版本的 minCoinChange 比动态规划版本简单多了。对每个面额（行 {1}—— 从大到小），把它的值和 total 相加后，total 需要小于 amount（行 {2}）。我们会将当前面额 coin 添加到结果中（行 {3}），也会将它和 total 相加（行 {4}）。</p>\n<p>如你所见，这个贪心解法很简单。从最大面额的硬币开始，拿尽可能多的这种硬币找零。当无法再拿更多这种价值的硬币时，开始拿第二大价值的硬币，依次继续。</p>\n<p>用和 DP 方法同样的测试代码测试。</p>\n<p>console.log(minCoinChange([1, 5, 10, 25], 36));</p>\n<p>结果依然是 [25, 10, 1]，和用 DP 得到的一样。下图阐释了算法的执行过程。</p>\n<p>然而，如果用 [1, 3, 4] 面额执行贪心算法，会得到结果 [4, 1, 1]。如果用动态规划的解法，会得到最优的结果 [3, 3]。</p>\n<p>比起动态规划算法而言，贪心算法更简单、更快。然而，如我们所见，它并不总是得到最优答案。但是综合来看，它相对执行时间来说，输出了一个可以接受的解。</p>\n<p>14.3.2　分数背包问题</p>\n<p>求解分数背包问题的算法与动态规划版本稍有不同。在 0-1 背包问题中，只能向背包里装入完整的物品，而在分数背包问题中，可以装入分数的物品。我们用前面用过的例子来比较两者的差异，如下所示。</p>\n<p>物品</p>\n<p>重量</p>\n<p>价值</p>\n<p>1</p>\n<p>2</p>\n<p>3</p>\n<p>2</p>\n<p>3</p>\n<p>4</p>\n<p>3</p>\n<p>4</p>\n<p>5</p>\n<p>在动态规划的例子里，我们考虑背包能够携带的重量只有 5。在这个例子里，我们可以说最佳解决方案是往背包里装入物品 1 和物品 2，总重量为 5，总价值为 7。</p>\n<p>如果在分数背包问题中考虑相同的容量，得到的结果是一样的。因此，我们考虑容量为 6 的情况。</p>\n<p>在这种情况下，解决方案是装入物品 1 和物品 2，还有 25% 的物品 3。这样，重量为 6 的物品总价值为 8.25。</p>\n<p>我们来看看下面这个算法。</p>\n<p>function knapSack(capacity, weights, values) { const n = values.length; let load = 0; let val = 0; for (let i = 0; i &lt; n &amp;&amp; load &lt; capacity; i++) { // {1} if (weights[i] &lt;= capacity - load) { // {2} val += values[i]; load += weights[i]; } else { const r = (capacity - load) / weights[i]; // {3} val += r * values[i]; load += weights[i]; } } return val; }</p>\n<p>总重量少于背包容量（不能带超过容量的东西），我们会迭代物品（行 {1}）。如果物品可以完整地装入背包（行 {2}—— 小于等于背包容量），就将其价值和重量分别计入背包已装入物品的总价值（val）和总重量（load）。如果物品不能完整地装入背包，计算能够装入部分的比例（r）（行 {3}—— 我们可以带的分数）。</p>\n<p>如果在 0-1 背包问题中考虑同样的容量 6，我们就会看到，物品 1 和物品 3 组成了解决方案。在这种情况下，对同一个问题应用不同的解决方法，会得到两种不同的结果。</p>\n<p>14.4　回溯算法</p>\n<p>回溯是一种渐进式寻找并构建问题解决方式的策略。我们从一个可能的动作开始并试着用这个动作解决问题。如果不能解决，就回溯并选择另一个动作直到将问题解决。根据这种行为，回溯算法会尝试所有可能的动作（如果更快找到了解决办法就尝试较少的次数）来解决问题。</p>\n<p>有一些可用回溯解决的著名问题：</p>\n<p>骑士巡逻问题</p>\n<p>皇后问题</p>\n<p>迷宫老鼠问题</p>\n<p>数独解题器</p>\n<p>本书中，我们会学习迷宫老鼠和数独解题器问题，因为它们比较容易理解。但是，你也可以在本书源代码中找到其他回溯问题的源代码。</p>\n<p>14.4.1　迷宫老鼠问题</p>\n<p>假设我们有一个大小为的矩阵，矩阵的每个位置是一个方块。每个位置（或块）可以是空闲的（值为 1）或是被阻挡的（值为 0），如下图所示，其中 S 是起点，D 是终点。</p>\n<p>矩阵就是迷宫，“老鼠” 的目标是从位置 [0][0] 开始并移动到 [n-1][n-1]（终点）。老鼠可以在垂直或水平方向上任何未被阻挡的位置间移动。</p>\n<p>我们来声明算法的基本结构。</p>\n<p>export function ratInAMaze(maze) { const solution = []; for (let i = 0; i &lt; maze.length; i++) { // {1} solution[i] = []; for (let j = 0; j &lt; maze[i].length; j++) { solution[i][j] = 0; } } if (findPath(maze, 0, 0, solution) === true) { // {2} return solution; } return 'NO PATH FOUND'; // {3} }</p>\n<p>首先创建一个包含解的矩阵。将每个位置初始化为零（行 {1}）。对于老鼠采取的每步行动，我们将路径标记为 1。如果算法能够找到一个解（行 {2}），就返回解决矩阵，否则返回一条错误信息（行 {3}）。</p>\n<p>然后，我们创建一个 findPath 方法，它会试着从位置 x 和 y 开始在给定的 maze 矩阵中找到一个解。和本章介绍的其他技巧一样，回溯技巧也使用了递归，这也是使这个算法有回溯能力的原因。</p>\n<p>function findPath(maze, x, y, solution) { const n = maze.length; if (x === n - 1 &amp;&amp; y === n - 1) { // {4} solution[x][y] = 1; return true; } if (isSafe(maze, x, y) === true) { // {5} solution[x][y] = 1; // {6} if (findPath(maze, x + 1, y, solution)) { // {7} return true; } if (findPath(maze, x, y + 1, solution)) { // {8} return true; } solution[x][y] = 0; // {9} return false; } return false; // {10} }</p>\n<p>算法的第一步是验证老鼠是否到达了终点（行 {4}）。如果到了，就将最后一个位置标记为路径的一部分并返回 true，表示移动成功结束。如果不是最后一步，要验证老鼠能否安全移动至该位置（行 {5} 表示根据下面声明的 isSafe 方法判断出该位置空闲）。如果是安全的，我们将这步加入路径（行 {6}）并试着在 maze 矩阵中水平移动（向右）到下一个位置（行 {7}）。如果水平移动不可行，我们就试着垂直向下移动到下一个位置（行 {8}）。如果水平和垂直都不能移动，那么将这步从路径中移除并回溯（行 {9}），表示算法会尝试另一个可能的解。在算法尝试了所有可能的动作还是找不到解时，就返回 false（行 {10}），表示这个问题无解。</p>\n<p>function isSafe(maze, x, y) { const n = maze.length; if (x &gt;= 0 &amp;&amp; y &gt;= 0 &amp;&amp; x &lt; n &amp;&amp; y &lt; n &amp;&amp; maze[x][y] !== 0) { return true; // {11} } return false; }</p>\n<p>用下面的代码进行测试。</p>\n<p>const maze = [ [1, 0, 0, 0], [1, 1, 1, 1], [0, 0, 1, 0], [0, 1, 1, 1] ]; console.log(ratInAMaze(maze));</p>\n<p>输出如下。</p>\n<p>[[1, 0, 0, 0], [1, 1, 1, 0], [0, 0, 1, 0], [0, 0, 1, 1]]</p>\n<p>14.4.2　数独解题器</p>\n<p>数独是一个非常有趣的解谜游戏，也是史上最流行的游戏之一。目标是用数字 1～9 填满一个 9 × 9 的矩阵，要求每行和每列都由这九个数字构成。矩阵还包含了小方块（3 × 3 矩阵），它们同样需要分别用这九个数字填满。谜题在开始给出一个已填了部分数字的矩阵，如下图所示。</p>\n<p>数独解题器的回溯算法会尝试在每行每列中填入每个数字。和迷宫老鼠问题一样，我们从算法的主方法开始。</p>\n<p>function sudokuSolver (matrix) { if (solveSudoku (matrix) === true) { return matrix; } return ' 问题无解！'; }</p>\n<p>算法在找到解后会返回填满了缺失数字的矩阵，否则返回错误信息。现在，我们来看算法的主要逻辑。</p>\n<p>const UNASSIGNED = 0; function solveSudoku(matrix) { let row = 0; let col = 0; let checkBlankSpaces = false; for (row = 0; row &lt; matrix.length; row++) { // {1} for (col = 0; col &lt; matrix[row].length; col++) { if (matrix[row][col] === UNASSIGNED) { checkBlankSpaces = true; // {2} break; } } if (checkBlankSpaces === true) { // {3} break; } } if (checkBlankSpaces === false) { return true; // {4} } for (let num = 1; num &lt;= 9; num++) { // {5} if (isSafe(matrix, row, col, num)) { // {6} matrix[row][col] = num; // {7} if (solveSudoku(matrix)) { // {8} return true; } matrix[row][col] = UNASSIGNED; // {9} } } return false; // {10} }</p>\n<p>第一步是验证谜题是否已被解决（行 {1}）。如果没有空白的位置（值为 0 的位置），表示谜题已被完成（行 {4}）。如果有空白位置（行 {2}），我们要从两个循环中跳出（行 {3}）并且 row 和 col 变量会表示需要用 1～9 填写空白的位置。下面，算法会试着用 1～9 填写这个位置，一次填一个（行 {5}）。我们会检查添加的数字是否符合规则（行 {6}），也就是这个数字在这行、这列或在小矩阵（3 × 3 矩阵）中没有出现过。如果符合，我们就将这个数字填入（行 {7}）并再次执行 solveSudoku 函数来尝试填写下一个位置（行 {8}）。如果一个数字填在了不正确的位置，我们就再将这个位置标记为空（行 {9}），并且算法会回溯（行 {10}）再尝试一个其他数字。</p>\n<p>isSafe 声明如下，它包含检查填入的数字是否符合规则。</p>\n<p return=\"\" (=\"\" !usedInRow(matrix,=\"\" row,=\"\" num)=\"\" &amp;&amp;=\"\" !usedInCol(matrix,=\"\" col,=\"\" num)=\"\" &amp;&amp;=\"\" !usedInBox(matrix,=\"\" row=\"\" -=\"\" (row=\"\" %=\"\" 3),=\"\" col=\"\" -=\"\" (col=\"\" %=\"\" 3),=\"\" num)=\"\" );=\"\">function isSafe(matrix, row, col, num)</p>\n<p>具体的检查声明如下。</p>\n<p>function usedInRow(matrix, row, num) { for (let col = 0; col &lt; matrix.length; col++) { // {11} if (matrix[row][col] === num) { return true; } } return false; } function usedInCol(matrix, col, num) { for (let row = 0; row &lt; matrix.length; row++) { // {12} if (matrix[row][col] === num) { return true; } } return false; } function usedInBox(matrix, boxStartRow, boxStartCol, num) { for (let row = 0; row &lt; 3; row++) { for (let col = 0; col &lt; 3; col++) { if (matrix[row + boxStartRow][col + boxStartCol] === num) { // {13} return true; } } } return false; }</p>\n<p>首先，通过迭代矩阵中给定行 row 中的每个位置检查数字是否在行 row 中存在（行 {11}）。然后，迭代所有的列来验证数字是否在给定的列中存在（行 {12}）。最后的检查是通过迭代 3 × 3 矩阵中的所有位置来检查数字是否在小矩阵中存在（行 {13}）。</p>\n<p>用下面的例子来测试算法。</p>\n<p>const sudokuGrid = [ [5, 3, 0, 0, 7, 0, 0, 0, 0], [6, 0, 0, 1, 9, 5, 0, 0, 0], [0, 9, 8, 0, 0, 0, 0, 6, 0], [8, 0, 0, 0, 6, 0, 0, 0, 3], [4, 0, 0, 8, 0, 3, 0, 0, 1], [7, 0, 0, 0, 2, 0, 0, 0, 6], [0, 6, 0, 0, 0, 0, 2, 8, 0], [0, 0, 0, 4, 1, 9, 0, 0, 5], [0, 0, 0, 0, 8, 0, 0, 7, 9] ]; console.log(sudokuSolver(sudokuGrid));</p>\n<p>输出如下。</p>\n<p>[[5, 3, 4, 6, 7, 8, 9, 1, 2], [6, 7, 2, 1, 9, 5, 3, 4, 8], [1, 9, 8, 3, 4, 2, 5, 6, 7], [8, 5, 9, 7, 6, 1, 4, 2, 3], [4, 2, 6, 8, 5, 3, 7, 9, 1], [7, 1, 3, 9, 2, 4, 8, 5, 6], [9, 6, 1, 5, 3, 7, 2, 8, 4], [2, 8, 7, 4, 1, 9, 6, 3, 5], [3, 4, 5, 2, 8, 6, 1, 7, 9]]</p>\n<p>14.5　函数式编程简介</p>\n<p>到目前为止，我们在本书中所用的编程范式都是命令式编程。在命令式编程中，我们按部就班地编写程序代码，详细描述要完成的事情以及完成的顺序。</p>\n<p>在本节中，我们会介绍一种新的范式，叫作函数式编程（FP）。我们在本书的一些算法中已经使用过一些 FP 代码片段。函数式编程是一种曾经主要用于学术领域的范式，多亏了 Python 和 Ruby 等现代语言，它才开始在行业开发者中流行起来。值得欣慰的是，借助 ES2015 的能力，JavaScript 也能够进行函数式编程。</p>\n<p>14.5.1　函数式编程与命令式编程</p>\n<p>以函数式范式进行开发并不简单，关键在于习惯这种范式的机制。我们编写一个例子来说明差异。</p>\n<p>假设我们想打印一个数组中所有的元素。我们可以用命令式编程，声明的函数如下。</p>\n<p>const printArray = function(array) { for (var i = 0; i &lt; array.length; i++){ console.log(array[i]); } }; printArray([1, 2, 3, 4, 5]);</p>\n<p>在上面的代码中，我们迭代数组，打印每一项。</p>\n<p>现在，我们试着把这个例子转换成函数式编程。在函数式编程中，函数就是摇滚明星。我们关注的重点是需要描述什么，而不是如何描述。回到这一句：“我们迭代数组，打印每一项。” 那么，首先要关注的是迭代数据，然后进行操作，即打印数组项。下面的函数负责迭代数组。</p>\n<p>const forEach = function(array, action){ for (var i = 0; i &lt; array.length; i++){ action(array[i]); } };</p>\n<p>接下来，要创建另一个负责把数组元素打印到控制台的函数（考虑为回调函数），如下所示。</p>\n<p>const logItem = function(item) { console.log(item); };</p>\n<p>最后，像下面这样使用声明的函数。</p>\n<p>forEach([1, 2, 3, 4, 5], logItem);</p>\n<p>只需要上面这一行代码，就能描述我们要把数组的每一项打印到控制台。这是我们的第一个函数式编程的例子！</p>\n<p>有以下几点要注意。</p>\n<p>函数式编程的主要目标是描述数据，以及要对数据应用的转换。</p>\n<p>在函数式编程中，程序执行顺序的重要性很低；而在命令式编程中，步骤和顺序是非常重要的。</p>\n<p>函数和数据集合是函数式编程的核心。</p>\n<p>在函数式编程中，我们可以使用和滥用函数和递归；而在命令式编程中，则使用循环、赋值、条件和函数。</p>\n<p>在函数式编程中，要避免副作用和可变数据，意味着我们不会修改传入函数的数据。如果需要基于输入返回一个解决方案，可以制作一个副本并返回数据修改后的副本。</p>\n<p>14.5.2　ES2015 + 和函数式编程</p>\n<p>有了 ES2015 + 的新功能，用 JavaScript 进行函数式编程就变得更加容易了。我们来看一个例子。</p>\n<p>考虑我们要找出数组中最小的值。要用命令式编程完成这个任务，只要迭代数组，检查当前的最小值是否大于数组元素；如果是，就更新最小值，代码如下。</p>\n<p>var findMinArray = function (array){ var minValue = array [0]; for (var i=1; i&lt;array.length; i++){ if (minValue &gt; array [i]){ minValue = array [i]; } } return minValue; }; console.log (findMinArray ([8,6,4,5,9])); // 输出 4</p>\n<p>要用函数式编程完成相同的任务，可以使用 Math.min 函数，传入所有要比较的数组元素。我们可以像下面的例子里这样，使用 ES2015 的解构运算符（...），把数组转换成单个的元素。</p>\n<p>const min_ = function (array){ return Math.min (...array) }; console.log (min_([8,6,4,5,9])); // 输出 4</p>\n<p>使用 ES2015 的箭头函数，可以进一步简化上面的代码。</p>\n<p>const min = arr =&gt; Math.min(...arr); console.log(min([8, 6, 4, 5, 9]));</p>\n<p>我们可以用 ES2015 语法重写第一个示例。</p>\n<p>const forEach = (array, action) =&gt; array.forEach(item =&gt; action(item)); const logItem = (item) =&gt; console.log(item);</p>\n<p>14.5.3　JavaScript 函数式工具箱 ——map、filter 和 reduce</p>\n<p>map、filter 和 reduce 函数（第 3 章已经学习过）是 JavaScript 函数式编程的基础。</p>\n<p>我们可以使用 map 函数，把一个数据集合转换或映射成另一个数据集合。先看一个命令式编程的例子。</p>\n<p daysOfWeekValues_.push(daysOfWeek[i].value);=\"\">const daysOfWeek = [ {name: 'Monday', value: 1}, {name: 'Tuesday', value: 2}, {name: 'Wednesday', value: 7} ]; let daysOfWeekValues_ = []; for (let i = 0; i &lt; daysOfWeek.length; i++)</p>\n<p>再以函数式编程并使用 ES2015 + 语法来考虑同样的例子，代码如下。</p>\n<p>const daysOfWeekValues = daysOfWeek.map(day =&gt; day.value); console.log(daysOfWeekValues);</p>\n<p>我们可以使用 filter 函数过滤一个集合的值。下面来看一个例子。</p>\n<p>const positiveNumbers_ = function(array){ let positive = []; for (let i = 0; i &lt; array.length; i++) { if (array[i] &gt;= 0){ positive.push(array[i]); } } return positive; } console.log(positiveNumbers_([-1,1,2,-2]));</p>\n<p>我们可以把同样的代码写成函数式的，如下所示。</p>\n<p>const positiveNumbers = (array) =&gt; array.filter(num =&gt; (num &gt;= 0)); console.log(positiveNumbers([-1,1,2,-2]));</p>\n<p>我们也可以使用 reduce 函数，把一个集合归约成一个特定的值。比如，对一个数组中的值求和。</p>\n<p>const sumValues = function(array) { let total = array[0]; for (let i = 1; i&lt;array.length; i++) { total += array[i]; } return total; }; console.log(sumValues([1, 2, 3, 4, 5]));</p>\n<p>上面的代码也可以写成这样。</p>\n<p>const sum_ = function(array){ return array.reduce(function(a, b){ return a + b; }) }; console.log(sum_([1, 2, 3, 4, 5]));</p>\n<p>我们还可以把这些函数与 ES2015 的功能结合起来，比如解构运算符和箭头函数，代码如下。</p>\n<p>const sum = arr =&gt; arr.reduce((a, b) =&gt; a + b); console.log(sum([1, 2, 3, 4, 5]));</p>\n<p>我们再看另一个例子。考虑我们需要写一个函数，把几个数组连接起来。为此，可以创建另一个数组，用于存放其他数组的元素。可以执行以下命令式的代码。</p>\n<p>const mergeArrays_ = function(arrays){ const count = arrays.length; let newArray = []; let k = 0; for (let i = 0; i &lt; count; i++){ for (var j = 0; j &lt; arrays[i].length; j++){ newArray[k++] = arrays[i][j]; } } return newArray; }; console.log(mergeArrays_([[1, 2, 3], [4, 5], [6]]));</p>\n<p>注意，在这个例子中，我们声明了变量，还使用了循环。现在，我们用 JavaScript 函数式编程把上面的代码重写如下。</p>\n<p>const mergeArraysConcat = function(arrays){ return arrays.reduce( function(p,n){ return p.concat(n); }); }; console.log(mergeArraysConcat([[1, 2, 3], [4, 5], [6]]));</p>\n<p>上面的代码完成了同样的任务，但它是面向函数的。我们也可以用 ES2015 使代码更加精简，如下所示。</p>\n<p>const mergeArrays = (...arrays) =&gt; [].concat(...arrays); console.log(mergeArrays([1, 2, 3], [4, 5], [6]));</p>\n<p>从 11 行代码变成了只有一行（尽管可读性降低了）！</p>\n<p>如果你想更多地练习 JavaScript 函数式编程，可以试试这些习题，非常有意思：<span class=\"exturl\" data-url=\"aHR0cDovL3JlYWN0aXZleC5pby9sZWFybnJ4LyVFMyU4MCU4Mg==\">http://reactivex.io/learnrx/。</span></p>\n<p>14.5.4　JavaScript 函数式类库和数据结构</p>\n<p>有一些很棒的 JavaScript 类库借助工具函数和函数式数据结构，对函数式编程提供支持。通过下面的列表，你可以找到一些最有名的 JavaScript 函数式类库。</p>\n<p>Underscode.js：<span class=\"exturl\" data-url=\"aHR0cDovL3VuZGVyc2NvcmVqcy5vcmcv\">http://underscorejs.org/</span></p>\n<p>Bilby.js：<span class=\"exturl\" data-url=\"aHR0cDovL2JpbGJ5LmJyaWFubWNrZW5uYS5vcmcv\">http://bilby.brianmckenna.org/</span></p>\n<p>Lazy.js：<span class=\"exturl\" data-url=\"aHR0cDovL2RhbmllbHRhby5jb20vbGF6eS5qcy8=\">http://danieltao.com/lazy.js/</span></p>\n<p>Bacon.js：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWNvbmpzLmdpdGh1Yi5pby8=\">https://baconjs.github.io/</span></p>\n<p>Fn.js：<span class=\"exturl\" data-url=\"aHR0cDovL2VsaXBlcmVsbWFuLmNvbS9mbi5qcy8=\">http://eliperelman.com/fn.js/</span></p>\n<p>Functional.js：<span class=\"exturl\" data-url=\"aHR0cDovL2Z1bmN0aW9uYWxqcy5jb20v\">http://functionaljs.com/</span></p>\n<p>Ramda.js：<span class=\"exturl\" data-url=\"aHR0cDovL3JhbWRhanMuY29tLzAuMjAuMS9pbmRleC5odG1s\">http://ramdajs.com/0.20.1/index.html</span></p>\n<p>Mori：<span class=\"exturl\" data-url=\"aHR0cDovL3N3YW5ub2RldHRlLmdpdGh1Yi5pby9tb3JpLw==\">http://swannodette.github.io/mori/</span></p>\n<p>如果你对学习 JavaScript 函数式编程感兴趣，可以看看 Packt 出版的另一本书：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucGFja3RwdWIuY29tL3dlYi1kZXZlbG9wbWVudC9mdW5jdGlvbmFsLXByb2dyYW1taW5nLWphdmFzY3JpcHQlRTMlODAlODI=\">https://www.packtpub.com/web-development/functional-programming-javascript。</span></p>\n<p>14.6　小结</p>\n<p>在本章中，我们介绍了最著名的动态规划问题，如最少硬币找零问题、背包问题、最长公共子序列和矩阵链相乘。我们学习了分而治之算法以及它们和动态规划算法的区别。</p>\n<p>我们学习了贪心算法，以及如何用贪心算法解决最少硬币找零问题和分数背包问题。我们还学习了回溯的概念以及一些著名的问题，如迷宫老鼠问题和数独解题器。</p>\n<p>你还学习了函数式编程，并通过一些例子了解了如何以这种范式使用 JavaScript 的功能。</p>\n<p>下一章，我们会介绍大表示法，并讨论如何计算一个算法的复杂性。你还将学习存在于算法世界里的更多概念。</p>\n<h1 id=\"第-15-章-算法复杂度\"><a class=\"anchor\" href=\"#第-15-章-算法复杂度\">#</a> 第 15 章　算法复杂度</h1>\n<p>本章，我们要学习著名的大表示法和 NP 完全理论，还要看看如何用算法增添乐趣、巩固知识，提高我们编程和解决问题的能力。</p>\n<p>15.1　大表示法</p>\n<p>第 13 章引入了大表示法的概念。它的确切含义是什么？它用于描述算法的性能和复杂程度。大表示法将算法按照消耗的时间进行分类，依据随输入增大所需要的空间 / 内存。</p>\n<p>分析算法时，时常遇到以下几类函数。</p>\n<p>符号</p>\n<p>名称</p>\n<p>常数的</p>\n<p>对数的</p>\n<p>对数多项式的</p>\n<p>线性的</p>\n<p>二次的</p>\n<p>多项式的</p>\n<p>指数的</p>\n<p>15.1.1　理解大 O 表示法</p>\n<p>如何衡量算法的效率？通常是用资源，例如 CPU（时间）占用、内存占用、硬盘占用和网络占用。当讨论大表示法时，一般考虑的是 CPU（时间）占用。</p>\n<p>让我们试着用一些例子来理解大表示法的规则。</p>\n<p>考虑以下函数。</p>\n<p return=\"\" ++num;=\"\">function increment(num)</p>\n<p>假设运行 increment (1) 函数，执行时间等于。如果再用不同的参数（例如 2）运行一次 increment 函数，执行时间依然是。和参数无关，increment 函数的性能都一样。因此，我们说上述函数的复杂度是 (1)（常数）。</p>\n<p>现在以第 13 章中实现的顺序搜索算法为例。</p>\n<p>function sequentialSearch(array, value, equalsFn = defaultEquals) { for (let i = 0; i &lt; array.length; i++) { if (equalsFn(value, array[i])) { // {1} return i; } } return -1; }</p>\n<p>如果将含 10 个元素的数组（[1, ..., 10]）传递给该函数，假如搜索 1 这个元素，那么，第一次判断时就能找到想要搜索的元素。在这里我们假设每执行一次行 {1}，开销是 1。</p>\n<p>现在，假如要搜索元素 11。行 {1} 会执行 10 次（迭代数组中所有的值，并且找不到要搜索的元素，因而结果返回 - 1）。如果行 {1} 的开销是 1，那么它执行 10 次的开销就是 10，10 倍于第一种假设。</p>\n<p>现在，假如该数组有 1000 个元素（[1, ..., 1000]）。搜索 1001 的结果是行 {1} 执行了 1000 次（然后返回 - 1）。</p>\n<p>注意，sequentialSearch 函数执行的总开销取决于数组元素的个数（数组大小），而且也和搜索的值有关。如果是查找数组中存在的值，行 {1} 会执行几次呢？如果查找的是数组中不存在的值，那么行 {1} 就会执行和数组大小一样多次，这就是通常所说的最坏情况。</p>\n<p>最坏情况下，如果数组大小是 10，开销就是 10；如果数组大小是 1000，开销就是 1000。可以得出 sequentialSearch 函数的时间复杂度是，是（输入）数组的大小。</p>\n<p>回到之前的例子，修改一下算法的实现（最坏情况），使之计算开销。</p>\n<p>function sequentialSearch(array, value, equalsFn = defaultEquals) { let cost = 0; for (let i = 0; i &lt; array.length; i++) { cost++; if (equalsFn(value, array[i])) { return i; } } console.log( <code>cost for sequentialSearch with input size $&#123;array.length&#125; is $&#123;cost&#125;</code> ); return -1; }</p>\n<p>用不同大小的输入数组执行以上算法，可以看到不同的输出。</p>\n<p>用冒泡排序做的例子。</p>\n<p>function bubbleSort(array, compareFn = defaultCompare) { const { length } = array; for (let i = 0; i &lt; length; i++) { // {1} for (let j = 0; j &lt; length - 1; j++) { // {2} if (compareFn(array[j], array[j + 1]) === Compare.BIGGER_THAN) { swap(array, j, j + 1); } } } return array; }</p>\n<p>假设行 {1} 和行 {2} 的开销分别是 1。修改算法的实现使之计算开销。</p>\n<p>function bubbleSort(array, compareFn = defaultCompare) { const { length } = array; let cost = 0; for (let i = 0; i &lt; length; i++) { // {1} cost++; for (let j = 0; j &lt; length - 1; j++) { // {2} cost++; if (compareFn(array[j], array[j + 1]) === Compare.BIGGER_THAN) { swap(array, j, j + 1); } } } console.log( <code>cost for bubbleSort with input size $&#123;length&#125; is $&#123;cost&#125;</code> ); return array; }</p>\n<p>如果用大小为 10 的数组执行 bubbleSort，开销是 100（102）。如果用大小为 100 的数组执行 bubbleSort，开销就是 10 000（）。需要注意，我们每次增加输入的大小，执行都会越来越久。</p>\n<p>时间复杂度的代码只有一层循环，而的代码有双层嵌套循环。如果算法有三层迭代数组的嵌套循环，它的时间复杂度很可能就是。</p>\n<p>15.1.2　时间复杂度比较</p>\n<p>我们可以创建一个表格来表示不同的时间复杂度。</p>\n<p>输入大小（）</p>\n<p>10</p>\n<p>1</p>\n<p>1</p>\n<p>10</p>\n<p>10</p>\n<p>100</p>\n<p>1024</p>\n<p>20</p>\n<p>1</p>\n<p>1.30</p>\n<p>20</p>\n<p>26.02</p>\n<p>400</p>\n<p>1 048 576</p>\n<p>50</p>\n<p>1</p>\n<p>1.69</p>\n<p>50</p>\n<p>84.94</p>\n<p>2500</p>\n<p>非常大</p>\n<p>100</p>\n<p>1</p>\n<p>2</p>\n<p>100</p>\n<p>200</p>\n<p>10 000</p>\n<p>非常大</p>\n<p>500</p>\n<p>1</p>\n<p>2.69</p>\n<p>500</p>\n<p>1349.48</p>\n<p>250 000</p>\n<p>非常大</p>\n<p>1000</p>\n<p>1</p>\n<p>3</p>\n<p>1000</p>\n<p>3000</p>\n<p>1 000 000</p>\n<p>非常大</p>\n<p>10 000</p>\n<p>1</p>\n<p>4</p>\n<p>10 000</p>\n<p>40 000</p>\n<p>100 000 000</p>\n<p>非常大</p>\n<p>我们可以基于上表信息画一个图来表示不同的大表示法的消耗。</p>\n<p>这个图表是用 JavaScript 绘制的哦！在本书示例代码中，你可以到 examples/chapter15 目录中找到绘制本图表的源代码。</p>\n<p>在接下来的部分，你可以找到本书实现的所有算法的时间复杂度的速查表。</p>\n<p>如果你需要一个打印版本的大速查表，下面的链接包含了一个很漂亮的版本：<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5iaWdvY2hlYXRzaGVldC5jb20=\">http://www.bigocheatsheet.com</span>。（请注意，对于某些数据结构例如栈和队列，本书实现了改进后的版本，因此大复杂度会比链接中给出的小一些。）</p>\n<p>数据结构</p>\n<p>下表是常用数据结构的时间复杂度。</p>\n<p>数据结构 一般情况 最差情况</p>\n<p>插入 删除 搜索 插入 删除 搜索</p>\n<p>数组 / 栈 / 队列</p>\n<p>链表</p>\n<p>双向链表</p>\n<p>散列表</p>\n<p>二分搜索树</p>\n<p>AVL 树</p>\n<p>红黑树</p>\n<p>二叉堆：寻找最大值 / 最小值</p>\n<p>图</p>\n<p>下表是图的时间复杂度。</p>\n<p>节点 / 边的管理方式 存储空间 增加顶点 增加边 删除顶点 删除边 轮询</p>\n<p>邻接表</p>\n<p>邻接矩阵</p>\n<p>排序算法</p>\n<p>下表是排序算法的时间复杂度。</p>\n<p>算法（用于数组） 时间复杂度</p>\n<p>最好情况 一般情况 最差情况</p>\n<p>冒泡排序</p>\n<p>选择排序</p>\n<p>插入排序</p>\n<p>希尔排序</p>\n<p>归并排序</p>\n<p>快速排序</p>\n<p>堆排序</p>\n<p>计数排序</p>\n<p>桶排序</p>\n<p>基数排序</p>\n<p>搜索算法</p>\n<p>下表是搜索算法的时间复杂度。</p>\n<p>算法 数据结构 最差情况</p>\n<p>顺序搜索 数组</p>\n<p>二分搜索 已排序的数组</p>\n<p>内插搜索 已排序的数组</p>\n<p>深度优先搜索（DFS） 顶点数为，边数为的图</p>\n<p>广度优先搜索（BFS） 顶点数为，边数为的图</p>\n<p>15.1.3　NP 完全理论概述</p>\n<p>一般来说，如果一个算法的复杂度为，其中是常数，我们就认为这个算法是高效的，这就是多项式算法。</p>\n<p>对于给定的问题，如果存在多项式算法，则计为（polynomial，多项式）。</p>\n<p>还有一类 NP（nondeterministic polynomial，非确定性多项式）算法。如果一个问题可以在多项式时间内验证解是否正确，则计为。</p>\n<p>如果一个问题存在多项式算法，自然可以在多项式时间内验证其解。因此，所有的都是。然而，是否成立，仍然不得而知。</p>\n<p>NP 问题中最难的是 NP 完全问题。如果满足以下两个条件，则称决策问题是 NP 完全的：</p>\n<p>(1) 是 NP 问题，也就是说，可以在多项式时间内验证解，但还没有找到多项式算法；</p>\n<p>(2) 所有的 NP 问题都能在多项式时间内归约为。</p>\n<p>为了理解问题的归约，考虑两个决策问题和。假设算法可以解决问题，算法可以验证输入是否为的解。目标是找到一个把转化为的方法，使得算法可以用于构造算法。</p>\n<p>还有一类问题，只需满足 NP 完全问题的第二个条件，称为 NP 困难问题。因此，NP 完全问题也是 NP 困难问题的子集。</p>\n<p>是否成立，是计算机科学中最重要的难题之一。如果能找到答案，对密码学、算法研究、人工智能等诸多领域都会产生重大影响。</p>\n<p>下面是满足时，P、NP、NP 完全和 NP 困难问题的欧拉图。</p>\n<p>非 NP 完全的 NP 困难问题的例子有停机问题和布尔可满足性问题（SAT）。</p>\n<p>NP 完全问题的例子有子集和问题、旅行商问题、顶点覆盖问题，等等。</p>\n<p>关于这些问题，详情请查阅 https://en.wikipedia.org/wiki/NP-completeness。</p>\n<p>不可解问题与启发式算法</p>\n<p>我们提到的有些问题是不可解的。然而，仍然有办法在符合要求的时间内找到一个近似解。启发式算法就是其中之一。启发式算法得到的未必是最优解，但足够解决问题了。</p>\n<p>启发式算法的例子有局部搜索、遗传算法、启发式导航、机器学习等。详情请查阅 https://en.wikipedia.org/wiki/Heuristic_(computer_science)。</p>\n<p>启发式算法可以很巧妙地解决一些问题。你可以尝试把研究启发式算法作为学士或硕士学位的论文主题。</p>\n<p>15.2　用算法娱乐身心</p>\n<p>我们学习算法并不单单是因为它是大学必修课，也不单单是因为我们想成为开发者。通过用在本书中学到的算法来解决问题，我们可以提高解决问题的能力，进而成为更棒的专业人士。</p>\n<p>增长（解题）知识的最好方式是练习，而练习不一定是枯燥的。本节将展示一些网站，你可以访问它们并尝试从算法中获到快乐（甚至小赚一笔）。</p>\n<p>这里列出一些有用的网站（有些不支持用 JavaScript 提交解答，但是我们依然可以将从本书中所学到的逻辑应用到其他语言上）。</p>\n<p>UVa Online Judge（<span class=\"exturl\" data-url=\"aHR0cDovL3V2YS5vbmxpbmVqdWRnZS5vcmcvJUVGJUJDJTg5JUVGJUJDJTlBJUU4JUJGJTk5JUU0JUI4JUFBJUU3JUJEJTkxJUU3JUFCJTk5JUU1JThDJTg1JUU1JTkwJUFCJUU0JUJBJTg2JUU0JUI4JTk2JUU3JTk1JThDJUU1JTkwJTg0JUU1JUE0JUE3JUU4JUI1JTlCJUU0JUJBJThCJUU3JTlBJTg0JUU5JUEyJTk4JUU3JTlCJUFFJUVGJUJDJThDJUU1JThDJTg1JUU2JThCJUFD\">http://uva.onlinejudge.org/）：这个网站包含了世界各大赛事的题目，包括</span> 由 IBM 赞助的 ACM 国际大学生程序竞赛（ICPC。若你依然在校，应尽量参与这项赛事，如果团队获胜，则有可能免费享受一次国际旅行）。这个网站包括了成百上千的题目，可以应用本书所学的算法。</p>\n<p>Sphere Online Judge（<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zcG9qLmNvbS8lRUYlQkMlODklRUYlQkMlOUElRTglQkYlOTklRTQlQjglQUElRTclQkQlOTElRTclQUIlOTklRTUlOTIlOENVVmE=\">http://www.spoj.com/）：这个网站和 UVa</span> Online Judge 差不多，但支持用更多语言解题（包括 JavaScript）。</p>\n<p>Coderbyte（<span class=\"exturl\" data-url=\"aHR0cDovL2NvZGVyYnl0ZS5jb20vJUVGJUJDJTg5JUVGJUJDJTlBJUU4JUJGJTk5JUU0JUI4JUFBJUU3JUJEJTkxJUU3JUFCJTk5JUU1JThDJTg1JUU1JTkwJUFCJUU0JUJBJTg2JUU1JThGJUFGJUU0JUJCJUE1JUU3JTk0JUE4SmF2YVNjcmlwdCVFOCVBNyVBMyVFNyVBRCU5NCVFNyU5QSU4NCVFOSVBMiU5OCVFNyU5QiVBRSVFRiVCQyU4OCVFNyVBRSU4MCVFNSU4RCU5NSVFMyU4MCU4MSVFNCVCOCVBRCVFNyVBRCU4OSVFOSU5QSVCRSVFNSVCQSVBNiVFNSU5MiU4QyVFOSU5RCU5RSVFNSVCOCVCOCVFNSU5QiVCMCVFOSU5QSVCRSVFRiVCQyU4OSVFMyU4MCU4Mg==\">http://coderbyte.com/）：这个网站包含了可以用 JavaScript 解答的题目（简单、中等难度和非常困难）。</span></p>\n<p>Project Euler（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wcm9qZWN0ZXVsZXIubmV0LyVFRiVCQyU4OSVFRiVCQyU5QSVFOCVCRiU5OSVFNCVCOCVBQSVFNyVCRCU5MSVFNyVBQiU5OSVFNSU4QyU4NSVFNSU5MCVBQiVFNCVCQSU4NiVFNCVCOCU4MCVFNyVCMyVCQiVFNSU4OCU5NyVFNiU5NSVCMCVFNSVBRCVBNi8lRTglQUUlQTElRTclQUUlOTclRTYlOUMlQkElRTclOUElODQlRTclQkMlOTYlRTclQTglOEIlRTklQTIlOTglRTclOUIlQUUlRTMlODAlODIlRTQlQkQlQTAlRTYlODklODAlRTglQTYlODElRTUlODElOUElRTclOUElODQlRTUlQjAlQjElRTYlOTglQUYlRTglQkUlOTMlRTUlODUlQTUlRTklODIlQTMlRTQlQkElOUIlRTklQTIlOTglRTclOUIlQUUlRTclOUElODQlRTclQUQlOTQlRTYlQTElODglRUYlQkMlOEMlRTQlQjglOEQlRTglQkYlODclRTYlODglOTElRTQlQkIlQUMlRTUlOEYlQUYlRTQlQkIlQTUlRTclOTQlQTglRTclQUUlOTclRTYlQjMlOTUlRTYlOUQlQTUlRTYlODklQkUlRTUlODglQjAlRTYlQUQlQTMlRTclQTElQUUlRTclOUElODQlRTglQTclQTMlRTclQUQlOTQlRTMlODAlODI=\">https://projecteuler.net/）：这个网站包含了一系列数学 / 计算机的编程题目。你所要做的就是输入那些题目的答案，不过我们可以用算法来找到正确的解答。</span></p>\n<p>HackerRank（<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFja2VycmFuay5jb20=\">https://www.hackerrank.com</span>）：这个网站包含 16 个类别的挑战（可以应用本书中的算法和更多其他算法）。它也支持 JavaScript 和其他语言。</p>\n<p>CodeChef（<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jb2RlY2hlZi5jb20vJUVGJUJDJTg5JUVGJUJDJTlBJUU4JUJGJTk5JUU0JUI4JUFBJUU3JUJEJTkxJUU3JUFCJTk5JUU1JThDJTg1JUU1JTkwJUFCJUU0JUI4JTgwJUU0JUJBJTlCJUU5JUEyJTk4JUU3JTlCJUFFJUVGJUJDJThDJUU1JUI5JUI2JUU0JUJDJTlBJUU0JUI4JUJFJUU1JThBJTlFJUU1JTlDJUE4JUU3JUJBJUJGJUU2JUFGJTk0JUU4JUI1JTlCJUUzJTgwJTgy\">http://www.codechef.com/）：这个网站包含一些题目，并会举办在线比赛。</span></p>\n<p>Top Coder（<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy50b3Bjb2Rlci5jb20vJUVGJUJDJTg5JUVGJUJDJTlBJUU2JUFEJUE0JUU3JUJEJTkxJUU3JUFCJTk5JUU0JUJDJTlBJUU0JUI4JUJFJUU1JThBJTlFJUU3JUFFJTk3JUU2JUIzJTk1JUU4JTgxJTk0JUU4JUI1JTlCJUVGJUJDJThDJUU4JUJGJTk5JUU0JUJBJTlCJUU4JTgxJTk0JUU4JUI1JTlCJUU5JTgwJTlBJUU1JUI4JUI4JUU3JTk0JUIxTkFTQSVFMyU4MCU4MUdvb2dsZSVFMyU4MCU4MVlhaG9vISVFMyU4MCU4MUFtYXpvbiVFNSU5MiU4Q0ZhY2Vib29rJUU4JUJGJTk5JUU2JUEwJUI3JUU3JTlBJTg0JUU1JTg1JUFDJUU1JThGJUI4JUU4JUI1JTlFJUU1JThBJUE5JUUzJTgwJTgyJUU1JThGJTgyJUU1JThBJUEwJUU1JTg1JUI2JUU0JUI4JUFEJUU0JUI4JTgwJUU0JUJBJTlCJUU4JUI1JTlCJUU0JUJBJThCJUVGJUJDJThDJUU0JUJEJUEwJUU1JThGJUFGJUU0JUJCJUE1JUU4JThFJUI3JUU1JUJFJTk3JUU1JTg4JUIwJUU4JUI1JTlFJUU1JThBJUE5JUU1JTg1JUFDJUU1JThGJUI4JUU1JUI3JUE1JUU0JUJEJTlDJUU3JTlBJTg0JUU2JTlDJUJBJUU0JUJDJTlBJUVGJUJDJThDJUU4JTgwJThDJUU1JThGJTgyJUU0JUI4JThFJUU1JThGJUE2JUU0JUI4JTgwJUU0JUJBJTlCJUU4JUI1JTlCJUU0JUJBJThCJUU0JUJDJTlBJUU4JUI1JUEyJUU1JUJFJTk3JUU1JUE1JTk2JUU5JTg3JTkxJUUzJTgwJTgyJUU4JUJGJTk5JUU0JUI4JUFBJUU3JUJEJTkxJUU3JUFCJTk5JUU0JUI5JTlGJUU2JThGJTkwJUU0JUJFJTlCJUU1JUJFJTg4JUU2JUEzJTkyJUU3JTlBJTg0JUU4JUE3JUEzJUU5JUEyJTk4JUU1JTkyJThDJUU3JUFFJTk3JUU2JUIzJTk1JUU2JTk1JTk5JUU3JUE4JThCJUUzJTgwJTgy\">http://www.topcoder.com/）：此网站会举办算法联赛，这些联赛通常由 NASA、Google、Yahoo!、Amazon 和 Facebook 这样的公司赞助。参加其中一些赛事，你可以获得到赞助公司工作的机会，而参与另一些赛事会赢得奖金。这个网站也提供很棒的解题和算法教程。</span></p>\n<p>以上网站的另一个好处是，它们通常给出的是真实世界中的问题，而我们需要鉴别用哪一个算法解决它。通过这样的方式也能让我们明白本书中的算法并非局限于学术，而是能应用到现实问题上。</p>\n<p>如果你想从事技术工作，强烈推荐你创建一个免费的 GitHub 账号，你可以将上述网站的解答代码提交上去。如果你没有任何专业经验，GitHub 可以帮助你建立一个作品集，还会对你找到第一份工作有所帮助！</p>\n<p>15.3　小结</p>\n<p>本章介绍了大表示法，以及如何运用它计算算法的复杂度。还介绍了 NP 完全理论；如果你想进一步了解如何面对无解难题，以及如何用启发式算法得到一个近似满足的方案，这是你可以深入探索的一个领域。</p>\n<p>我们还列出了一些网站，你可以免费注册，并应用从本书中学到的知识，甚至可能得到第一份 IT 行业的工作！</p>\n<p>编程快乐！</p>\n",
            "tags": [
                "算法",
                "JS",
                "算法"
            ]
        }
    ]
}